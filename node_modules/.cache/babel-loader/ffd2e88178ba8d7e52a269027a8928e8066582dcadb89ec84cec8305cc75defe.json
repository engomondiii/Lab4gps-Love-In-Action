{"ast":null,"code":"import Cartesian4 from \"../Core/Cartesian4.js\";\nimport defined from \"../Core/defined.js\";\nimport destroyObject from \"../Core/destroyObject.js\";\nimport FramebufferManager from \"../Renderer/FramebufferManager.js\";\nimport RenderState from \"../Renderer/RenderState.js\";\n\n/**\n * @alias PickDepth\n * @constructor\n *\n * @private\n */\nfunction PickDepth() {\n  this._framebuffer = new FramebufferManager();\n  this._textureToCopy = undefined;\n  this._copyDepthCommand = undefined;\n}\nObject.defineProperties(PickDepth.prototype, {\n  framebuffer: {\n    get: function () {\n      return this._framebuffer.framebuffer;\n    }\n  }\n});\nfunction updateFramebuffers(pickDepth, context, depthTexture) {\n  const {\n    width,\n    height\n  } = depthTexture;\n  pickDepth._framebuffer.update(context, width, height);\n}\nfunction updateCopyCommands(pickDepth, context, depthTexture) {\n  if (!defined(pickDepth._copyDepthCommand)) {\n    pickDepth._copyDepthCommand = context.createViewportQuadCommand(`uniform highp sampler2D colorTexture;\n\nin vec2 v_textureCoordinates;\n\nvoid main()\n{\n  vec4 globeDepthPacked = texture(czm_globeDepthTexture, v_textureCoordinates);\n  float globeDepth = czm_unpackDepth(globeDepthPacked);\n  float depth = texture(colorTexture, v_textureCoordinates).r;\n  out_FragColor = czm_branchFreeTernary(globeDepth <= 0.0 || globeDepth >= 1.0 || depth < globeDepth && depth > 0.0 && depth < 1.0,\n    czm_packDepth(depth), globeDepthPacked);\n}\n`, {\n      renderState: RenderState.fromCache(),\n      uniformMap: {\n        colorTexture: function () {\n          return pickDepth._textureToCopy;\n        }\n      },\n      owner: pickDepth\n    });\n  }\n  pickDepth._textureToCopy = depthTexture;\n  pickDepth._copyDepthCommand.framebuffer = pickDepth.framebuffer;\n}\nPickDepth.prototype.update = function (context, depthTexture) {\n  updateFramebuffers(this, context, depthTexture);\n  updateCopyCommands(this, context, depthTexture);\n};\nconst scratchPackedDepth = new Cartesian4();\nconst packedDepthScale = new Cartesian4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);\n\n/**\n * Read the depth from the framebuffer at the given coordinate.\n *\n * @param {Context} context\n * @param {number} x The x-coordinate at which to read the depth.\n * @param {number} y The y-coordinate at which to read the depth.\n * @returns {number} The depth read from the framebuffer.\n *\n * @private\n */\nPickDepth.prototype.getDepth = function (context, x, y) {\n  // If this function is called before the framebuffer is created, the depth is undefined.\n  if (!defined(this.framebuffer)) {\n    return undefined;\n  }\n  const pixels = context.readPixels({\n    x: x,\n    y: y,\n    width: 1,\n    height: 1,\n    framebuffer: this.framebuffer\n  });\n  const packedDepth = Cartesian4.unpack(pixels, 0, scratchPackedDepth);\n  Cartesian4.divideByScalar(packedDepth, 255.0, packedDepth);\n  return Cartesian4.dot(packedDepth, packedDepthScale);\n};\nPickDepth.prototype.executeCopyDepth = function (context, passState) {\n  this._copyDepthCommand.execute(context, passState);\n};\nPickDepth.prototype.isDestroyed = function () {\n  return false;\n};\nPickDepth.prototype.destroy = function () {\n  this._framebuffer.destroy();\n  if (defined(this._copyDepthCommand)) {\n    this._copyDepthCommand.shaderProgram = defined(this._copyDepthCommand.shaderProgram) && this._copyDepthCommand.shaderProgram.destroy();\n  }\n  return destroyObject(this);\n};\nexport default PickDepth;","map":{"version":3,"names":["Cartesian4","defined","destroyObject","FramebufferManager","RenderState","PickDepth","_framebuffer","_textureToCopy","undefined","_copyDepthCommand","Object","defineProperties","prototype","framebuffer","get","updateFramebuffers","pickDepth","context","depthTexture","width","height","update","updateCopyCommands","createViewportQuadCommand","renderState","fromCache","uniformMap","colorTexture","owner","scratchPackedDepth","packedDepthScale","getDepth","x","y","pixels","readPixels","packedDepth","unpack","divideByScalar","dot","executeCopyDepth","passState","execute","isDestroyed","destroy","shaderProgram"],"sources":["/Users/mac/Desktop/IWL_Fresh_Start/Lab4gps-Love-In-Action/node_modules/@cesium/engine/Source/Scene/PickDepth.js"],"sourcesContent":["import Cartesian4 from \"../Core/Cartesian4.js\";\nimport defined from \"../Core/defined.js\";\nimport destroyObject from \"../Core/destroyObject.js\";\nimport FramebufferManager from \"../Renderer/FramebufferManager.js\";\nimport RenderState from \"../Renderer/RenderState.js\";\n\n/**\n * @alias PickDepth\n * @constructor\n *\n * @private\n */\nfunction PickDepth() {\n  this._framebuffer = new FramebufferManager();\n\n  this._textureToCopy = undefined;\n  this._copyDepthCommand = undefined;\n}\n\nObject.defineProperties(PickDepth.prototype, {\n  framebuffer: {\n    get: function () {\n      return this._framebuffer.framebuffer;\n    },\n  },\n});\n\nfunction updateFramebuffers(pickDepth, context, depthTexture) {\n  const { width, height } = depthTexture;\n  pickDepth._framebuffer.update(context, width, height);\n}\n\nfunction updateCopyCommands(pickDepth, context, depthTexture) {\n  if (!defined(pickDepth._copyDepthCommand)) {\n    pickDepth._copyDepthCommand = context.createViewportQuadCommand(\n      `uniform highp sampler2D colorTexture;\n\nin vec2 v_textureCoordinates;\n\nvoid main()\n{\n  vec4 globeDepthPacked = texture(czm_globeDepthTexture, v_textureCoordinates);\n  float globeDepth = czm_unpackDepth(globeDepthPacked);\n  float depth = texture(colorTexture, v_textureCoordinates).r;\n  out_FragColor = czm_branchFreeTernary(globeDepth <= 0.0 || globeDepth >= 1.0 || depth < globeDepth && depth > 0.0 && depth < 1.0,\n    czm_packDepth(depth), globeDepthPacked);\n}\n`,\n      {\n        renderState: RenderState.fromCache(),\n        uniformMap: {\n          colorTexture: function () {\n            return pickDepth._textureToCopy;\n          },\n        },\n        owner: pickDepth,\n      },\n    );\n  }\n\n  pickDepth._textureToCopy = depthTexture;\n  pickDepth._copyDepthCommand.framebuffer = pickDepth.framebuffer;\n}\n\nPickDepth.prototype.update = function (context, depthTexture) {\n  updateFramebuffers(this, context, depthTexture);\n  updateCopyCommands(this, context, depthTexture);\n};\n\nconst scratchPackedDepth = new Cartesian4();\nconst packedDepthScale = new Cartesian4(\n  1.0,\n  1.0 / 255.0,\n  1.0 / 65025.0,\n  1.0 / 16581375.0,\n);\n\n/**\n * Read the depth from the framebuffer at the given coordinate.\n *\n * @param {Context} context\n * @param {number} x The x-coordinate at which to read the depth.\n * @param {number} y The y-coordinate at which to read the depth.\n * @returns {number} The depth read from the framebuffer.\n *\n * @private\n */\nPickDepth.prototype.getDepth = function (context, x, y) {\n  // If this function is called before the framebuffer is created, the depth is undefined.\n  if (!defined(this.framebuffer)) {\n    return undefined;\n  }\n\n  const pixels = context.readPixels({\n    x: x,\n    y: y,\n    width: 1,\n    height: 1,\n    framebuffer: this.framebuffer,\n  });\n\n  const packedDepth = Cartesian4.unpack(pixels, 0, scratchPackedDepth);\n  Cartesian4.divideByScalar(packedDepth, 255.0, packedDepth);\n  return Cartesian4.dot(packedDepth, packedDepthScale);\n};\n\nPickDepth.prototype.executeCopyDepth = function (context, passState) {\n  this._copyDepthCommand.execute(context, passState);\n};\n\nPickDepth.prototype.isDestroyed = function () {\n  return false;\n};\n\nPickDepth.prototype.destroy = function () {\n  this._framebuffer.destroy();\n  if (defined(this._copyDepthCommand)) {\n    this._copyDepthCommand.shaderProgram =\n      defined(this._copyDepthCommand.shaderProgram) &&\n      this._copyDepthCommand.shaderProgram.destroy();\n  }\n\n  return destroyObject(this);\n};\nexport default PickDepth;\n"],"mappings":"AAAA,OAAOA,UAAU,MAAM,uBAAuB;AAC9C,OAAOC,OAAO,MAAM,oBAAoB;AACxC,OAAOC,aAAa,MAAM,0BAA0B;AACpD,OAAOC,kBAAkB,MAAM,mCAAmC;AAClE,OAAOC,WAAW,MAAM,4BAA4B;;AAEpD;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,SAASA,CAAA,EAAG;EACnB,IAAI,CAACC,YAAY,GAAG,IAAIH,kBAAkB,CAAC,CAAC;EAE5C,IAAI,CAACI,cAAc,GAAGC,SAAS;EAC/B,IAAI,CAACC,iBAAiB,GAAGD,SAAS;AACpC;AAEAE,MAAM,CAACC,gBAAgB,CAACN,SAAS,CAACO,SAAS,EAAE;EAC3CC,WAAW,EAAE;IACXC,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAACR,YAAY,CAACO,WAAW;IACtC;EACF;AACF,CAAC,CAAC;AAEF,SAASE,kBAAkBA,CAACC,SAAS,EAAEC,OAAO,EAAEC,YAAY,EAAE;EAC5D,MAAM;IAAEC,KAAK;IAAEC;EAAO,CAAC,GAAGF,YAAY;EACtCF,SAAS,CAACV,YAAY,CAACe,MAAM,CAACJ,OAAO,EAAEE,KAAK,EAAEC,MAAM,CAAC;AACvD;AAEA,SAASE,kBAAkBA,CAACN,SAAS,EAAEC,OAAO,EAAEC,YAAY,EAAE;EAC5D,IAAI,CAACjB,OAAO,CAACe,SAAS,CAACP,iBAAiB,CAAC,EAAE;IACzCO,SAAS,CAACP,iBAAiB,GAAGQ,OAAO,CAACM,yBAAyB,CAC7D;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,EACK;MACEC,WAAW,EAAEpB,WAAW,CAACqB,SAAS,CAAC,CAAC;MACpCC,UAAU,EAAE;QACVC,YAAY,EAAE,SAAAA,CAAA,EAAY;UACxB,OAAOX,SAAS,CAACT,cAAc;QACjC;MACF,CAAC;MACDqB,KAAK,EAAEZ;IACT,CACF,CAAC;EACH;EAEAA,SAAS,CAACT,cAAc,GAAGW,YAAY;EACvCF,SAAS,CAACP,iBAAiB,CAACI,WAAW,GAAGG,SAAS,CAACH,WAAW;AACjE;AAEAR,SAAS,CAACO,SAAS,CAACS,MAAM,GAAG,UAAUJ,OAAO,EAAEC,YAAY,EAAE;EAC5DH,kBAAkB,CAAC,IAAI,EAAEE,OAAO,EAAEC,YAAY,CAAC;EAC/CI,kBAAkB,CAAC,IAAI,EAAEL,OAAO,EAAEC,YAAY,CAAC;AACjD,CAAC;AAED,MAAMW,kBAAkB,GAAG,IAAI7B,UAAU,CAAC,CAAC;AAC3C,MAAM8B,gBAAgB,GAAG,IAAI9B,UAAU,CACrC,GAAG,EACH,GAAG,GAAG,KAAK,EACX,GAAG,GAAG,OAAO,EACb,GAAG,GAAG,UACR,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAK,SAAS,CAACO,SAAS,CAACmB,QAAQ,GAAG,UAAUd,OAAO,EAAEe,CAAC,EAAEC,CAAC,EAAE;EACtD;EACA,IAAI,CAAChC,OAAO,CAAC,IAAI,CAACY,WAAW,CAAC,EAAE;IAC9B,OAAOL,SAAS;EAClB;EAEA,MAAM0B,MAAM,GAAGjB,OAAO,CAACkB,UAAU,CAAC;IAChCH,CAAC,EAAEA,CAAC;IACJC,CAAC,EAAEA,CAAC;IACJd,KAAK,EAAE,CAAC;IACRC,MAAM,EAAE,CAAC;IACTP,WAAW,EAAE,IAAI,CAACA;EACpB,CAAC,CAAC;EAEF,MAAMuB,WAAW,GAAGpC,UAAU,CAACqC,MAAM,CAACH,MAAM,EAAE,CAAC,EAAEL,kBAAkB,CAAC;EACpE7B,UAAU,CAACsC,cAAc,CAACF,WAAW,EAAE,KAAK,EAAEA,WAAW,CAAC;EAC1D,OAAOpC,UAAU,CAACuC,GAAG,CAACH,WAAW,EAAEN,gBAAgB,CAAC;AACtD,CAAC;AAEDzB,SAAS,CAACO,SAAS,CAAC4B,gBAAgB,GAAG,UAAUvB,OAAO,EAAEwB,SAAS,EAAE;EACnE,IAAI,CAAChC,iBAAiB,CAACiC,OAAO,CAACzB,OAAO,EAAEwB,SAAS,CAAC;AACpD,CAAC;AAEDpC,SAAS,CAACO,SAAS,CAAC+B,WAAW,GAAG,YAAY;EAC5C,OAAO,KAAK;AACd,CAAC;AAEDtC,SAAS,CAACO,SAAS,CAACgC,OAAO,GAAG,YAAY;EACxC,IAAI,CAACtC,YAAY,CAACsC,OAAO,CAAC,CAAC;EAC3B,IAAI3C,OAAO,CAAC,IAAI,CAACQ,iBAAiB,CAAC,EAAE;IACnC,IAAI,CAACA,iBAAiB,CAACoC,aAAa,GAClC5C,OAAO,CAAC,IAAI,CAACQ,iBAAiB,CAACoC,aAAa,CAAC,IAC7C,IAAI,CAACpC,iBAAiB,CAACoC,aAAa,CAACD,OAAO,CAAC,CAAC;EAClD;EAEA,OAAO1C,aAAa,CAAC,IAAI,CAAC;AAC5B,CAAC;AACD,eAAeG,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import BoundingRectangle from \"../Core/BoundingRectangle.js\";\nimport Color from \"../Core/Color.js\";\nimport defined from \"../Core/defined.js\";\nimport destroyObject from \"../Core/destroyObject.js\";\nimport ClearCommand from \"../Renderer/ClearCommand.js\";\nimport FramebufferManager from \"../Renderer/FramebufferManager.js\";\nimport PixelDatatype from \"../Renderer/PixelDatatype.js\";\nimport RenderState from \"../Renderer/RenderState.js\";\nimport PassThroughDepth from \"../Shaders/PostProcessStages/PassThroughDepth.js\";\n\n/**\n * @private\n */\nfunction GlobeTranslucencyFramebuffer() {\n  this._framebuffer = new FramebufferManager({\n    depthStencil: true,\n    supportsDepthTexture: true\n  });\n  this._packedDepthFramebuffer = new FramebufferManager();\n  this._renderState = undefined;\n  this._packedDepthCommand = undefined;\n  this._clearCommand = undefined;\n  this._viewport = new BoundingRectangle();\n  this._useScissorTest = false;\n  this._scissorRectangle = undefined;\n  this._useHdr = undefined;\n}\nObject.defineProperties(GlobeTranslucencyFramebuffer.prototype, {\n  // Exposed for testing\n  classificationTexture: {\n    get: function () {\n      return this._framebuffer.getColorTexture();\n    }\n  },\n  classificationFramebuffer: {\n    get: function () {\n      return this._framebuffer.framebuffer;\n    }\n  },\n  // Exposed for testing\n  packedDepthFramebuffer: {\n    get: function () {\n      return this._packedDepthFramebuffer.framebuffer;\n    }\n  },\n  depthStencilTexture: {\n    get: function () {\n      return this._framebuffer.getDepthStencilTexture();\n    }\n  },\n  // Exposed for testing\n  depthStencilRenderbuffer: {\n    get: function () {\n      return this._framebuffer.getDepthStencilRenderbuffer();\n    }\n  },\n  packedDepthTexture: {\n    get: function () {\n      return this._packedDepthFramebuffer.getColorTexture();\n    }\n  }\n});\nfunction destroyResources(globeTranslucency) {\n  globeTranslucency._framebuffer.destroy();\n  globeTranslucency._packedDepthFramebuffer.destroy();\n}\nfunction updateResources(globeTranslucency, context, width, height, hdr) {\n  const pixelDatatype = hdr ? context.halfFloatingPointTexture ? PixelDatatype.HALF_FLOAT : PixelDatatype.FLOAT : PixelDatatype.UNSIGNED_BYTE;\n  globeTranslucency._framebuffer.update(context, width, height, 1, pixelDatatype);\n  globeTranslucency._packedDepthFramebuffer.update(context, width, height);\n}\nfunction updateCommands(globeTranslucency, context, width, height, passState) {\n  globeTranslucency._viewport.width = width;\n  globeTranslucency._viewport.height = height;\n  const useScissorTest = !BoundingRectangle.equals(globeTranslucency._viewport, passState.viewport);\n  let updateScissor = useScissorTest !== globeTranslucency._useScissorTest;\n  globeTranslucency._useScissorTest = useScissorTest;\n  if (!BoundingRectangle.equals(globeTranslucency._scissorRectangle, passState.viewport)) {\n    globeTranslucency._scissorRectangle = BoundingRectangle.clone(passState.viewport, globeTranslucency._scissorRectangle);\n    updateScissor = true;\n  }\n  if (!defined(globeTranslucency._renderState) || !BoundingRectangle.equals(globeTranslucency._viewport, globeTranslucency._renderState.viewport) || updateScissor) {\n    globeTranslucency._renderState = RenderState.fromCache({\n      viewport: globeTranslucency._viewport,\n      scissorTest: {\n        enabled: globeTranslucency._useScissorTest,\n        rectangle: globeTranslucency._scissorRectangle\n      }\n    });\n  }\n  if (!defined(globeTranslucency._packedDepthCommand)) {\n    globeTranslucency._packedDepthCommand = context.createViewportQuadCommand(PassThroughDepth, {\n      uniformMap: {\n        u_depthTexture: function () {\n          return globeTranslucency.depthStencilTexture;\n        }\n      },\n      owner: globeTranslucency\n    });\n  }\n  if (!defined(globeTranslucency._clearCommand)) {\n    globeTranslucency._clearCommand = new ClearCommand({\n      color: new Color(0.0, 0.0, 0.0, 0.0),\n      depth: 1.0,\n      stencil: 0.0,\n      owner: globeTranslucency\n    });\n  }\n  globeTranslucency._packedDepthCommand.framebuffer = globeTranslucency._packedDepthFramebuffer.framebuffer;\n  globeTranslucency._packedDepthCommand.renderState = globeTranslucency._renderState;\n  globeTranslucency._clearCommand.framebuffer = globeTranslucency.classificationFramebuffer;\n  globeTranslucency._clearCommand.renderState = globeTranslucency._renderState;\n}\nGlobeTranslucencyFramebuffer.prototype.updateAndClear = function (hdr, viewport, context, passState) {\n  const width = viewport.width;\n  const height = viewport.height;\n  updateResources(this, context, width, height, hdr);\n  updateCommands(this, context, width, height, passState);\n  this._useHdr = hdr;\n};\nGlobeTranslucencyFramebuffer.prototype.clearClassification = function (context, passState) {\n  this._clearCommand.execute(context, passState);\n};\nGlobeTranslucencyFramebuffer.prototype.packDepth = function (context, passState) {\n  this._packedDepthCommand.execute(context, passState);\n  return this.packedDepthTexture;\n};\nGlobeTranslucencyFramebuffer.prototype.isDestroyed = function () {\n  return false;\n};\nGlobeTranslucencyFramebuffer.prototype.destroy = function () {\n  destroyResources(this);\n  return destroyObject(this);\n};\nexport default GlobeTranslucencyFramebuffer;","map":{"version":3,"names":["BoundingRectangle","Color","defined","destroyObject","ClearCommand","FramebufferManager","PixelDatatype","RenderState","PassThroughDepth","GlobeTranslucencyFramebuffer","_framebuffer","depthStencil","supportsDepthTexture","_packedDepthFramebuffer","_renderState","undefined","_packedDepthCommand","_clearCommand","_viewport","_useScissorTest","_scissorRectangle","_useHdr","Object","defineProperties","prototype","classificationTexture","get","getColorTexture","classificationFramebuffer","framebuffer","packedDepthFramebuffer","depthStencilTexture","getDepthStencilTexture","depthStencilRenderbuffer","getDepthStencilRenderbuffer","packedDepthTexture","destroyResources","globeTranslucency","destroy","updateResources","context","width","height","hdr","pixelDatatype","halfFloatingPointTexture","HALF_FLOAT","FLOAT","UNSIGNED_BYTE","update","updateCommands","passState","useScissorTest","equals","viewport","updateScissor","clone","fromCache","scissorTest","enabled","rectangle","createViewportQuadCommand","uniformMap","u_depthTexture","owner","color","depth","stencil","renderState","updateAndClear","clearClassification","execute","packDepth","isDestroyed"],"sources":["/Users/mac/Desktop/IWL_Fresh_Start/Lab4gps-Love-In-Action/node_modules/@cesium/engine/Source/Scene/GlobeTranslucencyFramebuffer.js"],"sourcesContent":["import BoundingRectangle from \"../Core/BoundingRectangle.js\";\nimport Color from \"../Core/Color.js\";\nimport defined from \"../Core/defined.js\";\nimport destroyObject from \"../Core/destroyObject.js\";\nimport ClearCommand from \"../Renderer/ClearCommand.js\";\nimport FramebufferManager from \"../Renderer/FramebufferManager.js\";\nimport PixelDatatype from \"../Renderer/PixelDatatype.js\";\nimport RenderState from \"../Renderer/RenderState.js\";\nimport PassThroughDepth from \"../Shaders/PostProcessStages/PassThroughDepth.js\";\n\n/**\n * @private\n */\nfunction GlobeTranslucencyFramebuffer() {\n  this._framebuffer = new FramebufferManager({\n    depthStencil: true,\n    supportsDepthTexture: true,\n  });\n  this._packedDepthFramebuffer = new FramebufferManager();\n\n  this._renderState = undefined;\n\n  this._packedDepthCommand = undefined;\n  this._clearCommand = undefined;\n\n  this._viewport = new BoundingRectangle();\n  this._useScissorTest = false;\n  this._scissorRectangle = undefined;\n  this._useHdr = undefined;\n}\n\nObject.defineProperties(GlobeTranslucencyFramebuffer.prototype, {\n  // Exposed for testing\n  classificationTexture: {\n    get: function () {\n      return this._framebuffer.getColorTexture();\n    },\n  },\n  classificationFramebuffer: {\n    get: function () {\n      return this._framebuffer.framebuffer;\n    },\n  },\n  // Exposed for testing\n  packedDepthFramebuffer: {\n    get: function () {\n      return this._packedDepthFramebuffer.framebuffer;\n    },\n  },\n  depthStencilTexture: {\n    get: function () {\n      return this._framebuffer.getDepthStencilTexture();\n    },\n  },\n  // Exposed for testing\n  depthStencilRenderbuffer: {\n    get: function () {\n      return this._framebuffer.getDepthStencilRenderbuffer();\n    },\n  },\n  packedDepthTexture: {\n    get: function () {\n      return this._packedDepthFramebuffer.getColorTexture();\n    },\n  },\n});\n\nfunction destroyResources(globeTranslucency) {\n  globeTranslucency._framebuffer.destroy();\n  globeTranslucency._packedDepthFramebuffer.destroy();\n}\n\nfunction updateResources(globeTranslucency, context, width, height, hdr) {\n  const pixelDatatype = hdr\n    ? context.halfFloatingPointTexture\n      ? PixelDatatype.HALF_FLOAT\n      : PixelDatatype.FLOAT\n    : PixelDatatype.UNSIGNED_BYTE;\n  globeTranslucency._framebuffer.update(\n    context,\n    width,\n    height,\n    1,\n    pixelDatatype,\n  );\n  globeTranslucency._packedDepthFramebuffer.update(context, width, height);\n}\n\nfunction updateCommands(globeTranslucency, context, width, height, passState) {\n  globeTranslucency._viewport.width = width;\n  globeTranslucency._viewport.height = height;\n\n  const useScissorTest = !BoundingRectangle.equals(\n    globeTranslucency._viewport,\n    passState.viewport,\n  );\n  let updateScissor = useScissorTest !== globeTranslucency._useScissorTest;\n  globeTranslucency._useScissorTest = useScissorTest;\n\n  if (\n    !BoundingRectangle.equals(\n      globeTranslucency._scissorRectangle,\n      passState.viewport,\n    )\n  ) {\n    globeTranslucency._scissorRectangle = BoundingRectangle.clone(\n      passState.viewport,\n      globeTranslucency._scissorRectangle,\n    );\n    updateScissor = true;\n  }\n\n  if (\n    !defined(globeTranslucency._renderState) ||\n    !BoundingRectangle.equals(\n      globeTranslucency._viewport,\n      globeTranslucency._renderState.viewport,\n    ) ||\n    updateScissor\n  ) {\n    globeTranslucency._renderState = RenderState.fromCache({\n      viewport: globeTranslucency._viewport,\n      scissorTest: {\n        enabled: globeTranslucency._useScissorTest,\n        rectangle: globeTranslucency._scissorRectangle,\n      },\n    });\n  }\n\n  if (!defined(globeTranslucency._packedDepthCommand)) {\n    globeTranslucency._packedDepthCommand = context.createViewportQuadCommand(\n      PassThroughDepth,\n      {\n        uniformMap: {\n          u_depthTexture: function () {\n            return globeTranslucency.depthStencilTexture;\n          },\n        },\n        owner: globeTranslucency,\n      },\n    );\n  }\n\n  if (!defined(globeTranslucency._clearCommand)) {\n    globeTranslucency._clearCommand = new ClearCommand({\n      color: new Color(0.0, 0.0, 0.0, 0.0),\n      depth: 1.0,\n      stencil: 0.0,\n      owner: globeTranslucency,\n    });\n  }\n\n  globeTranslucency._packedDepthCommand.framebuffer =\n    globeTranslucency._packedDepthFramebuffer.framebuffer;\n  globeTranslucency._packedDepthCommand.renderState =\n    globeTranslucency._renderState;\n  globeTranslucency._clearCommand.framebuffer =\n    globeTranslucency.classificationFramebuffer;\n  globeTranslucency._clearCommand.renderState = globeTranslucency._renderState;\n}\n\nGlobeTranslucencyFramebuffer.prototype.updateAndClear = function (\n  hdr,\n  viewport,\n  context,\n  passState,\n) {\n  const width = viewport.width;\n  const height = viewport.height;\n\n  updateResources(this, context, width, height, hdr);\n  updateCommands(this, context, width, height, passState);\n\n  this._useHdr = hdr;\n};\n\nGlobeTranslucencyFramebuffer.prototype.clearClassification = function (\n  context,\n  passState,\n) {\n  this._clearCommand.execute(context, passState);\n};\n\nGlobeTranslucencyFramebuffer.prototype.packDepth = function (\n  context,\n  passState,\n) {\n  this._packedDepthCommand.execute(context, passState);\n  return this.packedDepthTexture;\n};\n\nGlobeTranslucencyFramebuffer.prototype.isDestroyed = function () {\n  return false;\n};\n\nGlobeTranslucencyFramebuffer.prototype.destroy = function () {\n  destroyResources(this);\n  return destroyObject(this);\n};\n\nexport default GlobeTranslucencyFramebuffer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import ApproximateTerrainHeights from \"../Core/ApproximateTerrainHeights.js\";\nimport BoundingSphere from \"../Core/BoundingSphere.js\";\nimport Cartesian2 from \"../Core/Cartesian2.js\";\nimport Cartesian3 from \"../Core/Cartesian3.js\";\nimport Cartographic from \"../Core/Cartographic.js\";\nimport Check from \"../Core/Check.js\";\nimport clone from \"../Core/clone.js\";\nimport Color from \"../Core/Color.js\";\nimport Credit from \"../Core/Credit.js\";\nimport defaultValue from \"../Core/defaultValue.js\";\nimport defined from \"../Core/defined.js\";\nimport deprecationWarning from \"../Core/deprecationWarning.js\";\nimport destroyObject from \"../Core/destroyObject.js\";\nimport Ellipsoid from \"../Core/Ellipsoid.js\";\nimport Event from \"../Core/Event.js\";\nimport ImageBasedLighting from \"./ImageBasedLighting.js\";\nimport Interval from \"../Core/Interval.js\";\nimport IntersectionTests from \"../Core/IntersectionTests.js\";\nimport IonResource from \"../Core/IonResource.js\";\nimport JulianDate from \"../Core/JulianDate.js\";\nimport ManagedArray from \"../Core/ManagedArray.js\";\nimport CesiumMath from \"../Core/Math.js\";\nimport Matrix3 from \"../Core/Matrix3.js\";\nimport Matrix4 from \"../Core/Matrix4.js\";\nimport Resource from \"../Core/Resource.js\";\nimport RuntimeError from \"../Core/RuntimeError.js\";\nimport Transforms from \"../Core/Transforms.js\";\nimport ClearCommand from \"../Renderer/ClearCommand.js\";\nimport Pass from \"../Renderer/Pass.js\";\nimport RenderState from \"../Renderer/RenderState.js\";\nimport Axis from \"./Axis.js\";\nimport Cesium3DTile from \"./Cesium3DTile.js\";\nimport Cesium3DTileColorBlendMode from \"./Cesium3DTileColorBlendMode.js\";\nimport Cesium3DTileContentState from \"./Cesium3DTileContentState.js\";\nimport Cesium3DTilesetMetadata from \"./Cesium3DTilesetMetadata.js\";\nimport Cesium3DTileOptimizations from \"./Cesium3DTileOptimizations.js\";\nimport Cesium3DTilePass from \"./Cesium3DTilePass.js\";\nimport Cesium3DTileRefine from \"./Cesium3DTileRefine.js\";\nimport Cesium3DTilesetCache from \"./Cesium3DTilesetCache.js\";\nimport Cesium3DTilesetHeatmap from \"./Cesium3DTilesetHeatmap.js\";\nimport Cesium3DTilesetStatistics from \"./Cesium3DTilesetStatistics.js\";\nimport Cesium3DTileStyleEngine from \"./Cesium3DTileStyleEngine.js\";\nimport ClippingPlaneCollection from \"./ClippingPlaneCollection.js\";\nimport ClippingPolygonCollection from \"./ClippingPolygonCollection.js\";\nimport hasExtension from \"./hasExtension.js\";\nimport ImplicitTileset from \"./ImplicitTileset.js\";\nimport ImplicitTileCoordinates from \"./ImplicitTileCoordinates.js\";\nimport LabelCollection from \"./LabelCollection.js\";\nimport oneTimeWarning from \"../Core/oneTimeWarning.js\";\nimport PointCloudEyeDomeLighting from \"./PointCloudEyeDomeLighting.js\";\nimport PointCloudShading from \"./PointCloudShading.js\";\nimport ResourceCache from \"./ResourceCache.js\";\nimport SceneMode from \"./SceneMode.js\";\nimport ShadowMode from \"./ShadowMode.js\";\nimport SplitDirection from \"./SplitDirection.js\";\nimport StencilConstants from \"./StencilConstants.js\";\nimport TileBoundingRegion from \"./TileBoundingRegion.js\";\nimport TileBoundingSphere from \"./TileBoundingSphere.js\";\nimport TileOrientedBoundingBox from \"./TileOrientedBoundingBox.js\";\nimport Cesium3DTilesetMostDetailedTraversal from \"./Cesium3DTilesetMostDetailedTraversal.js\";\nimport Cesium3DTilesetBaseTraversal from \"./Cesium3DTilesetBaseTraversal.js\";\nimport Cesium3DTilesetSkipTraversal from \"./Cesium3DTilesetSkipTraversal.js\";\nimport Ray from \"../Core/Ray.js\";\nimport DynamicEnvironmentMapManager from \"./DynamicEnvironmentMapManager.js\";\n\n/**\n * @typedef {Object} Cesium3DTileset.ConstructorOptions\n *\n * Initialization options for the Cesium3DTileset constructor\n *\n * @property {boolean} [show=true] Determines if the tileset will be shown.\n * @property {Matrix4} [modelMatrix=Matrix4.IDENTITY] A 4x4 transformation matrix that transforms the tileset's root tile.\n * @property {Axis} [modelUpAxis=Axis.Y] Which axis is considered up when loading models for tile contents.\n * @property {Axis} [modelForwardAxis=Axis.X] Which axis is considered forward when loading models for tile contents.\n * @property {ShadowMode} [shadows=ShadowMode.ENABLED] Determines whether the tileset casts or receives shadows from light sources.\n * @property {number} [maximumScreenSpaceError=16] The maximum screen space error used to drive level of detail refinement.\n * @property {number} [cacheBytes=536870912] The size (in bytes) to which the tile cache will be trimmed, if the cache contains tiles not needed for the current view.\n * @property {number} [maximumCacheOverflowBytes=536870912] The maximum additional memory (in bytes) to allow for cache headroom, if more than {@link Cesium3DTileset#cacheBytes} are needed for the current view.\n * @property {boolean} [cullWithChildrenBounds=true] Optimization option. Whether to cull tiles using the union of their children bounding volumes.\n * @property {boolean} [cullRequestsWhileMoving=true] Optimization option. Don't request tiles that will likely be unused when they come back because of the camera's movement. This optimization only applies to stationary tilesets.\n * @property {number} [cullRequestsWhileMovingMultiplier=60.0] Optimization option. Multiplier used in culling requests while moving. Larger is more aggressive culling, smaller less aggressive culling.\n * @property {boolean} [preloadWhenHidden=false] Preload tiles when <code>tileset.show</code> is <code>false</code>. Loads tiles as if the tileset is visible but does not render them.\n * @property {boolean} [preloadFlightDestinations=true] Optimization option. Preload tiles at the camera's flight destination while the camera is in flight.\n * @property {boolean} [preferLeaves=false] Optimization option. Prefer loading of leaves first.\n * @property {boolean} [dynamicScreenSpaceError=true] Optimization option. For street-level horizon views, use lower resolution tiles far from the camera. This reduces the amount of data loaded and improves tileset loading time with a slight drop in visual quality in the distance.\n * @property {number} [dynamicScreenSpaceErrorDensity=2.0e-4] Similar to {@link Fog#density}, this option controls the camera distance at which the {@link Cesium3DTileset#dynamicScreenSpaceError} optimization applies. Larger values will cause tiles closer to the camera to be affected.\n * @property {number} [dynamicScreenSpaceErrorFactor=24.0] A parameter that controls the intensity of the {@link Cesium3DTileset#dynamicScreenSpaceError} optimization for tiles on the horizon. Larger values cause lower resolution tiles to load, improving runtime performance at a slight reduction of visual quality.\n * @property {number} [dynamicScreenSpaceErrorHeightFalloff=0.25] A ratio of the tileset's height that determines where \"street level\" camera views occur. When the camera is below this height, the {@link Cesium3DTileset#dynamicScreenSpaceError} optimization will have the maximum effect, and it will roll off above this value.\n * @property {number} [progressiveResolutionHeightFraction=0.3] Optimization option. If between (0.0, 0.5], tiles at or above the screen space error for the reduced screen resolution of <code>progressiveResolutionHeightFraction*screenHeight</code> will be prioritized first. This can help get a quick layer of tiles down while full resolution tiles continue to load.\n * @property {boolean} [foveatedScreenSpaceError=true] Optimization option. Prioritize loading tiles in the center of the screen by temporarily raising the screen space error for tiles around the edge of the screen. Screen space error returns to normal once all the tiles in the center of the screen as determined by the {@link Cesium3DTileset#foveatedConeSize} are loaded.\n * @property {number} [foveatedConeSize=0.1] Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control the cone size that determines which tiles are deferred. Tiles that are inside this cone are loaded immediately. Tiles outside the cone are potentially deferred based on how far outside the cone they are and their screen space error. This is controlled by {@link Cesium3DTileset#foveatedInterpolationCallback} and {@link Cesium3DTileset#foveatedMinimumScreenSpaceErrorRelaxation}. Setting this to 0.0 means the cone will be the line formed by the camera position and its view direction. Setting this to 1.0 means the cone encompasses the entire field of view of the camera, disabling the effect.\n * @property {number} [foveatedMinimumScreenSpaceErrorRelaxation=0.0] Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control the starting screen space error relaxation for tiles outside the foveated cone. The screen space error will be raised starting with tileset value up to {@link Cesium3DTileset#maximumScreenSpaceError} based on the provided {@link Cesium3DTileset#foveatedInterpolationCallback}.\n * @property {Cesium3DTileset.foveatedInterpolationCallback} [foveatedInterpolationCallback=Math.lerp] Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control how much to raise the screen space error for tiles outside the foveated cone, interpolating between {@link Cesium3DTileset#foveatedMinimumScreenSpaceErrorRelaxation} and {@link Cesium3DTileset#maximumScreenSpaceError}\n * @property {number} [foveatedTimeDelay=0.2] Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control how long in seconds to wait after the camera stops moving before deferred tiles start loading in. This time delay prevents requesting tiles around the edges of the screen when the camera is moving. Setting this to 0.0 will immediately request all tiles in any given view.\n * @property {boolean} [skipLevelOfDetail=false] Optimization option. Determines if level of detail skipping should be applied during the traversal.\n * @property {number} [baseScreenSpaceError=1024] When <code>skipLevelOfDetail</code> is <code>true</code>, the screen space error that must be reached before skipping levels of detail.\n * @property {number} [skipScreenSpaceErrorFactor=16] When <code>skipLevelOfDetail</code> is <code>true</code>, a multiplier defining the minimum screen space error to skip. Used in conjunction with <code>skipLevels</code> to determine which tiles to load.\n * @property {number} [skipLevels=1] When <code>skipLevelOfDetail</code> is <code>true</code>, a constant defining the minimum number of levels to skip when loading tiles. When it is 0, no levels are skipped. Used in conjunction with <code>skipScreenSpaceErrorFactor</code> to determine which tiles to load.\n * @property {boolean} [immediatelyLoadDesiredLevelOfDetail=false] When <code>skipLevelOfDetail</code> is <code>true</code>, only tiles that meet the maximum screen space error will ever be downloaded. Skipping factors are ignored and just the desired tiles are loaded.\n * @property {boolean} [loadSiblings=false] When <code>skipLevelOfDetail</code> is <code>true</code>, determines whether siblings of visible tiles are always downloaded during traversal.\n * @property {ClippingPlaneCollection} [clippingPlanes] The {@link ClippingPlaneCollection} used to selectively disable rendering the tileset.\n * @property {ClippingPolygonCollection} [clippingPolygons] The {@link ClippingPolygonCollection} used to selectively disable rendering the tileset.\n * @property {ClassificationType} [classificationType] Determines whether terrain, 3D Tiles or both will be classified by this tileset. See {@link Cesium3DTileset#classificationType} for details about restrictions and limitations.\n * @property {Ellipsoid} [ellipsoid=Ellipsoid.WGS84] The ellipsoid determining the size and shape of the globe.\n * @property {object} [pointCloudShading] Options for constructing a {@link PointCloudShading} object to control point attenuation based on geometric error and lighting.\n * @property {Cartesian3} [lightColor] The light color when shading models. When <code>undefined</code> the scene's light color is used instead.\n * @property {ImageBasedLighting} [imageBasedLighting] The properties for managing image-based lighting for this tileset.\n * @param {DynamicEnvironmentMapManager.ConstructorOptions} [options.environmentMapOptions] The properties for managing dynamic environment maps on this model.\n * @property {boolean} [backFaceCulling=true] Whether to cull back-facing geometry. When true, back face culling is determined by the glTF material's doubleSided property; when false, back face culling is disabled.\n * @property {boolean} [enableShowOutline=true] Whether to enable outlines for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. This can be set to false to avoid the additional processing of geometry at load time. When false, the showOutlines and outlineColor options are ignored.\n * @property {boolean} [showOutline=true] Whether to display the outline for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. When true, outlines are displayed. When false, outlines are not displayed.\n * @property {Color} [outlineColor=Color.BLACK] The color to use when rendering outlines.\n * @property {boolean} [vectorClassificationOnly=false] Indicates that only the tileset's vector tiles should be used for classification.\n * @property {boolean} [vectorKeepDecodedPositions=false] Whether vector tiles should keep decoded positions in memory. This is used with {@link Cesium3DTileFeature.getPolylinePositions}.\n * @property {string|number} [featureIdLabel=\"featureId_0\"] Label of the feature ID set to use for picking and styling. For EXT_mesh_features, this is the feature ID's label property, or \"featureId_N\" (where N is the index in the featureIds array) when not specified. EXT_feature_metadata did not have a label field, so such feature ID sets are always labeled \"featureId_N\" where N is the index in the list of all feature Ids, where feature ID attributes are listed before feature ID textures. If featureIdLabel is an integer N, it is converted to the string \"featureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @property {string|number} [instanceFeatureIdLabel=\"instanceFeatureId_0\"] Label of the instance feature ID set used for picking and styling. If instanceFeatureIdLabel is set to an integer N, it is converted to the string \"instanceFeatureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @property {boolean} [showCreditsOnScreen=false] Whether to display the credits of this tileset on screen.\n * @property {SplitDirection} [splitDirection=SplitDirection.NONE] The {@link SplitDirection} split to apply to this tileset.\n * @property {boolean} [enableCollision=false] When <code>true</code>, enables collisions for camera or CPU picking. While this is <code>true</code> the camera will be prevented from going below the tileset surface if {@link ScreenSpaceCameraController#enableCollisionDetection} is true.\n * @property {boolean} [projectTo2D=false] Whether to accurately project the tileset to 2D. If this is true, the tileset will be projected accurately to 2D, but it will use more memory to do so. If this is false, the tileset will use less memory and will still render in 2D / CV mode, but its projected positions may be inaccurate. This cannot be set after the tileset has been created.\n * @property {boolean} [enablePick=false] Whether to allow collision and CPU picking with <code>pick</code> when using WebGL 1. If using WebGL 2 or above, this option will be ignored. If using WebGL 1 and this is true, the <code>pick</code> operation will work correctly, but it will use more memory to do so. If running with WebGL 1 and this is false, the model will use less memory, but <code>pick</code> will always return <code>undefined</code>. This cannot be set after the tileset has loaded.\n * @property {string} [debugHeatmapTilePropertyName] The tile variable to colorize as a heatmap. All rendered tiles will be colorized relative to each other's specified variable value.\n * @property {boolean} [debugFreezeFrame=false] For debugging only. Determines if only the tiles from last frame should be used for rendering.\n * @property {boolean} [debugColorizeTiles=false] For debugging only. When true, assigns a random color to each tile.\n * @property {boolean} [enableDebugWireframe=false] For debugging only. This must be true for debugWireframe to work in WebGL1. This cannot be set after the tileset has been created.\n * @property {boolean} [debugWireframe=false] For debugging only. When true, render's each tile's content as a wireframe.\n * @property {boolean} [debugShowBoundingVolume=false] For debugging only. When true, renders the bounding volume for each tile.\n * @property {boolean} [debugShowContentBoundingVolume=false] For debugging only. When true, renders the bounding volume for each tile's content.\n * @property {boolean} [debugShowViewerRequestVolume=false] For debugging only. When true, renders the viewer request volume for each tile.\n * @property {boolean} [debugShowGeometricError=false] For debugging only. When true, draws labels to indicate the geometric error of each tile.\n * @property {boolean} [debugShowRenderingStatistics=false] For debugging only. When true, draws labels to indicate the number of commands, points, triangles and features for each tile.\n * @property {boolean} [debugShowMemoryUsage=false] For debugging only. When true, draws labels to indicate the texture and geometry memory in megabytes used by each tile.\n * @property {boolean} [debugShowUrl=false] For debugging only. When true, draws labels to indicate the url of each tile.\n */\n\n/**\n * A {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification|3D Tiles tileset},\n * used for streaming massive heterogeneous 3D geospatial datasets.\n *\n * <div class=\"notice\">\n * This object is normally not instantiated directly, use {@link Cesium3DTileset.fromUrl}.\n * </div>\n *\n * @alias Cesium3DTileset\n * @constructor\n *\n * @param {Cesium3DTileset.ConstructorOptions} options An object describing initialization options\n *\n * @exception {DeveloperError} The tileset must be 3D Tiles version 0.0 or 1.0.\n *\n * @example\n * try {\n *   const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *      \"http://localhost:8002/tilesets/Seattle/tileset.json\"\n *   );\n *   scene.primitives.add(tileset);\n * } catch (error) {\n *   console.error(`Error creating tileset: ${error}`);\n * }\n *\n * @example\n * // Turn on camera collisions with the tileset.\n * try {\n *   const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *      \"http://localhost:8002/tilesets/Seattle/tileset.json\",\n *      { enableCollision: true }\n *   );\n *   scene.primitives.add(tileset);\n * } catch (error) {\n *   console.error(`Error creating tileset: ${error}`);\n * }\n *\n * @example\n * // Common setting for the skipLevelOfDetail optimization\n * const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *   \"http://localhost:8002/tilesets/Seattle/tileset.json\", {\n *      skipLevelOfDetail: true,\n *      baseScreenSpaceError: 1024,\n *      skipScreenSpaceErrorFactor: 16,\n *      skipLevels: 1,\n *      immediatelyLoadDesiredLevelOfDetail: false,\n *      loadSiblings: false,\n *      cullWithChildrenBounds: true\n * });\n * scene.primitives.add(tileset);\n *\n * @example\n * // Common settings for the dynamicScreenSpaceError optimization\n * const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *   \"http://localhost:8002/tilesets/Seattle/tileset.json\", {\n *      dynamicScreenSpaceError: true,\n *      dynamicScreenSpaceErrorDensity: 2.0e-4,\n *      dynamicScreenSpaceErrorFactor: 24.0,\n *      dynamicScreenSpaceErrorHeightFalloff: 0.25\n * });\n * scene.primitives.add(tileset);\n *\n * @see {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification|3D Tiles specification}\n */\nfunction Cesium3DTileset(options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n  this._url = undefined;\n  this._basePath = undefined;\n  this._root = undefined;\n  this._resource = undefined;\n  this._asset = undefined; // Metadata for the entire tileset\n  this._properties = undefined; // Metadata for per-model/point/etc properties\n  this._geometricError = undefined; // Geometric error when the tree is not rendered at all\n  this._scaledGeometricError = undefined; // Geometric error scaled by root tile scale\n  this._extensionsUsed = undefined;\n  this._extensions = undefined;\n  this._modelUpAxis = undefined;\n  this._modelForwardAxis = undefined;\n  this._cache = new Cesium3DTilesetCache();\n  this._processingQueue = [];\n  this._selectedTiles = [];\n  this._emptyTiles = [];\n  this._requestedTiles = [];\n  this._selectedTilesToStyle = [];\n  this._loadTimestamp = undefined;\n  this._timeSinceLoad = 0.0;\n  this._updatedVisibilityFrame = 0;\n  this._updatedModelMatrixFrame = 0;\n  this._modelMatrixChanged = false;\n  this._previousModelMatrix = undefined;\n  this._extras = undefined;\n  this._credits = undefined;\n  this._showCreditsOnScreen = defaultValue(options.showCreditsOnScreen, false);\n  this._cullWithChildrenBounds = defaultValue(options.cullWithChildrenBounds, true);\n  this._allTilesAdditive = true;\n  this._hasMixedContent = false;\n  this._stencilClearCommand = undefined;\n  this._backfaceCommands = new ManagedArray();\n  this._maximumScreenSpaceError = defaultValue(options.maximumScreenSpaceError, 16);\n  this._memoryAdjustedScreenSpaceError = this._maximumScreenSpaceError;\n  this._cacheBytes = defaultValue(options.cacheBytes, 512 * 1024 * 1024);\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.number.greaterThanOrEquals(\"cacheBytes\", this._cacheBytes, 0);\n  //>>includeEnd('debug');\n\n  const maximumCacheOverflowBytes = defaultValue(options.maximumCacheOverflowBytes, 512 * 1024 * 1024);\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.number.greaterThanOrEquals(\"maximumCacheOverflowBytes\", maximumCacheOverflowBytes, 0);\n  //>>includeEnd('debug');\n  this._maximumCacheOverflowBytes = maximumCacheOverflowBytes;\n  this._styleEngine = new Cesium3DTileStyleEngine();\n  this._styleApplied = false;\n  this._modelMatrix = defined(options.modelMatrix) ? Matrix4.clone(options.modelMatrix) : Matrix4.clone(Matrix4.IDENTITY);\n  this._addHeightCallbacks = [];\n  this._statistics = new Cesium3DTilesetStatistics();\n  this._statisticsLast = new Cesium3DTilesetStatistics();\n  this._statisticsPerPass = new Array(Cesium3DTilePass.NUMBER_OF_PASSES);\n  for (let i = 0; i < Cesium3DTilePass.NUMBER_OF_PASSES; ++i) {\n    this._statisticsPerPass[i] = new Cesium3DTilesetStatistics();\n  }\n  this._requestedTilesInFlight = [];\n  this._maximumPriority = {\n    foveatedFactor: -Number.MAX_VALUE,\n    depth: -Number.MAX_VALUE,\n    distance: -Number.MAX_VALUE,\n    reverseScreenSpaceError: -Number.MAX_VALUE\n  };\n  this._minimumPriority = {\n    foveatedFactor: Number.MAX_VALUE,\n    depth: Number.MAX_VALUE,\n    distance: Number.MAX_VALUE,\n    reverseScreenSpaceError: Number.MAX_VALUE\n  };\n  this._heatmap = new Cesium3DTilesetHeatmap(options.debugHeatmapTilePropertyName);\n\n  /**\n   * Optimization option. Don't request tiles that will likely be unused when they come back because of the camera's movement. This optimization only applies to stationary tilesets.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.cullRequestsWhileMoving = defaultValue(options.cullRequestsWhileMoving, true);\n  this._cullRequestsWhileMoving = false;\n\n  /**\n   * Optimization option. Multiplier used in culling requests while moving. Larger is more aggressive culling, smaller less aggressive culling.\n   *\n   * @type {number}\n   * @default 60.0\n   */\n  this.cullRequestsWhileMovingMultiplier = defaultValue(options.cullRequestsWhileMovingMultiplier, 60.0);\n\n  /**\n   * Optimization option. If between (0.0, 0.5], tiles at or above the screen space error for the reduced screen resolution of <code>progressiveResolutionHeightFraction*screenHeight</code> will be prioritized first. This can help get a quick layer of tiles down while full resolution tiles continue to load.\n   *\n   * @type {number}\n   * @default 0.3\n   */\n  this.progressiveResolutionHeightFraction = CesiumMath.clamp(defaultValue(options.progressiveResolutionHeightFraction, 0.3), 0.0, 0.5);\n\n  /**\n   * Optimization option. Prefer loading of leaves first.\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.preferLeaves = defaultValue(options.preferLeaves, false);\n  this._tilesLoaded = false;\n  this._initialTilesLoaded = false;\n  this._tileDebugLabels = undefined;\n  this._classificationType = options.classificationType;\n  this._ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n  this._initialClippingPlanesOriginMatrix = Matrix4.IDENTITY; // Computed from the tileset JSON.\n  this._clippingPlanesOriginMatrix = undefined; // Combines the above with any run-time transforms.\n  this._clippingPlanesOriginMatrixDirty = true;\n  this._vectorClassificationOnly = defaultValue(options.vectorClassificationOnly, false);\n  this._vectorKeepDecodedPositions = defaultValue(options.vectorKeepDecodedPositions, false);\n\n  /**\n   * Preload tiles when <code>tileset.show</code> is <code>false</code>. Loads tiles as if the tileset is visible but does not render them.\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.preloadWhenHidden = defaultValue(options.preloadWhenHidden, false);\n\n  /**\n   * Optimization option. Fetch tiles at the camera's flight destination while the camera is in flight.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.preloadFlightDestinations = defaultValue(options.preloadFlightDestinations, true);\n  this._pass = undefined; // Cesium3DTilePass\n\n  /**\n   * Optimization option. For street-level horizon views, use lower resolution tiles far from the camera. This reduces\n   * the amount of data loaded and improves tileset loading time with a slight drop in visual quality in the distance.\n   * <p>\n   * This optimization is strongest when the camera is close to the ground plane of the tileset and looking at the\n   * horizon. Furthermore, the results are more accurate for tightly fitting bounding volumes like box and region.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.dynamicScreenSpaceError = defaultValue(options.dynamicScreenSpaceError, true);\n\n  /**\n   * Optimization option. Prioritize loading tiles in the center of the screen by temporarily raising the\n   * screen space error for tiles around the edge of the screen. Screen space error returns to normal once all\n   * the tiles in the center of the screen as determined by the {@link Cesium3DTileset#foveatedConeSize} are loaded.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.foveatedScreenSpaceError = defaultValue(options.foveatedScreenSpaceError, true);\n  this._foveatedConeSize = defaultValue(options.foveatedConeSize, 0.1);\n  this._foveatedMinimumScreenSpaceErrorRelaxation = defaultValue(options.foveatedMinimumScreenSpaceErrorRelaxation, 0.0);\n\n  /**\n   * Gets or sets a callback to control how much to raise the screen space error for tiles outside the foveated cone,\n   * interpolating between {@link Cesium3DTileset#foveatedMinimumScreenSpaceErrorRelaxation} and {@link Cesium3DTileset#maximumScreenSpaceError}.\n   *\n   * @type {Cesium3DTileset.foveatedInterpolationCallback}\n   */\n  this.foveatedInterpolationCallback = defaultValue(options.foveatedInterpolationCallback, CesiumMath.lerp);\n\n  /**\n   * Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control\n   * how long in seconds to wait after the camera stops moving before deferred tiles start loading in.\n   * This time delay prevents requesting tiles around the edges of the screen when the camera is moving.\n   * Setting this to 0.0 will immediately request all tiles in any given view.\n   *\n   * @type {number}\n   * @default 0.2\n   */\n  this.foveatedTimeDelay = defaultValue(options.foveatedTimeDelay, 0.2);\n\n  /**\n   * Similar to {@link Fog#density}, this option controls the camera distance at which the {@link Cesium3DTileset#dynamicScreenSpaceError}\n   * optimization applies. Larger values will cause tiles closer to the camera to be affected. This value must be\n   * non-negative.\n   * <p>\n   * This optimization works by rolling off the tile screen space error (SSE) with camera distance like a bell curve.\n   * This has the effect of selecting lower resolution tiles far from the camera. Near the camera, no adjustment is\n   * made. For tiles further away, the SSE is reduced by up to {@link Cesium3DTileset#dynamicScreenSpaceErrorFactor}\n   * (measured in pixels of error).\n   * </p>\n   * <p>\n   * Increasing the density makes the bell curve narrower so tiles closer to the camera are affected. This is analagous\n   * to moving fog closer to the camera.\n   * </p>\n   * <p>\n   * When the density is 0, the optimization will have no effect on the tileset.\n   * </p>\n   *\n   * @type {number}\n   * @default 2.0e-4\n   */\n  this.dynamicScreenSpaceErrorDensity = defaultValue(options.dynamicScreenSpaceErrorDensity, 2.0e-4);\n\n  /**\n   * A parameter that controls the intensity of the {@link Cesium3DTileset#dynamicScreenSpaceError} optimization for\n   * tiles on the horizon. Larger values cause lower resolution tiles to load, improving runtime performance at a slight\n   * reduction of visual quality. The value must be non-negative.\n   * <p>\n   * More specifically, this parameter represents the maximum adjustment to screen space error (SSE) in pixels for tiles\n   * far away from the camera. See {@link Cesium3DTileset#dynamicScreenSpaceErrorDensity} for more details about how\n   * this optimization works.\n   * </p>\n   * <p>\n   * When the SSE factor is set to 0, the optimization will have no effect on the tileset.\n   * </p>\n   *\n   * @type {number}\n   * @default 24.0\n   */\n  this.dynamicScreenSpaceErrorFactor = defaultValue(options.dynamicScreenSpaceErrorFactor, 24.0);\n\n  /**\n   * A ratio of the tileset's height that determines \"street level\" for the {@link Cesium3DTileset#dynamicScreenSpaceError}\n   * optimization. When the camera is below this height, the dynamic screen space error optimization will have the maximum\n   * effect, and it will roll off above this value. Valid values are between 0.0 and 1.0.\n   * <p>\n   *\n   * @type {number}\n   * @default 0.25\n   */\n  this.dynamicScreenSpaceErrorHeightFalloff = defaultValue(options.dynamicScreenSpaceErrorHeightFalloff, 0.25);\n\n  // Updated based on the camera position and direction\n  this._dynamicScreenSpaceErrorComputedDensity = 0.0;\n\n  /**\n   * Determines whether the tileset casts or receives shadows from light sources.\n   * <p>\n   * Enabling shadows has a performance impact. A tileset that casts shadows must be rendered twice, once from the camera and again from the light's point of view.\n   * </p>\n   * <p>\n   * Shadows are rendered only when {@link Viewer#shadows} is <code>true</code>.\n   * </p>\n   *\n   * @type {ShadowMode}\n   * @default ShadowMode.ENABLED\n   */\n  this.shadows = defaultValue(options.shadows, ShadowMode.ENABLED);\n\n  /**\n   * Determines if the tileset will be shown.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.show = defaultValue(options.show, true);\n\n  /**\n   * Defines how per-feature colors set from the Cesium API or declarative styling blend with the source colors from\n   * the original feature, e.g. glTF material or per-point color in the tile.\n   *\n   * @type {Cesium3DTileColorBlendMode}\n   * @default Cesium3DTileColorBlendMode.HIGHLIGHT\n   */\n  this.colorBlendMode = Cesium3DTileColorBlendMode.HIGHLIGHT;\n\n  /**\n   * Defines the value used to linearly interpolate between the source color and feature color when the {@link Cesium3DTileset#colorBlendMode} is <code>MIX</code>.\n   * A value of 0.0 results in the source color while a value of 1.0 results in the feature color, with any value in-between\n   * resulting in a mix of the source color and feature color.\n   *\n   * @type {number}\n   * @default 0.5\n   */\n  this.colorBlendAmount = 0.5;\n  this._pointCloudShading = new PointCloudShading(options.pointCloudShading);\n  this._pointCloudEyeDomeLighting = new PointCloudEyeDomeLighting();\n\n  /**\n   * The event fired to indicate progress of loading new tiles.  This event is fired when a new tile\n   * is requested, when a requested tile is finished downloading, and when a downloaded tile has been\n   * processed and is ready to render.\n   * <p>\n   * The number of pending tile requests, <code>numberOfPendingRequests</code>, and number of tiles\n   * processing, <code>numberOfTilesProcessing</code> are passed to the event listener.\n   * </p>\n   * <p>\n   * This event is fired at the end of the frame after the scene is rendered.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.loadProgress.addEventListener(function(numberOfPendingRequests, numberOfTilesProcessing) {\n   *     if ((numberOfPendingRequests === 0) && (numberOfTilesProcessing === 0)) {\n   *         console.log('Stopped loading');\n   *         return;\n   *     }\n   *\n   *     console.log(`Loading: requests: ${numberOfPendingRequests}, processing: ${numberOfTilesProcessing}`);\n   * });\n   */\n  this.loadProgress = new Event();\n\n  /**\n   * The event fired to indicate that all tiles that meet the screen space error this frame are loaded. The tileset\n   * is completely loaded for this view.\n   * <p>\n   * This event is fired at the end of the frame after the scene is rendered.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.allTilesLoaded.addEventListener(function() {\n   *     console.log('All tiles are loaded');\n   * });\n   *\n   * @see Cesium3DTileset#tilesLoaded\n   */\n  this.allTilesLoaded = new Event();\n\n  /**\n   * The event fired to indicate that all tiles that meet the screen space error this frame are loaded. This event\n   * is fired once when all tiles in the initial view are loaded.\n   * <p>\n   * This event is fired at the end of the frame after the scene is rendered.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.initialTilesLoaded.addEventListener(function() {\n   *     console.log('Initial tiles are loaded');\n   * });\n   *\n   * @see Cesium3DTileset#allTilesLoaded\n   */\n  this.initialTilesLoaded = new Event();\n\n  /**\n   * The event fired to indicate that a tile's content was loaded.\n   * <p>\n   * The loaded {@link Cesium3DTile} is passed to the event listener.\n   * </p>\n   * <p>\n   * This event is fired during the tileset traversal while the frame is being rendered\n   * so that updates to the tile take effect in the same frame.  Do not create or modify\n   * Cesium entities or primitives during the event listener.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.tileLoad.addEventListener(function(tile) {\n   *     console.log('A tile was loaded.');\n   * });\n   */\n  this.tileLoad = new Event();\n\n  /**\n   * The event fired to indicate that a tile's content was unloaded.\n   * <p>\n   * The unloaded {@link Cesium3DTile} is passed to the event listener.\n   * </p>\n   * <p>\n   * This event is fired immediately before the tile's content is unloaded while the frame is being\n   * rendered so that the event listener has access to the tile's content.  Do not create\n   * or modify Cesium entities or primitives during the event listener.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.tileUnload.addEventListener(function(tile) {\n   *     console.log('A tile was unloaded from the cache.');\n   * });\n   *\n   * @see Cesium3DTileset#cacheBytes\n   * @see Cesium3DTileset#trimLoadedTiles\n   */\n  this.tileUnload = new Event();\n\n  /**\n   * The event fired to indicate that a tile's content failed to load.\n   * <p>\n   * If there are no event listeners, error messages will be logged to the console.\n   * </p>\n   * <p>\n   * The error object passed to the listener contains two properties:\n   * <ul>\n   * <li><code>url</code>: the url of the failed tile.</li>\n   * <li><code>message</code>: the error message.</li>\n   * </ul>\n   * <p>\n   * If multiple contents are present, this event is raised once per inner content with errors.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.tileFailed.addEventListener(function(error) {\n   *     console.log(`An error occurred loading tile: ${error.url}`);\n   *     console.log(`Error: ${error.message}`);\n   * });\n   */\n  this.tileFailed = new Event();\n\n  /**\n   * This event fires once for each visible tile in a frame.  This can be used to manually\n   * style a tileset.\n   * <p>\n   * The visible {@link Cesium3DTile} is passed to the event listener.\n   * </p>\n   * <p>\n   * This event is fired during the tileset traversal while the frame is being rendered\n   * so that updates to the tile take effect in the same frame.  Do not create or modify\n   * Cesium entities or primitives during the event listener.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.tileVisible.addEventListener(function(tile) {\n   *     if (tile.content instanceof Cesium.Model3DTileContent) {\n   *         console.log('A 3D model tile is visible.');\n   *     }\n   * });\n   *\n   * @example\n   * // Apply a red style and then manually set random colors for every other feature when the tile becomes visible.\n   * tileset.style = new Cesium.Cesium3DTileStyle({\n   *     color : 'color(\"red\")'\n   * });\n   * tileset.tileVisible.addEventListener(function(tile) {\n   *     const content = tile.content;\n   *     const featuresLength = content.featuresLength;\n   *     for (let i = 0; i < featuresLength; i+=2) {\n   *         content.getFeature(i).color = Cesium.Color.fromRandom();\n   *     }\n   * });\n   */\n  this.tileVisible = new Event();\n\n  /**\n   * Optimization option. Determines if level of detail skipping should be applied during the traversal.\n   * <p>\n   * The common strategy for replacement-refinement traversal is to store all levels of the tree in memory and require\n   * all children to be loaded before the parent can refine. With this optimization levels of the tree can be skipped\n   * entirely and children can be rendered alongside their parents. The tileset requires significantly less memory when\n   * using this optimization.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.skipLevelOfDetail = defaultValue(options.skipLevelOfDetail, false);\n  this._disableSkipLevelOfDetail = false;\n\n  /**\n   * The screen space error that must be reached before skipping levels of detail.\n   * <p>\n   * Only used when {@link Cesium3DTileset#skipLevelOfDetail} is <code>true</code>.\n   * </p>\n   *\n   * @type {number}\n   * @default 1024\n   */\n  this.baseScreenSpaceError = defaultValue(options.baseScreenSpaceError, 1024);\n\n  /**\n   * Multiplier defining the minimum screen space error to skip.\n   * For example, if a tile has screen space error of 100, no tiles will be loaded unless they\n   * are leaves or have a screen space error <code><= 100 / skipScreenSpaceErrorFactor</code>.\n   * <p>\n   * Only used when {@link Cesium3DTileset#skipLevelOfDetail} is <code>true</code>.\n   * </p>\n   *\n   * @type {number}\n   * @default 16\n   */\n  this.skipScreenSpaceErrorFactor = defaultValue(options.skipScreenSpaceErrorFactor, 16);\n\n  /**\n   * Constant defining the minimum number of levels to skip when loading tiles. When it is 0, no levels are skipped.\n   * For example, if a tile is level 1, no tiles will be loaded unless they are at level greater than 2.\n   * <p>\n   * Only used when {@link Cesium3DTileset#skipLevelOfDetail} is <code>true</code>.\n   * </p>\n   *\n   * @type {number}\n   * @default 1\n   */\n  this.skipLevels = defaultValue(options.skipLevels, 1);\n\n  /**\n   * When true, only tiles that meet the maximum screen space error will ever be downloaded.\n   * Skipping factors are ignored and just the desired tiles are loaded.\n   * <p>\n   * Only used when {@link Cesium3DTileset#skipLevelOfDetail} is <code>true</code>.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.immediatelyLoadDesiredLevelOfDetail = defaultValue(options.immediatelyLoadDesiredLevelOfDetail, false);\n\n  /**\n   * Determines whether siblings of visible tiles are always downloaded during traversal.\n   * This may be useful for ensuring that tiles are already available when the viewer turns left/right.\n   * <p>\n   * Only used when {@link Cesium3DTileset#skipLevelOfDetail} is <code>true</code>.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.loadSiblings = defaultValue(options.loadSiblings, false);\n  this._clippingPlanes = undefined;\n  if (defined(options.clippingPlanes)) {\n    ClippingPlaneCollection.setOwner(options.clippingPlanes, this, \"_clippingPlanes\");\n  }\n  this._clippingPolygons = undefined;\n  if (defined(options.clippingPolygons)) {\n    ClippingPolygonCollection.setOwner(options.clippingPolygons, this, \"_clippingPolygons\");\n  }\n  if (defined(options.imageBasedLighting)) {\n    this._imageBasedLighting = options.imageBasedLighting;\n    this._shouldDestroyImageBasedLighting = false;\n  } else {\n    this._imageBasedLighting = new ImageBasedLighting();\n    this._shouldDestroyImageBasedLighting = true;\n  }\n  this._environmentMapManager = new DynamicEnvironmentMapManager(options.environmentMapOptions);\n\n  /**\n   * The light color when shading models. When <code>undefined</code> the scene's light color is used instead.\n   * <p>\n   * For example, disabling additional light sources by setting\n   * <code>tileset.imageBasedLighting.imageBasedLightingFactor = new Cartesian2(0.0, 0.0)</code>\n   * will make the tileset much darker. Here, increasing the intensity of the light source will make the tileset brighter.\n   * </p>\n   *\n   * @type {Cartesian3}\n   * @default undefined\n   */\n  this.lightColor = options.lightColor;\n\n  /**\n   * Whether to cull back-facing geometry. When true, back face culling is determined\n   * by the glTF material's doubleSided property; when false, back face culling is disabled.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.backFaceCulling = defaultValue(options.backFaceCulling, true);\n  this._enableShowOutline = defaultValue(options.enableShowOutline, true);\n\n  /**\n   * Whether to display the outline for models using the\n   * {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension.\n   * When true, outlines are displayed. When false, outlines are not displayed.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.showOutline = defaultValue(options.showOutline, true);\n\n  /**\n   * The color to use when rendering outlines.\n   *\n   * @type {Color}\n   * @default Color.BLACK\n   */\n  this.outlineColor = defaultValue(options.outlineColor, Color.BLACK);\n\n  /**\n   * The {@link SplitDirection} to apply to this tileset.\n   *\n   * @type {SplitDirection}\n   * @default {@link SplitDirection.NONE}\n   */\n  this.splitDirection = defaultValue(options.splitDirection, SplitDirection.NONE);\n\n  /**\n   * If <code>true</code>, allows collisions for camera collisions or picking. While this is  <code>true</code> the camera will be prevented from going in or below the tileset surface if {@link ScreenSpaceCameraController#enableCollisionDetection} is true. This can have performance implecations if the tileset contains tile with a larger number of vertices.\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.enableCollision = defaultValue(options.enableCollision, false);\n  this._projectTo2D = defaultValue(options.projectTo2D, false);\n  this._enablePick = defaultValue(options.enablePick, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * Determines if only the tiles from last frame should be used for rendering.  This\n   * effectively \"freezes\" the tileset to the previous frame so it is possible to zoom\n   * out and see what was rendered.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugFreezeFrame = defaultValue(options.debugFreezeFrame, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, assigns a random color to each tile.  This is useful for visualizing\n   * what features belong to what tiles, especially with additive refinement where features\n   * from parent tiles may be interleaved with features from child tiles.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugColorizeTiles = defaultValue(options.debugColorizeTiles, false);\n  this._enableDebugWireframe = defaultValue(options.enableDebugWireframe, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, renders each tile's content as a wireframe.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugWireframe = defaultValue(options.debugWireframe, false);\n\n  // Warning for improper setup of debug wireframe\n  if (this.debugWireframe === true && this._enableDebugWireframe === false) {\n    oneTimeWarning(\"tileset-debug-wireframe-ignored\", \"enableDebugWireframe must be set to true in the Cesium3DTileset constructor, otherwise debugWireframe will be ignored.\");\n  }\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, renders the bounding volume for each visible tile.  The bounding volume is\n   * white if the tile has a content bounding volume or is empty; otherwise, it is red.  Tiles that don't meet the\n   * screen space error and are still refining to their descendants are yellow.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowBoundingVolume = defaultValue(options.debugShowBoundingVolume, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, renders the bounding volume for each visible tile's content. The bounding volume is\n   * blue if the tile has a content bounding volume; otherwise it is red.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowContentBoundingVolume = defaultValue(options.debugShowContentBoundingVolume, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, renders the viewer request volume for each tile.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowViewerRequestVolume = defaultValue(options.debugShowViewerRequestVolume, false);\n\n  /**\n   * @private\n   * @type {LabelCollection|undefined}\n   */\n  this._tileDebugLabels = undefined;\n  this.debugPickedTileLabelOnly = false;\n  this.debugPickedTile = undefined;\n  this.debugPickPosition = undefined;\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, draws labels to indicate the geometric error of each tile.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowGeometricError = defaultValue(options.debugShowGeometricError, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, draws labels to indicate the number of commands, points, triangles and features of each tile.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowRenderingStatistics = defaultValue(options.debugShowRenderingStatistics, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, draws labels to indicate the geometry and texture memory usage of each tile.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowMemoryUsage = defaultValue(options.debugShowMemoryUsage, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, draws labels to indicate the url of each tile.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowUrl = defaultValue(options.debugShowUrl, false);\n\n  /**\n   * Function for examining vector lines as they are being streamed.\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   *\n   * @type {Function}\n   */\n  this.examineVectorLinesFunction = undefined;\n\n  // this is the underlying Cesium3DTileMetadata object, whether it came from\n  // the 3DTILES_metadata extension or a 3D Tiles 1.1 tileset JSON. Getters\n  // like tileset.metadata and tileset.schema will delegate to this object.\n  this._metadataExtension = undefined;\n  this._customShader = options.customShader;\n  let featureIdLabel = defaultValue(options.featureIdLabel, \"featureId_0\");\n  if (typeof featureIdLabel === \"number\") {\n    featureIdLabel = `featureId_${featureIdLabel}`;\n  }\n  this._featureIdLabel = featureIdLabel;\n  let instanceFeatureIdLabel = defaultValue(options.instanceFeatureIdLabel, \"instanceFeatureId_0\");\n  if (typeof instanceFeatureIdLabel === \"number\") {\n    instanceFeatureIdLabel = `instanceFeatureId_${instanceFeatureIdLabel}`;\n  }\n  this._instanceFeatureIdLabel = instanceFeatureIdLabel;\n}\nObject.defineProperties(Cesium3DTileset.prototype, {\n  /**\n   * NOTE: This getter exists so that `Picking.js` can differentiate between\n   *       PrimitiveCollection and Cesium3DTileset objects without inflating\n   *       the size of the module via `instanceof Cesium3DTileset`\n   * @private\n   */\n  isCesium3DTileset: {\n    get: function () {\n      return true;\n    }\n  },\n  /**\n   * Gets the tileset's asset object property, which contains metadata about the tileset.\n   * <p>\n   * See the {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification#reference-asset|asset schema reference}\n   * in the 3D Tiles spec for the full set of properties.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {object}\n   * @readonly\n   */\n  asset: {\n    get: function () {\n      return this._asset;\n    }\n  },\n  /**\n   * Gets the tileset's extensions object property.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {object}\n   * @readonly\n   */\n  extensions: {\n    get: function () {\n      return this._extensions;\n    }\n  },\n  /**\n   * The {@link ClippingPlaneCollection} used to selectively disable rendering the tileset.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {ClippingPlaneCollection}\n   */\n  clippingPlanes: {\n    get: function () {\n      return this._clippingPlanes;\n    },\n    set: function (value) {\n      ClippingPlaneCollection.setOwner(value, this, \"_clippingPlanes\");\n    }\n  },\n  /**\n   * The {@link ClippingPolygonCollection} used to selectively disable rendering the tileset.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {ClippingPolygonCollection}\n   */\n  clippingPolygons: {\n    get: function () {\n      return this._clippingPolygons;\n    },\n    set: function (value) {\n      ClippingPolygonCollection.setOwner(value, this, \"_clippingPolygons\");\n    }\n  },\n  /**\n   * Gets the tileset's properties dictionary object, which contains metadata about per-feature properties.\n   * <p>\n   * See the {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification#reference-properties|properties schema reference}\n   * in the 3D Tiles spec for the full set of properties.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {object}\n   * @readonly\n   *\n   * @example\n   * console.log(`Maximum building height: ${tileset.properties.height.maximum}`);\n   * console.log(`Minimum building height: ${tileset.properties.height.minimum}`);\n   *\n   * @see Cesium3DTileFeature#getProperty\n   * @see Cesium3DTileFeature#setProperty\n   */\n  properties: {\n    get: function () {\n      return this._properties;\n    }\n  },\n  /**\n   * When <code>true</code>, all tiles that meet the screen space error this frame are loaded. The tileset is\n   * completely loaded for this view.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {boolean}\n   * @readonly\n   *\n   * @default false\n   *\n   * @see Cesium3DTileset#allTilesLoaded\n   */\n  tilesLoaded: {\n    get: function () {\n      return this._tilesLoaded;\n    }\n  },\n  /**\n   * The resource used to fetch the tileset JSON file\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {Resource}\n   * @readonly\n   */\n  resource: {\n    get: function () {\n      return this._resource;\n    }\n  },\n  /**\n   * The base path that non-absolute paths in tileset JSON file are relative to.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {string}\n   * @readonly\n   * @deprecated\n   */\n  basePath: {\n    get: function () {\n      deprecationWarning(\"Cesium3DTileset.basePath\", \"Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead.\");\n      return this._basePath;\n    }\n  },\n  /**\n   * The style, defined using the\n   * {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification/Styling|3D Tiles Styling language},\n   * applied to each feature in the tileset.\n   * <p>\n   * Assign <code>undefined</code> to remove the style, which will restore the visual\n   * appearance of the tileset to its default when no style was applied.\n   * </p>\n   * <p>\n   * The style is applied to a tile before the {@link Cesium3DTileset#tileVisible}\n   * event is raised, so code in <code>tileVisible</code> can manually set a feature's\n   * properties (e.g. color and show) after the style is applied. When\n   * a new style is assigned any manually set properties are overwritten.\n   * </p>\n   * <p>\n   * Use an always \"true\" condition to specify the Color for all objects that are not\n   * overridden by pre-existing conditions. Otherwise, the default color Cesium.Color.White\n   * will be used. Similarly, use an always \"true\" condition to specify the show property\n   * for all objects that are not overridden by pre-existing conditions. Otherwise, the\n   * default show value true will be used.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {Cesium3DTileStyle|undefined}\n   *\n   * @default undefined\n   *\n   * @example\n   * tileset.style = new Cesium.Cesium3DTileStyle({\n   *    color : {\n   *        conditions : [\n   *            ['${Height} >= 100', 'color(\"purple\", 0.5)'],\n   *            ['${Height} >= 50', 'color(\"red\")'],\n   *            ['true', 'color(\"blue\")']\n   *        ]\n   *    },\n   *    show : '${Height} > 0',\n   *    meta : {\n   *        description : '\"Building id ${id} has height ${Height}.\"'\n   *    }\n   * });\n   *\n   * @see {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification/Styling|3D Tiles Styling language}\n   */\n  style: {\n    get: function () {\n      return this._styleEngine.style;\n    },\n    set: function (value) {\n      this._styleEngine.style = value;\n    }\n  },\n  /**\n   * A custom shader to apply to all tiles in the tileset. Only used for\n   * contents that use {@link Model}. Using custom shaders with a\n   * {@link Cesium3DTileStyle} may lead to undefined behavior.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {CustomShader|undefined}\n   *\n   * @default undefined\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  customShader: {\n    get: function () {\n      return this._customShader;\n    },\n    set: function (value) {\n      this._customShader = value;\n    }\n  },\n  /**\n   * Whether the tileset is rendering different levels of detail in the same view.\n   * Only relevant if {@link Cesium3DTileset.isSkippingLevelOfDetail} is true.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {boolean}\n   * @private\n   */\n  hasMixedContent: {\n    get: function () {\n      return this._hasMixedContent;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.bool(\"value\", value);\n      //>>includeEnd('debug');\n\n      this._hasMixedContent = value;\n    }\n  },\n  /**\n   * Whether this tileset is actually skipping levels of detail.\n   * The user option may have been disabled if all tiles are using additive refinement,\n   * or if some tiles have a content type for which rendering does not support skipping\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {boolean}\n   * @private\n   * @readonly\n   */\n  isSkippingLevelOfDetail: {\n    get: function () {\n      return this.skipLevelOfDetail && !defined(this._classificationType) && !this._disableSkipLevelOfDetail && !this._allTilesAdditive;\n    }\n  },\n  /**\n   * The tileset's schema, groups, tileset metadata and other details from the\n   * 3DTILES_metadata extension or a 3D Tiles 1.1 tileset JSON. This getter is\n   * for internal use by other classes.\n   *\n   * @memberof Cesium3DTileset.prototype\n   * @type {Cesium3DTilesetMetadata}\n   * @private\n   * @readonly\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  metadataExtension: {\n    get: function () {\n      return this._metadataExtension;\n    }\n  },\n  /**\n   * The metadata properties attached to the tileset as a whole.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {TilesetMetadata}\n   * @private\n   * @readonly\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  metadata: {\n    get: function () {\n      if (defined(this._metadataExtension)) {\n        return this._metadataExtension.tileset;\n      }\n      return undefined;\n    }\n  },\n  /**\n   * The metadata schema used in this tileset. Shorthand for\n   * <code>tileset.metadataExtension.schema</code>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {MetadataSchema}\n   * @private\n   * @readonly\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  schema: {\n    get: function () {\n      if (defined(this._metadataExtension)) {\n        return this._metadataExtension.schema;\n      }\n      return undefined;\n    }\n  },\n  /**\n   * The maximum screen space error used to drive level of detail refinement.  This value helps determine when a tile\n   * refines to its descendants, and therefore plays a major role in balancing performance with visual quality.\n   * <p>\n   * A tile's screen space error is roughly equivalent to the number of pixels wide that would be drawn if a sphere with a\n   * radius equal to the tile's <b>geometric error</b> were rendered at the tile's position. If this value exceeds\n   * <code>maximumScreenSpaceError</code> the tile refines to its descendants.\n   * </p>\n   * <p>\n   * Depending on the tileset, <code>maximumScreenSpaceError</code> may need to be tweaked to achieve the right balance.\n   * Higher values provide better performance but lower visual quality.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @default 16\n   *\n   * @exception {DeveloperError} <code>maximumScreenSpaceError</code> must be greater than or equal to zero.\n   */\n  maximumScreenSpaceError: {\n    get: function () {\n      return this._maximumScreenSpaceError;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.number.greaterThanOrEquals(\"maximumScreenSpaceError\", value, 0);\n      //>>includeEnd('debug');\n\n      this._maximumScreenSpaceError = value;\n      this._memoryAdjustedScreenSpaceError = value;\n    }\n  },\n  /**\n   * The amount of GPU memory (in bytes) used to cache tiles. This memory usage is estimated from\n   * geometry, textures, and batch table textures of loaded tiles. For point clouds, this value also\n   * includes per-point metadata.\n   * <p>\n   * Tiles not in view are unloaded to enforce this.\n   * </p>\n   * <p>\n   * If decreasing this value results in unloading tiles, the tiles are unloaded the next frame.\n   * </p>\n   * <p>\n   * If tiles sized more than <code>cacheBytes</code> are needed to meet the\n   * desired screen space error, determined by {@link Cesium3DTileset#maximumScreenSpaceError},\n   * for the current view, then the memory usage of the tiles loaded will exceed\n   * <code>cacheBytes</code> by up to <code>maximumCacheOverflowBytes</code>.\n   * For example, if <code>cacheBytes</code> is 500000, but 600000 bytes\n   * of tiles are needed to meet the screen space error, then 600000 bytes of tiles\n   * may be loaded (if <code>maximumCacheOverflowBytes</code> is at least 100000).\n   * When these tiles go out of view, they will be unloaded.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @default 536870912\n   *\n   * @exception {DeveloperError} <code>cacheBytes</code> must be typeof 'number' and greater than or equal to 0\n   * @see Cesium3DTileset#totalMemoryUsageInBytes\n   */\n  cacheBytes: {\n    get: function () {\n      return this._cacheBytes;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.number.greaterThanOrEquals(\"value\", value, 0);\n      //>>includeEnd('debug');\n\n      this._cacheBytes = value;\n    }\n  },\n  /**\n   * The maximum additional amount of GPU memory (in bytes) that will be used to cache tiles.\n   * <p>\n   * If tiles sized more than <code>cacheBytes</code> plus <code>maximumCacheOverflowBytes</code>\n   * are needed to meet the desired screen space error, determined by\n   * {@link Cesium3DTileset#maximumScreenSpaceError} for the current view, then\n   * {@link Cesium3DTileset#memoryAdjustedScreenSpaceError} will be adjusted\n   * until the tiles required to meet the adjusted screen space error use less\n   * than <code>cacheBytes</code> plus <code>maximumCacheOverflowBytes</code>.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @default 536870912\n   *\n   * @exception {DeveloperError} <code>maximumCacheOverflowBytes</code> must be typeof 'number' and greater than or equal to 0\n   * @see Cesium3DTileset#totalMemoryUsageInBytes\n   */\n  maximumCacheOverflowBytes: {\n    get: function () {\n      return this._maximumCacheOverflowBytes;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.number.greaterThanOrEquals(\"value\", value, 0);\n      //>>includeEnd('debug');\n\n      this._maximumCacheOverflowBytes = value;\n    }\n  },\n  /**\n   * If loading the level of detail required by @{link Cesium3DTileset#maximumScreenSpaceError}\n   * results in the memory usage exceeding @{link Cesium3DTileset#cacheBytes}\n   * plus @{link Cesium3DTileset#maximumCacheOverflowBytes}, level of detail refinement\n   * will instead use this (larger) adjusted screen space error to achieve the\n   * best possible visual quality within the available memory\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @readonly\n   *\n   * @private\n   */\n  memoryAdjustedScreenSpaceError: {\n    get: function () {\n      return this._memoryAdjustedScreenSpaceError;\n    }\n  },\n  /**\n   * Options for controlling point size based on geometric error and eye dome lighting.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {PointCloudShading}\n   */\n  pointCloudShading: {\n    get: function () {\n      return this._pointCloudShading;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.defined(\"pointCloudShading\", value);\n      //>>includeEnd('debug');\n      this._pointCloudShading = value;\n    }\n  },\n  /**\n   * The root tile.\n   *\n   * @memberOf Cesium3DTileset.prototype\n   *\n   * @type {Cesium3DTile}\n   * @readonly\n   */\n  root: {\n    get: function () {\n      return this._root;\n    }\n  },\n  /**\n   * The tileset's bounding sphere.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {BoundingSphere}\n   * @readonly\n   *\n   * @example\n   * const tileset = await Cesium.Cesium3DTileset.fromUrl(\"http://localhost:8002/tilesets/Seattle/tileset.json\");\n   *\n   * viewer.scene.primitives.add(tileset);\n   *\n   * // Set the camera to view the newly added tileset\n   * viewer.camera.viewBoundingSphere(tileset.boundingSphere, new Cesium.HeadingPitchRange(0, -0.5, 0));\n   */\n  boundingSphere: {\n    get: function () {\n      this._root.updateTransform(this._modelMatrix);\n      return this._root.boundingSphere;\n    }\n  },\n  /**\n   * A 4x4 transformation matrix that transforms the entire tileset.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {Matrix4}\n   * @default Matrix4.IDENTITY\n   *\n   * @example\n   * // Adjust a tileset's height from the globe's surface.\n   * const heightOffset = 20.0;\n   * const boundingSphere = tileset.boundingSphere;\n   * const cartographic = Cesium.Cartographic.fromCartesian(boundingSphere.center);\n   * const surface = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, 0.0);\n   * const offset = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, heightOffset);\n   * const translation = Cesium.Cartesian3.subtract(offset, surface, new Cesium.Cartesian3());\n   * tileset.modelMatrix = Cesium.Matrix4.fromTranslation(translation);\n   */\n  modelMatrix: {\n    get: function () {\n      return this._modelMatrix;\n    },\n    set: function (value) {\n      this._modelMatrix = Matrix4.clone(value, this._modelMatrix);\n    }\n  },\n  /**\n   * Returns the time, in milliseconds, since the tileset was loaded and first updated.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @readonly\n   */\n  timeSinceLoad: {\n    get: function () {\n      return this._timeSinceLoad;\n    }\n  },\n  /**\n   * The total amount of GPU memory in bytes used by the tileset. This value is estimated from\n   * geometry, texture, batch table textures, and binary metadata of loaded tiles.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @readonly\n   *\n   * @see Cesium3DTileset#cacheBytes\n   */\n  totalMemoryUsageInBytes: {\n    get: function () {\n      const statistics = this._statistics;\n      return statistics.texturesByteLength + statistics.geometryByteLength + statistics.batchTableByteLength;\n    }\n  },\n  /**\n   * @private\n   */\n  clippingPlanesOriginMatrix: {\n    get: function () {\n      if (!defined(this._clippingPlanesOriginMatrix)) {\n        return Matrix4.IDENTITY;\n      }\n      if (this._clippingPlanesOriginMatrixDirty) {\n        Matrix4.multiply(this.root.computedTransform, this._initialClippingPlanesOriginMatrix, this._clippingPlanesOriginMatrix);\n        this._clippingPlanesOriginMatrixDirty = false;\n      }\n      return this._clippingPlanesOriginMatrix;\n    }\n  },\n  /**\n   * @private\n   */\n  styleEngine: {\n    get: function () {\n      return this._styleEngine;\n    }\n  },\n  /**\n   * @private\n   */\n  statistics: {\n    get: function () {\n      return this._statistics;\n    }\n  },\n  /**\n   * Determines whether terrain, 3D Tiles, or both will be classified by this tileset.\n   * <p>\n   * This option is only applied to tilesets containing batched 3D models,\n   * glTF content, geometry data, or vector data. Even when undefined, vector\n   * and geometry data must render as classifications and will default to\n   * rendering on both terrain and other 3D Tiles tilesets.\n   * </p>\n   * <p>\n   * When enabled for batched 3D model and glTF tilesets, there are a few\n   * requirements/limitations on the glTF:\n   * <ul>\n   *     <li>The glTF cannot contain morph targets, skins, or animations.</li>\n   *     <li>The glTF cannot contain the <code>EXT_mesh_gpu_instancing</code> extension.</li>\n   *     <li>Only meshes with TRIANGLES can be used to classify other assets.</li>\n   *     <li>The meshes must be watertight.</li>\n   *     <li>The <code>POSITION</code> semantic is required.</li>\n   *     <li>If <code>_BATCHID</code>s and an index buffer are both present, all indices with the same batch id must occupy contiguous sections of the index buffer.</li>\n   *     <li>If <code>_BATCHID</code>s are present with no index buffer, all positions with the same batch id must occupy contiguous sections of the position buffer.</li>\n   * </ul>\n   * </p>\n   * <p>\n   * Additionally, classification is not supported for points or instanced 3D\n   * models.\n   * </p>\n   * <p>\n   * The 3D Tiles or terrain receiving the classification must be opaque.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {ClassificationType}\n   * @default undefined\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   * @readonly\n   */\n  classificationType: {\n    get: function () {\n      return this._classificationType;\n    }\n  },\n  /**\n   * Gets an ellipsoid describing the shape of the globe.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {Ellipsoid}\n   * @readonly\n   */\n  ellipsoid: {\n    get: function () {\n      return this._ellipsoid;\n    }\n  },\n  /**\n   * Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control the cone size that determines which tiles are deferred.\n   * Tiles that are inside this cone are loaded immediately. Tiles outside the cone are potentially deferred based on how far outside the cone they are and {@link Cesium3DTileset#foveatedInterpolationCallback} and {@link Cesium3DTileset#foveatedMinimumScreenSpaceErrorRelaxation}.\n   * Setting this to 0.0 means the cone will be the line formed by the camera position and its view direction. Setting this to 1.0 means the cone encompasses the entire field of view of the camera, essentially disabling the effect.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @default 0.3\n   */\n  foveatedConeSize: {\n    get: function () {\n      return this._foveatedConeSize;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.number.greaterThanOrEquals(\"foveatedConeSize\", value, 0.0);\n      Check.typeOf.number.lessThanOrEquals(\"foveatedConeSize\", value, 1.0);\n      //>>includeEnd('debug');\n\n      this._foveatedConeSize = value;\n    }\n  },\n  /**\n   * Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control the starting screen space error relaxation for tiles outside the foveated cone.\n   * The screen space error will be raised starting with this value up to {@link Cesium3DTileset#maximumScreenSpaceError} based on the provided {@link Cesium3DTileset#foveatedInterpolationCallback}.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @default 0.0\n   */\n  foveatedMinimumScreenSpaceErrorRelaxation: {\n    get: function () {\n      return this._foveatedMinimumScreenSpaceErrorRelaxation;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.number.greaterThanOrEquals(\"foveatedMinimumScreenSpaceErrorRelaxation\", value, 0.0);\n      Check.typeOf.number.lessThanOrEquals(\"foveatedMinimumScreenSpaceErrorRelaxation\", value, this.maximumScreenSpaceError);\n      //>>includeEnd('debug');\n\n      this._foveatedMinimumScreenSpaceErrorRelaxation = value;\n    }\n  },\n  /**\n   * Returns the <code>extras</code> property at the top-level of the tileset JSON, which contains application specific metadata.\n   * Returns <code>undefined</code> if <code>extras</code> does not exist.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {*}\n   * @readonly\n   *\n   * @see {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification#specifying-extensions-and-application-specific-extras|Extras in the 3D Tiles specification.}\n   */\n  extras: {\n    get: function () {\n      return this._extras;\n    }\n  },\n  /**\n   * The properties for managing image-based lighting on this tileset.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {ImageBasedLighting}\n   */\n  imageBasedLighting: {\n    get: function () {\n      return this._imageBasedLighting;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.object(\"imageBasedLighting\", this._imageBasedLighting);\n      //>>includeEnd('debug');\n      if (value !== this._imageBasedLighting) {\n        if (this._shouldDestroyImageBasedLighting && !this._imageBasedLighting.isDestroyed()) {\n          this._imageBasedLighting.destroy();\n        }\n        this._imageBasedLighting = value;\n        this._shouldDestroyImageBasedLighting = false;\n      }\n    }\n  },\n  /**\n   * The properties for managing dynamic environment maps on this model. Affects lighting.\n   *\n   * @memberof Cesium3DTileset.prototype\n   * @readonly\n   *\n   * @example\n   * // Change the ground color used for a tileset's environment map to a forest green\n   * const environmentMapManager = tileset.environmentMapManager;\n   * environmentMapManager.groundColor = Cesium.Color.fromCssColorString(\"#203b34\");\n   *\n   * @type {DynamicEnvironmentMapManager}\n   */\n  environmentMapManager: {\n    get: function () {\n      return this._environmentMapManager;\n    }\n  },\n  /**\n   * Indicates that only the tileset's vector tiles should be used for classification.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   *\n   * @type {boolean}\n   * @default false\n   */\n  vectorClassificationOnly: {\n    get: function () {\n      return this._vectorClassificationOnly;\n    }\n  },\n  /**\n   * Whether vector tiles should keep decoded positions in memory.\n   * This is used with {@link Cesium3DTileFeature.getPolylinePositions}.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   *\n   * @type {boolean}\n   * @default false\n   */\n  vectorKeepDecodedPositions: {\n    get: function () {\n      return this._vectorKeepDecodedPositions;\n    }\n  },\n  /**\n   * Determines whether the credits of the tileset will be displayed on the screen\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {boolean}\n   * @default false\n   */\n  showCreditsOnScreen: {\n    get: function () {\n      return this._showCreditsOnScreen;\n    },\n    set: function (value) {\n      this._showCreditsOnScreen = value;\n      createCredits(this);\n    }\n  },\n  /**\n   * Label of the feature ID set to use for picking and styling.\n   * <p>\n   * For EXT_mesh_features, this is the feature ID's label property, or\n   * \"featureId_N\" (where N is the index in the featureIds array) when not\n   * specified. EXT_feature_metadata did not have a label field, so such\n   * feature ID sets are always labeled \"featureId_N\" where N is the index in\n   * the list of all feature Ids, where feature ID attributes are listed before\n   * feature ID textures.\n   * </p>\n   * <p>\n   * If featureIdLabel is set to an integer N, it is converted to\n   * the string \"featureId_N\" automatically. If both per-primitive and\n   * per-instance feature IDs are present, the instance feature IDs take\n   * priority.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {string}\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  featureIdLabel: {\n    get: function () {\n      return this._featureIdLabel;\n    },\n    set: function (value) {\n      // indices get converted into featureId_N\n      if (typeof value === \"number\") {\n        value = `featureId_${value}`;\n      }\n\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.string(\"value\", value);\n      //>>includeEnd('debug');\n\n      this._featureIdLabel = value;\n    }\n  },\n  /**\n   * Label of the instance feature ID set used for picking and styling.\n   * <p>\n   * If instanceFeatureIdLabel is set to an integer N, it is converted to\n   * the string \"instanceFeatureId_N\" automatically.\n   * If both per-primitive and per-instance feature IDs are present, the\n   * instance feature IDs take priority.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {string}\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  instanceFeatureIdLabel: {\n    get: function () {\n      return this._instanceFeatureIdLabel;\n    },\n    set: function (value) {\n      // indices get converted into instanceFeatureId_N\n      if (typeof value === \"number\") {\n        value = `instanceFeatureId_${value}`;\n      }\n\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.string(\"value\", value);\n      //>>includeEnd('debug');\n\n      this._instanceFeatureIdLabel = value;\n    }\n  }\n});\n\n/**\n * Creates a {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification|3D Tiles tileset},\n * used for streaming massive heterogeneous 3D geospatial datasets, from a Cesium ion asset ID.\n *\n * @param {number} assetId The Cesium ion asset id.\n * @param {Cesium3DTileset.ConstructorOptions} [options] An object describing initialization options\n * @returns {Promise<Cesium3DTileset>}\n *\n * @exception {RuntimeError} When the tileset asset version is not 0.0, 1.0, or 1.1,\n * or when the tileset contains a required extension that is not supported.\n *\n * @see Cesium3DTileset#fromUrl\n *\n * @example\n * // Load a Cesium3DTileset with a Cesium ion asset ID of 124624234\n * try {\n *   const tileset = await Cesium.Cesium3DTileset.fromIonAssetId(124624234);\n *   scene.primitives.add(tileset);\n * } catch (error) {\n *   console.error(`Error creating tileset: ${error}`);\n * }\n */\nCesium3DTileset.fromIonAssetId = async function (assetId, options) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.defined(\"assetId\", assetId);\n  //>>includeEnd('debug');\n\n  const resource = await IonResource.fromAssetId(assetId);\n  return Cesium3DTileset.fromUrl(resource, options);\n};\n\n/**\n * Creates a {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification|3D Tiles tileset},\n * used for streaming massive heterogeneous 3D geospatial datasets.\n *\n * @param {Resource|string} url The url to a tileset JSON file.\n * @param {Cesium3DTileset.ConstructorOptions} [options] An object describing initialization options\n * @returns {Promise<Cesium3DTileset>}\n *\n * @exception {RuntimeError} When the tileset asset version is not 0.0, 1.0, or 1.1,\n * or when the tileset contains a required extension that is not supported.\n *\n * @see Cesium3DTileset#fromIonAssetId\n *\n * @example\n * try {\n *   const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *      \"http://localhost:8002/tilesets/Seattle/tileset.json\"\n *   );\n *   scene.primitives.add(tileset);\n * } catch (error) {\n *   console.error(`Error creating tileset: ${error}`);\n * }\n *\n * @example\n * // Common setting for the skipLevelOfDetail optimization\n * const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *   \"http://localhost:8002/tilesets/Seattle/tileset.json\", {\n *      skipLevelOfDetail: true,\n *      baseScreenSpaceError: 1024,\n *      skipScreenSpaceErrorFactor: 16,\n *      skipLevels: 1,\n *      immediatelyLoadDesiredLevelOfDetail: false,\n *      loadSiblings: false,\n *      cullWithChildrenBounds: true\n * });\n * scene.primitives.add(tileset);\n *\n * @example\n * // Common settings for the dynamicScreenSpaceError optimization\n * const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *   \"http://localhost:8002/tilesets/Seattle/tileset.json\", {\n *      dynamicScreenSpaceError: true,\n *      dynamicScreenSpaceErrorDensity: 2.0e-4,\n *      dynamicScreenSpaceErrorFactor: 24.0,\n *      dynamicScreenSpaceErrorHeightFalloff: 0.25\n * });\n * scene.primitives.add(tileset);\n */\nCesium3DTileset.fromUrl = async function (url, options) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.defined(\"url\", url);\n  //>>includeEnd('debug');\n\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n  const resource = Resource.createIfNeeded(url);\n  let basePath;\n  if (resource.extension === \"json\") {\n    basePath = resource.getBaseUri(true);\n  } else if (resource.isDataUri) {\n    basePath = \"\";\n  }\n  const tilesetJson = await Cesium3DTileset.loadJson(resource);\n  const metadataExtension = await processMetadataExtension(resource, tilesetJson);\n  const tileset = new Cesium3DTileset(options);\n  tileset._resource = resource;\n  tileset._url = resource.url;\n  tileset._basePath = basePath;\n  tileset._metadataExtension = metadataExtension;\n  // Set these before loading the tileset since _geometricError\n  // and _scaledGeometricError get accessed during tile creation\n  tileset._geometricError = tilesetJson.geometricError;\n  tileset._scaledGeometricError = tilesetJson.geometricError;\n  const asset = tilesetJson.asset;\n  tileset._asset = asset;\n  tileset._extras = tilesetJson.extras;\n  createCredits(tileset);\n\n  // Handle legacy gltfUpAxis option\n  const gltfUpAxis = defined(tilesetJson.asset.gltfUpAxis) ? Axis.fromName(tilesetJson.asset.gltfUpAxis) : Axis.Y;\n  const modelUpAxis = defaultValue(options.modelUpAxis, gltfUpAxis);\n  const modelForwardAxis = defaultValue(options.modelForwardAxis, Axis.X);\n  tileset._properties = tilesetJson.properties;\n  tileset._extensionsUsed = tilesetJson.extensionsUsed;\n  tileset._extensions = tilesetJson.extensions;\n  tileset._modelUpAxis = modelUpAxis;\n  tileset._modelForwardAxis = modelForwardAxis;\n  tileset._root = tileset.loadTileset(resource, tilesetJson);\n\n  // Save the original, untransformed bounding volume position so we can apply\n  // the tile transform and model matrix at run time\n  const boundingVolume = tileset._root.createBoundingVolume(tilesetJson.root.boundingVolume, Matrix4.IDENTITY);\n  const clippingPlanesOrigin = boundingVolume.boundingSphere.center;\n  // If this origin is above the surface of the earth\n  // we want to apply an ENU orientation as our best guess of orientation.\n  // Otherwise, we assume it gets its position/orientation completely from the\n  // root tile transform and the tileset's model matrix\n  const originCartographic = tileset._ellipsoid.cartesianToCartographic(clippingPlanesOrigin);\n  if (defined(originCartographic) && originCartographic.height > ApproximateTerrainHeights._defaultMinTerrainHeight) {\n    tileset._initialClippingPlanesOriginMatrix = Transforms.eastNorthUpToFixedFrame(clippingPlanesOrigin);\n  }\n  tileset._clippingPlanesOriginMatrix = Matrix4.clone(tileset._initialClippingPlanesOriginMatrix);\n  return tileset;\n};\n\n/**\n * Provides a hook to override the method used to request the tileset json\n * useful when fetching tilesets from remote servers\n * @param {Resource|string} tilesetUrl The url of the json file to be fetched\n * @returns {Promise<object>} A promise that resolves with the fetched json data\n */\nCesium3DTileset.loadJson = function (tilesetUrl) {\n  const resource = Resource.createIfNeeded(tilesetUrl);\n  return resource.fetchJson();\n};\n\n/**\n * Marks the tileset's {@link Cesium3DTileset#style} as dirty, which forces all\n * features to re-evaluate the style in the next frame each is visible.\n */\nCesium3DTileset.prototype.makeStyleDirty = function () {\n  this._styleEngine.makeDirty();\n};\n\n/**\n * Loads the main tileset JSON file or a tileset JSON file referenced from a tile.\n *\n * @exception {RuntimeError} When the tileset asset version is not 0.0, 1.0, or 1.1,\n * or when the tileset contains a required extension that is not supported.\n *\n * @private\n */\nCesium3DTileset.prototype.loadTileset = function (resource, tilesetJson, parentTile) {\n  const asset = tilesetJson.asset;\n  if (!defined(asset)) {\n    throw new RuntimeError(\"Tileset must have an asset property.\");\n  }\n  if (asset.version !== \"0.0\" && asset.version !== \"1.0\" && asset.version !== \"1.1\") {\n    throw new RuntimeError(\"The tileset must be 3D Tiles version 0.0, 1.0, or 1.1\");\n  }\n  if (defined(tilesetJson.extensionsRequired)) {\n    Cesium3DTileset.checkSupportedExtensions(tilesetJson.extensionsRequired);\n  }\n  const statistics = this._statistics;\n  const tilesetVersion = asset.tilesetVersion;\n  if (defined(tilesetVersion)) {\n    // Append the tileset version to the resource\n    this._basePath += `?v=${tilesetVersion}`;\n    resource = resource.clone();\n    resource.setQueryParameters({\n      v: tilesetVersion\n    });\n  }\n\n  // A tileset JSON file referenced from a tile may exist in a different directory than the root tileset.\n  // Get the basePath relative to the external tileset.\n  const rootTile = makeTile(this, resource, tilesetJson.root, parentTile);\n\n  // If there is a parentTile, add the root of the currently loading tileset\n  // to parentTile's children, and update its _depth.\n  if (defined(parentTile)) {\n    parentTile.children.push(rootTile);\n    rootTile._depth = parentTile._depth + 1;\n  }\n  const stack = [];\n  stack.push(rootTile);\n  while (stack.length > 0) {\n    const tile = stack.pop();\n    ++statistics.numberOfTilesTotal;\n    this._allTilesAdditive = this._allTilesAdditive && tile.refine === Cesium3DTileRefine.ADD;\n    const children = tile._header.children;\n    if (defined(children)) {\n      for (let i = 0; i < children.length; ++i) {\n        const childHeader = children[i];\n        const childTile = makeTile(this, resource, childHeader, tile);\n        tile.children.push(childTile);\n        childTile._depth = tile._depth + 1;\n        stack.push(childTile);\n      }\n    }\n    if (this._cullWithChildrenBounds) {\n      Cesium3DTileOptimizations.checkChildrenWithinParent(tile);\n    }\n  }\n  return rootTile;\n};\n\n/**\n * Make a {@link Cesium3DTile} for a specific tile. If the tile's header has implicit\n * tiling (3D Tiles 1.1) or uses the <code>3DTILES_implicit_tiling</code> extension,\n * it creates a placeholder tile instead for lazy evaluation of the implicit tileset.\n *\n * @param {Cesium3DTileset} tileset The tileset\n * @param {Resource} baseResource The base resource for the tileset\n * @param {object} tileHeader The JSON header for the tile\n * @param {Cesium3DTile} [parentTile] The parent tile of the new tile\n * @returns {Cesium3DTile} The newly created tile\n *\n * @private\n */\nfunction makeTile(tileset, baseResource, tileHeader, parentTile) {\n  const hasImplicitTiling = defined(tileHeader.implicitTiling) || hasExtension(tileHeader, \"3DTILES_implicit_tiling\");\n  if (!hasImplicitTiling) {\n    return new Cesium3DTile(tileset, baseResource, tileHeader, parentTile);\n  }\n  const metadataSchema = tileset.schema;\n  const implicitTileset = new ImplicitTileset(baseResource, tileHeader, metadataSchema);\n  const rootCoordinates = new ImplicitTileCoordinates({\n    subdivisionScheme: implicitTileset.subdivisionScheme,\n    subtreeLevels: implicitTileset.subtreeLevels,\n    level: 0,\n    x: 0,\n    y: 0,\n    // The constructor will only use this for octrees.\n    z: 0\n  });\n\n  // Create a placeholder Cesium3DTile that has an ImplicitTileset\n  // object and whose content will resolve to an Implicit3DTileContent\n  const contentUri = implicitTileset.subtreeUriTemplate.getDerivedResource({\n    templateValues: rootCoordinates.getTemplateValues()\n  }).url;\n  const deepCopy = true;\n  const tileJson = clone(tileHeader, deepCopy);\n  // Replace contents with the subtree\n  tileJson.contents = [{\n    uri: contentUri\n  }];\n  delete tileJson.content;\n\n  // The placeholder tile does not have any extensions. If there are any\n  // extensions beyond 3DTILES_implicit_tiling, Implicit3DTileContent will\n  // copy them to the transcoded tiles.\n  delete tileJson.extensions;\n  const tile = new Cesium3DTile(tileset, baseResource, tileJson, parentTile);\n  tile.implicitTileset = implicitTileset;\n  tile.implicitCoordinates = rootCoordinates;\n  return tile;\n}\n\n/**\n * If tileset metadata is present, initialize the {@link Cesium3DTilesetMetadata}\n * instance. This is asynchronous since metadata schemas may be external.\n *\n * @param {Cesium3DTileset} tileset The tileset\n * @param {object} tilesetJson The tileset JSON\n * @return {Promise<Cesium3DTilesetMetadata>} The loaded Cesium3DTilesetMetadata\n * @private\n */\nasync function processMetadataExtension(resource, tilesetJson) {\n  const metadataJson = hasExtension(tilesetJson, \"3DTILES_metadata\") ? tilesetJson.extensions[\"3DTILES_metadata\"] : tilesetJson;\n  let schemaLoader;\n  if (defined(metadataJson.schemaUri)) {\n    resource = resource.getDerivedResource({\n      url: metadataJson.schemaUri\n    });\n    schemaLoader = ResourceCache.getSchemaLoader({\n      resource: resource\n    });\n  } else if (defined(metadataJson.schema)) {\n    schemaLoader = ResourceCache.getSchemaLoader({\n      schema: metadataJson.schema\n    });\n  } else {\n    return;\n  }\n  await schemaLoader.load();\n  const metadataExtension = new Cesium3DTilesetMetadata({\n    schema: schemaLoader.schema,\n    metadataJson: metadataJson\n  });\n  ResourceCache.unload(schemaLoader);\n  return metadataExtension;\n}\nconst scratchPositionNormal = new Cartesian3();\nconst scratchCartographic = new Cartographic();\nconst scratchMatrix = new Matrix4();\nconst scratchCenter = new Cartesian3();\nconst scratchPosition = new Cartesian3();\nconst scratchDirection = new Cartesian3();\nconst scratchHalfHeight = new Cartesian3();\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n */\nfunction updateDynamicScreenSpaceError(tileset, frameState) {\n  let up;\n  let direction;\n  let height;\n  let minimumHeight;\n  let maximumHeight;\n  const camera = frameState.camera;\n  const root = tileset._root;\n  const tileBoundingVolume = root.contentBoundingVolume;\n  if (tileBoundingVolume instanceof TileBoundingRegion) {\n    up = Cartesian3.normalize(camera.positionWC, scratchPositionNormal);\n    direction = camera.directionWC;\n    height = camera.positionCartographic.height;\n    minimumHeight = tileBoundingVolume.minimumHeight;\n    maximumHeight = tileBoundingVolume.maximumHeight;\n  } else {\n    // Transform camera position and direction into the local coordinate system of the tileset\n    const transformLocal = Matrix4.inverseTransformation(root.computedTransform, scratchMatrix);\n    const ellipsoid = frameState.mapProjection.ellipsoid;\n    const boundingVolume = tileBoundingVolume.boundingVolume;\n    const centerLocal = Matrix4.multiplyByPoint(transformLocal, boundingVolume.center, scratchCenter);\n    if (Cartesian3.magnitude(centerLocal) > ellipsoid.minimumRadius) {\n      // The tileset is defined in WGS84. Approximate the minimum and maximum height.\n      const centerCartographic = Cartographic.fromCartesian(centerLocal, ellipsoid, scratchCartographic);\n      up = Cartesian3.normalize(camera.positionWC, scratchPositionNormal);\n      direction = camera.directionWC;\n      height = camera.positionCartographic.height;\n      minimumHeight = 0.0;\n      maximumHeight = centerCartographic.height * 2.0;\n    } else {\n      // The tileset is defined in local coordinates (z-up)\n      const positionLocal = Matrix4.multiplyByPoint(transformLocal, camera.positionWC, scratchPosition);\n      up = Cartesian3.UNIT_Z;\n      direction = Matrix4.multiplyByPointAsVector(transformLocal, camera.directionWC, scratchDirection);\n      direction = Cartesian3.normalize(direction, direction);\n      height = positionLocal.z;\n      if (tileBoundingVolume instanceof TileOrientedBoundingBox) {\n        // Assuming z-up, the last column is the local z direction and\n        // represents the height of the bounding box.\n        const halfHeightVector = Matrix3.getColumn(boundingVolume.halfAxes, 2, scratchHalfHeight);\n        const halfHeight = Cartesian3.magnitude(halfHeightVector);\n        minimumHeight = centerLocal.z - halfHeight;\n        maximumHeight = centerLocal.z + halfHeight;\n      } else if (tileBoundingVolume instanceof TileBoundingSphere) {\n        const radius = boundingVolume.radius;\n        minimumHeight = centerLocal.z - radius;\n        maximumHeight = centerLocal.z + radius;\n      }\n    }\n  }\n\n  // The range where the density starts to lessen. Start at the quarter height of the tileset.\n  const heightFalloff = tileset.dynamicScreenSpaceErrorHeightFalloff;\n  const heightClose = minimumHeight + (maximumHeight - minimumHeight) * heightFalloff;\n  const heightFar = maximumHeight;\n  const t = CesiumMath.clamp((height - heightClose) / (heightFar - heightClose), 0.0, 1.0);\n\n  // Increase density as the camera tilts towards the horizon\n  let horizonFactor = 1.0 - Math.abs(Cartesian3.dot(direction, up));\n\n  // Weaken the horizon factor as the camera height increases, implying the camera is further away from the tileset.\n  // The goal is to increase density for the \"street view\", not when viewing the tileset from a distance.\n  horizonFactor = horizonFactor * (1.0 - t);\n  tileset._dynamicScreenSpaceErrorComputedDensity = tileset.dynamicScreenSpaceErrorDensity * horizonFactor;\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction requestContent(tileset, tile) {\n  if (tile.hasEmptyContent) {\n    return;\n  }\n  const {\n    statistics\n  } = tileset;\n  const contentExpired = tile.contentExpired;\n  const promise = tile.requestContent();\n  if (!defined(promise)) {\n    return;\n  }\n  promise.then(content => {\n    if (!defined(content) || tile.isDestroyed() || tileset.isDestroyed()) {\n      return;\n    }\n    tileset._processingQueue.push(tile);\n    ++statistics.numberOfTilesProcessing;\n  }).catch(error => {\n    handleTileFailure(error, tileset, tile);\n  });\n  if (contentExpired) {\n    if (tile.hasTilesetContent || tile.hasImplicitContent) {\n      destroySubtree(tileset, tile);\n    } else {\n      statistics.decrementLoadCounts(tile.content);\n      --statistics.numberOfTilesWithContentReady;\n    }\n  }\n  tileset._requestedTilesInFlight.push(tile);\n}\nfunction sortTilesByPriority(a, b) {\n  return a._priority - b._priority;\n}\n\n/**\n * Perform any pass invariant tasks here. Called after the render pass.\n * @private\n * @param {FrameState} frameState\n */\nCesium3DTileset.prototype.postPassesUpdate = function (frameState) {\n  if (!defined(this._root)) {\n    return;\n  }\n  cancelOutOfViewRequests(this, frameState);\n  raiseLoadProgressEvent(this, frameState);\n  this._cache.unloadTiles(this, unloadTile);\n\n  // If the style wasn't able to be applied this frame (for example,\n  // the tileset was hidden), keep it dirty so the engine can try\n  // to apply the style next frame.\n  if (this._styleApplied) {\n    this._styleEngine.resetDirty();\n  }\n  this._styleApplied = false;\n};\n\n/**\n * Perform any pass invariant tasks here. Called before any passes are executed.\n * @private\n * @param {FrameState} frameState\n */\nCesium3DTileset.prototype.prePassesUpdate = function (frameState) {\n  if (!defined(this._root)) {\n    return;\n  }\n  processTiles(this, frameState);\n\n  // Update clipping planes\n  const clippingPlanes = this._clippingPlanes;\n  this._clippingPlanesOriginMatrixDirty = true;\n  if (defined(clippingPlanes) && clippingPlanes.enabled) {\n    clippingPlanes.update(frameState);\n  }\n\n  // Update clipping polygons\n  const clippingPolygons = this._clippingPolygons;\n  if (defined(clippingPolygons) && clippingPolygons.enabled) {\n    clippingPolygons.update(frameState);\n  }\n  if (!defined(this._loadTimestamp)) {\n    this._loadTimestamp = JulianDate.clone(frameState.time);\n  }\n  this._timeSinceLoad = Math.max(JulianDate.secondsDifference(frameState.time, this._loadTimestamp) * 1000, 0.0);\n  if (this.dynamicScreenSpaceError) {\n    updateDynamicScreenSpaceError(this, frameState);\n  }\n  if (frameState.newFrame) {\n    this._cache.reset();\n  }\n};\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n */\nfunction cancelOutOfViewRequests(tileset, frameState) {\n  const requestedTilesInFlight = tileset._requestedTilesInFlight;\n  let removeCount = 0;\n  for (let i = 0; i < requestedTilesInFlight.length; ++i) {\n    const tile = requestedTilesInFlight[i];\n\n    // NOTE: This is framerate dependant so make sure the threshold check is small\n    const outOfView = frameState.frameNumber - tile._touchedFrame >= 1;\n    if (tile._contentState !== Cesium3DTileContentState.LOADING) {\n      // No longer fetching from host, don't need to track it anymore. Gets marked as LOADING in Cesium3DTile::requestContent().\n      ++removeCount;\n      continue;\n    } else if (outOfView) {\n      // RequestScheduler will take care of cancelling it\n      tile.cancelRequests();\n      ++removeCount;\n      continue;\n    }\n    if (removeCount > 0) {\n      requestedTilesInFlight[i - removeCount] = tile;\n    }\n  }\n  requestedTilesInFlight.length -= removeCount;\n}\n\n/**\n * Sort requests by priority before making any requests.\n * This makes it less likely that requests will be cancelled after being issued.\n * @private\n * @param {Cesium3DTileset} tileset\n */\nfunction requestTiles(tileset) {\n  const requestedTiles = tileset._requestedTiles;\n  requestedTiles.sort(sortTilesByPriority);\n  for (let i = 0; i < requestedTiles.length; ++i) {\n    requestContent(tileset, requestedTiles[i]);\n  }\n}\n\n/**\n * @private\n * @param {Error} error\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction handleTileFailure(error, tileset, tile) {\n  if (tileset.isDestroyed()) {\n    return;\n  }\n  let url;\n  if (!tile.isDestroyed()) {\n    url = tile._contentResource.url;\n  }\n  const message = defined(error.message) ? error.message : error.toString();\n  if (tileset.tileFailed.numberOfListeners > 0) {\n    tileset.tileFailed.raiseEvent({\n      url: url,\n      message: message\n    });\n  } else {\n    console.log(`A 3D tile failed to load: ${url}`);\n    console.log(`Error: ${message}`);\n    console.log(error.stack);\n  }\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n */\nfunction filterProcessingQueue(tileset) {\n  const tiles = tileset._processingQueue;\n  let removeCount = 0;\n  for (let i = 0; i < tiles.length; ++i) {\n    const tile = tiles[i];\n    if (tile.isDestroyed() || tile._contentState !== Cesium3DTileContentState.PROCESSING) {\n      ++removeCount;\n      continue;\n    }\n    if (removeCount > 0) {\n      tiles[i - removeCount] = tile;\n    }\n  }\n  tiles.length -= removeCount;\n}\nconst scratchUpdateHeightCartographic = new Cartographic();\nconst scratchUpdateHeightCartographic2 = new Cartographic();\nconst scratchUpdateHeightCartesian = new Cartesian3();\nfunction processUpdateHeight(tileset, tile, frameState) {\n  if (!tileset.enableCollision || !tileset.show) {\n    return;\n  }\n  const heightCallbackData = tileset._addHeightCallbacks;\n  const boundingSphere = tile.boundingSphere;\n  for (const callbackData of heightCallbackData) {\n    // No need to update if the tile was already visible last frame\n    if (callbackData.invoked || tile._wasSelectedLastFrame) {\n      continue;\n    }\n    const ellipsoid = callbackData.ellipsoid;\n    const positionCartographic = Cartographic.clone(callbackData.positionCartographic, scratchUpdateHeightCartographic);\n    const centerCartographic = Cartographic.fromCartesian(boundingSphere.center, ellipsoid, scratchUpdateHeightCartographic2);\n\n    // This can be undefined when the bounding sphere is at the origin\n    if (defined(centerCartographic)) {\n      positionCartographic.height = centerCartographic.height;\n    }\n    const position = Cartographic.toCartesian(positionCartographic, ellipsoid, scratchUpdateHeightCartesian);\n    if (Cartesian3.distance(position, boundingSphere.center) <= boundingSphere.radius) {\n      frameState.afterRender.push(() => {\n        // Callback can be removed before it actually invoked at the end of the frame\n        if (defined(callbackData.callback)) {\n          callbackData.callback(positionCartographic);\n        }\n        callbackData.invoked = false;\n      });\n    }\n  }\n}\n\n/**\n * Process tiles in the PROCESSING state so they will eventually move to the READY state.\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction processTiles(tileset, frameState) {\n  filterProcessingQueue(tileset);\n  const tiles = tileset._processingQueue;\n  const {\n    cacheBytes,\n    maximumCacheOverflowBytes,\n    statistics\n  } = tileset;\n  const cacheByteLimit = cacheBytes + maximumCacheOverflowBytes;\n  let memoryExceeded = false;\n  for (let i = 0; i < tiles.length; ++i) {\n    if (tileset.totalMemoryUsageInBytes > cacheByteLimit) {\n      memoryExceeded = true;\n      break;\n    }\n    const tile = tiles[i];\n    try {\n      tile.process(tileset, frameState);\n      if (tile.contentReady) {\n        --statistics.numberOfTilesProcessing;\n        tileset.tileLoad.raiseEvent(tile);\n      }\n    } catch (error) {\n      --statistics.numberOfTilesProcessing;\n      handleTileFailure(error, tileset, tile);\n    }\n  }\n  if (tileset.totalMemoryUsageInBytes < cacheBytes) {\n    decreaseScreenSpaceError(tileset);\n  } else if (memoryExceeded && tiles.length > 0) {\n    increaseScreenSpaceError(tileset);\n  }\n}\nfunction increaseScreenSpaceError(tileset) {\n  //>>includeStart('debug', pragmas.debug);\n  oneTimeWarning(\"increase-screenSpaceError\", `The tiles needed to meet maximumScreenSpaceError would use more memory than allocated for this tileset.\n    The tileset will be rendered with a larger screen space error (see memoryAdjustedScreenSpaceError).\n    Consider using larger values for cacheBytes and maximumCacheOverflowBytes.`);\n  //>>includeEnd('debug');\n\n  tileset._memoryAdjustedScreenSpaceError *= 1.02;\n  const tiles = tileset._processingQueue;\n  for (let i = 0; i < tiles.length; ++i) {\n    tiles[i].updatePriority();\n  }\n  tiles.sort(sortTilesByPriority);\n}\nfunction decreaseScreenSpaceError(tileset) {\n  tileset._memoryAdjustedScreenSpaceError = Math.max(tileset.memoryAdjustedScreenSpaceError / 1.02, tileset.maximumScreenSpaceError);\n}\nconst scratchCartesian = new Cartesian3();\nconst stringOptions = {\n  maximumFractionDigits: 3\n};\n\n/**\n * @private\n * @param {number} memorySizeInBytes\n * @returns {string}\n */\nfunction formatMemoryString(memorySizeInBytes) {\n  const memoryInMegabytes = memorySizeInBytes / 1048576;\n  if (memoryInMegabytes < 1.0) {\n    return memoryInMegabytes.toLocaleString(undefined, stringOptions);\n  }\n  return Math.round(memoryInMegabytes).toLocaleString();\n}\n\n/**\n * @private\n * @param {Cesium3DTile} tile\n * @returns {Cartesian3}\n */\nfunction computeTileLabelPosition(tile) {\n  const {\n    halfAxes,\n    radius,\n    center\n  } = tile.boundingVolume.boundingVolume;\n  let position = Cartesian3.clone(center, scratchCartesian);\n  if (defined(halfAxes)) {\n    position.x += 0.75 * (halfAxes[0] + halfAxes[3] + halfAxes[6]);\n    position.y += 0.75 * (halfAxes[1] + halfAxes[4] + halfAxes[7]);\n    position.z += 0.75 * (halfAxes[2] + halfAxes[5] + halfAxes[8]);\n  } else if (defined(radius)) {\n    let normal = Cartesian3.normalize(center, scratchCartesian);\n    normal = Cartesian3.multiplyByScalar(normal, 0.75 * radius, scratchCartesian);\n    position = Cartesian3.add(normal, center, scratchCartesian);\n  }\n  return position;\n}\n\n/**\n * @private\n * @param {Cesium3DTile} tile\n * @param {Cesium3DTileset} tileset\n * @param {Cartesian3} position\n * @returns {Label}\n */\nfunction addTileDebugLabel(tile, tileset, position) {\n  let labelString = \"\";\n  let attributes = 0;\n  if (tileset.debugShowGeometricError) {\n    labelString += `\\nGeometric error: ${tile.geometricError}`;\n    attributes++;\n  }\n  if (tileset.debugShowRenderingStatistics) {\n    labelString += `\\nCommands: ${tile.commandsLength}`;\n    attributes++;\n\n    // Don't display number of points or triangles if 0.\n    const numberOfPoints = tile.content.pointsLength;\n    if (numberOfPoints > 0) {\n      labelString += `\\nPoints: ${tile.content.pointsLength}`;\n      attributes++;\n    }\n    const numberOfTriangles = tile.content.trianglesLength;\n    if (numberOfTriangles > 0) {\n      labelString += `\\nTriangles: ${tile.content.trianglesLength}`;\n      attributes++;\n    }\n    labelString += `\\nFeatures: ${tile.content.featuresLength}`;\n    attributes++;\n  }\n  if (tileset.debugShowMemoryUsage) {\n    labelString += `\\nTexture Memory: ${formatMemoryString(tile.content.texturesByteLength)}`;\n    labelString += `\\nGeometry Memory: ${formatMemoryString(tile.content.geometryByteLength)}`;\n    attributes += 2;\n  }\n  if (tileset.debugShowUrl) {\n    if (tile.hasMultipleContents) {\n      labelString += \"\\nUrls:\";\n      const urls = tile.content.innerContentUrls;\n      for (let i = 0; i < urls.length; i++) {\n        labelString += `\\n- ${urls[i]}`;\n      }\n      attributes += urls.length;\n    } else {\n      labelString += `\\nUrl: ${tile._contentHeader.uri}`;\n      attributes++;\n    }\n  }\n  const newLabel = {\n    text: labelString.substring(1),\n    position: position,\n    font: `${19 - attributes}px sans-serif`,\n    showBackground: true,\n    disableDepthTestDistance: Number.POSITIVE_INFINITY\n  };\n  return tileset._tileDebugLabels.add(newLabel);\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n */\nfunction updateTileDebugLabels(tileset, frameState) {\n  const selectedTiles = tileset._selectedTiles;\n  const selectedLength = selectedTiles.length;\n  const emptyTiles = tileset._emptyTiles;\n  const emptyLength = emptyTiles.length;\n  tileset._tileDebugLabels.removeAll();\n  if (tileset.debugPickedTileLabelOnly) {\n    if (defined(tileset.debugPickedTile)) {\n      const position = defined(tileset.debugPickPosition) ? tileset.debugPickPosition : computeTileLabelPosition(tileset.debugPickedTile);\n      const label = addTileDebugLabel(tileset.debugPickedTile, tileset, position);\n      label.pixelOffset = new Cartesian2(15, -15); // Offset to avoid picking the label.\n    }\n  } else {\n    for (let i = 0; i < selectedLength; ++i) {\n      const tile = selectedTiles[i];\n      addTileDebugLabel(tile, tileset, computeTileLabelPosition(tile));\n    }\n    for (let i = 0; i < emptyLength; ++i) {\n      const tile = emptyTiles[i];\n      if (tile.hasTilesetContent || tile.hasImplicitContent) {\n        addTileDebugLabel(tile, tileset, computeTileLabelPosition(tile));\n      }\n    }\n  }\n  tileset._tileDebugLabels.update(frameState);\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n * @param {object} passOptions\n */\nfunction updateTiles(tileset, frameState, passOptions) {\n  tileset._styleEngine.applyStyle(tileset);\n  tileset._styleApplied = true;\n  const {\n    commandList,\n    context\n  } = frameState;\n  const numberOfInitialCommands = commandList.length;\n  const selectedTiles = tileset._selectedTiles;\n  const bivariateVisibilityTest = tileset.isSkippingLevelOfDetail && tileset._hasMixedContent && context.stencilBuffer && selectedTiles.length > 0;\n  tileset._backfaceCommands.length = 0;\n  if (bivariateVisibilityTest) {\n    if (!defined(tileset._stencilClearCommand)) {\n      tileset._stencilClearCommand = new ClearCommand({\n        stencil: 0,\n        pass: Pass.CESIUM_3D_TILE,\n        renderState: RenderState.fromCache({\n          stencilMask: StencilConstants.SKIP_LOD_MASK\n        })\n      });\n    }\n    commandList.push(tileset._stencilClearCommand);\n  }\n  const {\n    statistics,\n    tileVisible\n  } = tileset;\n  const isRender = passOptions.isRender;\n  const lengthBeforeUpdate = commandList.length;\n  for (let i = 0; i < selectedTiles.length; ++i) {\n    const tile = selectedTiles[i];\n    // Raise the tileVisible event before update in case the tileVisible event\n    // handler makes changes that update needs to apply to WebGL resources\n    if (isRender) {\n      tileVisible.raiseEvent(tile);\n    }\n    processUpdateHeight(tileset, tile, frameState);\n    tile.update(tileset, frameState, passOptions);\n    statistics.incrementSelectionCounts(tile.content);\n    ++statistics.selected;\n  }\n  const emptyTiles = tileset._emptyTiles;\n  for (let i = 0; i < emptyTiles.length; ++i) {\n    const tile = emptyTiles[i];\n    tile.update(tileset, frameState, passOptions);\n  }\n  let addedCommandsLength = commandList.length - lengthBeforeUpdate;\n  tileset._backfaceCommands.trim();\n  if (bivariateVisibilityTest) {\n    /*\n     * Consider 'effective leaf' tiles as selected tiles that have no selected descendants. They may have children,\n     * but they are currently our effective leaves because they do not have selected descendants. These tiles\n     * are those where with tile._finalResolution === true.\n     * Let 'unresolved' tiles be those with tile._finalResolution === false.\n     *\n     * 1. Render just the backfaces of unresolved tiles in order to lay down z\n     * 2. Render all frontfaces wherever tile._selectionDepth > stencilBuffer.\n     *    Replace stencilBuffer with tile._selectionDepth, when passing the z test.\n     *    Because children are always drawn before ancestors {@link Cesium3DTilesetTraversal#traverseAndSelect},\n     *    this effectively draws children first and does not draw ancestors if a descendant has already\n     *    been drawn at that pixel.\n     *    Step 1 prevents child tiles from appearing on top when they are truly behind ancestor content.\n     *    If they are behind the backfaces of the ancestor, then they will not be drawn.\n     *\n     * NOTE: Step 2 sometimes causes visual artifacts when backfacing child content has some faces that\n     * partially face the camera and are inside of the ancestor content. Because they are inside, they will\n     * not be culled by the depth writes in Step 1, and because they partially face the camera, the stencil tests\n     * will draw them on top of the ancestor content.\n     *\n     * NOTE: Because we always render backfaces of unresolved tiles, if the camera is looking at the backfaces\n     * of an object, they will always be drawn while loading, even if backface culling is enabled.\n     */\n\n    const backfaceCommands = tileset._backfaceCommands.values;\n    const backfaceCommandsLength = backfaceCommands.length;\n    commandList.length += backfaceCommandsLength;\n\n    // copy commands to the back of the commandList\n    for (let i = addedCommandsLength - 1; i >= 0; --i) {\n      commandList[lengthBeforeUpdate + backfaceCommandsLength + i] = commandList[lengthBeforeUpdate + i];\n    }\n\n    // move backface commands to the front of the commandList\n    for (let i = 0; i < backfaceCommandsLength; ++i) {\n      commandList[lengthBeforeUpdate + i] = backfaceCommands[i];\n    }\n  }\n\n  // Number of commands added by each update above\n  addedCommandsLength = commandList.length - numberOfInitialCommands;\n  statistics.numberOfCommands = addedCommandsLength;\n  if (!isRender) {\n    return;\n  }\n\n  // Only run EDL if simple attenuation is on\n  if (tileset.pointCloudShading.attenuation && tileset.pointCloudShading.eyeDomeLighting && addedCommandsLength > 0) {\n    tileset._pointCloudEyeDomeLighting.update(frameState, numberOfInitialCommands, tileset.pointCloudShading, tileset.boundingSphere);\n  }\n  if (tileset.debugShowGeometricError || tileset.debugShowRenderingStatistics || tileset.debugShowMemoryUsage || tileset.debugShowUrl) {\n    if (!defined(tileset._tileDebugLabels)) {\n      tileset._tileDebugLabels = new LabelCollection();\n    }\n    updateTileDebugLabels(tileset, frameState);\n  } else {\n    tileset._tileDebugLabels = tileset._tileDebugLabels && tileset._tileDebugLabels.destroy();\n  }\n}\nconst scratchStack = [];\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction destroySubtree(tileset, tile) {\n  const root = tile;\n  const stack = scratchStack;\n  stack.push(tile);\n  while (stack.length > 0) {\n    tile = stack.pop();\n    const children = tile.children;\n    for (let i = 0; i < children.length; ++i) {\n      stack.push(children[i]);\n    }\n    if (tile !== root) {\n      destroyTile(tileset, tile);\n      --tileset._statistics.numberOfTilesTotal;\n    }\n  }\n  root.children = [];\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction unloadTile(tileset, tile) {\n  tileset.tileUnload.raiseEvent(tile);\n  tileset._statistics.decrementLoadCounts(tile.content);\n  --tileset._statistics.numberOfTilesWithContentReady;\n  tile.unloadContent();\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction destroyTile(tileset, tile) {\n  tileset._cache.unloadTile(tileset, tile, unloadTile);\n  tile.destroy();\n}\n\n/**\n * Unloads all tiles that weren't selected the previous frame.  This can be used to\n * explicitly manage the tile cache and reduce the total number of tiles loaded below\n * {@link Cesium3DTileset#cacheBytes}.\n * <p>\n * Tile unloads occur at the next frame to keep all the WebGL delete calls\n * within the render loop.\n * </p>\n */\nCesium3DTileset.prototype.trimLoadedTiles = function () {\n  this._cache.trim();\n};\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n */\nfunction raiseLoadProgressEvent(tileset, frameState) {\n  const statistics = tileset._statistics;\n  const statisticsLast = tileset._statisticsLast;\n  const numberOfPendingRequests = statistics.numberOfPendingRequests;\n  const numberOfTilesProcessing = statistics.numberOfTilesProcessing;\n  const lastNumberOfPendingRequest = statisticsLast.numberOfPendingRequests;\n  const lastNumberOfTilesProcessing = statisticsLast.numberOfTilesProcessing;\n  Cesium3DTilesetStatistics.clone(statistics, statisticsLast);\n  const progressChanged = numberOfPendingRequests !== lastNumberOfPendingRequest || numberOfTilesProcessing !== lastNumberOfTilesProcessing;\n  if (progressChanged) {\n    frameState.afterRender.push(function () {\n      tileset.loadProgress.raiseEvent(numberOfPendingRequests, numberOfTilesProcessing);\n      return true;\n    });\n  }\n  tileset._tilesLoaded = statistics.numberOfPendingRequests === 0 && statistics.numberOfTilesProcessing === 0 && statistics.numberOfAttemptedRequests === 0;\n\n  // Events are raised (added to the afterRender queue) here since promises\n  // may resolve outside of the update loop that then raise events, e.g.,\n  // model's readyEvent\n  if (progressChanged && tileset._tilesLoaded) {\n    frameState.afterRender.push(function () {\n      tileset.allTilesLoaded.raiseEvent();\n      return true;\n    });\n    if (!tileset._initialTilesLoaded) {\n      tileset._initialTilesLoaded = true;\n      frameState.afterRender.push(function () {\n        tileset.initialTilesLoaded.raiseEvent();\n        return true;\n      });\n    }\n  }\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n */\nfunction resetMinimumMaximum(tileset) {\n  tileset._heatmap.resetMinimumMaximum();\n  tileset._minimumPriority.depth = Number.MAX_VALUE;\n  tileset._maximumPriority.depth = -Number.MAX_VALUE;\n  tileset._minimumPriority.foveatedFactor = Number.MAX_VALUE;\n  tileset._maximumPriority.foveatedFactor = -Number.MAX_VALUE;\n  tileset._minimumPriority.distance = Number.MAX_VALUE;\n  tileset._maximumPriority.distance = -Number.MAX_VALUE;\n  tileset._minimumPriority.reverseScreenSpaceError = Number.MAX_VALUE;\n  tileset._maximumPriority.reverseScreenSpaceError = -Number.MAX_VALUE;\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n */\nfunction detectModelMatrixChanged(tileset, frameState) {\n  if (frameState.frameNumber === tileset._updatedModelMatrixFrame && defined(tileset._previousModelMatrix)) {\n    return;\n  }\n  tileset._updatedModelMatrixFrame = frameState.frameNumber;\n  tileset._modelMatrixChanged = !Matrix4.equals(tileset.modelMatrix, tileset._previousModelMatrix);\n  if (tileset._modelMatrixChanged) {\n    tileset._previousModelMatrix = Matrix4.clone(tileset.modelMatrix, tileset._previousModelMatrix);\n  }\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n * @param {Cesium3DTilesetStatistics} passStatistics\n * @param {object} passOptions\n * @returns {boolean}\n */\nfunction update(tileset, frameState, passStatistics, passOptions) {\n  if (frameState.mode === SceneMode.MORPHING) {\n    return false;\n  }\n  if (!defined(tileset._root)) {\n    return false;\n  }\n  const statistics = tileset._statistics;\n  statistics.clear();\n\n  // Resets the visibility check for each pass\n  ++tileset._updatedVisibilityFrame;\n\n  // Update any tracked min max values\n  resetMinimumMaximum(tileset);\n  detectModelMatrixChanged(tileset, frameState);\n  tileset._cullRequestsWhileMoving = tileset.cullRequestsWhileMoving && !tileset._modelMatrixChanged;\n  const ready = tileset.getTraversal(passOptions).selectTiles(tileset, frameState);\n  if (passOptions.requestTiles) {\n    requestTiles(tileset);\n  }\n  updateTiles(tileset, frameState, passOptions);\n\n  // Update pass statistics\n  Cesium3DTilesetStatistics.clone(statistics, passStatistics);\n  if (passOptions.isRender) {\n    const credits = tileset._credits;\n    if (defined(credits) && statistics.selected !== 0) {\n      for (let i = 0; i < credits.length; ++i) {\n        const credit = credits[i];\n        frameState.creditDisplay.addCreditToNextFrame(credit);\n      }\n    }\n  }\n  return ready;\n}\nfunction createCredits(tileset) {\n  let credits = tileset._credits;\n  if (!defined(credits)) {\n    credits = [];\n  }\n  credits.length = 0;\n  if (defined(tileset.resource.credits)) {\n    tileset.resource.credits.forEach(credit => {\n      credits.push(Credit.clone(credit));\n    });\n  }\n  const assetExtras = tileset.asset.extras;\n  if (defined(assetExtras) && defined(assetExtras.cesium) && defined(assetExtras.cesium.credits)) {\n    const extraCredits = assetExtras.cesium.credits;\n    for (let i = 0; i < extraCredits.length; ++i) {\n      const credit = extraCredits[i];\n      credits.push(new Credit(credit.html));\n    }\n  }\n  credits.forEach(credit => credit.showOnScreen = credit.showOnScreen || tileset._showCreditsOnScreen);\n  tileset._credits = credits;\n}\n\n/**\n * @private\n * @param {object} passOptions\n * @returns {Cesium3DTilesetTraversal}\n */\nCesium3DTileset.prototype.getTraversal = function (passOptions) {\n  const {\n    pass\n  } = passOptions;\n  if (pass === Cesium3DTilePass.MOST_DETAILED_PRELOAD || pass === Cesium3DTilePass.MOST_DETAILED_PICK) {\n    return Cesium3DTilesetMostDetailedTraversal;\n  }\n  return this.isSkippingLevelOfDetail ? Cesium3DTilesetSkipTraversal : Cesium3DTilesetBaseTraversal;\n};\n\n/**\n * @private\n * @param {FrameState} frameState\n */\nCesium3DTileset.prototype.update = function (frameState) {\n  this.updateForPass(frameState, frameState.tilesetPassState);\n};\n\n/**\n * @private\n * @param {FrameState} frameState\n * @param {object} tilesetPassState\n */\nCesium3DTileset.prototype.updateForPass = function (frameState, tilesetPassState) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.object(\"frameState\", frameState);\n  Check.typeOf.object(\"tilesetPassState\", tilesetPassState);\n  //>>includeEnd('debug');\n\n  const pass = tilesetPassState.pass;\n  if (pass === Cesium3DTilePass.PRELOAD && (!this.preloadWhenHidden || this.show) || pass === Cesium3DTilePass.PRELOAD_FLIGHT && (!this.preloadFlightDestinations || !this.show && !this.preloadWhenHidden) || pass === Cesium3DTilePass.REQUEST_RENDER_MODE_DEFER_CHECK && (!this._cullRequestsWhileMoving && this.foveatedTimeDelay <= 0 || !this.show)) {\n    return;\n  }\n  const originalCommandList = frameState.commandList;\n  const originalCamera = frameState.camera;\n  const originalCullingVolume = frameState.cullingVolume;\n  tilesetPassState.ready = false;\n  const passOptions = Cesium3DTilePass.getPassOptions(pass);\n  const ignoreCommands = passOptions.ignoreCommands;\n  const commandList = defaultValue(tilesetPassState.commandList, originalCommandList);\n  const commandStart = commandList.length;\n  frameState.commandList = commandList;\n  frameState.camera = defaultValue(tilesetPassState.camera, originalCamera);\n  frameState.cullingVolume = defaultValue(tilesetPassState.cullingVolume, originalCullingVolume);\n  if (passOptions.isRender) {\n    const environmentMapManager = this._environmentMapManager;\n    if (defined(this._root)) {\n      environmentMapManager.position = this.boundingSphere.center;\n    }\n    environmentMapManager.update(frameState);\n  }\n\n  // Update clipping polygons\n  const clippingPolygons = this._clippingPolygons;\n  if (defined(clippingPolygons) && clippingPolygons.enabled) {\n    clippingPolygons.queueCommands(frameState);\n  }\n  const passStatistics = this._statisticsPerPass[pass];\n  if (this.show || ignoreCommands) {\n    this._pass = pass;\n    tilesetPassState.ready = update(this, frameState, passStatistics, passOptions);\n  }\n  if (ignoreCommands) {\n    commandList.length = commandStart;\n  }\n  frameState.commandList = originalCommandList;\n  frameState.camera = originalCamera;\n  frameState.cullingVolume = originalCullingVolume;\n};\n\n/**\n * <code>true</code> if the tileset JSON file lists the extension in extensionsUsed; otherwise, <code>false</code>.\n * @param {string} extensionName The name of the extension to check.\n *\n * @returns {boolean} <code>true</code> if the tileset JSON file lists the extension in extensionsUsed; otherwise, <code>false</code>.\n */\nCesium3DTileset.prototype.hasExtension = function (extensionName) {\n  if (!defined(this._extensionsUsed)) {\n    return false;\n  }\n  return this._extensionsUsed.indexOf(extensionName) > -1;\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <br /><br />\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n *\n * @returns {boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n *\n * @see Cesium3DTileset#destroy\n */\nCesium3DTileset.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n * <br /><br />\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n * @example\n * tileset = tileset && tileset.destroy();\n *\n * @see Cesium3DTileset#isDestroyed\n */\nCesium3DTileset.prototype.destroy = function () {\n  this._tileDebugLabels = this._tileDebugLabels && this._tileDebugLabels.destroy();\n  this._clippingPlanes = this._clippingPlanes && this._clippingPlanes.destroy();\n  this._clippingPolygons = this._clippingPolygons && this._clippingPolygons.destroy();\n\n  // Traverse the tree and destroy all tiles\n  if (defined(this._root)) {\n    const stack = scratchStack;\n    stack.push(this._root);\n    while (stack.length > 0) {\n      const tile = stack.pop();\n      tile.destroy();\n      const children = tile.children;\n      for (let i = 0; i < children.length; ++i) {\n        stack.push(children[i]);\n      }\n    }\n  }\n  this._root = undefined;\n  if (this._shouldDestroyImageBasedLighting && !this._imageBasedLighting.isDestroyed()) {\n    this._imageBasedLighting.destroy();\n  }\n  this._imageBasedLighting = undefined;\n  if (!this._environmentMapManager.isDestroyed()) {\n    this._environmentMapManager.destroy();\n  }\n  this._environmentMapManager = undefined;\n  return destroyObject(this);\n};\nCesium3DTileset.supportedExtensions = {\n  \"3DTILES_metadata\": true,\n  \"3DTILES_implicit_tiling\": true,\n  \"3DTILES_content_gltf\": true,\n  \"3DTILES_multiple_contents\": true,\n  \"3DTILES_bounding_volume_S2\": true,\n  \"3DTILES_batch_table_hierarchy\": true,\n  \"3DTILES_draco_point_compression\": true,\n  MAXAR_content_geojson: true\n};\n\n/**\n * Checks to see if a given extension is supported by Cesium3DTileset. If\n * the extension is not supported by Cesium3DTileset, it throws a RuntimeError.\n *\n * @param {object} extensionsRequired The extensions we wish to check\n *\n * @private\n */\nCesium3DTileset.checkSupportedExtensions = function (extensionsRequired) {\n  for (let i = 0; i < extensionsRequired.length; i++) {\n    if (!Cesium3DTileset.supportedExtensions[extensionsRequired[i]]) {\n      throw new RuntimeError(`Unsupported 3D Tiles Extension: ${extensionsRequired[i]}`);\n    }\n  }\n};\nconst scratchGetHeightRay = new Ray();\nconst scratchIntersection = new Cartesian3();\nconst scratchGetHeightCartographic = new Cartographic();\n\n/**\n * Get the height of the loaded surface at a given cartographic. This function will only take into account meshes for loaded tiles, not neccisarily the most detailed tiles available for a tileset. This function will always return undefined when sampling a point cloud.\n *\n * @param {Cartographic} cartographic The cartographic for which to find the height.\n * @param {Scene} scene The scene where visualization is taking place.\n * @returns {number|undefined} The height of the cartographic or undefined if it could not be found.\n *\n * @example\n * const tileset = await Cesium.Cesium3DTileset.fromIonAssetId(124624234);\n * scene.primitives.add(tileset);\n *\n * const height = tileset.getHeight(scene.camera.positionCartographic, scene);\n */\nCesium3DTileset.prototype.getHeight = function (cartographic, scene) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.object(\"cartographic\", cartographic);\n  Check.typeOf.object(\"scene\", scene);\n  //>>includeEnd('debug');\n\n  let ellipsoid = scene.ellipsoid;\n  if (!defined(ellipsoid)) {\n    ellipsoid = Ellipsoid.WGS84;\n  }\n  const ray = scratchGetHeightRay;\n  const position = ellipsoid.cartographicToCartesian(cartographic, ray.direction);\n  Cartesian3.normalize(ray.direction, ray.direction);\n  ray.direction = Cartesian3.normalize(position, ray.direction);\n  ray.direction = Cartesian3.negate(position, ray.direction);\n  ray.origin = Cartesian3.multiplyByScalar(ray.direction, -2 * ellipsoid.maximumRadius, ray.origin);\n  const intersection = this.pick(ray, scene.frameState, scratchIntersection);\n  if (!defined(intersection)) {\n    return;\n  }\n  return ellipsoid.cartesianToCartographic(intersection, scratchGetHeightCartographic)?.height;\n};\n\n/**\n * Calls the callback when a new tile is rendered that contains the given cartographic. The only parameter\n * is the cartographic position on the tile.\n *\n * @private\n *\n * @param {Scene} scene The scene where visualization is taking place.\n * @param {Cartographic} cartographic The cartographic position.\n * @param {Function} callback The function to be called when a new tile is loaded.\n * @param {Ellipsoid} [ellipsoid=Ellipsoid.WGS84] The ellipsoid to use.\n * @returns {Function} The function to remove this callback from the quadtree.\n */\nCesium3DTileset.prototype.updateHeight = function (cartographic, callback, ellipsoid) {\n  ellipsoid = defaultValue(ellipsoid, Ellipsoid.WGS84);\n  const object = {\n    positionCartographic: cartographic,\n    ellipsoid: ellipsoid,\n    callback: callback,\n    invoked: false\n  };\n  const removeCallback = () => {\n    const addedCallbacks = this._addHeightCallbacks;\n    const length = addedCallbacks.length;\n    for (let i = 0; i < length; ++i) {\n      if (addedCallbacks[i] === object) {\n        addedCallbacks.splice(i, 1);\n        break;\n      }\n    }\n    if (object.callback) {\n      object.callback = undefined;\n    }\n  };\n  this._addHeightCallbacks.push(object);\n  return removeCallback;\n};\nconst scratchSphereIntersection = new Interval();\nconst scratchPickIntersection = new Cartesian3();\n\n/**\n * Find an intersection between a ray and the tileset surface that was rendered. The ray must be given in world coordinates.\n *\n * @param {Ray} ray The ray to test for intersection.\n * @param {FrameState} frameState The frame state.\n * @param {Cartesian3|undefined} [result] The intersection or <code>undefined</code> if none was found.\n * @returns {Cartesian3|undefined} The intersection or <code>undefined</code> if none was found.\n *\n * @private\n */\nCesium3DTileset.prototype.pick = function (ray, frameState, result) {\n  if (!frameState.context.webgl2 && !this._enablePick) {\n    return;\n  }\n  const selectedTiles = this._selectedTiles;\n  const selectedLength = selectedTiles.length;\n  const candidates = [];\n  for (let i = 0; i < selectedLength; ++i) {\n    const tile = selectedTiles[i];\n    const boundsIntersection = IntersectionTests.raySphere(ray, tile.contentBoundingVolume.boundingSphere, scratchSphereIntersection);\n    if (!defined(boundsIntersection) || !defined(tile.content)) {\n      continue;\n    }\n    candidates.push(tile);\n  }\n  const length = candidates.length;\n  candidates.sort((a, b) => {\n    const aDist = BoundingSphere.distanceSquaredTo(a.contentBoundingVolume.boundingSphere, ray.origin);\n    const bDist = BoundingSphere.distanceSquaredTo(b.contentBoundingVolume.boundingSphere, ray.origin);\n    return aDist - bDist;\n  });\n  let intersection;\n  for (let i = 0; i < length; ++i) {\n    const tile = candidates[i];\n    const candidate = tile.content.pick(ray, frameState, scratchPickIntersection);\n    if (defined(candidate)) {\n      intersection = Cartesian3.clone(candidate, result);\n      return intersection;\n    }\n  }\n};\n\n/**\n * Optimization option. Used as a callback when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control how much to raise the screen space error for tiles outside the foveated cone,\n * interpolating between {@link Cesium3DTileset#foveatedMinimumScreenSpaceErrorRelaxation} and {@link Cesium3DTileset#maximumScreenSpaceError}.\n *\n * @callback Cesium3DTileset.foveatedInterpolationCallback\n * @default Math.lerp\n *\n * @param {number} p The start value to interpolate.\n * @param {number} q The end value to interpolate.\n * @param {number} time The time of interpolation generally in the range <code>[0.0, 1.0]</code>.\n * @returns {number} The interpolated value.\n */\nexport default Cesium3DTileset;","map":{"version":3,"names":["ApproximateTerrainHeights","BoundingSphere","Cartesian2","Cartesian3","Cartographic","Check","clone","Color","Credit","defaultValue","defined","deprecationWarning","destroyObject","Ellipsoid","Event","ImageBasedLighting","Interval","IntersectionTests","IonResource","JulianDate","ManagedArray","CesiumMath","Matrix3","Matrix4","Resource","RuntimeError","Transforms","ClearCommand","Pass","RenderState","Axis","Cesium3DTile","Cesium3DTileColorBlendMode","Cesium3DTileContentState","Cesium3DTilesetMetadata","Cesium3DTileOptimizations","Cesium3DTilePass","Cesium3DTileRefine","Cesium3DTilesetCache","Cesium3DTilesetHeatmap","Cesium3DTilesetStatistics","Cesium3DTileStyleEngine","ClippingPlaneCollection","ClippingPolygonCollection","hasExtension","ImplicitTileset","ImplicitTileCoordinates","LabelCollection","oneTimeWarning","PointCloudEyeDomeLighting","PointCloudShading","ResourceCache","SceneMode","ShadowMode","SplitDirection","StencilConstants","TileBoundingRegion","TileBoundingSphere","TileOrientedBoundingBox","Cesium3DTilesetMostDetailedTraversal","Cesium3DTilesetBaseTraversal","Cesium3DTilesetSkipTraversal","Ray","DynamicEnvironmentMapManager","Cesium3DTileset","options","EMPTY_OBJECT","_url","undefined","_basePath","_root","_resource","_asset","_properties","_geometricError","_scaledGeometricError","_extensionsUsed","_extensions","_modelUpAxis","_modelForwardAxis","_cache","_processingQueue","_selectedTiles","_emptyTiles","_requestedTiles","_selectedTilesToStyle","_loadTimestamp","_timeSinceLoad","_updatedVisibilityFrame","_updatedModelMatrixFrame","_modelMatrixChanged","_previousModelMatrix","_extras","_credits","_showCreditsOnScreen","showCreditsOnScreen","_cullWithChildrenBounds","cullWithChildrenBounds","_allTilesAdditive","_hasMixedContent","_stencilClearCommand","_backfaceCommands","_maximumScreenSpaceError","maximumScreenSpaceError","_memoryAdjustedScreenSpaceError","_cacheBytes","cacheBytes","typeOf","number","greaterThanOrEquals","maximumCacheOverflowBytes","_maximumCacheOverflowBytes","_styleEngine","_styleApplied","_modelMatrix","modelMatrix","IDENTITY","_addHeightCallbacks","_statistics","_statisticsLast","_statisticsPerPass","Array","NUMBER_OF_PASSES","i","_requestedTilesInFlight","_maximumPriority","foveatedFactor","Number","MAX_VALUE","depth","distance","reverseScreenSpaceError","_minimumPriority","_heatmap","debugHeatmapTilePropertyName","cullRequestsWhileMoving","_cullRequestsWhileMoving","cullRequestsWhileMovingMultiplier","progressiveResolutionHeightFraction","clamp","preferLeaves","_tilesLoaded","_initialTilesLoaded","_tileDebugLabels","_classificationType","classificationType","_ellipsoid","ellipsoid","WGS84","_initialClippingPlanesOriginMatrix","_clippingPlanesOriginMatrix","_clippingPlanesOriginMatrixDirty","_vectorClassificationOnly","vectorClassificationOnly","_vectorKeepDecodedPositions","vectorKeepDecodedPositions","preloadWhenHidden","preloadFlightDestinations","_pass","dynamicScreenSpaceError","foveatedScreenSpaceError","_foveatedConeSize","foveatedConeSize","_foveatedMinimumScreenSpaceErrorRelaxation","foveatedMinimumScreenSpaceErrorRelaxation","foveatedInterpolationCallback","lerp","foveatedTimeDelay","dynamicScreenSpaceErrorDensity","dynamicScreenSpaceErrorFactor","dynamicScreenSpaceErrorHeightFalloff","_dynamicScreenSpaceErrorComputedDensity","shadows","ENABLED","show","colorBlendMode","HIGHLIGHT","colorBlendAmount","_pointCloudShading","pointCloudShading","_pointCloudEyeDomeLighting","loadProgress","allTilesLoaded","initialTilesLoaded","tileLoad","tileUnload","tileFailed","tileVisible","skipLevelOfDetail","_disableSkipLevelOfDetail","baseScreenSpaceError","skipScreenSpaceErrorFactor","skipLevels","immediatelyLoadDesiredLevelOfDetail","loadSiblings","_clippingPlanes","clippingPlanes","setOwner","_clippingPolygons","clippingPolygons","imageBasedLighting","_imageBasedLighting","_shouldDestroyImageBasedLighting","_environmentMapManager","environmentMapOptions","lightColor","backFaceCulling","_enableShowOutline","enableShowOutline","showOutline","outlineColor","BLACK","splitDirection","NONE","enableCollision","_projectTo2D","projectTo2D","_enablePick","enablePick","debugFreezeFrame","debugColorizeTiles","_enableDebugWireframe","enableDebugWireframe","debugWireframe","debugShowBoundingVolume","debugShowContentBoundingVolume","debugShowViewerRequestVolume","debugPickedTileLabelOnly","debugPickedTile","debugPickPosition","debugShowGeometricError","debugShowRenderingStatistics","debugShowMemoryUsage","debugShowUrl","examineVectorLinesFunction","_metadataExtension","_customShader","customShader","featureIdLabel","_featureIdLabel","instanceFeatureIdLabel","_instanceFeatureIdLabel","Object","defineProperties","prototype","isCesium3DTileset","get","asset","extensions","set","value","properties","tilesLoaded","resource","basePath","style","hasMixedContent","bool","isSkippingLevelOfDetail","metadataExtension","metadata","tileset","schema","memoryAdjustedScreenSpaceError","root","boundingSphere","updateTransform","timeSinceLoad","totalMemoryUsageInBytes","statistics","texturesByteLength","geometryByteLength","batchTableByteLength","clippingPlanesOriginMatrix","multiply","computedTransform","styleEngine","lessThanOrEquals","extras","object","isDestroyed","destroy","environmentMapManager","createCredits","string","fromIonAssetId","assetId","fromAssetId","fromUrl","url","createIfNeeded","extension","getBaseUri","isDataUri","tilesetJson","loadJson","processMetadataExtension","geometricError","gltfUpAxis","fromName","Y","modelUpAxis","modelForwardAxis","X","extensionsUsed","loadTileset","boundingVolume","createBoundingVolume","clippingPlanesOrigin","center","originCartographic","cartesianToCartographic","height","_defaultMinTerrainHeight","eastNorthUpToFixedFrame","tilesetUrl","fetchJson","makeStyleDirty","makeDirty","parentTile","version","extensionsRequired","checkSupportedExtensions","tilesetVersion","setQueryParameters","v","rootTile","makeTile","children","push","_depth","stack","length","tile","pop","numberOfTilesTotal","refine","ADD","_header","childHeader","childTile","checkChildrenWithinParent","baseResource","tileHeader","hasImplicitTiling","implicitTiling","metadataSchema","implicitTileset","rootCoordinates","subdivisionScheme","subtreeLevels","level","x","y","z","contentUri","subtreeUriTemplate","getDerivedResource","templateValues","getTemplateValues","deepCopy","tileJson","contents","uri","content","implicitCoordinates","metadataJson","schemaLoader","schemaUri","getSchemaLoader","load","unload","scratchPositionNormal","scratchCartographic","scratchMatrix","scratchCenter","scratchPosition","scratchDirection","scratchHalfHeight","updateDynamicScreenSpaceError","frameState","up","direction","minimumHeight","maximumHeight","camera","tileBoundingVolume","contentBoundingVolume","normalize","positionWC","directionWC","positionCartographic","transformLocal","inverseTransformation","mapProjection","centerLocal","multiplyByPoint","magnitude","minimumRadius","centerCartographic","fromCartesian","positionLocal","UNIT_Z","multiplyByPointAsVector","halfHeightVector","getColumn","halfAxes","halfHeight","radius","heightFalloff","heightClose","heightFar","t","horizonFactor","Math","abs","dot","requestContent","hasEmptyContent","contentExpired","promise","then","numberOfTilesProcessing","catch","error","handleTileFailure","hasTilesetContent","hasImplicitContent","destroySubtree","decrementLoadCounts","numberOfTilesWithContentReady","sortTilesByPriority","a","b","_priority","postPassesUpdate","cancelOutOfViewRequests","raiseLoadProgressEvent","unloadTiles","unloadTile","resetDirty","prePassesUpdate","processTiles","enabled","update","time","max","secondsDifference","newFrame","reset","requestedTilesInFlight","removeCount","outOfView","frameNumber","_touchedFrame","_contentState","LOADING","cancelRequests","requestTiles","requestedTiles","sort","_contentResource","message","toString","numberOfListeners","raiseEvent","console","log","filterProcessingQueue","tiles","PROCESSING","scratchUpdateHeightCartographic","scratchUpdateHeightCartographic2","scratchUpdateHeightCartesian","processUpdateHeight","heightCallbackData","callbackData","invoked","_wasSelectedLastFrame","position","toCartesian","afterRender","callback","cacheByteLimit","memoryExceeded","process","contentReady","decreaseScreenSpaceError","increaseScreenSpaceError","updatePriority","scratchCartesian","stringOptions","maximumFractionDigits","formatMemoryString","memorySizeInBytes","memoryInMegabytes","toLocaleString","round","computeTileLabelPosition","normal","multiplyByScalar","add","addTileDebugLabel","labelString","attributes","commandsLength","numberOfPoints","pointsLength","numberOfTriangles","trianglesLength","featuresLength","hasMultipleContents","urls","innerContentUrls","_contentHeader","newLabel","text","substring","font","showBackground","disableDepthTestDistance","POSITIVE_INFINITY","updateTileDebugLabels","selectedTiles","selectedLength","emptyTiles","emptyLength","removeAll","label","pixelOffset","updateTiles","passOptions","applyStyle","commandList","context","numberOfInitialCommands","bivariateVisibilityTest","stencilBuffer","stencil","pass","CESIUM_3D_TILE","renderState","fromCache","stencilMask","SKIP_LOD_MASK","isRender","lengthBeforeUpdate","incrementSelectionCounts","selected","addedCommandsLength","trim","backfaceCommands","values","backfaceCommandsLength","numberOfCommands","attenuation","eyeDomeLighting","scratchStack","destroyTile","unloadContent","trimLoadedTiles","statisticsLast","numberOfPendingRequests","lastNumberOfPendingRequest","lastNumberOfTilesProcessing","progressChanged","numberOfAttemptedRequests","resetMinimumMaximum","detectModelMatrixChanged","equals","passStatistics","mode","MORPHING","clear","ready","getTraversal","selectTiles","credits","credit","creditDisplay","addCreditToNextFrame","forEach","assetExtras","cesium","extraCredits","html","showOnScreen","MOST_DETAILED_PRELOAD","MOST_DETAILED_PICK","updateForPass","tilesetPassState","PRELOAD","PRELOAD_FLIGHT","REQUEST_RENDER_MODE_DEFER_CHECK","originalCommandList","originalCamera","originalCullingVolume","cullingVolume","getPassOptions","ignoreCommands","commandStart","queueCommands","extensionName","indexOf","supportedExtensions","MAXAR_content_geojson","scratchGetHeightRay","scratchIntersection","scratchGetHeightCartographic","getHeight","cartographic","scene","ray","cartographicToCartesian","negate","origin","maximumRadius","intersection","pick","updateHeight","removeCallback","addedCallbacks","splice","scratchSphereIntersection","scratchPickIntersection","result","webgl2","candidates","boundsIntersection","raySphere","aDist","distanceSquaredTo","bDist","candidate"],"sources":["/Users/mac/Desktop/IWL_Fresh_Start/Lab4gps-Love-In-Action/node_modules/@cesium/engine/Source/Scene/Cesium3DTileset.js"],"sourcesContent":["import ApproximateTerrainHeights from \"../Core/ApproximateTerrainHeights.js\";\nimport BoundingSphere from \"../Core/BoundingSphere.js\";\nimport Cartesian2 from \"../Core/Cartesian2.js\";\nimport Cartesian3 from \"../Core/Cartesian3.js\";\nimport Cartographic from \"../Core/Cartographic.js\";\nimport Check from \"../Core/Check.js\";\nimport clone from \"../Core/clone.js\";\nimport Color from \"../Core/Color.js\";\nimport Credit from \"../Core/Credit.js\";\nimport defaultValue from \"../Core/defaultValue.js\";\nimport defined from \"../Core/defined.js\";\nimport deprecationWarning from \"../Core/deprecationWarning.js\";\nimport destroyObject from \"../Core/destroyObject.js\";\nimport Ellipsoid from \"../Core/Ellipsoid.js\";\nimport Event from \"../Core/Event.js\";\nimport ImageBasedLighting from \"./ImageBasedLighting.js\";\nimport Interval from \"../Core/Interval.js\";\nimport IntersectionTests from \"../Core/IntersectionTests.js\";\nimport IonResource from \"../Core/IonResource.js\";\nimport JulianDate from \"../Core/JulianDate.js\";\nimport ManagedArray from \"../Core/ManagedArray.js\";\nimport CesiumMath from \"../Core/Math.js\";\nimport Matrix3 from \"../Core/Matrix3.js\";\nimport Matrix4 from \"../Core/Matrix4.js\";\nimport Resource from \"../Core/Resource.js\";\nimport RuntimeError from \"../Core/RuntimeError.js\";\nimport Transforms from \"../Core/Transforms.js\";\nimport ClearCommand from \"../Renderer/ClearCommand.js\";\nimport Pass from \"../Renderer/Pass.js\";\nimport RenderState from \"../Renderer/RenderState.js\";\nimport Axis from \"./Axis.js\";\nimport Cesium3DTile from \"./Cesium3DTile.js\";\nimport Cesium3DTileColorBlendMode from \"./Cesium3DTileColorBlendMode.js\";\nimport Cesium3DTileContentState from \"./Cesium3DTileContentState.js\";\nimport Cesium3DTilesetMetadata from \"./Cesium3DTilesetMetadata.js\";\nimport Cesium3DTileOptimizations from \"./Cesium3DTileOptimizations.js\";\nimport Cesium3DTilePass from \"./Cesium3DTilePass.js\";\nimport Cesium3DTileRefine from \"./Cesium3DTileRefine.js\";\nimport Cesium3DTilesetCache from \"./Cesium3DTilesetCache.js\";\nimport Cesium3DTilesetHeatmap from \"./Cesium3DTilesetHeatmap.js\";\nimport Cesium3DTilesetStatistics from \"./Cesium3DTilesetStatistics.js\";\nimport Cesium3DTileStyleEngine from \"./Cesium3DTileStyleEngine.js\";\nimport ClippingPlaneCollection from \"./ClippingPlaneCollection.js\";\nimport ClippingPolygonCollection from \"./ClippingPolygonCollection.js\";\nimport hasExtension from \"./hasExtension.js\";\nimport ImplicitTileset from \"./ImplicitTileset.js\";\nimport ImplicitTileCoordinates from \"./ImplicitTileCoordinates.js\";\nimport LabelCollection from \"./LabelCollection.js\";\nimport oneTimeWarning from \"../Core/oneTimeWarning.js\";\nimport PointCloudEyeDomeLighting from \"./PointCloudEyeDomeLighting.js\";\nimport PointCloudShading from \"./PointCloudShading.js\";\nimport ResourceCache from \"./ResourceCache.js\";\nimport SceneMode from \"./SceneMode.js\";\nimport ShadowMode from \"./ShadowMode.js\";\nimport SplitDirection from \"./SplitDirection.js\";\nimport StencilConstants from \"./StencilConstants.js\";\nimport TileBoundingRegion from \"./TileBoundingRegion.js\";\nimport TileBoundingSphere from \"./TileBoundingSphere.js\";\nimport TileOrientedBoundingBox from \"./TileOrientedBoundingBox.js\";\nimport Cesium3DTilesetMostDetailedTraversal from \"./Cesium3DTilesetMostDetailedTraversal.js\";\nimport Cesium3DTilesetBaseTraversal from \"./Cesium3DTilesetBaseTraversal.js\";\nimport Cesium3DTilesetSkipTraversal from \"./Cesium3DTilesetSkipTraversal.js\";\nimport Ray from \"../Core/Ray.js\";\nimport DynamicEnvironmentMapManager from \"./DynamicEnvironmentMapManager.js\";\n\n/**\n * @typedef {Object} Cesium3DTileset.ConstructorOptions\n *\n * Initialization options for the Cesium3DTileset constructor\n *\n * @property {boolean} [show=true] Determines if the tileset will be shown.\n * @property {Matrix4} [modelMatrix=Matrix4.IDENTITY] A 4x4 transformation matrix that transforms the tileset's root tile.\n * @property {Axis} [modelUpAxis=Axis.Y] Which axis is considered up when loading models for tile contents.\n * @property {Axis} [modelForwardAxis=Axis.X] Which axis is considered forward when loading models for tile contents.\n * @property {ShadowMode} [shadows=ShadowMode.ENABLED] Determines whether the tileset casts or receives shadows from light sources.\n * @property {number} [maximumScreenSpaceError=16] The maximum screen space error used to drive level of detail refinement.\n * @property {number} [cacheBytes=536870912] The size (in bytes) to which the tile cache will be trimmed, if the cache contains tiles not needed for the current view.\n * @property {number} [maximumCacheOverflowBytes=536870912] The maximum additional memory (in bytes) to allow for cache headroom, if more than {@link Cesium3DTileset#cacheBytes} are needed for the current view.\n * @property {boolean} [cullWithChildrenBounds=true] Optimization option. Whether to cull tiles using the union of their children bounding volumes.\n * @property {boolean} [cullRequestsWhileMoving=true] Optimization option. Don't request tiles that will likely be unused when they come back because of the camera's movement. This optimization only applies to stationary tilesets.\n * @property {number} [cullRequestsWhileMovingMultiplier=60.0] Optimization option. Multiplier used in culling requests while moving. Larger is more aggressive culling, smaller less aggressive culling.\n * @property {boolean} [preloadWhenHidden=false] Preload tiles when <code>tileset.show</code> is <code>false</code>. Loads tiles as if the tileset is visible but does not render them.\n * @property {boolean} [preloadFlightDestinations=true] Optimization option. Preload tiles at the camera's flight destination while the camera is in flight.\n * @property {boolean} [preferLeaves=false] Optimization option. Prefer loading of leaves first.\n * @property {boolean} [dynamicScreenSpaceError=true] Optimization option. For street-level horizon views, use lower resolution tiles far from the camera. This reduces the amount of data loaded and improves tileset loading time with a slight drop in visual quality in the distance.\n * @property {number} [dynamicScreenSpaceErrorDensity=2.0e-4] Similar to {@link Fog#density}, this option controls the camera distance at which the {@link Cesium3DTileset#dynamicScreenSpaceError} optimization applies. Larger values will cause tiles closer to the camera to be affected.\n * @property {number} [dynamicScreenSpaceErrorFactor=24.0] A parameter that controls the intensity of the {@link Cesium3DTileset#dynamicScreenSpaceError} optimization for tiles on the horizon. Larger values cause lower resolution tiles to load, improving runtime performance at a slight reduction of visual quality.\n * @property {number} [dynamicScreenSpaceErrorHeightFalloff=0.25] A ratio of the tileset's height that determines where \"street level\" camera views occur. When the camera is below this height, the {@link Cesium3DTileset#dynamicScreenSpaceError} optimization will have the maximum effect, and it will roll off above this value.\n * @property {number} [progressiveResolutionHeightFraction=0.3] Optimization option. If between (0.0, 0.5], tiles at or above the screen space error for the reduced screen resolution of <code>progressiveResolutionHeightFraction*screenHeight</code> will be prioritized first. This can help get a quick layer of tiles down while full resolution tiles continue to load.\n * @property {boolean} [foveatedScreenSpaceError=true] Optimization option. Prioritize loading tiles in the center of the screen by temporarily raising the screen space error for tiles around the edge of the screen. Screen space error returns to normal once all the tiles in the center of the screen as determined by the {@link Cesium3DTileset#foveatedConeSize} are loaded.\n * @property {number} [foveatedConeSize=0.1] Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control the cone size that determines which tiles are deferred. Tiles that are inside this cone are loaded immediately. Tiles outside the cone are potentially deferred based on how far outside the cone they are and their screen space error. This is controlled by {@link Cesium3DTileset#foveatedInterpolationCallback} and {@link Cesium3DTileset#foveatedMinimumScreenSpaceErrorRelaxation}. Setting this to 0.0 means the cone will be the line formed by the camera position and its view direction. Setting this to 1.0 means the cone encompasses the entire field of view of the camera, disabling the effect.\n * @property {number} [foveatedMinimumScreenSpaceErrorRelaxation=0.0] Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control the starting screen space error relaxation for tiles outside the foveated cone. The screen space error will be raised starting with tileset value up to {@link Cesium3DTileset#maximumScreenSpaceError} based on the provided {@link Cesium3DTileset#foveatedInterpolationCallback}.\n * @property {Cesium3DTileset.foveatedInterpolationCallback} [foveatedInterpolationCallback=Math.lerp] Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control how much to raise the screen space error for tiles outside the foveated cone, interpolating between {@link Cesium3DTileset#foveatedMinimumScreenSpaceErrorRelaxation} and {@link Cesium3DTileset#maximumScreenSpaceError}\n * @property {number} [foveatedTimeDelay=0.2] Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control how long in seconds to wait after the camera stops moving before deferred tiles start loading in. This time delay prevents requesting tiles around the edges of the screen when the camera is moving. Setting this to 0.0 will immediately request all tiles in any given view.\n * @property {boolean} [skipLevelOfDetail=false] Optimization option. Determines if level of detail skipping should be applied during the traversal.\n * @property {number} [baseScreenSpaceError=1024] When <code>skipLevelOfDetail</code> is <code>true</code>, the screen space error that must be reached before skipping levels of detail.\n * @property {number} [skipScreenSpaceErrorFactor=16] When <code>skipLevelOfDetail</code> is <code>true</code>, a multiplier defining the minimum screen space error to skip. Used in conjunction with <code>skipLevels</code> to determine which tiles to load.\n * @property {number} [skipLevels=1] When <code>skipLevelOfDetail</code> is <code>true</code>, a constant defining the minimum number of levels to skip when loading tiles. When it is 0, no levels are skipped. Used in conjunction with <code>skipScreenSpaceErrorFactor</code> to determine which tiles to load.\n * @property {boolean} [immediatelyLoadDesiredLevelOfDetail=false] When <code>skipLevelOfDetail</code> is <code>true</code>, only tiles that meet the maximum screen space error will ever be downloaded. Skipping factors are ignored and just the desired tiles are loaded.\n * @property {boolean} [loadSiblings=false] When <code>skipLevelOfDetail</code> is <code>true</code>, determines whether siblings of visible tiles are always downloaded during traversal.\n * @property {ClippingPlaneCollection} [clippingPlanes] The {@link ClippingPlaneCollection} used to selectively disable rendering the tileset.\n * @property {ClippingPolygonCollection} [clippingPolygons] The {@link ClippingPolygonCollection} used to selectively disable rendering the tileset.\n * @property {ClassificationType} [classificationType] Determines whether terrain, 3D Tiles or both will be classified by this tileset. See {@link Cesium3DTileset#classificationType} for details about restrictions and limitations.\n * @property {Ellipsoid} [ellipsoid=Ellipsoid.WGS84] The ellipsoid determining the size and shape of the globe.\n * @property {object} [pointCloudShading] Options for constructing a {@link PointCloudShading} object to control point attenuation based on geometric error and lighting.\n * @property {Cartesian3} [lightColor] The light color when shading models. When <code>undefined</code> the scene's light color is used instead.\n * @property {ImageBasedLighting} [imageBasedLighting] The properties for managing image-based lighting for this tileset.\n * @param {DynamicEnvironmentMapManager.ConstructorOptions} [options.environmentMapOptions] The properties for managing dynamic environment maps on this model.\n * @property {boolean} [backFaceCulling=true] Whether to cull back-facing geometry. When true, back face culling is determined by the glTF material's doubleSided property; when false, back face culling is disabled.\n * @property {boolean} [enableShowOutline=true] Whether to enable outlines for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. This can be set to false to avoid the additional processing of geometry at load time. When false, the showOutlines and outlineColor options are ignored.\n * @property {boolean} [showOutline=true] Whether to display the outline for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. When true, outlines are displayed. When false, outlines are not displayed.\n * @property {Color} [outlineColor=Color.BLACK] The color to use when rendering outlines.\n * @property {boolean} [vectorClassificationOnly=false] Indicates that only the tileset's vector tiles should be used for classification.\n * @property {boolean} [vectorKeepDecodedPositions=false] Whether vector tiles should keep decoded positions in memory. This is used with {@link Cesium3DTileFeature.getPolylinePositions}.\n * @property {string|number} [featureIdLabel=\"featureId_0\"] Label of the feature ID set to use for picking and styling. For EXT_mesh_features, this is the feature ID's label property, or \"featureId_N\" (where N is the index in the featureIds array) when not specified. EXT_feature_metadata did not have a label field, so such feature ID sets are always labeled \"featureId_N\" where N is the index in the list of all feature Ids, where feature ID attributes are listed before feature ID textures. If featureIdLabel is an integer N, it is converted to the string \"featureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @property {string|number} [instanceFeatureIdLabel=\"instanceFeatureId_0\"] Label of the instance feature ID set used for picking and styling. If instanceFeatureIdLabel is set to an integer N, it is converted to the string \"instanceFeatureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @property {boolean} [showCreditsOnScreen=false] Whether to display the credits of this tileset on screen.\n * @property {SplitDirection} [splitDirection=SplitDirection.NONE] The {@link SplitDirection} split to apply to this tileset.\n * @property {boolean} [enableCollision=false] When <code>true</code>, enables collisions for camera or CPU picking. While this is <code>true</code> the camera will be prevented from going below the tileset surface if {@link ScreenSpaceCameraController#enableCollisionDetection} is true.\n * @property {boolean} [projectTo2D=false] Whether to accurately project the tileset to 2D. If this is true, the tileset will be projected accurately to 2D, but it will use more memory to do so. If this is false, the tileset will use less memory and will still render in 2D / CV mode, but its projected positions may be inaccurate. This cannot be set after the tileset has been created.\n * @property {boolean} [enablePick=false] Whether to allow collision and CPU picking with <code>pick</code> when using WebGL 1. If using WebGL 2 or above, this option will be ignored. If using WebGL 1 and this is true, the <code>pick</code> operation will work correctly, but it will use more memory to do so. If running with WebGL 1 and this is false, the model will use less memory, but <code>pick</code> will always return <code>undefined</code>. This cannot be set after the tileset has loaded.\n * @property {string} [debugHeatmapTilePropertyName] The tile variable to colorize as a heatmap. All rendered tiles will be colorized relative to each other's specified variable value.\n * @property {boolean} [debugFreezeFrame=false] For debugging only. Determines if only the tiles from last frame should be used for rendering.\n * @property {boolean} [debugColorizeTiles=false] For debugging only. When true, assigns a random color to each tile.\n * @property {boolean} [enableDebugWireframe=false] For debugging only. This must be true for debugWireframe to work in WebGL1. This cannot be set after the tileset has been created.\n * @property {boolean} [debugWireframe=false] For debugging only. When true, render's each tile's content as a wireframe.\n * @property {boolean} [debugShowBoundingVolume=false] For debugging only. When true, renders the bounding volume for each tile.\n * @property {boolean} [debugShowContentBoundingVolume=false] For debugging only. When true, renders the bounding volume for each tile's content.\n * @property {boolean} [debugShowViewerRequestVolume=false] For debugging only. When true, renders the viewer request volume for each tile.\n * @property {boolean} [debugShowGeometricError=false] For debugging only. When true, draws labels to indicate the geometric error of each tile.\n * @property {boolean} [debugShowRenderingStatistics=false] For debugging only. When true, draws labels to indicate the number of commands, points, triangles and features for each tile.\n * @property {boolean} [debugShowMemoryUsage=false] For debugging only. When true, draws labels to indicate the texture and geometry memory in megabytes used by each tile.\n * @property {boolean} [debugShowUrl=false] For debugging only. When true, draws labels to indicate the url of each tile.\n */\n\n/**\n * A {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification|3D Tiles tileset},\n * used for streaming massive heterogeneous 3D geospatial datasets.\n *\n * <div class=\"notice\">\n * This object is normally not instantiated directly, use {@link Cesium3DTileset.fromUrl}.\n * </div>\n *\n * @alias Cesium3DTileset\n * @constructor\n *\n * @param {Cesium3DTileset.ConstructorOptions} options An object describing initialization options\n *\n * @exception {DeveloperError} The tileset must be 3D Tiles version 0.0 or 1.0.\n *\n * @example\n * try {\n *   const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *      \"http://localhost:8002/tilesets/Seattle/tileset.json\"\n *   );\n *   scene.primitives.add(tileset);\n * } catch (error) {\n *   console.error(`Error creating tileset: ${error}`);\n * }\n *\n * @example\n * // Turn on camera collisions with the tileset.\n * try {\n *   const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *      \"http://localhost:8002/tilesets/Seattle/tileset.json\",\n *      { enableCollision: true }\n *   );\n *   scene.primitives.add(tileset);\n * } catch (error) {\n *   console.error(`Error creating tileset: ${error}`);\n * }\n *\n * @example\n * // Common setting for the skipLevelOfDetail optimization\n * const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *   \"http://localhost:8002/tilesets/Seattle/tileset.json\", {\n *      skipLevelOfDetail: true,\n *      baseScreenSpaceError: 1024,\n *      skipScreenSpaceErrorFactor: 16,\n *      skipLevels: 1,\n *      immediatelyLoadDesiredLevelOfDetail: false,\n *      loadSiblings: false,\n *      cullWithChildrenBounds: true\n * });\n * scene.primitives.add(tileset);\n *\n * @example\n * // Common settings for the dynamicScreenSpaceError optimization\n * const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *   \"http://localhost:8002/tilesets/Seattle/tileset.json\", {\n *      dynamicScreenSpaceError: true,\n *      dynamicScreenSpaceErrorDensity: 2.0e-4,\n *      dynamicScreenSpaceErrorFactor: 24.0,\n *      dynamicScreenSpaceErrorHeightFalloff: 0.25\n * });\n * scene.primitives.add(tileset);\n *\n * @see {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification|3D Tiles specification}\n */\nfunction Cesium3DTileset(options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n  this._url = undefined;\n  this._basePath = undefined;\n  this._root = undefined;\n  this._resource = undefined;\n  this._asset = undefined; // Metadata for the entire tileset\n  this._properties = undefined; // Metadata for per-model/point/etc properties\n  this._geometricError = undefined; // Geometric error when the tree is not rendered at all\n  this._scaledGeometricError = undefined; // Geometric error scaled by root tile scale\n  this._extensionsUsed = undefined;\n  this._extensions = undefined;\n  this._modelUpAxis = undefined;\n  this._modelForwardAxis = undefined;\n  this._cache = new Cesium3DTilesetCache();\n  this._processingQueue = [];\n  this._selectedTiles = [];\n  this._emptyTiles = [];\n  this._requestedTiles = [];\n  this._selectedTilesToStyle = [];\n  this._loadTimestamp = undefined;\n  this._timeSinceLoad = 0.0;\n  this._updatedVisibilityFrame = 0;\n  this._updatedModelMatrixFrame = 0;\n  this._modelMatrixChanged = false;\n  this._previousModelMatrix = undefined;\n  this._extras = undefined;\n  this._credits = undefined;\n\n  this._showCreditsOnScreen = defaultValue(options.showCreditsOnScreen, false);\n\n  this._cullWithChildrenBounds = defaultValue(\n    options.cullWithChildrenBounds,\n    true,\n  );\n  this._allTilesAdditive = true;\n\n  this._hasMixedContent = false;\n\n  this._stencilClearCommand = undefined;\n  this._backfaceCommands = new ManagedArray();\n\n  this._maximumScreenSpaceError = defaultValue(\n    options.maximumScreenSpaceError,\n    16,\n  );\n  this._memoryAdjustedScreenSpaceError = this._maximumScreenSpaceError;\n\n  this._cacheBytes = defaultValue(options.cacheBytes, 512 * 1024 * 1024);\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.number.greaterThanOrEquals(\"cacheBytes\", this._cacheBytes, 0);\n  //>>includeEnd('debug');\n\n  const maximumCacheOverflowBytes = defaultValue(\n    options.maximumCacheOverflowBytes,\n    512 * 1024 * 1024,\n  );\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.number.greaterThanOrEquals(\n    \"maximumCacheOverflowBytes\",\n    maximumCacheOverflowBytes,\n    0,\n  );\n  //>>includeEnd('debug');\n  this._maximumCacheOverflowBytes = maximumCacheOverflowBytes;\n\n  this._styleEngine = new Cesium3DTileStyleEngine();\n  this._styleApplied = false;\n\n  this._modelMatrix = defined(options.modelMatrix)\n    ? Matrix4.clone(options.modelMatrix)\n    : Matrix4.clone(Matrix4.IDENTITY);\n\n  this._addHeightCallbacks = [];\n\n  this._statistics = new Cesium3DTilesetStatistics();\n  this._statisticsLast = new Cesium3DTilesetStatistics();\n  this._statisticsPerPass = new Array(Cesium3DTilePass.NUMBER_OF_PASSES);\n\n  for (let i = 0; i < Cesium3DTilePass.NUMBER_OF_PASSES; ++i) {\n    this._statisticsPerPass[i] = new Cesium3DTilesetStatistics();\n  }\n\n  this._requestedTilesInFlight = [];\n\n  this._maximumPriority = {\n    foveatedFactor: -Number.MAX_VALUE,\n    depth: -Number.MAX_VALUE,\n    distance: -Number.MAX_VALUE,\n    reverseScreenSpaceError: -Number.MAX_VALUE,\n  };\n  this._minimumPriority = {\n    foveatedFactor: Number.MAX_VALUE,\n    depth: Number.MAX_VALUE,\n    distance: Number.MAX_VALUE,\n    reverseScreenSpaceError: Number.MAX_VALUE,\n  };\n  this._heatmap = new Cesium3DTilesetHeatmap(\n    options.debugHeatmapTilePropertyName,\n  );\n\n  /**\n   * Optimization option. Don't request tiles that will likely be unused when they come back because of the camera's movement. This optimization only applies to stationary tilesets.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.cullRequestsWhileMoving = defaultValue(\n    options.cullRequestsWhileMoving,\n    true,\n  );\n  this._cullRequestsWhileMoving = false;\n\n  /**\n   * Optimization option. Multiplier used in culling requests while moving. Larger is more aggressive culling, smaller less aggressive culling.\n   *\n   * @type {number}\n   * @default 60.0\n   */\n  this.cullRequestsWhileMovingMultiplier = defaultValue(\n    options.cullRequestsWhileMovingMultiplier,\n    60.0,\n  );\n\n  /**\n   * Optimization option. If between (0.0, 0.5], tiles at or above the screen space error for the reduced screen resolution of <code>progressiveResolutionHeightFraction*screenHeight</code> will be prioritized first. This can help get a quick layer of tiles down while full resolution tiles continue to load.\n   *\n   * @type {number}\n   * @default 0.3\n   */\n  this.progressiveResolutionHeightFraction = CesiumMath.clamp(\n    defaultValue(options.progressiveResolutionHeightFraction, 0.3),\n    0.0,\n    0.5,\n  );\n\n  /**\n   * Optimization option. Prefer loading of leaves first.\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.preferLeaves = defaultValue(options.preferLeaves, false);\n\n  this._tilesLoaded = false;\n  this._initialTilesLoaded = false;\n\n  this._tileDebugLabels = undefined;\n\n  this._classificationType = options.classificationType;\n\n  this._ellipsoid = defaultValue(options.ellipsoid, Ellipsoid.WGS84);\n\n  this._initialClippingPlanesOriginMatrix = Matrix4.IDENTITY; // Computed from the tileset JSON.\n  this._clippingPlanesOriginMatrix = undefined; // Combines the above with any run-time transforms.\n  this._clippingPlanesOriginMatrixDirty = true;\n\n  this._vectorClassificationOnly = defaultValue(\n    options.vectorClassificationOnly,\n    false,\n  );\n\n  this._vectorKeepDecodedPositions = defaultValue(\n    options.vectorKeepDecodedPositions,\n    false,\n  );\n\n  /**\n   * Preload tiles when <code>tileset.show</code> is <code>false</code>. Loads tiles as if the tileset is visible but does not render them.\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.preloadWhenHidden = defaultValue(options.preloadWhenHidden, false);\n\n  /**\n   * Optimization option. Fetch tiles at the camera's flight destination while the camera is in flight.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.preloadFlightDestinations = defaultValue(\n    options.preloadFlightDestinations,\n    true,\n  );\n  this._pass = undefined; // Cesium3DTilePass\n\n  /**\n   * Optimization option. For street-level horizon views, use lower resolution tiles far from the camera. This reduces\n   * the amount of data loaded and improves tileset loading time with a slight drop in visual quality in the distance.\n   * <p>\n   * This optimization is strongest when the camera is close to the ground plane of the tileset and looking at the\n   * horizon. Furthermore, the results are more accurate for tightly fitting bounding volumes like box and region.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.dynamicScreenSpaceError = defaultValue(\n    options.dynamicScreenSpaceError,\n    true,\n  );\n\n  /**\n   * Optimization option. Prioritize loading tiles in the center of the screen by temporarily raising the\n   * screen space error for tiles around the edge of the screen. Screen space error returns to normal once all\n   * the tiles in the center of the screen as determined by the {@link Cesium3DTileset#foveatedConeSize} are loaded.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.foveatedScreenSpaceError = defaultValue(\n    options.foveatedScreenSpaceError,\n    true,\n  );\n  this._foveatedConeSize = defaultValue(options.foveatedConeSize, 0.1);\n  this._foveatedMinimumScreenSpaceErrorRelaxation = defaultValue(\n    options.foveatedMinimumScreenSpaceErrorRelaxation,\n    0.0,\n  );\n\n  /**\n   * Gets or sets a callback to control how much to raise the screen space error for tiles outside the foveated cone,\n   * interpolating between {@link Cesium3DTileset#foveatedMinimumScreenSpaceErrorRelaxation} and {@link Cesium3DTileset#maximumScreenSpaceError}.\n   *\n   * @type {Cesium3DTileset.foveatedInterpolationCallback}\n   */\n  this.foveatedInterpolationCallback = defaultValue(\n    options.foveatedInterpolationCallback,\n    CesiumMath.lerp,\n  );\n\n  /**\n   * Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control\n   * how long in seconds to wait after the camera stops moving before deferred tiles start loading in.\n   * This time delay prevents requesting tiles around the edges of the screen when the camera is moving.\n   * Setting this to 0.0 will immediately request all tiles in any given view.\n   *\n   * @type {number}\n   * @default 0.2\n   */\n  this.foveatedTimeDelay = defaultValue(options.foveatedTimeDelay, 0.2);\n\n  /**\n   * Similar to {@link Fog#density}, this option controls the camera distance at which the {@link Cesium3DTileset#dynamicScreenSpaceError}\n   * optimization applies. Larger values will cause tiles closer to the camera to be affected. This value must be\n   * non-negative.\n   * <p>\n   * This optimization works by rolling off the tile screen space error (SSE) with camera distance like a bell curve.\n   * This has the effect of selecting lower resolution tiles far from the camera. Near the camera, no adjustment is\n   * made. For tiles further away, the SSE is reduced by up to {@link Cesium3DTileset#dynamicScreenSpaceErrorFactor}\n   * (measured in pixels of error).\n   * </p>\n   * <p>\n   * Increasing the density makes the bell curve narrower so tiles closer to the camera are affected. This is analagous\n   * to moving fog closer to the camera.\n   * </p>\n   * <p>\n   * When the density is 0, the optimization will have no effect on the tileset.\n   * </p>\n   *\n   * @type {number}\n   * @default 2.0e-4\n   */\n  this.dynamicScreenSpaceErrorDensity = defaultValue(\n    options.dynamicScreenSpaceErrorDensity,\n    2.0e-4,\n  );\n\n  /**\n   * A parameter that controls the intensity of the {@link Cesium3DTileset#dynamicScreenSpaceError} optimization for\n   * tiles on the horizon. Larger values cause lower resolution tiles to load, improving runtime performance at a slight\n   * reduction of visual quality. The value must be non-negative.\n   * <p>\n   * More specifically, this parameter represents the maximum adjustment to screen space error (SSE) in pixels for tiles\n   * far away from the camera. See {@link Cesium3DTileset#dynamicScreenSpaceErrorDensity} for more details about how\n   * this optimization works.\n   * </p>\n   * <p>\n   * When the SSE factor is set to 0, the optimization will have no effect on the tileset.\n   * </p>\n   *\n   * @type {number}\n   * @default 24.0\n   */\n  this.dynamicScreenSpaceErrorFactor = defaultValue(\n    options.dynamicScreenSpaceErrorFactor,\n    24.0,\n  );\n\n  /**\n   * A ratio of the tileset's height that determines \"street level\" for the {@link Cesium3DTileset#dynamicScreenSpaceError}\n   * optimization. When the camera is below this height, the dynamic screen space error optimization will have the maximum\n   * effect, and it will roll off above this value. Valid values are between 0.0 and 1.0.\n   * <p>\n   *\n   * @type {number}\n   * @default 0.25\n   */\n  this.dynamicScreenSpaceErrorHeightFalloff = defaultValue(\n    options.dynamicScreenSpaceErrorHeightFalloff,\n    0.25,\n  );\n\n  // Updated based on the camera position and direction\n  this._dynamicScreenSpaceErrorComputedDensity = 0.0;\n\n  /**\n   * Determines whether the tileset casts or receives shadows from light sources.\n   * <p>\n   * Enabling shadows has a performance impact. A tileset that casts shadows must be rendered twice, once from the camera and again from the light's point of view.\n   * </p>\n   * <p>\n   * Shadows are rendered only when {@link Viewer#shadows} is <code>true</code>.\n   * </p>\n   *\n   * @type {ShadowMode}\n   * @default ShadowMode.ENABLED\n   */\n  this.shadows = defaultValue(options.shadows, ShadowMode.ENABLED);\n\n  /**\n   * Determines if the tileset will be shown.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.show = defaultValue(options.show, true);\n\n  /**\n   * Defines how per-feature colors set from the Cesium API or declarative styling blend with the source colors from\n   * the original feature, e.g. glTF material or per-point color in the tile.\n   *\n   * @type {Cesium3DTileColorBlendMode}\n   * @default Cesium3DTileColorBlendMode.HIGHLIGHT\n   */\n  this.colorBlendMode = Cesium3DTileColorBlendMode.HIGHLIGHT;\n\n  /**\n   * Defines the value used to linearly interpolate between the source color and feature color when the {@link Cesium3DTileset#colorBlendMode} is <code>MIX</code>.\n   * A value of 0.0 results in the source color while a value of 1.0 results in the feature color, with any value in-between\n   * resulting in a mix of the source color and feature color.\n   *\n   * @type {number}\n   * @default 0.5\n   */\n  this.colorBlendAmount = 0.5;\n\n  this._pointCloudShading = new PointCloudShading(options.pointCloudShading);\n  this._pointCloudEyeDomeLighting = new PointCloudEyeDomeLighting();\n\n  /**\n   * The event fired to indicate progress of loading new tiles.  This event is fired when a new tile\n   * is requested, when a requested tile is finished downloading, and when a downloaded tile has been\n   * processed and is ready to render.\n   * <p>\n   * The number of pending tile requests, <code>numberOfPendingRequests</code>, and number of tiles\n   * processing, <code>numberOfTilesProcessing</code> are passed to the event listener.\n   * </p>\n   * <p>\n   * This event is fired at the end of the frame after the scene is rendered.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.loadProgress.addEventListener(function(numberOfPendingRequests, numberOfTilesProcessing) {\n   *     if ((numberOfPendingRequests === 0) && (numberOfTilesProcessing === 0)) {\n   *         console.log('Stopped loading');\n   *         return;\n   *     }\n   *\n   *     console.log(`Loading: requests: ${numberOfPendingRequests}, processing: ${numberOfTilesProcessing}`);\n   * });\n   */\n  this.loadProgress = new Event();\n\n  /**\n   * The event fired to indicate that all tiles that meet the screen space error this frame are loaded. The tileset\n   * is completely loaded for this view.\n   * <p>\n   * This event is fired at the end of the frame after the scene is rendered.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.allTilesLoaded.addEventListener(function() {\n   *     console.log('All tiles are loaded');\n   * });\n   *\n   * @see Cesium3DTileset#tilesLoaded\n   */\n  this.allTilesLoaded = new Event();\n\n  /**\n   * The event fired to indicate that all tiles that meet the screen space error this frame are loaded. This event\n   * is fired once when all tiles in the initial view are loaded.\n   * <p>\n   * This event is fired at the end of the frame after the scene is rendered.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.initialTilesLoaded.addEventListener(function() {\n   *     console.log('Initial tiles are loaded');\n   * });\n   *\n   * @see Cesium3DTileset#allTilesLoaded\n   */\n  this.initialTilesLoaded = new Event();\n\n  /**\n   * The event fired to indicate that a tile's content was loaded.\n   * <p>\n   * The loaded {@link Cesium3DTile} is passed to the event listener.\n   * </p>\n   * <p>\n   * This event is fired during the tileset traversal while the frame is being rendered\n   * so that updates to the tile take effect in the same frame.  Do not create or modify\n   * Cesium entities or primitives during the event listener.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.tileLoad.addEventListener(function(tile) {\n   *     console.log('A tile was loaded.');\n   * });\n   */\n  this.tileLoad = new Event();\n\n  /**\n   * The event fired to indicate that a tile's content was unloaded.\n   * <p>\n   * The unloaded {@link Cesium3DTile} is passed to the event listener.\n   * </p>\n   * <p>\n   * This event is fired immediately before the tile's content is unloaded while the frame is being\n   * rendered so that the event listener has access to the tile's content.  Do not create\n   * or modify Cesium entities or primitives during the event listener.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.tileUnload.addEventListener(function(tile) {\n   *     console.log('A tile was unloaded from the cache.');\n   * });\n   *\n   * @see Cesium3DTileset#cacheBytes\n   * @see Cesium3DTileset#trimLoadedTiles\n   */\n  this.tileUnload = new Event();\n\n  /**\n   * The event fired to indicate that a tile's content failed to load.\n   * <p>\n   * If there are no event listeners, error messages will be logged to the console.\n   * </p>\n   * <p>\n   * The error object passed to the listener contains two properties:\n   * <ul>\n   * <li><code>url</code>: the url of the failed tile.</li>\n   * <li><code>message</code>: the error message.</li>\n   * </ul>\n   * <p>\n   * If multiple contents are present, this event is raised once per inner content with errors.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.tileFailed.addEventListener(function(error) {\n   *     console.log(`An error occurred loading tile: ${error.url}`);\n   *     console.log(`Error: ${error.message}`);\n   * });\n   */\n  this.tileFailed = new Event();\n\n  /**\n   * This event fires once for each visible tile in a frame.  This can be used to manually\n   * style a tileset.\n   * <p>\n   * The visible {@link Cesium3DTile} is passed to the event listener.\n   * </p>\n   * <p>\n   * This event is fired during the tileset traversal while the frame is being rendered\n   * so that updates to the tile take effect in the same frame.  Do not create or modify\n   * Cesium entities or primitives during the event listener.\n   * </p>\n   *\n   * @type {Event}\n   * @default new Event()\n   *\n   * @example\n   * tileset.tileVisible.addEventListener(function(tile) {\n   *     if (tile.content instanceof Cesium.Model3DTileContent) {\n   *         console.log('A 3D model tile is visible.');\n   *     }\n   * });\n   *\n   * @example\n   * // Apply a red style and then manually set random colors for every other feature when the tile becomes visible.\n   * tileset.style = new Cesium.Cesium3DTileStyle({\n   *     color : 'color(\"red\")'\n   * });\n   * tileset.tileVisible.addEventListener(function(tile) {\n   *     const content = tile.content;\n   *     const featuresLength = content.featuresLength;\n   *     for (let i = 0; i < featuresLength; i+=2) {\n   *         content.getFeature(i).color = Cesium.Color.fromRandom();\n   *     }\n   * });\n   */\n  this.tileVisible = new Event();\n\n  /**\n   * Optimization option. Determines if level of detail skipping should be applied during the traversal.\n   * <p>\n   * The common strategy for replacement-refinement traversal is to store all levels of the tree in memory and require\n   * all children to be loaded before the parent can refine. With this optimization levels of the tree can be skipped\n   * entirely and children can be rendered alongside their parents. The tileset requires significantly less memory when\n   * using this optimization.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.skipLevelOfDetail = defaultValue(options.skipLevelOfDetail, false);\n\n  this._disableSkipLevelOfDetail = false;\n\n  /**\n   * The screen space error that must be reached before skipping levels of detail.\n   * <p>\n   * Only used when {@link Cesium3DTileset#skipLevelOfDetail} is <code>true</code>.\n   * </p>\n   *\n   * @type {number}\n   * @default 1024\n   */\n  this.baseScreenSpaceError = defaultValue(options.baseScreenSpaceError, 1024);\n\n  /**\n   * Multiplier defining the minimum screen space error to skip.\n   * For example, if a tile has screen space error of 100, no tiles will be loaded unless they\n   * are leaves or have a screen space error <code><= 100 / skipScreenSpaceErrorFactor</code>.\n   * <p>\n   * Only used when {@link Cesium3DTileset#skipLevelOfDetail} is <code>true</code>.\n   * </p>\n   *\n   * @type {number}\n   * @default 16\n   */\n  this.skipScreenSpaceErrorFactor = defaultValue(\n    options.skipScreenSpaceErrorFactor,\n    16,\n  );\n\n  /**\n   * Constant defining the minimum number of levels to skip when loading tiles. When it is 0, no levels are skipped.\n   * For example, if a tile is level 1, no tiles will be loaded unless they are at level greater than 2.\n   * <p>\n   * Only used when {@link Cesium3DTileset#skipLevelOfDetail} is <code>true</code>.\n   * </p>\n   *\n   * @type {number}\n   * @default 1\n   */\n  this.skipLevels = defaultValue(options.skipLevels, 1);\n\n  /**\n   * When true, only tiles that meet the maximum screen space error will ever be downloaded.\n   * Skipping factors are ignored and just the desired tiles are loaded.\n   * <p>\n   * Only used when {@link Cesium3DTileset#skipLevelOfDetail} is <code>true</code>.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.immediatelyLoadDesiredLevelOfDetail = defaultValue(\n    options.immediatelyLoadDesiredLevelOfDetail,\n    false,\n  );\n\n  /**\n   * Determines whether siblings of visible tiles are always downloaded during traversal.\n   * This may be useful for ensuring that tiles are already available when the viewer turns left/right.\n   * <p>\n   * Only used when {@link Cesium3DTileset#skipLevelOfDetail} is <code>true</code>.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.loadSiblings = defaultValue(options.loadSiblings, false);\n\n  this._clippingPlanes = undefined;\n  if (defined(options.clippingPlanes)) {\n    ClippingPlaneCollection.setOwner(\n      options.clippingPlanes,\n      this,\n      \"_clippingPlanes\",\n    );\n  }\n\n  this._clippingPolygons = undefined;\n  if (defined(options.clippingPolygons)) {\n    ClippingPolygonCollection.setOwner(\n      options.clippingPolygons,\n      this,\n      \"_clippingPolygons\",\n    );\n  }\n\n  if (defined(options.imageBasedLighting)) {\n    this._imageBasedLighting = options.imageBasedLighting;\n    this._shouldDestroyImageBasedLighting = false;\n  } else {\n    this._imageBasedLighting = new ImageBasedLighting();\n    this._shouldDestroyImageBasedLighting = true;\n  }\n\n  this._environmentMapManager = new DynamicEnvironmentMapManager(\n    options.environmentMapOptions,\n  );\n\n  /**\n   * The light color when shading models. When <code>undefined</code> the scene's light color is used instead.\n   * <p>\n   * For example, disabling additional light sources by setting\n   * <code>tileset.imageBasedLighting.imageBasedLightingFactor = new Cartesian2(0.0, 0.0)</code>\n   * will make the tileset much darker. Here, increasing the intensity of the light source will make the tileset brighter.\n   * </p>\n   *\n   * @type {Cartesian3}\n   * @default undefined\n   */\n  this.lightColor = options.lightColor;\n\n  /**\n   * Whether to cull back-facing geometry. When true, back face culling is determined\n   * by the glTF material's doubleSided property; when false, back face culling is disabled.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.backFaceCulling = defaultValue(options.backFaceCulling, true);\n\n  this._enableShowOutline = defaultValue(options.enableShowOutline, true);\n\n  /**\n   * Whether to display the outline for models using the\n   * {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension.\n   * When true, outlines are displayed. When false, outlines are not displayed.\n   *\n   * @type {boolean}\n   * @default true\n   */\n  this.showOutline = defaultValue(options.showOutline, true);\n\n  /**\n   * The color to use when rendering outlines.\n   *\n   * @type {Color}\n   * @default Color.BLACK\n   */\n  this.outlineColor = defaultValue(options.outlineColor, Color.BLACK);\n\n  /**\n   * The {@link SplitDirection} to apply to this tileset.\n   *\n   * @type {SplitDirection}\n   * @default {@link SplitDirection.NONE}\n   */\n  this.splitDirection = defaultValue(\n    options.splitDirection,\n    SplitDirection.NONE,\n  );\n\n  /**\n   * If <code>true</code>, allows collisions for camera collisions or picking. While this is  <code>true</code> the camera will be prevented from going in or below the tileset surface if {@link ScreenSpaceCameraController#enableCollisionDetection} is true. This can have performance implecations if the tileset contains tile with a larger number of vertices.\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.enableCollision = defaultValue(options.enableCollision, false);\n  this._projectTo2D = defaultValue(options.projectTo2D, false);\n  this._enablePick = defaultValue(options.enablePick, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * Determines if only the tiles from last frame should be used for rendering.  This\n   * effectively \"freezes\" the tileset to the previous frame so it is possible to zoom\n   * out and see what was rendered.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugFreezeFrame = defaultValue(options.debugFreezeFrame, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, assigns a random color to each tile.  This is useful for visualizing\n   * what features belong to what tiles, especially with additive refinement where features\n   * from parent tiles may be interleaved with features from child tiles.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugColorizeTiles = defaultValue(options.debugColorizeTiles, false);\n\n  this._enableDebugWireframe = defaultValue(\n    options.enableDebugWireframe,\n    false,\n  );\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, renders each tile's content as a wireframe.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugWireframe = defaultValue(options.debugWireframe, false);\n\n  // Warning for improper setup of debug wireframe\n  if (this.debugWireframe === true && this._enableDebugWireframe === false) {\n    oneTimeWarning(\n      \"tileset-debug-wireframe-ignored\",\n      \"enableDebugWireframe must be set to true in the Cesium3DTileset constructor, otherwise debugWireframe will be ignored.\",\n    );\n  }\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, renders the bounding volume for each visible tile.  The bounding volume is\n   * white if the tile has a content bounding volume or is empty; otherwise, it is red.  Tiles that don't meet the\n   * screen space error and are still refining to their descendants are yellow.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowBoundingVolume = defaultValue(\n    options.debugShowBoundingVolume,\n    false,\n  );\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, renders the bounding volume for each visible tile's content. The bounding volume is\n   * blue if the tile has a content bounding volume; otherwise it is red.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowContentBoundingVolume = defaultValue(\n    options.debugShowContentBoundingVolume,\n    false,\n  );\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, renders the viewer request volume for each tile.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowViewerRequestVolume = defaultValue(\n    options.debugShowViewerRequestVolume,\n    false,\n  );\n\n  /**\n   * @private\n   * @type {LabelCollection|undefined}\n   */\n  this._tileDebugLabels = undefined;\n  this.debugPickedTileLabelOnly = false;\n  this.debugPickedTile = undefined;\n  this.debugPickPosition = undefined;\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, draws labels to indicate the geometric error of each tile.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowGeometricError = defaultValue(\n    options.debugShowGeometricError,\n    false,\n  );\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, draws labels to indicate the number of commands, points, triangles and features of each tile.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowRenderingStatistics = defaultValue(\n    options.debugShowRenderingStatistics,\n    false,\n  );\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, draws labels to indicate the geometry and texture memory usage of each tile.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowMemoryUsage = defaultValue(options.debugShowMemoryUsage, false);\n\n  /**\n   * This property is for debugging only; it is not optimized for production use.\n   * <p>\n   * When true, draws labels to indicate the url of each tile.\n   * </p>\n   *\n   * @type {boolean}\n   * @default false\n   */\n  this.debugShowUrl = defaultValue(options.debugShowUrl, false);\n\n  /**\n   * Function for examining vector lines as they are being streamed.\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   *\n   * @type {Function}\n   */\n  this.examineVectorLinesFunction = undefined;\n\n  // this is the underlying Cesium3DTileMetadata object, whether it came from\n  // the 3DTILES_metadata extension or a 3D Tiles 1.1 tileset JSON. Getters\n  // like tileset.metadata and tileset.schema will delegate to this object.\n  this._metadataExtension = undefined;\n\n  this._customShader = options.customShader;\n\n  let featureIdLabel = defaultValue(options.featureIdLabel, \"featureId_0\");\n  if (typeof featureIdLabel === \"number\") {\n    featureIdLabel = `featureId_${featureIdLabel}`;\n  }\n  this._featureIdLabel = featureIdLabel;\n\n  let instanceFeatureIdLabel = defaultValue(\n    options.instanceFeatureIdLabel,\n    \"instanceFeatureId_0\",\n  );\n  if (typeof instanceFeatureIdLabel === \"number\") {\n    instanceFeatureIdLabel = `instanceFeatureId_${instanceFeatureIdLabel}`;\n  }\n  this._instanceFeatureIdLabel = instanceFeatureIdLabel;\n}\n\nObject.defineProperties(Cesium3DTileset.prototype, {\n  /**\n   * NOTE: This getter exists so that `Picking.js` can differentiate between\n   *       PrimitiveCollection and Cesium3DTileset objects without inflating\n   *       the size of the module via `instanceof Cesium3DTileset`\n   * @private\n   */\n  isCesium3DTileset: {\n    get: function () {\n      return true;\n    },\n  },\n\n  /**\n   * Gets the tileset's asset object property, which contains metadata about the tileset.\n   * <p>\n   * See the {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification#reference-asset|asset schema reference}\n   * in the 3D Tiles spec for the full set of properties.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {object}\n   * @readonly\n   */\n  asset: {\n    get: function () {\n      return this._asset;\n    },\n  },\n\n  /**\n   * Gets the tileset's extensions object property.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {object}\n   * @readonly\n   */\n  extensions: {\n    get: function () {\n      return this._extensions;\n    },\n  },\n\n  /**\n   * The {@link ClippingPlaneCollection} used to selectively disable rendering the tileset.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {ClippingPlaneCollection}\n   */\n  clippingPlanes: {\n    get: function () {\n      return this._clippingPlanes;\n    },\n    set: function (value) {\n      ClippingPlaneCollection.setOwner(value, this, \"_clippingPlanes\");\n    },\n  },\n\n  /**\n   * The {@link ClippingPolygonCollection} used to selectively disable rendering the tileset.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {ClippingPolygonCollection}\n   */\n  clippingPolygons: {\n    get: function () {\n      return this._clippingPolygons;\n    },\n    set: function (value) {\n      ClippingPolygonCollection.setOwner(value, this, \"_clippingPolygons\");\n    },\n  },\n\n  /**\n   * Gets the tileset's properties dictionary object, which contains metadata about per-feature properties.\n   * <p>\n   * See the {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification#reference-properties|properties schema reference}\n   * in the 3D Tiles spec for the full set of properties.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {object}\n   * @readonly\n   *\n   * @example\n   * console.log(`Maximum building height: ${tileset.properties.height.maximum}`);\n   * console.log(`Minimum building height: ${tileset.properties.height.minimum}`);\n   *\n   * @see Cesium3DTileFeature#getProperty\n   * @see Cesium3DTileFeature#setProperty\n   */\n  properties: {\n    get: function () {\n      return this._properties;\n    },\n  },\n\n  /**\n   * When <code>true</code>, all tiles that meet the screen space error this frame are loaded. The tileset is\n   * completely loaded for this view.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {boolean}\n   * @readonly\n   *\n   * @default false\n   *\n   * @see Cesium3DTileset#allTilesLoaded\n   */\n  tilesLoaded: {\n    get: function () {\n      return this._tilesLoaded;\n    },\n  },\n\n  /**\n   * The resource used to fetch the tileset JSON file\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {Resource}\n   * @readonly\n   */\n  resource: {\n    get: function () {\n      return this._resource;\n    },\n  },\n\n  /**\n   * The base path that non-absolute paths in tileset JSON file are relative to.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {string}\n   * @readonly\n   * @deprecated\n   */\n  basePath: {\n    get: function () {\n      deprecationWarning(\n        \"Cesium3DTileset.basePath\",\n        \"Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead.\",\n      );\n      return this._basePath;\n    },\n  },\n\n  /**\n   * The style, defined using the\n   * {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification/Styling|3D Tiles Styling language},\n   * applied to each feature in the tileset.\n   * <p>\n   * Assign <code>undefined</code> to remove the style, which will restore the visual\n   * appearance of the tileset to its default when no style was applied.\n   * </p>\n   * <p>\n   * The style is applied to a tile before the {@link Cesium3DTileset#tileVisible}\n   * event is raised, so code in <code>tileVisible</code> can manually set a feature's\n   * properties (e.g. color and show) after the style is applied. When\n   * a new style is assigned any manually set properties are overwritten.\n   * </p>\n   * <p>\n   * Use an always \"true\" condition to specify the Color for all objects that are not\n   * overridden by pre-existing conditions. Otherwise, the default color Cesium.Color.White\n   * will be used. Similarly, use an always \"true\" condition to specify the show property\n   * for all objects that are not overridden by pre-existing conditions. Otherwise, the\n   * default show value true will be used.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {Cesium3DTileStyle|undefined}\n   *\n   * @default undefined\n   *\n   * @example\n   * tileset.style = new Cesium.Cesium3DTileStyle({\n   *    color : {\n   *        conditions : [\n   *            ['${Height} >= 100', 'color(\"purple\", 0.5)'],\n   *            ['${Height} >= 50', 'color(\"red\")'],\n   *            ['true', 'color(\"blue\")']\n   *        ]\n   *    },\n   *    show : '${Height} > 0',\n   *    meta : {\n   *        description : '\"Building id ${id} has height ${Height}.\"'\n   *    }\n   * });\n   *\n   * @see {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification/Styling|3D Tiles Styling language}\n   */\n  style: {\n    get: function () {\n      return this._styleEngine.style;\n    },\n    set: function (value) {\n      this._styleEngine.style = value;\n    },\n  },\n\n  /**\n   * A custom shader to apply to all tiles in the tileset. Only used for\n   * contents that use {@link Model}. Using custom shaders with a\n   * {@link Cesium3DTileStyle} may lead to undefined behavior.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {CustomShader|undefined}\n   *\n   * @default undefined\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  customShader: {\n    get: function () {\n      return this._customShader;\n    },\n    set: function (value) {\n      this._customShader = value;\n    },\n  },\n\n  /**\n   * Whether the tileset is rendering different levels of detail in the same view.\n   * Only relevant if {@link Cesium3DTileset.isSkippingLevelOfDetail} is true.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {boolean}\n   * @private\n   */\n  hasMixedContent: {\n    get: function () {\n      return this._hasMixedContent;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.bool(\"value\", value);\n      //>>includeEnd('debug');\n\n      this._hasMixedContent = value;\n    },\n  },\n\n  /**\n   * Whether this tileset is actually skipping levels of detail.\n   * The user option may have been disabled if all tiles are using additive refinement,\n   * or if some tiles have a content type for which rendering does not support skipping\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {boolean}\n   * @private\n   * @readonly\n   */\n  isSkippingLevelOfDetail: {\n    get: function () {\n      return (\n        this.skipLevelOfDetail &&\n        !defined(this._classificationType) &&\n        !this._disableSkipLevelOfDetail &&\n        !this._allTilesAdditive\n      );\n    },\n  },\n\n  /**\n   * The tileset's schema, groups, tileset metadata and other details from the\n   * 3DTILES_metadata extension or a 3D Tiles 1.1 tileset JSON. This getter is\n   * for internal use by other classes.\n   *\n   * @memberof Cesium3DTileset.prototype\n   * @type {Cesium3DTilesetMetadata}\n   * @private\n   * @readonly\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  metadataExtension: {\n    get: function () {\n      return this._metadataExtension;\n    },\n  },\n\n  /**\n   * The metadata properties attached to the tileset as a whole.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {TilesetMetadata}\n   * @private\n   * @readonly\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  metadata: {\n    get: function () {\n      if (defined(this._metadataExtension)) {\n        return this._metadataExtension.tileset;\n      }\n\n      return undefined;\n    },\n  },\n\n  /**\n   * The metadata schema used in this tileset. Shorthand for\n   * <code>tileset.metadataExtension.schema</code>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {MetadataSchema}\n   * @private\n   * @readonly\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  schema: {\n    get: function () {\n      if (defined(this._metadataExtension)) {\n        return this._metadataExtension.schema;\n      }\n\n      return undefined;\n    },\n  },\n\n  /**\n   * The maximum screen space error used to drive level of detail refinement.  This value helps determine when a tile\n   * refines to its descendants, and therefore plays a major role in balancing performance with visual quality.\n   * <p>\n   * A tile's screen space error is roughly equivalent to the number of pixels wide that would be drawn if a sphere with a\n   * radius equal to the tile's <b>geometric error</b> were rendered at the tile's position. If this value exceeds\n   * <code>maximumScreenSpaceError</code> the tile refines to its descendants.\n   * </p>\n   * <p>\n   * Depending on the tileset, <code>maximumScreenSpaceError</code> may need to be tweaked to achieve the right balance.\n   * Higher values provide better performance but lower visual quality.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @default 16\n   *\n   * @exception {DeveloperError} <code>maximumScreenSpaceError</code> must be greater than or equal to zero.\n   */\n  maximumScreenSpaceError: {\n    get: function () {\n      return this._maximumScreenSpaceError;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.number.greaterThanOrEquals(\n        \"maximumScreenSpaceError\",\n        value,\n        0,\n      );\n      //>>includeEnd('debug');\n\n      this._maximumScreenSpaceError = value;\n      this._memoryAdjustedScreenSpaceError = value;\n    },\n  },\n\n  /**\n   * The amount of GPU memory (in bytes) used to cache tiles. This memory usage is estimated from\n   * geometry, textures, and batch table textures of loaded tiles. For point clouds, this value also\n   * includes per-point metadata.\n   * <p>\n   * Tiles not in view are unloaded to enforce this.\n   * </p>\n   * <p>\n   * If decreasing this value results in unloading tiles, the tiles are unloaded the next frame.\n   * </p>\n   * <p>\n   * If tiles sized more than <code>cacheBytes</code> are needed to meet the\n   * desired screen space error, determined by {@link Cesium3DTileset#maximumScreenSpaceError},\n   * for the current view, then the memory usage of the tiles loaded will exceed\n   * <code>cacheBytes</code> by up to <code>maximumCacheOverflowBytes</code>.\n   * For example, if <code>cacheBytes</code> is 500000, but 600000 bytes\n   * of tiles are needed to meet the screen space error, then 600000 bytes of tiles\n   * may be loaded (if <code>maximumCacheOverflowBytes</code> is at least 100000).\n   * When these tiles go out of view, they will be unloaded.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @default 536870912\n   *\n   * @exception {DeveloperError} <code>cacheBytes</code> must be typeof 'number' and greater than or equal to 0\n   * @see Cesium3DTileset#totalMemoryUsageInBytes\n   */\n  cacheBytes: {\n    get: function () {\n      return this._cacheBytes;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.number.greaterThanOrEquals(\"value\", value, 0);\n      //>>includeEnd('debug');\n\n      this._cacheBytes = value;\n    },\n  },\n\n  /**\n   * The maximum additional amount of GPU memory (in bytes) that will be used to cache tiles.\n   * <p>\n   * If tiles sized more than <code>cacheBytes</code> plus <code>maximumCacheOverflowBytes</code>\n   * are needed to meet the desired screen space error, determined by\n   * {@link Cesium3DTileset#maximumScreenSpaceError} for the current view, then\n   * {@link Cesium3DTileset#memoryAdjustedScreenSpaceError} will be adjusted\n   * until the tiles required to meet the adjusted screen space error use less\n   * than <code>cacheBytes</code> plus <code>maximumCacheOverflowBytes</code>.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @default 536870912\n   *\n   * @exception {DeveloperError} <code>maximumCacheOverflowBytes</code> must be typeof 'number' and greater than or equal to 0\n   * @see Cesium3DTileset#totalMemoryUsageInBytes\n   */\n  maximumCacheOverflowBytes: {\n    get: function () {\n      return this._maximumCacheOverflowBytes;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.number.greaterThanOrEquals(\"value\", value, 0);\n      //>>includeEnd('debug');\n\n      this._maximumCacheOverflowBytes = value;\n    },\n  },\n\n  /**\n   * If loading the level of detail required by @{link Cesium3DTileset#maximumScreenSpaceError}\n   * results in the memory usage exceeding @{link Cesium3DTileset#cacheBytes}\n   * plus @{link Cesium3DTileset#maximumCacheOverflowBytes}, level of detail refinement\n   * will instead use this (larger) adjusted screen space error to achieve the\n   * best possible visual quality within the available memory\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @readonly\n   *\n   * @private\n   */\n  memoryAdjustedScreenSpaceError: {\n    get: function () {\n      return this._memoryAdjustedScreenSpaceError;\n    },\n  },\n\n  /**\n   * Options for controlling point size based on geometric error and eye dome lighting.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {PointCloudShading}\n   */\n  pointCloudShading: {\n    get: function () {\n      return this._pointCloudShading;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.defined(\"pointCloudShading\", value);\n      //>>includeEnd('debug');\n      this._pointCloudShading = value;\n    },\n  },\n\n  /**\n   * The root tile.\n   *\n   * @memberOf Cesium3DTileset.prototype\n   *\n   * @type {Cesium3DTile}\n   * @readonly\n   */\n  root: {\n    get: function () {\n      return this._root;\n    },\n  },\n\n  /**\n   * The tileset's bounding sphere.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {BoundingSphere}\n   * @readonly\n   *\n   * @example\n   * const tileset = await Cesium.Cesium3DTileset.fromUrl(\"http://localhost:8002/tilesets/Seattle/tileset.json\");\n   *\n   * viewer.scene.primitives.add(tileset);\n   *\n   * // Set the camera to view the newly added tileset\n   * viewer.camera.viewBoundingSphere(tileset.boundingSphere, new Cesium.HeadingPitchRange(0, -0.5, 0));\n   */\n  boundingSphere: {\n    get: function () {\n      this._root.updateTransform(this._modelMatrix);\n      return this._root.boundingSphere;\n    },\n  },\n\n  /**\n   * A 4x4 transformation matrix that transforms the entire tileset.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {Matrix4}\n   * @default Matrix4.IDENTITY\n   *\n   * @example\n   * // Adjust a tileset's height from the globe's surface.\n   * const heightOffset = 20.0;\n   * const boundingSphere = tileset.boundingSphere;\n   * const cartographic = Cesium.Cartographic.fromCartesian(boundingSphere.center);\n   * const surface = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, 0.0);\n   * const offset = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, heightOffset);\n   * const translation = Cesium.Cartesian3.subtract(offset, surface, new Cesium.Cartesian3());\n   * tileset.modelMatrix = Cesium.Matrix4.fromTranslation(translation);\n   */\n  modelMatrix: {\n    get: function () {\n      return this._modelMatrix;\n    },\n    set: function (value) {\n      this._modelMatrix = Matrix4.clone(value, this._modelMatrix);\n    },\n  },\n\n  /**\n   * Returns the time, in milliseconds, since the tileset was loaded and first updated.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @readonly\n   */\n  timeSinceLoad: {\n    get: function () {\n      return this._timeSinceLoad;\n    },\n  },\n\n  /**\n   * The total amount of GPU memory in bytes used by the tileset. This value is estimated from\n   * geometry, texture, batch table textures, and binary metadata of loaded tiles.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @readonly\n   *\n   * @see Cesium3DTileset#cacheBytes\n   */\n  totalMemoryUsageInBytes: {\n    get: function () {\n      const statistics = this._statistics;\n      return (\n        statistics.texturesByteLength +\n        statistics.geometryByteLength +\n        statistics.batchTableByteLength\n      );\n    },\n  },\n\n  /**\n   * @private\n   */\n  clippingPlanesOriginMatrix: {\n    get: function () {\n      if (!defined(this._clippingPlanesOriginMatrix)) {\n        return Matrix4.IDENTITY;\n      }\n\n      if (this._clippingPlanesOriginMatrixDirty) {\n        Matrix4.multiply(\n          this.root.computedTransform,\n          this._initialClippingPlanesOriginMatrix,\n          this._clippingPlanesOriginMatrix,\n        );\n        this._clippingPlanesOriginMatrixDirty = false;\n      }\n\n      return this._clippingPlanesOriginMatrix;\n    },\n  },\n\n  /**\n   * @private\n   */\n  styleEngine: {\n    get: function () {\n      return this._styleEngine;\n    },\n  },\n\n  /**\n   * @private\n   */\n  statistics: {\n    get: function () {\n      return this._statistics;\n    },\n  },\n\n  /**\n   * Determines whether terrain, 3D Tiles, or both will be classified by this tileset.\n   * <p>\n   * This option is only applied to tilesets containing batched 3D models,\n   * glTF content, geometry data, or vector data. Even when undefined, vector\n   * and geometry data must render as classifications and will default to\n   * rendering on both terrain and other 3D Tiles tilesets.\n   * </p>\n   * <p>\n   * When enabled for batched 3D model and glTF tilesets, there are a few\n   * requirements/limitations on the glTF:\n   * <ul>\n   *     <li>The glTF cannot contain morph targets, skins, or animations.</li>\n   *     <li>The glTF cannot contain the <code>EXT_mesh_gpu_instancing</code> extension.</li>\n   *     <li>Only meshes with TRIANGLES can be used to classify other assets.</li>\n   *     <li>The meshes must be watertight.</li>\n   *     <li>The <code>POSITION</code> semantic is required.</li>\n   *     <li>If <code>_BATCHID</code>s and an index buffer are both present, all indices with the same batch id must occupy contiguous sections of the index buffer.</li>\n   *     <li>If <code>_BATCHID</code>s are present with no index buffer, all positions with the same batch id must occupy contiguous sections of the position buffer.</li>\n   * </ul>\n   * </p>\n   * <p>\n   * Additionally, classification is not supported for points or instanced 3D\n   * models.\n   * </p>\n   * <p>\n   * The 3D Tiles or terrain receiving the classification must be opaque.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {ClassificationType}\n   * @default undefined\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   * @readonly\n   */\n  classificationType: {\n    get: function () {\n      return this._classificationType;\n    },\n  },\n\n  /**\n   * Gets an ellipsoid describing the shape of the globe.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {Ellipsoid}\n   * @readonly\n   */\n  ellipsoid: {\n    get: function () {\n      return this._ellipsoid;\n    },\n  },\n\n  /**\n   * Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control the cone size that determines which tiles are deferred.\n   * Tiles that are inside this cone are loaded immediately. Tiles outside the cone are potentially deferred based on how far outside the cone they are and {@link Cesium3DTileset#foveatedInterpolationCallback} and {@link Cesium3DTileset#foveatedMinimumScreenSpaceErrorRelaxation}.\n   * Setting this to 0.0 means the cone will be the line formed by the camera position and its view direction. Setting this to 1.0 means the cone encompasses the entire field of view of the camera, essentially disabling the effect.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @default 0.3\n   */\n  foveatedConeSize: {\n    get: function () {\n      return this._foveatedConeSize;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.number.greaterThanOrEquals(\"foveatedConeSize\", value, 0.0);\n      Check.typeOf.number.lessThanOrEquals(\"foveatedConeSize\", value, 1.0);\n      //>>includeEnd('debug');\n\n      this._foveatedConeSize = value;\n    },\n  },\n\n  /**\n   * Optimization option. Used when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control the starting screen space error relaxation for tiles outside the foveated cone.\n   * The screen space error will be raised starting with this value up to {@link Cesium3DTileset#maximumScreenSpaceError} based on the provided {@link Cesium3DTileset#foveatedInterpolationCallback}.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {number}\n   * @default 0.0\n   */\n  foveatedMinimumScreenSpaceErrorRelaxation: {\n    get: function () {\n      return this._foveatedMinimumScreenSpaceErrorRelaxation;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.number.greaterThanOrEquals(\n        \"foveatedMinimumScreenSpaceErrorRelaxation\",\n        value,\n        0.0,\n      );\n      Check.typeOf.number.lessThanOrEquals(\n        \"foveatedMinimumScreenSpaceErrorRelaxation\",\n        value,\n        this.maximumScreenSpaceError,\n      );\n      //>>includeEnd('debug');\n\n      this._foveatedMinimumScreenSpaceErrorRelaxation = value;\n    },\n  },\n\n  /**\n   * Returns the <code>extras</code> property at the top-level of the tileset JSON, which contains application specific metadata.\n   * Returns <code>undefined</code> if <code>extras</code> does not exist.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {*}\n   * @readonly\n   *\n   * @see {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification#specifying-extensions-and-application-specific-extras|Extras in the 3D Tiles specification.}\n   */\n  extras: {\n    get: function () {\n      return this._extras;\n    },\n  },\n\n  /**\n   * The properties for managing image-based lighting on this tileset.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {ImageBasedLighting}\n   */\n  imageBasedLighting: {\n    get: function () {\n      return this._imageBasedLighting;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.object(\"imageBasedLighting\", this._imageBasedLighting);\n      //>>includeEnd('debug');\n      if (value !== this._imageBasedLighting) {\n        if (\n          this._shouldDestroyImageBasedLighting &&\n          !this._imageBasedLighting.isDestroyed()\n        ) {\n          this._imageBasedLighting.destroy();\n        }\n        this._imageBasedLighting = value;\n        this._shouldDestroyImageBasedLighting = false;\n      }\n    },\n  },\n\n  /**\n   * The properties for managing dynamic environment maps on this model. Affects lighting.\n   *\n   * @memberof Cesium3DTileset.prototype\n   * @readonly\n   *\n   * @example\n   * // Change the ground color used for a tileset's environment map to a forest green\n   * const environmentMapManager = tileset.environmentMapManager;\n   * environmentMapManager.groundColor = Cesium.Color.fromCssColorString(\"#203b34\");\n   *\n   * @type {DynamicEnvironmentMapManager}\n   */\n  environmentMapManager: {\n    get: function () {\n      return this._environmentMapManager;\n    },\n  },\n\n  /**\n   * Indicates that only the tileset's vector tiles should be used for classification.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   *\n   * @type {boolean}\n   * @default false\n   */\n  vectorClassificationOnly: {\n    get: function () {\n      return this._vectorClassificationOnly;\n    },\n  },\n\n  /**\n   * Whether vector tiles should keep decoded positions in memory.\n   * This is used with {@link Cesium3DTileFeature.getPolylinePositions}.\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   *\n   * @type {boolean}\n   * @default false\n   */\n  vectorKeepDecodedPositions: {\n    get: function () {\n      return this._vectorKeepDecodedPositions;\n    },\n  },\n\n  /**\n   * Determines whether the credits of the tileset will be displayed on the screen\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {boolean}\n   * @default false\n   */\n  showCreditsOnScreen: {\n    get: function () {\n      return this._showCreditsOnScreen;\n    },\n    set: function (value) {\n      this._showCreditsOnScreen = value;\n      createCredits(this);\n    },\n  },\n\n  /**\n   * Label of the feature ID set to use for picking and styling.\n   * <p>\n   * For EXT_mesh_features, this is the feature ID's label property, or\n   * \"featureId_N\" (where N is the index in the featureIds array) when not\n   * specified. EXT_feature_metadata did not have a label field, so such\n   * feature ID sets are always labeled \"featureId_N\" where N is the index in\n   * the list of all feature Ids, where feature ID attributes are listed before\n   * feature ID textures.\n   * </p>\n   * <p>\n   * If featureIdLabel is set to an integer N, it is converted to\n   * the string \"featureId_N\" automatically. If both per-primitive and\n   * per-instance feature IDs are present, the instance feature IDs take\n   * priority.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {string}\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  featureIdLabel: {\n    get: function () {\n      return this._featureIdLabel;\n    },\n    set: function (value) {\n      // indices get converted into featureId_N\n      if (typeof value === \"number\") {\n        value = `featureId_${value}`;\n      }\n\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.string(\"value\", value);\n      //>>includeEnd('debug');\n\n      this._featureIdLabel = value;\n    },\n  },\n\n  /**\n   * Label of the instance feature ID set used for picking and styling.\n   * <p>\n   * If instanceFeatureIdLabel is set to an integer N, it is converted to\n   * the string \"instanceFeatureId_N\" automatically.\n   * If both per-primitive and per-instance feature IDs are present, the\n   * instance feature IDs take priority.\n   * </p>\n   *\n   * @memberof Cesium3DTileset.prototype\n   *\n   * @type {string}\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  instanceFeatureIdLabel: {\n    get: function () {\n      return this._instanceFeatureIdLabel;\n    },\n    set: function (value) {\n      // indices get converted into instanceFeatureId_N\n      if (typeof value === \"number\") {\n        value = `instanceFeatureId_${value}`;\n      }\n\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.string(\"value\", value);\n      //>>includeEnd('debug');\n\n      this._instanceFeatureIdLabel = value;\n    },\n  },\n});\n\n/**\n * Creates a {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification|3D Tiles tileset},\n * used for streaming massive heterogeneous 3D geospatial datasets, from a Cesium ion asset ID.\n *\n * @param {number} assetId The Cesium ion asset id.\n * @param {Cesium3DTileset.ConstructorOptions} [options] An object describing initialization options\n * @returns {Promise<Cesium3DTileset>}\n *\n * @exception {RuntimeError} When the tileset asset version is not 0.0, 1.0, or 1.1,\n * or when the tileset contains a required extension that is not supported.\n *\n * @see Cesium3DTileset#fromUrl\n *\n * @example\n * // Load a Cesium3DTileset with a Cesium ion asset ID of 124624234\n * try {\n *   const tileset = await Cesium.Cesium3DTileset.fromIonAssetId(124624234);\n *   scene.primitives.add(tileset);\n * } catch (error) {\n *   console.error(`Error creating tileset: ${error}`);\n * }\n */\nCesium3DTileset.fromIonAssetId = async function (assetId, options) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.defined(\"assetId\", assetId);\n  //>>includeEnd('debug');\n\n  const resource = await IonResource.fromAssetId(assetId);\n  return Cesium3DTileset.fromUrl(resource, options);\n};\n\n/**\n * Creates a {@link https://github.com/CesiumGS/3d-tiles/tree/main/specification|3D Tiles tileset},\n * used for streaming massive heterogeneous 3D geospatial datasets.\n *\n * @param {Resource|string} url The url to a tileset JSON file.\n * @param {Cesium3DTileset.ConstructorOptions} [options] An object describing initialization options\n * @returns {Promise<Cesium3DTileset>}\n *\n * @exception {RuntimeError} When the tileset asset version is not 0.0, 1.0, or 1.1,\n * or when the tileset contains a required extension that is not supported.\n *\n * @see Cesium3DTileset#fromIonAssetId\n *\n * @example\n * try {\n *   const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *      \"http://localhost:8002/tilesets/Seattle/tileset.json\"\n *   );\n *   scene.primitives.add(tileset);\n * } catch (error) {\n *   console.error(`Error creating tileset: ${error}`);\n * }\n *\n * @example\n * // Common setting for the skipLevelOfDetail optimization\n * const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *   \"http://localhost:8002/tilesets/Seattle/tileset.json\", {\n *      skipLevelOfDetail: true,\n *      baseScreenSpaceError: 1024,\n *      skipScreenSpaceErrorFactor: 16,\n *      skipLevels: 1,\n *      immediatelyLoadDesiredLevelOfDetail: false,\n *      loadSiblings: false,\n *      cullWithChildrenBounds: true\n * });\n * scene.primitives.add(tileset);\n *\n * @example\n * // Common settings for the dynamicScreenSpaceError optimization\n * const tileset = await Cesium.Cesium3DTileset.fromUrl(\n *   \"http://localhost:8002/tilesets/Seattle/tileset.json\", {\n *      dynamicScreenSpaceError: true,\n *      dynamicScreenSpaceErrorDensity: 2.0e-4,\n *      dynamicScreenSpaceErrorFactor: 24.0,\n *      dynamicScreenSpaceErrorHeightFalloff: 0.25\n * });\n * scene.primitives.add(tileset);\n */\nCesium3DTileset.fromUrl = async function (url, options) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.defined(\"url\", url);\n  //>>includeEnd('debug');\n\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n  const resource = Resource.createIfNeeded(url);\n  let basePath;\n  if (resource.extension === \"json\") {\n    basePath = resource.getBaseUri(true);\n  } else if (resource.isDataUri) {\n    basePath = \"\";\n  }\n\n  const tilesetJson = await Cesium3DTileset.loadJson(resource);\n  const metadataExtension = await processMetadataExtension(\n    resource,\n    tilesetJson,\n  );\n\n  const tileset = new Cesium3DTileset(options);\n  tileset._resource = resource;\n  tileset._url = resource.url;\n  tileset._basePath = basePath;\n  tileset._metadataExtension = metadataExtension;\n  // Set these before loading the tileset since _geometricError\n  // and _scaledGeometricError get accessed during tile creation\n  tileset._geometricError = tilesetJson.geometricError;\n  tileset._scaledGeometricError = tilesetJson.geometricError;\n\n  const asset = tilesetJson.asset;\n  tileset._asset = asset;\n  tileset._extras = tilesetJson.extras;\n\n  createCredits(tileset);\n\n  // Handle legacy gltfUpAxis option\n  const gltfUpAxis = defined(tilesetJson.asset.gltfUpAxis)\n    ? Axis.fromName(tilesetJson.asset.gltfUpAxis)\n    : Axis.Y;\n  const modelUpAxis = defaultValue(options.modelUpAxis, gltfUpAxis);\n  const modelForwardAxis = defaultValue(options.modelForwardAxis, Axis.X);\n\n  tileset._properties = tilesetJson.properties;\n  tileset._extensionsUsed = tilesetJson.extensionsUsed;\n  tileset._extensions = tilesetJson.extensions;\n  tileset._modelUpAxis = modelUpAxis;\n  tileset._modelForwardAxis = modelForwardAxis;\n\n  tileset._root = tileset.loadTileset(resource, tilesetJson);\n\n  // Save the original, untransformed bounding volume position so we can apply\n  // the tile transform and model matrix at run time\n  const boundingVolume = tileset._root.createBoundingVolume(\n    tilesetJson.root.boundingVolume,\n    Matrix4.IDENTITY,\n  );\n  const clippingPlanesOrigin = boundingVolume.boundingSphere.center;\n  // If this origin is above the surface of the earth\n  // we want to apply an ENU orientation as our best guess of orientation.\n  // Otherwise, we assume it gets its position/orientation completely from the\n  // root tile transform and the tileset's model matrix\n  const originCartographic =\n    tileset._ellipsoid.cartesianToCartographic(clippingPlanesOrigin);\n  if (\n    defined(originCartographic) &&\n    originCartographic.height >\n      ApproximateTerrainHeights._defaultMinTerrainHeight\n  ) {\n    tileset._initialClippingPlanesOriginMatrix =\n      Transforms.eastNorthUpToFixedFrame(clippingPlanesOrigin);\n  }\n  tileset._clippingPlanesOriginMatrix = Matrix4.clone(\n    tileset._initialClippingPlanesOriginMatrix,\n  );\n\n  return tileset;\n};\n\n/**\n * Provides a hook to override the method used to request the tileset json\n * useful when fetching tilesets from remote servers\n * @param {Resource|string} tilesetUrl The url of the json file to be fetched\n * @returns {Promise<object>} A promise that resolves with the fetched json data\n */\nCesium3DTileset.loadJson = function (tilesetUrl) {\n  const resource = Resource.createIfNeeded(tilesetUrl);\n  return resource.fetchJson();\n};\n\n/**\n * Marks the tileset's {@link Cesium3DTileset#style} as dirty, which forces all\n * features to re-evaluate the style in the next frame each is visible.\n */\nCesium3DTileset.prototype.makeStyleDirty = function () {\n  this._styleEngine.makeDirty();\n};\n\n/**\n * Loads the main tileset JSON file or a tileset JSON file referenced from a tile.\n *\n * @exception {RuntimeError} When the tileset asset version is not 0.0, 1.0, or 1.1,\n * or when the tileset contains a required extension that is not supported.\n *\n * @private\n */\nCesium3DTileset.prototype.loadTileset = function (\n  resource,\n  tilesetJson,\n  parentTile,\n) {\n  const asset = tilesetJson.asset;\n  if (!defined(asset)) {\n    throw new RuntimeError(\"Tileset must have an asset property.\");\n  }\n  if (\n    asset.version !== \"0.0\" &&\n    asset.version !== \"1.0\" &&\n    asset.version !== \"1.1\"\n  ) {\n    throw new RuntimeError(\n      \"The tileset must be 3D Tiles version 0.0, 1.0, or 1.1\",\n    );\n  }\n\n  if (defined(tilesetJson.extensionsRequired)) {\n    Cesium3DTileset.checkSupportedExtensions(tilesetJson.extensionsRequired);\n  }\n\n  const statistics = this._statistics;\n\n  const tilesetVersion = asset.tilesetVersion;\n  if (defined(tilesetVersion)) {\n    // Append the tileset version to the resource\n    this._basePath += `?v=${tilesetVersion}`;\n    resource = resource.clone();\n    resource.setQueryParameters({ v: tilesetVersion });\n  }\n\n  // A tileset JSON file referenced from a tile may exist in a different directory than the root tileset.\n  // Get the basePath relative to the external tileset.\n  const rootTile = makeTile(this, resource, tilesetJson.root, parentTile);\n\n  // If there is a parentTile, add the root of the currently loading tileset\n  // to parentTile's children, and update its _depth.\n  if (defined(parentTile)) {\n    parentTile.children.push(rootTile);\n    rootTile._depth = parentTile._depth + 1;\n  }\n\n  const stack = [];\n  stack.push(rootTile);\n\n  while (stack.length > 0) {\n    const tile = stack.pop();\n    ++statistics.numberOfTilesTotal;\n    this._allTilesAdditive =\n      this._allTilesAdditive && tile.refine === Cesium3DTileRefine.ADD;\n    const children = tile._header.children;\n    if (defined(children)) {\n      for (let i = 0; i < children.length; ++i) {\n        const childHeader = children[i];\n        const childTile = makeTile(this, resource, childHeader, tile);\n        tile.children.push(childTile);\n        childTile._depth = tile._depth + 1;\n        stack.push(childTile);\n      }\n    }\n\n    if (this._cullWithChildrenBounds) {\n      Cesium3DTileOptimizations.checkChildrenWithinParent(tile);\n    }\n  }\n\n  return rootTile;\n};\n\n/**\n * Make a {@link Cesium3DTile} for a specific tile. If the tile's header has implicit\n * tiling (3D Tiles 1.1) or uses the <code>3DTILES_implicit_tiling</code> extension,\n * it creates a placeholder tile instead for lazy evaluation of the implicit tileset.\n *\n * @param {Cesium3DTileset} tileset The tileset\n * @param {Resource} baseResource The base resource for the tileset\n * @param {object} tileHeader The JSON header for the tile\n * @param {Cesium3DTile} [parentTile] The parent tile of the new tile\n * @returns {Cesium3DTile} The newly created tile\n *\n * @private\n */\nfunction makeTile(tileset, baseResource, tileHeader, parentTile) {\n  const hasImplicitTiling =\n    defined(tileHeader.implicitTiling) ||\n    hasExtension(tileHeader, \"3DTILES_implicit_tiling\");\n\n  if (!hasImplicitTiling) {\n    return new Cesium3DTile(tileset, baseResource, tileHeader, parentTile);\n  }\n\n  const metadataSchema = tileset.schema;\n\n  const implicitTileset = new ImplicitTileset(\n    baseResource,\n    tileHeader,\n    metadataSchema,\n  );\n  const rootCoordinates = new ImplicitTileCoordinates({\n    subdivisionScheme: implicitTileset.subdivisionScheme,\n    subtreeLevels: implicitTileset.subtreeLevels,\n    level: 0,\n    x: 0,\n    y: 0,\n    // The constructor will only use this for octrees.\n    z: 0,\n  });\n\n  // Create a placeholder Cesium3DTile that has an ImplicitTileset\n  // object and whose content will resolve to an Implicit3DTileContent\n  const contentUri = implicitTileset.subtreeUriTemplate.getDerivedResource({\n    templateValues: rootCoordinates.getTemplateValues(),\n  }).url;\n\n  const deepCopy = true;\n  const tileJson = clone(tileHeader, deepCopy);\n  // Replace contents with the subtree\n  tileJson.contents = [\n    {\n      uri: contentUri,\n    },\n  ];\n\n  delete tileJson.content;\n\n  // The placeholder tile does not have any extensions. If there are any\n  // extensions beyond 3DTILES_implicit_tiling, Implicit3DTileContent will\n  // copy them to the transcoded tiles.\n  delete tileJson.extensions;\n\n  const tile = new Cesium3DTile(tileset, baseResource, tileJson, parentTile);\n  tile.implicitTileset = implicitTileset;\n  tile.implicitCoordinates = rootCoordinates;\n  return tile;\n}\n\n/**\n * If tileset metadata is present, initialize the {@link Cesium3DTilesetMetadata}\n * instance. This is asynchronous since metadata schemas may be external.\n *\n * @param {Cesium3DTileset} tileset The tileset\n * @param {object} tilesetJson The tileset JSON\n * @return {Promise<Cesium3DTilesetMetadata>} The loaded Cesium3DTilesetMetadata\n * @private\n */\nasync function processMetadataExtension(resource, tilesetJson) {\n  const metadataJson = hasExtension(tilesetJson, \"3DTILES_metadata\")\n    ? tilesetJson.extensions[\"3DTILES_metadata\"]\n    : tilesetJson;\n\n  let schemaLoader;\n  if (defined(metadataJson.schemaUri)) {\n    resource = resource.getDerivedResource({\n      url: metadataJson.schemaUri,\n    });\n    schemaLoader = ResourceCache.getSchemaLoader({\n      resource: resource,\n    });\n  } else if (defined(metadataJson.schema)) {\n    schemaLoader = ResourceCache.getSchemaLoader({\n      schema: metadataJson.schema,\n    });\n  } else {\n    return;\n  }\n\n  await schemaLoader.load();\n\n  const metadataExtension = new Cesium3DTilesetMetadata({\n    schema: schemaLoader.schema,\n    metadataJson: metadataJson,\n  });\n\n  ResourceCache.unload(schemaLoader);\n\n  return metadataExtension;\n}\n\nconst scratchPositionNormal = new Cartesian3();\nconst scratchCartographic = new Cartographic();\nconst scratchMatrix = new Matrix4();\nconst scratchCenter = new Cartesian3();\nconst scratchPosition = new Cartesian3();\nconst scratchDirection = new Cartesian3();\nconst scratchHalfHeight = new Cartesian3();\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n */\nfunction updateDynamicScreenSpaceError(tileset, frameState) {\n  let up;\n  let direction;\n  let height;\n  let minimumHeight;\n  let maximumHeight;\n\n  const camera = frameState.camera;\n  const root = tileset._root;\n  const tileBoundingVolume = root.contentBoundingVolume;\n\n  if (tileBoundingVolume instanceof TileBoundingRegion) {\n    up = Cartesian3.normalize(camera.positionWC, scratchPositionNormal);\n    direction = camera.directionWC;\n    height = camera.positionCartographic.height;\n    minimumHeight = tileBoundingVolume.minimumHeight;\n    maximumHeight = tileBoundingVolume.maximumHeight;\n  } else {\n    // Transform camera position and direction into the local coordinate system of the tileset\n    const transformLocal = Matrix4.inverseTransformation(\n      root.computedTransform,\n      scratchMatrix,\n    );\n    const ellipsoid = frameState.mapProjection.ellipsoid;\n    const boundingVolume = tileBoundingVolume.boundingVolume;\n    const centerLocal = Matrix4.multiplyByPoint(\n      transformLocal,\n      boundingVolume.center,\n      scratchCenter,\n    );\n    if (Cartesian3.magnitude(centerLocal) > ellipsoid.minimumRadius) {\n      // The tileset is defined in WGS84. Approximate the minimum and maximum height.\n      const centerCartographic = Cartographic.fromCartesian(\n        centerLocal,\n        ellipsoid,\n        scratchCartographic,\n      );\n      up = Cartesian3.normalize(camera.positionWC, scratchPositionNormal);\n      direction = camera.directionWC;\n      height = camera.positionCartographic.height;\n      minimumHeight = 0.0;\n      maximumHeight = centerCartographic.height * 2.0;\n    } else {\n      // The tileset is defined in local coordinates (z-up)\n      const positionLocal = Matrix4.multiplyByPoint(\n        transformLocal,\n        camera.positionWC,\n        scratchPosition,\n      );\n      up = Cartesian3.UNIT_Z;\n      direction = Matrix4.multiplyByPointAsVector(\n        transformLocal,\n        camera.directionWC,\n        scratchDirection,\n      );\n      direction = Cartesian3.normalize(direction, direction);\n      height = positionLocal.z;\n      if (tileBoundingVolume instanceof TileOrientedBoundingBox) {\n        // Assuming z-up, the last column is the local z direction and\n        // represents the height of the bounding box.\n        const halfHeightVector = Matrix3.getColumn(\n          boundingVolume.halfAxes,\n          2,\n          scratchHalfHeight,\n        );\n        const halfHeight = Cartesian3.magnitude(halfHeightVector);\n        minimumHeight = centerLocal.z - halfHeight;\n        maximumHeight = centerLocal.z + halfHeight;\n      } else if (tileBoundingVolume instanceof TileBoundingSphere) {\n        const radius = boundingVolume.radius;\n        minimumHeight = centerLocal.z - radius;\n        maximumHeight = centerLocal.z + radius;\n      }\n    }\n  }\n\n  // The range where the density starts to lessen. Start at the quarter height of the tileset.\n  const heightFalloff = tileset.dynamicScreenSpaceErrorHeightFalloff;\n  const heightClose =\n    minimumHeight + (maximumHeight - minimumHeight) * heightFalloff;\n  const heightFar = maximumHeight;\n\n  const t = CesiumMath.clamp(\n    (height - heightClose) / (heightFar - heightClose),\n    0.0,\n    1.0,\n  );\n\n  // Increase density as the camera tilts towards the horizon\n  let horizonFactor = 1.0 - Math.abs(Cartesian3.dot(direction, up));\n\n  // Weaken the horizon factor as the camera height increases, implying the camera is further away from the tileset.\n  // The goal is to increase density for the \"street view\", not when viewing the tileset from a distance.\n  horizonFactor = horizonFactor * (1.0 - t);\n\n  tileset._dynamicScreenSpaceErrorComputedDensity =\n    tileset.dynamicScreenSpaceErrorDensity * horizonFactor;\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction requestContent(tileset, tile) {\n  if (tile.hasEmptyContent) {\n    return;\n  }\n\n  const { statistics } = tileset;\n  const contentExpired = tile.contentExpired;\n\n  const promise = tile.requestContent();\n  if (!defined(promise)) {\n    return;\n  }\n\n  promise\n    .then((content) => {\n      if (!defined(content) || tile.isDestroyed() || tileset.isDestroyed()) {\n        return;\n      }\n\n      tileset._processingQueue.push(tile);\n      ++statistics.numberOfTilesProcessing;\n    })\n    .catch((error) => {\n      handleTileFailure(error, tileset, tile);\n    });\n\n  if (contentExpired) {\n    if (tile.hasTilesetContent || tile.hasImplicitContent) {\n      destroySubtree(tileset, tile);\n    } else {\n      statistics.decrementLoadCounts(tile.content);\n      --statistics.numberOfTilesWithContentReady;\n    }\n  }\n\n  tileset._requestedTilesInFlight.push(tile);\n}\n\nfunction sortTilesByPriority(a, b) {\n  return a._priority - b._priority;\n}\n\n/**\n * Perform any pass invariant tasks here. Called after the render pass.\n * @private\n * @param {FrameState} frameState\n */\nCesium3DTileset.prototype.postPassesUpdate = function (frameState) {\n  if (!defined(this._root)) {\n    return;\n  }\n\n  cancelOutOfViewRequests(this, frameState);\n  raiseLoadProgressEvent(this, frameState);\n  this._cache.unloadTiles(this, unloadTile);\n\n  // If the style wasn't able to be applied this frame (for example,\n  // the tileset was hidden), keep it dirty so the engine can try\n  // to apply the style next frame.\n  if (this._styleApplied) {\n    this._styleEngine.resetDirty();\n  }\n  this._styleApplied = false;\n};\n\n/**\n * Perform any pass invariant tasks here. Called before any passes are executed.\n * @private\n * @param {FrameState} frameState\n */\nCesium3DTileset.prototype.prePassesUpdate = function (frameState) {\n  if (!defined(this._root)) {\n    return;\n  }\n\n  processTiles(this, frameState);\n\n  // Update clipping planes\n  const clippingPlanes = this._clippingPlanes;\n  this._clippingPlanesOriginMatrixDirty = true;\n  if (defined(clippingPlanes) && clippingPlanes.enabled) {\n    clippingPlanes.update(frameState);\n  }\n\n  // Update clipping polygons\n  const clippingPolygons = this._clippingPolygons;\n  if (defined(clippingPolygons) && clippingPolygons.enabled) {\n    clippingPolygons.update(frameState);\n  }\n\n  if (!defined(this._loadTimestamp)) {\n    this._loadTimestamp = JulianDate.clone(frameState.time);\n  }\n  this._timeSinceLoad = Math.max(\n    JulianDate.secondsDifference(frameState.time, this._loadTimestamp) * 1000,\n    0.0,\n  );\n\n  if (this.dynamicScreenSpaceError) {\n    updateDynamicScreenSpaceError(this, frameState);\n  }\n\n  if (frameState.newFrame) {\n    this._cache.reset();\n  }\n};\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n */\nfunction cancelOutOfViewRequests(tileset, frameState) {\n  const requestedTilesInFlight = tileset._requestedTilesInFlight;\n  let removeCount = 0;\n  for (let i = 0; i < requestedTilesInFlight.length; ++i) {\n    const tile = requestedTilesInFlight[i];\n\n    // NOTE: This is framerate dependant so make sure the threshold check is small\n    const outOfView = frameState.frameNumber - tile._touchedFrame >= 1;\n    if (tile._contentState !== Cesium3DTileContentState.LOADING) {\n      // No longer fetching from host, don't need to track it anymore. Gets marked as LOADING in Cesium3DTile::requestContent().\n      ++removeCount;\n      continue;\n    } else if (outOfView) {\n      // RequestScheduler will take care of cancelling it\n      tile.cancelRequests();\n      ++removeCount;\n      continue;\n    }\n\n    if (removeCount > 0) {\n      requestedTilesInFlight[i - removeCount] = tile;\n    }\n  }\n\n  requestedTilesInFlight.length -= removeCount;\n}\n\n/**\n * Sort requests by priority before making any requests.\n * This makes it less likely that requests will be cancelled after being issued.\n * @private\n * @param {Cesium3DTileset} tileset\n */\nfunction requestTiles(tileset) {\n  const requestedTiles = tileset._requestedTiles;\n  requestedTiles.sort(sortTilesByPriority);\n  for (let i = 0; i < requestedTiles.length; ++i) {\n    requestContent(tileset, requestedTiles[i]);\n  }\n}\n\n/**\n * @private\n * @param {Error} error\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction handleTileFailure(error, tileset, tile) {\n  if (tileset.isDestroyed()) {\n    return;\n  }\n\n  let url;\n  if (!tile.isDestroyed()) {\n    url = tile._contentResource.url;\n  }\n\n  const message = defined(error.message) ? error.message : error.toString();\n  if (tileset.tileFailed.numberOfListeners > 0) {\n    tileset.tileFailed.raiseEvent({\n      url: url,\n      message: message,\n    });\n  } else {\n    console.log(`A 3D tile failed to load: ${url}`);\n    console.log(`Error: ${message}`);\n    console.log(error.stack);\n  }\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n */\nfunction filterProcessingQueue(tileset) {\n  const tiles = tileset._processingQueue;\n\n  let removeCount = 0;\n  for (let i = 0; i < tiles.length; ++i) {\n    const tile = tiles[i];\n    if (\n      tile.isDestroyed() ||\n      tile._contentState !== Cesium3DTileContentState.PROCESSING\n    ) {\n      ++removeCount;\n      continue;\n    }\n    if (removeCount > 0) {\n      tiles[i - removeCount] = tile;\n    }\n  }\n  tiles.length -= removeCount;\n}\n\nconst scratchUpdateHeightCartographic = new Cartographic();\nconst scratchUpdateHeightCartographic2 = new Cartographic();\nconst scratchUpdateHeightCartesian = new Cartesian3();\nfunction processUpdateHeight(tileset, tile, frameState) {\n  if (!tileset.enableCollision || !tileset.show) {\n    return;\n  }\n\n  const heightCallbackData = tileset._addHeightCallbacks;\n  const boundingSphere = tile.boundingSphere;\n\n  for (const callbackData of heightCallbackData) {\n    // No need to update if the tile was already visible last frame\n    if (callbackData.invoked || tile._wasSelectedLastFrame) {\n      continue;\n    }\n\n    const ellipsoid = callbackData.ellipsoid;\n    const positionCartographic = Cartographic.clone(\n      callbackData.positionCartographic,\n      scratchUpdateHeightCartographic,\n    );\n    const centerCartographic = Cartographic.fromCartesian(\n      boundingSphere.center,\n      ellipsoid,\n      scratchUpdateHeightCartographic2,\n    );\n\n    // This can be undefined when the bounding sphere is at the origin\n    if (defined(centerCartographic)) {\n      positionCartographic.height = centerCartographic.height;\n    }\n\n    const position = Cartographic.toCartesian(\n      positionCartographic,\n      ellipsoid,\n      scratchUpdateHeightCartesian,\n    );\n    if (\n      Cartesian3.distance(position, boundingSphere.center) <=\n      boundingSphere.radius\n    ) {\n      frameState.afterRender.push(() => {\n        // Callback can be removed before it actually invoked at the end of the frame\n        if (defined(callbackData.callback)) {\n          callbackData.callback(positionCartographic);\n        }\n        callbackData.invoked = false;\n      });\n    }\n  }\n}\n\n/**\n * Process tiles in the PROCESSING state so they will eventually move to the READY state.\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction processTiles(tileset, frameState) {\n  filterProcessingQueue(tileset);\n  const tiles = tileset._processingQueue;\n\n  const { cacheBytes, maximumCacheOverflowBytes, statistics } = tileset;\n  const cacheByteLimit = cacheBytes + maximumCacheOverflowBytes;\n\n  let memoryExceeded = false;\n  for (let i = 0; i < tiles.length; ++i) {\n    if (tileset.totalMemoryUsageInBytes > cacheByteLimit) {\n      memoryExceeded = true;\n      break;\n    }\n\n    const tile = tiles[i];\n    try {\n      tile.process(tileset, frameState);\n\n      if (tile.contentReady) {\n        --statistics.numberOfTilesProcessing;\n        tileset.tileLoad.raiseEvent(tile);\n      }\n    } catch (error) {\n      --statistics.numberOfTilesProcessing;\n      handleTileFailure(error, tileset, tile);\n    }\n  }\n\n  if (tileset.totalMemoryUsageInBytes < cacheBytes) {\n    decreaseScreenSpaceError(tileset);\n  } else if (memoryExceeded && tiles.length > 0) {\n    increaseScreenSpaceError(tileset);\n  }\n}\n\nfunction increaseScreenSpaceError(tileset) {\n  //>>includeStart('debug', pragmas.debug);\n  oneTimeWarning(\n    \"increase-screenSpaceError\",\n    `The tiles needed to meet maximumScreenSpaceError would use more memory than allocated for this tileset.\n    The tileset will be rendered with a larger screen space error (see memoryAdjustedScreenSpaceError).\n    Consider using larger values for cacheBytes and maximumCacheOverflowBytes.`,\n  );\n  //>>includeEnd('debug');\n\n  tileset._memoryAdjustedScreenSpaceError *= 1.02;\n  const tiles = tileset._processingQueue;\n  for (let i = 0; i < tiles.length; ++i) {\n    tiles[i].updatePriority();\n  }\n  tiles.sort(sortTilesByPriority);\n}\n\nfunction decreaseScreenSpaceError(tileset) {\n  tileset._memoryAdjustedScreenSpaceError = Math.max(\n    tileset.memoryAdjustedScreenSpaceError / 1.02,\n    tileset.maximumScreenSpaceError,\n  );\n}\n\nconst scratchCartesian = new Cartesian3();\n\nconst stringOptions = {\n  maximumFractionDigits: 3,\n};\n\n/**\n * @private\n * @param {number} memorySizeInBytes\n * @returns {string}\n */\nfunction formatMemoryString(memorySizeInBytes) {\n  const memoryInMegabytes = memorySizeInBytes / 1048576;\n  if (memoryInMegabytes < 1.0) {\n    return memoryInMegabytes.toLocaleString(undefined, stringOptions);\n  }\n  return Math.round(memoryInMegabytes).toLocaleString();\n}\n\n/**\n * @private\n * @param {Cesium3DTile} tile\n * @returns {Cartesian3}\n */\nfunction computeTileLabelPosition(tile) {\n  const { halfAxes, radius, center } = tile.boundingVolume.boundingVolume;\n\n  let position = Cartesian3.clone(center, scratchCartesian);\n  if (defined(halfAxes)) {\n    position.x += 0.75 * (halfAxes[0] + halfAxes[3] + halfAxes[6]);\n    position.y += 0.75 * (halfAxes[1] + halfAxes[4] + halfAxes[7]);\n    position.z += 0.75 * (halfAxes[2] + halfAxes[5] + halfAxes[8]);\n  } else if (defined(radius)) {\n    let normal = Cartesian3.normalize(center, scratchCartesian);\n    normal = Cartesian3.multiplyByScalar(\n      normal,\n      0.75 * radius,\n      scratchCartesian,\n    );\n    position = Cartesian3.add(normal, center, scratchCartesian);\n  }\n  return position;\n}\n\n/**\n * @private\n * @param {Cesium3DTile} tile\n * @param {Cesium3DTileset} tileset\n * @param {Cartesian3} position\n * @returns {Label}\n */\nfunction addTileDebugLabel(tile, tileset, position) {\n  let labelString = \"\";\n  let attributes = 0;\n\n  if (tileset.debugShowGeometricError) {\n    labelString += `\\nGeometric error: ${tile.geometricError}`;\n    attributes++;\n  }\n\n  if (tileset.debugShowRenderingStatistics) {\n    labelString += `\\nCommands: ${tile.commandsLength}`;\n    attributes++;\n\n    // Don't display number of points or triangles if 0.\n    const numberOfPoints = tile.content.pointsLength;\n    if (numberOfPoints > 0) {\n      labelString += `\\nPoints: ${tile.content.pointsLength}`;\n      attributes++;\n    }\n\n    const numberOfTriangles = tile.content.trianglesLength;\n    if (numberOfTriangles > 0) {\n      labelString += `\\nTriangles: ${tile.content.trianglesLength}`;\n      attributes++;\n    }\n\n    labelString += `\\nFeatures: ${tile.content.featuresLength}`;\n    attributes++;\n  }\n\n  if (tileset.debugShowMemoryUsage) {\n    labelString += `\\nTexture Memory: ${formatMemoryString(\n      tile.content.texturesByteLength,\n    )}`;\n    labelString += `\\nGeometry Memory: ${formatMemoryString(\n      tile.content.geometryByteLength,\n    )}`;\n    attributes += 2;\n  }\n\n  if (tileset.debugShowUrl) {\n    if (tile.hasMultipleContents) {\n      labelString += \"\\nUrls:\";\n      const urls = tile.content.innerContentUrls;\n      for (let i = 0; i < urls.length; i++) {\n        labelString += `\\n- ${urls[i]}`;\n      }\n      attributes += urls.length;\n    } else {\n      labelString += `\\nUrl: ${tile._contentHeader.uri}`;\n      attributes++;\n    }\n  }\n\n  const newLabel = {\n    text: labelString.substring(1),\n    position: position,\n    font: `${19 - attributes}px sans-serif`,\n    showBackground: true,\n    disableDepthTestDistance: Number.POSITIVE_INFINITY,\n  };\n\n  return tileset._tileDebugLabels.add(newLabel);\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n */\nfunction updateTileDebugLabels(tileset, frameState) {\n  const selectedTiles = tileset._selectedTiles;\n  const selectedLength = selectedTiles.length;\n  const emptyTiles = tileset._emptyTiles;\n  const emptyLength = emptyTiles.length;\n  tileset._tileDebugLabels.removeAll();\n\n  if (tileset.debugPickedTileLabelOnly) {\n    if (defined(tileset.debugPickedTile)) {\n      const position = defined(tileset.debugPickPosition)\n        ? tileset.debugPickPosition\n        : computeTileLabelPosition(tileset.debugPickedTile);\n      const label = addTileDebugLabel(\n        tileset.debugPickedTile,\n        tileset,\n        position,\n      );\n      label.pixelOffset = new Cartesian2(15, -15); // Offset to avoid picking the label.\n    }\n  } else {\n    for (let i = 0; i < selectedLength; ++i) {\n      const tile = selectedTiles[i];\n      addTileDebugLabel(tile, tileset, computeTileLabelPosition(tile));\n    }\n    for (let i = 0; i < emptyLength; ++i) {\n      const tile = emptyTiles[i];\n      if (tile.hasTilesetContent || tile.hasImplicitContent) {\n        addTileDebugLabel(tile, tileset, computeTileLabelPosition(tile));\n      }\n    }\n  }\n  tileset._tileDebugLabels.update(frameState);\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n * @param {object} passOptions\n */\nfunction updateTiles(tileset, frameState, passOptions) {\n  tileset._styleEngine.applyStyle(tileset);\n  tileset._styleApplied = true;\n\n  const { commandList, context } = frameState;\n  const numberOfInitialCommands = commandList.length;\n  const selectedTiles = tileset._selectedTiles;\n\n  const bivariateVisibilityTest =\n    tileset.isSkippingLevelOfDetail &&\n    tileset._hasMixedContent &&\n    context.stencilBuffer &&\n    selectedTiles.length > 0;\n\n  tileset._backfaceCommands.length = 0;\n\n  if (bivariateVisibilityTest) {\n    if (!defined(tileset._stencilClearCommand)) {\n      tileset._stencilClearCommand = new ClearCommand({\n        stencil: 0,\n        pass: Pass.CESIUM_3D_TILE,\n        renderState: RenderState.fromCache({\n          stencilMask: StencilConstants.SKIP_LOD_MASK,\n        }),\n      });\n    }\n    commandList.push(tileset._stencilClearCommand);\n  }\n\n  const { statistics, tileVisible } = tileset;\n  const isRender = passOptions.isRender;\n  const lengthBeforeUpdate = commandList.length;\n\n  for (let i = 0; i < selectedTiles.length; ++i) {\n    const tile = selectedTiles[i];\n    // Raise the tileVisible event before update in case the tileVisible event\n    // handler makes changes that update needs to apply to WebGL resources\n    if (isRender) {\n      tileVisible.raiseEvent(tile);\n    }\n    processUpdateHeight(tileset, tile, frameState);\n    tile.update(tileset, frameState, passOptions);\n    statistics.incrementSelectionCounts(tile.content);\n    ++statistics.selected;\n  }\n  const emptyTiles = tileset._emptyTiles;\n  for (let i = 0; i < emptyTiles.length; ++i) {\n    const tile = emptyTiles[i];\n    tile.update(tileset, frameState, passOptions);\n  }\n\n  let addedCommandsLength = commandList.length - lengthBeforeUpdate;\n\n  tileset._backfaceCommands.trim();\n\n  if (bivariateVisibilityTest) {\n    /*\n     * Consider 'effective leaf' tiles as selected tiles that have no selected descendants. They may have children,\n     * but they are currently our effective leaves because they do not have selected descendants. These tiles\n     * are those where with tile._finalResolution === true.\n     * Let 'unresolved' tiles be those with tile._finalResolution === false.\n     *\n     * 1. Render just the backfaces of unresolved tiles in order to lay down z\n     * 2. Render all frontfaces wherever tile._selectionDepth > stencilBuffer.\n     *    Replace stencilBuffer with tile._selectionDepth, when passing the z test.\n     *    Because children are always drawn before ancestors {@link Cesium3DTilesetTraversal#traverseAndSelect},\n     *    this effectively draws children first and does not draw ancestors if a descendant has already\n     *    been drawn at that pixel.\n     *    Step 1 prevents child tiles from appearing on top when they are truly behind ancestor content.\n     *    If they are behind the backfaces of the ancestor, then they will not be drawn.\n     *\n     * NOTE: Step 2 sometimes causes visual artifacts when backfacing child content has some faces that\n     * partially face the camera and are inside of the ancestor content. Because they are inside, they will\n     * not be culled by the depth writes in Step 1, and because they partially face the camera, the stencil tests\n     * will draw them on top of the ancestor content.\n     *\n     * NOTE: Because we always render backfaces of unresolved tiles, if the camera is looking at the backfaces\n     * of an object, they will always be drawn while loading, even if backface culling is enabled.\n     */\n\n    const backfaceCommands = tileset._backfaceCommands.values;\n    const backfaceCommandsLength = backfaceCommands.length;\n\n    commandList.length += backfaceCommandsLength;\n\n    // copy commands to the back of the commandList\n    for (let i = addedCommandsLength - 1; i >= 0; --i) {\n      commandList[lengthBeforeUpdate + backfaceCommandsLength + i] =\n        commandList[lengthBeforeUpdate + i];\n    }\n\n    // move backface commands to the front of the commandList\n    for (let i = 0; i < backfaceCommandsLength; ++i) {\n      commandList[lengthBeforeUpdate + i] = backfaceCommands[i];\n    }\n  }\n\n  // Number of commands added by each update above\n  addedCommandsLength = commandList.length - numberOfInitialCommands;\n  statistics.numberOfCommands = addedCommandsLength;\n\n  if (!isRender) {\n    return;\n  }\n\n  // Only run EDL if simple attenuation is on\n  if (\n    tileset.pointCloudShading.attenuation &&\n    tileset.pointCloudShading.eyeDomeLighting &&\n    addedCommandsLength > 0\n  ) {\n    tileset._pointCloudEyeDomeLighting.update(\n      frameState,\n      numberOfInitialCommands,\n      tileset.pointCloudShading,\n      tileset.boundingSphere,\n    );\n  }\n\n  if (\n    tileset.debugShowGeometricError ||\n    tileset.debugShowRenderingStatistics ||\n    tileset.debugShowMemoryUsage ||\n    tileset.debugShowUrl\n  ) {\n    if (!defined(tileset._tileDebugLabels)) {\n      tileset._tileDebugLabels = new LabelCollection();\n    }\n    updateTileDebugLabels(tileset, frameState);\n  } else {\n    tileset._tileDebugLabels =\n      tileset._tileDebugLabels && tileset._tileDebugLabels.destroy();\n  }\n}\n\nconst scratchStack = [];\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction destroySubtree(tileset, tile) {\n  const root = tile;\n  const stack = scratchStack;\n  stack.push(tile);\n  while (stack.length > 0) {\n    tile = stack.pop();\n    const children = tile.children;\n    for (let i = 0; i < children.length; ++i) {\n      stack.push(children[i]);\n    }\n    if (tile !== root) {\n      destroyTile(tileset, tile);\n      --tileset._statistics.numberOfTilesTotal;\n    }\n  }\n  root.children = [];\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction unloadTile(tileset, tile) {\n  tileset.tileUnload.raiseEvent(tile);\n  tileset._statistics.decrementLoadCounts(tile.content);\n  --tileset._statistics.numberOfTilesWithContentReady;\n  tile.unloadContent();\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {Cesium3DTile} tile\n */\nfunction destroyTile(tileset, tile) {\n  tileset._cache.unloadTile(tileset, tile, unloadTile);\n  tile.destroy();\n}\n\n/**\n * Unloads all tiles that weren't selected the previous frame.  This can be used to\n * explicitly manage the tile cache and reduce the total number of tiles loaded below\n * {@link Cesium3DTileset#cacheBytes}.\n * <p>\n * Tile unloads occur at the next frame to keep all the WebGL delete calls\n * within the render loop.\n * </p>\n */\nCesium3DTileset.prototype.trimLoadedTiles = function () {\n  this._cache.trim();\n};\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n */\nfunction raiseLoadProgressEvent(tileset, frameState) {\n  const statistics = tileset._statistics;\n  const statisticsLast = tileset._statisticsLast;\n\n  const numberOfPendingRequests = statistics.numberOfPendingRequests;\n  const numberOfTilesProcessing = statistics.numberOfTilesProcessing;\n  const lastNumberOfPendingRequest = statisticsLast.numberOfPendingRequests;\n  const lastNumberOfTilesProcessing = statisticsLast.numberOfTilesProcessing;\n\n  Cesium3DTilesetStatistics.clone(statistics, statisticsLast);\n\n  const progressChanged =\n    numberOfPendingRequests !== lastNumberOfPendingRequest ||\n    numberOfTilesProcessing !== lastNumberOfTilesProcessing;\n\n  if (progressChanged) {\n    frameState.afterRender.push(function () {\n      tileset.loadProgress.raiseEvent(\n        numberOfPendingRequests,\n        numberOfTilesProcessing,\n      );\n\n      return true;\n    });\n  }\n\n  tileset._tilesLoaded =\n    statistics.numberOfPendingRequests === 0 &&\n    statistics.numberOfTilesProcessing === 0 &&\n    statistics.numberOfAttemptedRequests === 0;\n\n  // Events are raised (added to the afterRender queue) here since promises\n  // may resolve outside of the update loop that then raise events, e.g.,\n  // model's readyEvent\n  if (progressChanged && tileset._tilesLoaded) {\n    frameState.afterRender.push(function () {\n      tileset.allTilesLoaded.raiseEvent();\n      return true;\n    });\n    if (!tileset._initialTilesLoaded) {\n      tileset._initialTilesLoaded = true;\n      frameState.afterRender.push(function () {\n        tileset.initialTilesLoaded.raiseEvent();\n        return true;\n      });\n    }\n  }\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n */\nfunction resetMinimumMaximum(tileset) {\n  tileset._heatmap.resetMinimumMaximum();\n  tileset._minimumPriority.depth = Number.MAX_VALUE;\n  tileset._maximumPriority.depth = -Number.MAX_VALUE;\n  tileset._minimumPriority.foveatedFactor = Number.MAX_VALUE;\n  tileset._maximumPriority.foveatedFactor = -Number.MAX_VALUE;\n  tileset._minimumPriority.distance = Number.MAX_VALUE;\n  tileset._maximumPriority.distance = -Number.MAX_VALUE;\n  tileset._minimumPriority.reverseScreenSpaceError = Number.MAX_VALUE;\n  tileset._maximumPriority.reverseScreenSpaceError = -Number.MAX_VALUE;\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n */\nfunction detectModelMatrixChanged(tileset, frameState) {\n  if (\n    frameState.frameNumber === tileset._updatedModelMatrixFrame &&\n    defined(tileset._previousModelMatrix)\n  ) {\n    return;\n  }\n\n  tileset._updatedModelMatrixFrame = frameState.frameNumber;\n  tileset._modelMatrixChanged = !Matrix4.equals(\n    tileset.modelMatrix,\n    tileset._previousModelMatrix,\n  );\n  if (tileset._modelMatrixChanged) {\n    tileset._previousModelMatrix = Matrix4.clone(\n      tileset.modelMatrix,\n      tileset._previousModelMatrix,\n    );\n  }\n}\n\n/**\n * @private\n * @param {Cesium3DTileset} tileset\n * @param {FrameState} frameState\n * @param {Cesium3DTilesetStatistics} passStatistics\n * @param {object} passOptions\n * @returns {boolean}\n */\nfunction update(tileset, frameState, passStatistics, passOptions) {\n  if (frameState.mode === SceneMode.MORPHING) {\n    return false;\n  }\n\n  if (!defined(tileset._root)) {\n    return false;\n  }\n\n  const statistics = tileset._statistics;\n  statistics.clear();\n\n  // Resets the visibility check for each pass\n  ++tileset._updatedVisibilityFrame;\n\n  // Update any tracked min max values\n  resetMinimumMaximum(tileset);\n\n  detectModelMatrixChanged(tileset, frameState);\n  tileset._cullRequestsWhileMoving =\n    tileset.cullRequestsWhileMoving && !tileset._modelMatrixChanged;\n\n  const ready = tileset\n    .getTraversal(passOptions)\n    .selectTiles(tileset, frameState);\n\n  if (passOptions.requestTiles) {\n    requestTiles(tileset);\n  }\n\n  updateTiles(tileset, frameState, passOptions);\n\n  // Update pass statistics\n  Cesium3DTilesetStatistics.clone(statistics, passStatistics);\n\n  if (passOptions.isRender) {\n    const credits = tileset._credits;\n    if (defined(credits) && statistics.selected !== 0) {\n      for (let i = 0; i < credits.length; ++i) {\n        const credit = credits[i];\n        frameState.creditDisplay.addCreditToNextFrame(credit);\n      }\n    }\n  }\n\n  return ready;\n}\n\nfunction createCredits(tileset) {\n  let credits = tileset._credits;\n  if (!defined(credits)) {\n    credits = [];\n  }\n  credits.length = 0;\n\n  if (defined(tileset.resource.credits)) {\n    tileset.resource.credits.forEach((credit) => {\n      credits.push(Credit.clone(credit));\n    });\n  }\n\n  const assetExtras = tileset.asset.extras;\n  if (\n    defined(assetExtras) &&\n    defined(assetExtras.cesium) &&\n    defined(assetExtras.cesium.credits)\n  ) {\n    const extraCredits = assetExtras.cesium.credits;\n    for (let i = 0; i < extraCredits.length; ++i) {\n      const credit = extraCredits[i];\n      credits.push(new Credit(credit.html));\n    }\n  }\n\n  credits.forEach(\n    (credit) =>\n      (credit.showOnScreen =\n        credit.showOnScreen || tileset._showCreditsOnScreen),\n  );\n\n  tileset._credits = credits;\n}\n\n/**\n * @private\n * @param {object} passOptions\n * @returns {Cesium3DTilesetTraversal}\n */\nCesium3DTileset.prototype.getTraversal = function (passOptions) {\n  const { pass } = passOptions;\n  if (\n    pass === Cesium3DTilePass.MOST_DETAILED_PRELOAD ||\n    pass === Cesium3DTilePass.MOST_DETAILED_PICK\n  ) {\n    return Cesium3DTilesetMostDetailedTraversal;\n  }\n  return this.isSkippingLevelOfDetail\n    ? Cesium3DTilesetSkipTraversal\n    : Cesium3DTilesetBaseTraversal;\n};\n\n/**\n * @private\n * @param {FrameState} frameState\n */\nCesium3DTileset.prototype.update = function (frameState) {\n  this.updateForPass(frameState, frameState.tilesetPassState);\n};\n\n/**\n * @private\n * @param {FrameState} frameState\n * @param {object} tilesetPassState\n */\nCesium3DTileset.prototype.updateForPass = function (\n  frameState,\n  tilesetPassState,\n) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.object(\"frameState\", frameState);\n  Check.typeOf.object(\"tilesetPassState\", tilesetPassState);\n  //>>includeEnd('debug');\n\n  const pass = tilesetPassState.pass;\n  if (\n    (pass === Cesium3DTilePass.PRELOAD &&\n      (!this.preloadWhenHidden || this.show)) ||\n    (pass === Cesium3DTilePass.PRELOAD_FLIGHT &&\n      (!this.preloadFlightDestinations ||\n        (!this.show && !this.preloadWhenHidden))) ||\n    (pass === Cesium3DTilePass.REQUEST_RENDER_MODE_DEFER_CHECK &&\n      ((!this._cullRequestsWhileMoving && this.foveatedTimeDelay <= 0) ||\n        !this.show))\n  ) {\n    return;\n  }\n\n  const originalCommandList = frameState.commandList;\n  const originalCamera = frameState.camera;\n  const originalCullingVolume = frameState.cullingVolume;\n\n  tilesetPassState.ready = false;\n\n  const passOptions = Cesium3DTilePass.getPassOptions(pass);\n  const ignoreCommands = passOptions.ignoreCommands;\n\n  const commandList = defaultValue(\n    tilesetPassState.commandList,\n    originalCommandList,\n  );\n  const commandStart = commandList.length;\n\n  frameState.commandList = commandList;\n  frameState.camera = defaultValue(tilesetPassState.camera, originalCamera);\n  frameState.cullingVolume = defaultValue(\n    tilesetPassState.cullingVolume,\n    originalCullingVolume,\n  );\n\n  if (passOptions.isRender) {\n    const environmentMapManager = this._environmentMapManager;\n    if (defined(this._root)) {\n      environmentMapManager.position = this.boundingSphere.center;\n    }\n    environmentMapManager.update(frameState);\n  }\n\n  // Update clipping polygons\n  const clippingPolygons = this._clippingPolygons;\n  if (defined(clippingPolygons) && clippingPolygons.enabled) {\n    clippingPolygons.queueCommands(frameState);\n  }\n\n  const passStatistics = this._statisticsPerPass[pass];\n\n  if (this.show || ignoreCommands) {\n    this._pass = pass;\n    tilesetPassState.ready = update(\n      this,\n      frameState,\n      passStatistics,\n      passOptions,\n    );\n  }\n\n  if (ignoreCommands) {\n    commandList.length = commandStart;\n  }\n\n  frameState.commandList = originalCommandList;\n  frameState.camera = originalCamera;\n  frameState.cullingVolume = originalCullingVolume;\n};\n\n/**\n * <code>true</code> if the tileset JSON file lists the extension in extensionsUsed; otherwise, <code>false</code>.\n * @param {string} extensionName The name of the extension to check.\n *\n * @returns {boolean} <code>true</code> if the tileset JSON file lists the extension in extensionsUsed; otherwise, <code>false</code>.\n */\nCesium3DTileset.prototype.hasExtension = function (extensionName) {\n  if (!defined(this._extensionsUsed)) {\n    return false;\n  }\n\n  return this._extensionsUsed.indexOf(extensionName) > -1;\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <br /><br />\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n *\n * @returns {boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n *\n * @see Cesium3DTileset#destroy\n */\nCesium3DTileset.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n * <br /><br />\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n * @example\n * tileset = tileset && tileset.destroy();\n *\n * @see Cesium3DTileset#isDestroyed\n */\nCesium3DTileset.prototype.destroy = function () {\n  this._tileDebugLabels =\n    this._tileDebugLabels && this._tileDebugLabels.destroy();\n  this._clippingPlanes = this._clippingPlanes && this._clippingPlanes.destroy();\n  this._clippingPolygons =\n    this._clippingPolygons && this._clippingPolygons.destroy();\n\n  // Traverse the tree and destroy all tiles\n  if (defined(this._root)) {\n    const stack = scratchStack;\n    stack.push(this._root);\n\n    while (stack.length > 0) {\n      const tile = stack.pop();\n      tile.destroy();\n\n      const children = tile.children;\n      for (let i = 0; i < children.length; ++i) {\n        stack.push(children[i]);\n      }\n    }\n  }\n  this._root = undefined;\n\n  if (\n    this._shouldDestroyImageBasedLighting &&\n    !this._imageBasedLighting.isDestroyed()\n  ) {\n    this._imageBasedLighting.destroy();\n  }\n  this._imageBasedLighting = undefined;\n\n  if (!this._environmentMapManager.isDestroyed()) {\n    this._environmentMapManager.destroy();\n  }\n  this._environmentMapManager = undefined;\n\n  return destroyObject(this);\n};\n\nCesium3DTileset.supportedExtensions = {\n  \"3DTILES_metadata\": true,\n  \"3DTILES_implicit_tiling\": true,\n  \"3DTILES_content_gltf\": true,\n  \"3DTILES_multiple_contents\": true,\n  \"3DTILES_bounding_volume_S2\": true,\n  \"3DTILES_batch_table_hierarchy\": true,\n  \"3DTILES_draco_point_compression\": true,\n  MAXAR_content_geojson: true,\n};\n\n/**\n * Checks to see if a given extension is supported by Cesium3DTileset. If\n * the extension is not supported by Cesium3DTileset, it throws a RuntimeError.\n *\n * @param {object} extensionsRequired The extensions we wish to check\n *\n * @private\n */\nCesium3DTileset.checkSupportedExtensions = function (extensionsRequired) {\n  for (let i = 0; i < extensionsRequired.length; i++) {\n    if (!Cesium3DTileset.supportedExtensions[extensionsRequired[i]]) {\n      throw new RuntimeError(\n        `Unsupported 3D Tiles Extension: ${extensionsRequired[i]}`,\n      );\n    }\n  }\n};\n\nconst scratchGetHeightRay = new Ray();\nconst scratchIntersection = new Cartesian3();\nconst scratchGetHeightCartographic = new Cartographic();\n\n/**\n * Get the height of the loaded surface at a given cartographic. This function will only take into account meshes for loaded tiles, not neccisarily the most detailed tiles available for a tileset. This function will always return undefined when sampling a point cloud.\n *\n * @param {Cartographic} cartographic The cartographic for which to find the height.\n * @param {Scene} scene The scene where visualization is taking place.\n * @returns {number|undefined} The height of the cartographic or undefined if it could not be found.\n *\n * @example\n * const tileset = await Cesium.Cesium3DTileset.fromIonAssetId(124624234);\n * scene.primitives.add(tileset);\n *\n * const height = tileset.getHeight(scene.camera.positionCartographic, scene);\n */\nCesium3DTileset.prototype.getHeight = function (cartographic, scene) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.object(\"cartographic\", cartographic);\n  Check.typeOf.object(\"scene\", scene);\n  //>>includeEnd('debug');\n\n  let ellipsoid = scene.ellipsoid;\n  if (!defined(ellipsoid)) {\n    ellipsoid = Ellipsoid.WGS84;\n  }\n\n  const ray = scratchGetHeightRay;\n  const position = ellipsoid.cartographicToCartesian(\n    cartographic,\n    ray.direction,\n  );\n  Cartesian3.normalize(ray.direction, ray.direction);\n\n  ray.direction = Cartesian3.normalize(position, ray.direction);\n  ray.direction = Cartesian3.negate(position, ray.direction);\n  ray.origin = Cartesian3.multiplyByScalar(\n    ray.direction,\n    -2 * ellipsoid.maximumRadius,\n    ray.origin,\n  );\n\n  const intersection = this.pick(ray, scene.frameState, scratchIntersection);\n  if (!defined(intersection)) {\n    return;\n  }\n\n  return ellipsoid.cartesianToCartographic(\n    intersection,\n    scratchGetHeightCartographic,\n  )?.height;\n};\n\n/**\n * Calls the callback when a new tile is rendered that contains the given cartographic. The only parameter\n * is the cartographic position on the tile.\n *\n * @private\n *\n * @param {Scene} scene The scene where visualization is taking place.\n * @param {Cartographic} cartographic The cartographic position.\n * @param {Function} callback The function to be called when a new tile is loaded.\n * @param {Ellipsoid} [ellipsoid=Ellipsoid.WGS84] The ellipsoid to use.\n * @returns {Function} The function to remove this callback from the quadtree.\n */\nCesium3DTileset.prototype.updateHeight = function (\n  cartographic,\n  callback,\n  ellipsoid,\n) {\n  ellipsoid = defaultValue(ellipsoid, Ellipsoid.WGS84);\n\n  const object = {\n    positionCartographic: cartographic,\n    ellipsoid: ellipsoid,\n    callback: callback,\n    invoked: false,\n  };\n\n  const removeCallback = () => {\n    const addedCallbacks = this._addHeightCallbacks;\n    const length = addedCallbacks.length;\n    for (let i = 0; i < length; ++i) {\n      if (addedCallbacks[i] === object) {\n        addedCallbacks.splice(i, 1);\n        break;\n      }\n    }\n\n    if (object.callback) {\n      object.callback = undefined;\n    }\n  };\n\n  this._addHeightCallbacks.push(object);\n  return removeCallback;\n};\n\nconst scratchSphereIntersection = new Interval();\nconst scratchPickIntersection = new Cartesian3();\n\n/**\n * Find an intersection between a ray and the tileset surface that was rendered. The ray must be given in world coordinates.\n *\n * @param {Ray} ray The ray to test for intersection.\n * @param {FrameState} frameState The frame state.\n * @param {Cartesian3|undefined} [result] The intersection or <code>undefined</code> if none was found.\n * @returns {Cartesian3|undefined} The intersection or <code>undefined</code> if none was found.\n *\n * @private\n */\nCesium3DTileset.prototype.pick = function (ray, frameState, result) {\n  if (!frameState.context.webgl2 && !this._enablePick) {\n    return;\n  }\n\n  const selectedTiles = this._selectedTiles;\n  const selectedLength = selectedTiles.length;\n  const candidates = [];\n\n  for (let i = 0; i < selectedLength; ++i) {\n    const tile = selectedTiles[i];\n    const boundsIntersection = IntersectionTests.raySphere(\n      ray,\n      tile.contentBoundingVolume.boundingSphere,\n      scratchSphereIntersection,\n    );\n    if (!defined(boundsIntersection) || !defined(tile.content)) {\n      continue;\n    }\n\n    candidates.push(tile);\n  }\n\n  const length = candidates.length;\n  candidates.sort((a, b) => {\n    const aDist = BoundingSphere.distanceSquaredTo(\n      a.contentBoundingVolume.boundingSphere,\n      ray.origin,\n    );\n    const bDist = BoundingSphere.distanceSquaredTo(\n      b.contentBoundingVolume.boundingSphere,\n      ray.origin,\n    );\n\n    return aDist - bDist;\n  });\n\n  let intersection;\n  for (let i = 0; i < length; ++i) {\n    const tile = candidates[i];\n    const candidate = tile.content.pick(\n      ray,\n      frameState,\n      scratchPickIntersection,\n    );\n\n    if (defined(candidate)) {\n      intersection = Cartesian3.clone(candidate, result);\n      return intersection;\n    }\n  }\n};\n\n/**\n * Optimization option. Used as a callback when {@link Cesium3DTileset#foveatedScreenSpaceError} is true to control how much to raise the screen space error for tiles outside the foveated cone,\n * interpolating between {@link Cesium3DTileset#foveatedMinimumScreenSpaceErrorRelaxation} and {@link Cesium3DTileset#maximumScreenSpaceError}.\n *\n * @callback Cesium3DTileset.foveatedInterpolationCallback\n * @default Math.lerp\n *\n * @param {number} p The start value to interpolate.\n * @param {number} q The end value to interpolate.\n * @param {number} time The time of interpolation generally in the range <code>[0.0, 1.0]</code>.\n * @returns {number} The interpolated value.\n */\nexport default Cesium3DTileset;\n"],"mappings":"AAAA,OAAOA,yBAAyB,MAAM,sCAAsC;AAC5E,OAAOC,cAAc,MAAM,2BAA2B;AACtD,OAAOC,UAAU,MAAM,uBAAuB;AAC9C,OAAOC,UAAU,MAAM,uBAAuB;AAC9C,OAAOC,YAAY,MAAM,yBAAyB;AAClD,OAAOC,KAAK,MAAM,kBAAkB;AACpC,OAAOC,KAAK,MAAM,kBAAkB;AACpC,OAAOC,KAAK,MAAM,kBAAkB;AACpC,OAAOC,MAAM,MAAM,mBAAmB;AACtC,OAAOC,YAAY,MAAM,yBAAyB;AAClD,OAAOC,OAAO,MAAM,oBAAoB;AACxC,OAAOC,kBAAkB,MAAM,+BAA+B;AAC9D,OAAOC,aAAa,MAAM,0BAA0B;AACpD,OAAOC,SAAS,MAAM,sBAAsB;AAC5C,OAAOC,KAAK,MAAM,kBAAkB;AACpC,OAAOC,kBAAkB,MAAM,yBAAyB;AACxD,OAAOC,QAAQ,MAAM,qBAAqB;AAC1C,OAAOC,iBAAiB,MAAM,8BAA8B;AAC5D,OAAOC,WAAW,MAAM,wBAAwB;AAChD,OAAOC,UAAU,MAAM,uBAAuB;AAC9C,OAAOC,YAAY,MAAM,yBAAyB;AAClD,OAAOC,UAAU,MAAM,iBAAiB;AACxC,OAAOC,OAAO,MAAM,oBAAoB;AACxC,OAAOC,OAAO,MAAM,oBAAoB;AACxC,OAAOC,QAAQ,MAAM,qBAAqB;AAC1C,OAAOC,YAAY,MAAM,yBAAyB;AAClD,OAAOC,UAAU,MAAM,uBAAuB;AAC9C,OAAOC,YAAY,MAAM,6BAA6B;AACtD,OAAOC,IAAI,MAAM,qBAAqB;AACtC,OAAOC,WAAW,MAAM,4BAA4B;AACpD,OAAOC,IAAI,MAAM,WAAW;AAC5B,OAAOC,YAAY,MAAM,mBAAmB;AAC5C,OAAOC,0BAA0B,MAAM,iCAAiC;AACxE,OAAOC,wBAAwB,MAAM,+BAA+B;AACpE,OAAOC,uBAAuB,MAAM,8BAA8B;AAClE,OAAOC,yBAAyB,MAAM,gCAAgC;AACtE,OAAOC,gBAAgB,MAAM,uBAAuB;AACpD,OAAOC,kBAAkB,MAAM,yBAAyB;AACxD,OAAOC,oBAAoB,MAAM,2BAA2B;AAC5D,OAAOC,sBAAsB,MAAM,6BAA6B;AAChE,OAAOC,yBAAyB,MAAM,gCAAgC;AACtE,OAAOC,uBAAuB,MAAM,8BAA8B;AAClE,OAAOC,uBAAuB,MAAM,8BAA8B;AAClE,OAAOC,yBAAyB,MAAM,gCAAgC;AACtE,OAAOC,YAAY,MAAM,mBAAmB;AAC5C,OAAOC,eAAe,MAAM,sBAAsB;AAClD,OAAOC,uBAAuB,MAAM,8BAA8B;AAClE,OAAOC,eAAe,MAAM,sBAAsB;AAClD,OAAOC,cAAc,MAAM,2BAA2B;AACtD,OAAOC,yBAAyB,MAAM,gCAAgC;AACtE,OAAOC,iBAAiB,MAAM,wBAAwB;AACtD,OAAOC,aAAa,MAAM,oBAAoB;AAC9C,OAAOC,SAAS,MAAM,gBAAgB;AACtC,OAAOC,UAAU,MAAM,iBAAiB;AACxC,OAAOC,cAAc,MAAM,qBAAqB;AAChD,OAAOC,gBAAgB,MAAM,uBAAuB;AACpD,OAAOC,kBAAkB,MAAM,yBAAyB;AACxD,OAAOC,kBAAkB,MAAM,yBAAyB;AACxD,OAAOC,uBAAuB,MAAM,8BAA8B;AAClE,OAAOC,oCAAoC,MAAM,2CAA2C;AAC5F,OAAOC,4BAA4B,MAAM,mCAAmC;AAC5E,OAAOC,4BAA4B,MAAM,mCAAmC;AAC5E,OAAOC,GAAG,MAAM,gBAAgB;AAChC,OAAOC,4BAA4B,MAAM,mCAAmC;;AAE5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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,GAAG,CAAC;EACpE,IAAI,CAACC,0CAA0C,GAAG1J,YAAY,CAC5DwD,OAAO,CAACmG,yCAAyC,EACjD,GACF,CAAC;;EAED;AACF;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,6BAA6B,GAAG5J,YAAY,CAC/CwD,OAAO,CAACoG,6BAA6B,EACrChJ,UAAU,CAACiJ,IACb,CAAC;;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,iBAAiB,GAAG9J,YAAY,CAACwD,OAAO,CAACsG,iBAAiB,EAAE,GAAG,CAAC;;EAErE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,8BAA8B,GAAG/J,YAAY,CAChDwD,OAAO,CAACuG,8BAA8B,EACtC,MACF,CAAC;;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,6BAA6B,GAAGhK,YAAY,CAC/CwD,OAAO,CAACwG,6BAA6B,EACrC,IACF,CAAC;;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,oCAAoC,GAAGjK,YAAY,CACtDwD,OAAO,CAACyG,oCAAoC,EAC5C,IACF,CAAC;;EAED;EACA,IAAI,CAACC,uCAAuC,GAAG,GAAG;;EAElD;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,OAAO,GAAGnK,YAAY,CAACwD,OAAO,CAAC2G,OAAO,EAAEvH,UAAU,CAACwH,OAAO,CAAC;;EAEhE;AACF;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,IAAI,GAAGrK,YAAY,CAACwD,OAAO,CAAC6G,IAAI,EAAE,IAAI,CAAC;;EAE5C;AACF;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,cAAc,GAAG/I,0BAA0B,CAACgJ,SAAS;;EAE1D;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,gBAAgB,GAAG,GAAG;EAE3B,IAAI,CAACC,kBAAkB,GAAG,IAAIhI,iBAAiB,CAACe,OAAO,CAACkH,iBAAiB,CAAC;EAC1E,IAAI,CAACC,0BAA0B,GAAG,IAAInI,yBAAyB,CAAC,CAAC;;EAEjE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACoI,YAAY,GAAG,IAAIvK,KAAK,CAAC,CAAC;;EAE/B;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACwK,cAAc,GAAG,IAAIxK,KAAK,CAAC,CAAC;;EAEjC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACyK,kBAAkB,GAAG,IAAIzK,KAAK,CAAC,CAAC;;EAErC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAAC0K,QAAQ,GAAG,IAAI1K,KAAK,CAAC,CAAC;;EAE3B;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAAC2K,UAAU,GAAG,IAAI3K,KAAK,CAAC,CAAC;;EAE7B;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAAC4K,UAAU,GAAG,IAAI5K,KAAK,CAAC,CAAC;;EAE7B;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAAC6K,WAAW,GAAG,IAAI7K,KAAK,CAAC,CAAC;;EAE9B;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAAC8K,iBAAiB,GAAGnL,YAAY,CAACwD,OAAO,CAAC2H,iBAAiB,EAAE,KAAK,CAAC;EAEvE,IAAI,CAACC,yBAAyB,GAAG,KAAK;;EAEtC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,oBAAoB,GAAGrL,YAAY,CAACwD,OAAO,CAAC6H,oBAAoB,EAAE,IAAI,CAAC;;EAE5E;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,0BAA0B,GAAGtL,YAAY,CAC5CwD,OAAO,CAAC8H,0BAA0B,EAClC,EACF,CAAC;;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,UAAU,GAAGvL,YAAY,CAACwD,OAAO,CAAC+H,UAAU,EAAE,CAAC,CAAC;;EAErD;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,mCAAmC,GAAGxL,YAAY,CACrDwD,OAAO,CAACgI,mCAAmC,EAC3C,KACF,CAAC;;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,YAAY,GAAGzL,YAAY,CAACwD,OAAO,CAACiI,YAAY,EAAE,KAAK,CAAC;EAE7D,IAAI,CAACC,eAAe,GAAG/H,SAAS;EAChC,IAAI1D,OAAO,CAACuD,OAAO,CAACmI,cAAc,CAAC,EAAE;IACnC1J,uBAAuB,CAAC2J,QAAQ,CAC9BpI,OAAO,CAACmI,cAAc,EACtB,IAAI,EACJ,iBACF,CAAC;EACH;EAEA,IAAI,CAACE,iBAAiB,GAAGlI,SAAS;EAClC,IAAI1D,OAAO,CAACuD,OAAO,CAACsI,gBAAgB,CAAC,EAAE;I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AA,EAAY;MACf,OAAO,IAAI;IACb;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,KAAK,EAAE;IACLD,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAAC9K,MAAM;IACpB;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACEgL,UAAU,EAAE;IACVF,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAACzK,WAAW;IACzB;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;EACEuH,cAAc,EAAE;IACdkD,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAACnD,eAAe;IAC7B,CAAC;IACDsD,GAAG,EAAE,SAAAA,CAAUC,KAAK,EAAE;MACpBhN,uBAAuB,CAAC2J,QAAQ,CAACqD,KAAK,EAAE,IAAI,EAAE,iBAAiB,CAAC;IAClE;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;EACEnD,gBAAgB,EAAE;IAChB+C,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAAChD,iBAAiB;IAC/B,CAAC;IACDmD,GAAG,EAAE,SAAAA,CAAUC,KAAK,EAAE;MACpB/M,yBAAyB,CAAC0J,QAAQ,CAACqD,KAAK,EAAE,IAAI,EAAE,mBAAmB,CAAC;IACtE;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,UAAU,EAAE;IACVL,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAAC7K,WAAW;IACzB;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEmL,WAAW,EAAE;IACXN,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAACzG,YAAY;IAC1B;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACEgH,QAAQ,EAAE;IACRP,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAAC/K,SAAS;IACvB;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEuL,QAAQ,EAAE;IACRR,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf3O,kBAAkB,CAChB,0BAA0B,EAC1B,4JACF,CAAC;MACD,OAAO,IAAI,CAAC0D,SAAS;IACvB;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE0L,KAAK,EAAE;IACLT,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAACtI,YAAY,CAAC+I,KAAK;IAChC,CAAC;IACDN,GAAG,EAAE,SAAAA,CAAUC,KAAK,EAAE;MACpB,IAAI,CAAC1I,YAAY,CAAC+I,KAAK,GAAGL,KAAK;IACjC;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEb,YAAY,EAAE;IACZS,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAACV,aAAa;IAC3B,CAAC;IACDa,GAAG,EAAE,SAAAA,CAAUC,KAAK,EAAE;MACpB,IAAI,CAACd,aAAa,GAAGc,KAAK;IAC5B;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEM,eAAe,EAAE;IACfV,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAACnJ,gBAAgB;IAC9B,CAAC;IACDsJ,GAAG,EAAE,SAAAA,CAAUC,KAAK,EAAE;MACpB;MACArP,KAAK,CAACsG,MAAM,CAACsJ,IAAI,CAAC,OAAO,EAAEP,KAAK,CAAC;MACjC;;MAEA,IAAI,CAACvJ,gBAAg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,QAAQ,EAAE;QAC7BA,KAAK,GAAG,aAAaA,KAAK,EAAE;MAC9B;;MAEA;MACArP,KAAK,CAACsG,MAAM,CAACiL,MAAM,CAAC,OAAO,EAAElC,KAAK,CAAC;MACnC;;MAEA,IAAI,CAACX,eAAe,GAAGW,KAAK;IAC9B;EACF,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEV,sBAAsB,EAAE;IACtBM,GAAG,EAAE,SAAAA,CAAA,EAAY;MACf,OAAO,IAAI,CAACL,uBAAuB;IACrC,CAAC;IACDQ,GAAG,EAAE,SAAAA,CAAUC,KAAK,EAAE;MACpB;MACA,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;QAC7BA,KAAK,GAAG,qBAAqBA,KAAK,EAAE;MACtC;;MAEA;MACArP,KAAK,CAACsG,MAAM,CAACiL,MAAM,CAAC,OAAO,EAAElC,KAAK,CAAC;MACnC;;MAEA,IAAI,CAACT,uBAAuB,GAAGS,KAAK;IACtC;EACF;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA1L,eAAe,CAAC6N,cAAc,GAAG,gBAAgBC,OAAO,EAAE7N,OAAO,EAAE;EACjE;EACA5D,KAAK,CAACK,OAAO,CAAC,SAAS,EAAEoR,OAAO,CAAC;EACjC;;EAEA,MAAMjC,QAAQ,GAAG,MAAM3O,WAAW,CAAC6Q,WAAW,CAACD,OAAO,CAAC;EACvD,OAAO9N,eAAe,CAACgO,OAAO,CAACnC,QAAQ,EAAE5L,OAAO,CAAC;AACnD,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
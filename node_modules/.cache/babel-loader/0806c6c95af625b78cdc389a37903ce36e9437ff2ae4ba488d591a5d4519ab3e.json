{"ast":null,"code":"import Uri from \"urijs\";\nimport appendForwardSlash from \"./appendForwardSlash.js\";\nimport Check from \"./Check.js\";\nimport clone from \"./clone.js\";\nimport combine from \"./combine.js\";\nimport defaultValue from \"./defaultValue.js\";\nimport defer from \"./defer.js\";\nimport defined from \"./defined.js\";\nimport DeveloperError from \"./DeveloperError.js\";\nimport getAbsoluteUri from \"./getAbsoluteUri.js\";\nimport getBaseUri from \"./getBaseUri.js\";\nimport getExtensionFromUri from \"./getExtensionFromUri.js\";\nimport getImagePixels from \"./getImagePixels.js\";\nimport isBlobUri from \"./isBlobUri.js\";\nimport isCrossOriginUrl from \"./isCrossOriginUrl.js\";\nimport isDataUri from \"./isDataUri.js\";\nimport loadAndExecuteScript from \"./loadAndExecuteScript.js\";\nimport CesiumMath from \"./Math.js\";\nimport objectToQuery from \"./objectToQuery.js\";\nimport queryToObject from \"./queryToObject.js\";\nimport Request from \"./Request.js\";\nimport RequestErrorEvent from \"./RequestErrorEvent.js\";\nimport RequestScheduler from \"./RequestScheduler.js\";\nimport RequestState from \"./RequestState.js\";\nimport RuntimeError from \"./RuntimeError.js\";\nimport TrustedServers from \"./TrustedServers.js\";\nconst xhrBlobSupported = function () {\n  try {\n    const xhr = new XMLHttpRequest();\n    xhr.open(\"GET\", \"#\", true);\n    xhr.responseType = \"blob\";\n    return xhr.responseType === \"blob\";\n  } catch (e) {\n    return false;\n  }\n}();\n\n/**\n * @typedef {object} Resource.ConstructorOptions\n *\n * Initialization options for the Resource constructor\n *\n * @property {string} url The url of the resource.\n * @property {object} [queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @property {object} [templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @property {object} [headers={}] Additional HTTP headers that will be sent.\n * @property {Proxy} [proxy] A proxy to be used when loading the resource.\n * @property {Resource.RetryCallback} [retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @property {number} [retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @property {Request} [request] A Request object that will be used. Intended for internal use only.\n * @property {boolean} [parseUrl=true] If true, parse the url for query parameters; otherwise store the url without change\n */\n\n/**\n * A resource that includes the location and any other parameters we need to retrieve it or create derived resources. It also provides the ability to retry requests.\n *\n * @alias Resource\n * @constructor\n *\n * @param {string|Resource.ConstructorOptions} options A url or an object describing initialization options\n *\n * @example\n * function refreshTokenRetryCallback(resource, error) {\n *   if (error.statusCode === 403) {\n *     // 403 status code means a new token should be generated\n *     return getNewAccessToken()\n *       .then(function(token) {\n *         resource.queryParameters.access_token = token;\n *         return true;\n *       })\n *       .catch(function() {\n *         return false;\n *       });\n *   }\n *\n *   return false;\n * }\n *\n * const resource = new Resource({\n *    url: 'http://server.com/path/to/resource.json',\n *    proxy: new DefaultProxy('/proxy/'),\n *    headers: {\n *      'X-My-Header': 'valueOfHeader'\n *    },\n *    queryParameters: {\n *      'access_token': '123-435-456-000'\n *    },\n *    retryCallback: refreshTokenRetryCallback,\n *    retryAttempts: 1\n * });\n */\nfunction Resource(options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n  if (typeof options === \"string\") {\n    options = {\n      url: options\n    };\n  }\n\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.string(\"options.url\", options.url);\n  //>>includeEnd('debug');\n\n  this._url = undefined;\n  this._templateValues = defaultClone(options.templateValues, {});\n  this._queryParameters = defaultClone(options.queryParameters, {});\n\n  /**\n   * Additional HTTP headers that will be sent with the request.\n   *\n   * @type {object}\n   */\n  this.headers = defaultClone(options.headers, {});\n\n  /**\n   * A Request object that will be used. Intended for internal use only.\n   *\n   * @type {Request}\n   */\n  this.request = defaultValue(options.request, new Request());\n\n  /**\n   * A proxy to be used when loading the resource.\n   *\n   * @type {Proxy}\n   */\n  this.proxy = options.proxy;\n\n  /**\n   * Function to call when a request for this resource fails. If it returns true or a Promise that resolves to true, the request will be retried.\n   *\n   * @type {Function}\n   */\n  this.retryCallback = options.retryCallback;\n\n  /**\n   * The number of times the retryCallback should be called before giving up.\n   *\n   * @type {number}\n   */\n  this.retryAttempts = defaultValue(options.retryAttempts, 0);\n  this._retryCount = 0;\n  const parseUrl = defaultValue(options.parseUrl, true);\n  if (parseUrl) {\n    this.parseUrl(options.url, true, true);\n  } else {\n    this._url = options.url;\n  }\n  this._credits = options.credits;\n}\n\n/**\n * Clones a value if it is defined, otherwise returns the default value\n *\n * @param {object} [value] The value to clone.\n * @param {object} [defaultValue] The default value.\n *\n * @returns {object} A clone of value or the defaultValue.\n *\n * @private\n */\nfunction defaultClone(value, defaultValue) {\n  return defined(value) ? clone(value) : defaultValue;\n}\n\n/**\n * A helper function to create a resource depending on whether we have a String or a Resource\n *\n * @param {Resource|string} resource A Resource or a String to use when creating a new Resource.\n *\n * @returns {Resource} If resource is a String, a Resource constructed with the url and options. Otherwise the resource parameter is returned.\n *\n * @private\n */\nResource.createIfNeeded = function (resource) {\n  if (resource instanceof Resource) {\n    // Keep existing request object. This function is used internally to duplicate a Resource, so that it can't\n    //  be modified outside of a class that holds it (eg. an imagery or terrain provider). Since the Request objects\n    //  are managed outside of the providers, by the tile loading code, we want to keep the request property the same so if it is changed\n    //  in the underlying tiling code the requests for this resource will use it.\n    return resource.getDerivedResource({\n      request: resource.request\n    });\n  }\n  if (typeof resource !== \"string\") {\n    return resource;\n  }\n  return new Resource({\n    url: resource\n  });\n};\nlet supportsImageBitmapOptionsPromise;\n/**\n * A helper function to check whether createImageBitmap supports passing ImageBitmapOptions.\n *\n * @returns {Promise<boolean>} A promise that resolves to true if this browser supports creating an ImageBitmap with options.\n *\n * @private\n */\nResource.supportsImageBitmapOptions = function () {\n  // Until the HTML folks figure out what to do about this, we need to actually try loading an image to\n  // know if this browser supports passing options to the createImageBitmap function.\n  // https://github.com/whatwg/html/pull/4248\n  //\n  // We also need to check whether the colorSpaceConversion option is supported.\n  // We do this by loading a PNG with an embedded color profile, first with\n  // colorSpaceConversion: \"none\" and then with colorSpaceConversion: \"default\".\n  // If the pixel color is different then we know the option is working.\n  // As of Webkit 17612.3.6.1.6 the createImageBitmap promise resolves but the\n  // option is not actually supported.\n  if (defined(supportsImageBitmapOptionsPromise)) {\n    return supportsImageBitmapOptionsPromise;\n  }\n  if (typeof createImageBitmap !== \"function\") {\n    supportsImageBitmapOptionsPromise = Promise.resolve(false);\n    return supportsImageBitmapOptionsPromise;\n  }\n  const imageDataUri = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAABGdBTUEAAE4g3rEiDgAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAADElEQVQI12Ng6GAAAAEUAIngE3ZiAAAAAElFTkSuQmCC\";\n  supportsImageBitmapOptionsPromise = Resource.fetchBlob({\n    url: imageDataUri\n  }).then(function (blob) {\n    const imageBitmapOptions = {\n      imageOrientation: \"flipY\",\n      // default is \"none\"\n      premultiplyAlpha: \"none\",\n      // default is \"default\"\n      colorSpaceConversion: \"none\" // default is \"default\"\n    };\n    return Promise.all([createImageBitmap(blob, imageBitmapOptions), createImageBitmap(blob)]);\n  }).then(function (imageBitmaps) {\n    // Check whether the colorSpaceConversion option had any effect on the green channel\n    const colorWithOptions = getImagePixels(imageBitmaps[0]);\n    const colorWithDefaults = getImagePixels(imageBitmaps[1]);\n    return colorWithOptions[1] !== colorWithDefaults[1];\n  }).catch(function () {\n    return false;\n  });\n  return supportsImageBitmapOptionsPromise;\n};\nObject.defineProperties(Resource, {\n  /**\n   * Returns true if blobs are supported.\n   *\n   * @memberof Resource\n   * @type {boolean}\n   *\n   * @readonly\n   */\n  isBlobSupported: {\n    get: function () {\n      return xhrBlobSupported;\n    }\n  }\n});\nObject.defineProperties(Resource.prototype, {\n  /**\n   * Query parameters appended to the url.\n   *\n   * @memberof Resource.prototype\n   * @type {object}\n   *\n   * @readonly\n   */\n  queryParameters: {\n    get: function () {\n      return this._queryParameters;\n    }\n  },\n  /**\n   * The key/value pairs used to replace template parameters in the url.\n   *\n   * @memberof Resource.prototype\n   * @type {object}\n   *\n   * @readonly\n   */\n  templateValues: {\n    get: function () {\n      return this._templateValues;\n    }\n  },\n  /**\n   * The url to the resource with template values replaced, query string appended and encoded by proxy if one was set.\n   *\n   * @memberof Resource.prototype\n   * @type {string}\n   */\n  url: {\n    get: function () {\n      return this.getUrlComponent(true, true);\n    },\n    set: function (value) {\n      this.parseUrl(value, false, false);\n    }\n  },\n  /**\n   * The file extension of the resource.\n   *\n   * @memberof Resource.prototype\n   * @type {string}\n   *\n   * @readonly\n   */\n  extension: {\n    get: function () {\n      return getExtensionFromUri(this._url);\n    }\n  },\n  /**\n   * True if the Resource refers to a data URI.\n   *\n   * @memberof Resource.prototype\n   * @type {boolean}\n   */\n  isDataUri: {\n    get: function () {\n      return isDataUri(this._url);\n    }\n  },\n  /**\n   * True if the Resource refers to a blob URI.\n   *\n   * @memberof Resource.prototype\n   * @type {boolean}\n   */\n  isBlobUri: {\n    get: function () {\n      return isBlobUri(this._url);\n    }\n  },\n  /**\n   * True if the Resource refers to a cross origin URL.\n   *\n   * @memberof Resource.prototype\n   * @type {boolean}\n   */\n  isCrossOriginUrl: {\n    get: function () {\n      return isCrossOriginUrl(this._url);\n    }\n  },\n  /**\n   * True if the Resource has request headers. This is equivalent to checking if the headers property has any keys.\n   *\n   * @memberof Resource.prototype\n   * @type {boolean}\n   */\n  hasHeaders: {\n    get: function () {\n      return Object.keys(this.headers).length > 0;\n    }\n  },\n  /**\n   * Gets the credits required for attribution of an asset.\n   * @private\n   */\n  credits: {\n    get: function () {\n      return this._credits;\n    }\n  }\n});\n\n/**\n * Override Object#toString so that implicit string conversion gives the\n * complete URL represented by this Resource.\n *\n * @returns {string} The URL represented by this Resource\n */\nResource.prototype.toString = function () {\n  return this.getUrlComponent(true, true);\n};\n\n/**\n * Parse a url string, and store its info\n *\n * @param {string} url The input url string.\n * @param {boolean} merge If true, we'll merge with the resource's existing queryParameters. Otherwise they will be replaced.\n * @param {boolean} preserveQuery If true duplicate parameters will be concatenated into an array. If false, keys in url will take precedence.\n * @param {string} [baseUrl] If supplied, and input url is a relative url, it will be made absolute relative to baseUrl\n *\n * @private\n */\nResource.prototype.parseUrl = function (url, merge, preserveQuery, baseUrl) {\n  let uri = new Uri(url);\n  const query = parseQueryString(uri.query());\n  this._queryParameters = merge ? combineQueryParameters(query, this.queryParameters, preserveQuery) : query;\n\n  // Remove unneeded info from the Uri\n  uri.search(\"\");\n  uri.fragment(\"\");\n  if (defined(baseUrl) && uri.scheme() === \"\") {\n    uri = uri.absoluteTo(getAbsoluteUri(baseUrl));\n  }\n  this._url = uri.toString();\n};\n\n/**\n * Parses a query string and returns the object equivalent.\n *\n * @param {string} queryString The query string\n * @returns {object}\n *\n * @private\n */\nfunction parseQueryString(queryString) {\n  if (queryString.length === 0) {\n    return {};\n  }\n\n  // Special case where the querystring is just a string, not key/value pairs\n  if (queryString.indexOf(\"=\") === -1) {\n    return {\n      [queryString]: undefined\n    };\n  }\n  return queryToObject(queryString);\n}\n\n/**\n * This combines a map of query parameters.\n *\n * @param {object} q1 The first map of query parameters. Values in this map will take precedence if preserveQueryParameters is false.\n * @param {object} q2 The second map of query parameters.\n * @param {boolean} preserveQueryParameters If true duplicate parameters will be concatenated into an array. If false, keys in q1 will take precedence.\n *\n * @returns {object} The combined map of query parameters.\n *\n * @example\n * const q1 = {\n *   a: 1,\n *   b: 2\n * };\n * const q2 = {\n *   a: 3,\n *   c: 4\n * };\n * const q3 = {\n *   b: [5, 6],\n *   d: 7\n * }\n *\n * // Returns\n * // {\n * //   a: [1, 3],\n * //   b: 2,\n * //   c: 4\n * // };\n * combineQueryParameters(q1, q2, true);\n *\n * // Returns\n * // {\n * //   a: 1,\n * //   b: 2,\n * //   c: 4\n * // };\n * combineQueryParameters(q1, q2, false);\n *\n * // Returns\n * // {\n * //   a: 1,\n * //   b: [2, 5, 6],\n * //   d: 7\n * // };\n * combineQueryParameters(q1, q3, true);\n *\n * // Returns\n * // {\n * //   a: 1,\n * //   b: 2,\n * //   d: 7\n * // };\n * combineQueryParameters(q1, q3, false);\n *\n * @private\n */\nfunction combineQueryParameters(q1, q2, preserveQueryParameters) {\n  if (!preserveQueryParameters) {\n    return combine(q1, q2);\n  }\n  const result = clone(q1, true);\n  for (const param in q2) {\n    if (q2.hasOwnProperty(param)) {\n      let value = result[param];\n      const q2Value = q2[param];\n      if (defined(value)) {\n        if (!Array.isArray(value)) {\n          value = result[param] = [value];\n        }\n        result[param] = value.concat(q2Value);\n      } else {\n        result[param] = Array.isArray(q2Value) ? q2Value.slice() : q2Value;\n      }\n    }\n  }\n  return result;\n}\n\n/**\n * Returns the url, optional with the query string and processed by a proxy.\n *\n * @param {boolean} [query=false] If true, the query string is included.\n * @param {boolean} [proxy=false] If true, the url is processed by the proxy object, if defined.\n *\n * @returns {string} The url with all the requested components.\n */\nResource.prototype.getUrlComponent = function (query, proxy) {\n  if (this.isDataUri) {\n    return this._url;\n  }\n  let url = this._url;\n  if (query) {\n    url = `${url}${stringifyQuery(this.queryParameters)}`;\n  }\n\n  // Restore the placeholders, which may have been escaped in objectToQuery or elsewhere\n  url = url.replace(/%7B/g, \"{\").replace(/%7D/g, \"}\");\n  const templateValues = this._templateValues;\n  if (Object.keys(templateValues).length > 0) {\n    url = url.replace(/{(.*?)}/g, function (match, key) {\n      const replacement = templateValues[key];\n      if (defined(replacement)) {\n        // use the replacement value from templateValues if there is one...\n        return encodeURIComponent(replacement);\n      }\n      // otherwise leave it unchanged\n      return match;\n    });\n  }\n  if (proxy && defined(this.proxy)) {\n    url = this.proxy.getURL(url);\n  }\n  return url;\n};\n\n/**\n * Converts a query object into a string.\n *\n * @param {object} queryObject The object with query parameters\n * @returns {string}\n *\n * @private\n */\nfunction stringifyQuery(queryObject) {\n  const keys = Object.keys(queryObject);\n  if (keys.length === 0) {\n    return \"\";\n  }\n  if (keys.length === 1 && !defined(queryObject[keys[0]])) {\n    // We have 1 key with an undefined value, so this is just a string, not key/value pairs\n    return `?${keys[0]}`;\n  }\n  return `?${objectToQuery(queryObject)}`;\n}\n\n/**\n * Combines the specified object and the existing query parameters. This allows you to add many parameters at once,\n *  as opposed to adding them one at a time to the queryParameters property. If a value is already set, it will be replaced with the new value.\n *\n * @param {object} params The query parameters\n * @param {boolean} [useAsDefault=false] If true the params will be used as the default values, so they will only be set if they are undefined.\n */\nResource.prototype.setQueryParameters = function (params, useAsDefault) {\n  if (useAsDefault) {\n    this._queryParameters = combineQueryParameters(this._queryParameters, params, false);\n  } else {\n    this._queryParameters = combineQueryParameters(params, this._queryParameters, false);\n  }\n};\n\n/**\n * Combines the specified object and the existing query parameters. This allows you to add many parameters at once,\n *  as opposed to adding them one at a time to the queryParameters property.\n *\n * @param {object} params The query parameters\n */\nResource.prototype.appendQueryParameters = function (params) {\n  this._queryParameters = combineQueryParameters(params, this._queryParameters, true);\n};\n\n/**\n * Combines the specified object and the existing template values. This allows you to add many values at once,\n *  as opposed to adding them one at a time to the templateValues property. If a value is already set, it will become an array and the new value will be appended.\n *\n * @param {object} template The template values\n * @param {boolean} [useAsDefault=false] If true the values will be used as the default values, so they will only be set if they are undefined.\n */\nResource.prototype.setTemplateValues = function (template, useAsDefault) {\n  if (useAsDefault) {\n    this._templateValues = combine(this._templateValues, template);\n  } else {\n    this._templateValues = combine(template, this._templateValues);\n  }\n};\n\n/**\n * Returns a resource relative to the current instance. All properties remain the same as the current instance unless overridden in options.\n *\n * @param {object} options An object with the following properties\n * @param {string} [options.url]  The url that will be resolved relative to the url of the current instance.\n * @param {object} [options.queryParameters] An object containing query parameters that will be combined with those of the current instance.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}). These will be combined with those of the current instance.\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The function to call when loading the resource fails.\n * @param {number} [options.retryAttempts] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {boolean} [options.preserveQueryParameters=false] If true, this will keep all query parameters from the current resource and derived resource. If false, derived parameters will replace those of the current resource.\n *\n * @returns {Resource} The resource derived from the current one.\n */\nResource.prototype.getDerivedResource = function (options) {\n  const resource = this.clone();\n  resource._retryCount = 0;\n  if (defined(options.url)) {\n    const preserveQuery = defaultValue(options.preserveQueryParameters, false);\n    resource.parseUrl(options.url, true, preserveQuery, this._url);\n  }\n  if (defined(options.queryParameters)) {\n    resource._queryParameters = combine(options.queryParameters, resource.queryParameters);\n  }\n  if (defined(options.templateValues)) {\n    resource._templateValues = combine(options.templateValues, resource.templateValues);\n  }\n  if (defined(options.headers)) {\n    resource.headers = combine(options.headers, resource.headers);\n  }\n  if (defined(options.proxy)) {\n    resource.proxy = options.proxy;\n  }\n  if (defined(options.request)) {\n    resource.request = options.request;\n  }\n  if (defined(options.retryCallback)) {\n    resource.retryCallback = options.retryCallback;\n  }\n  if (defined(options.retryAttempts)) {\n    resource.retryAttempts = options.retryAttempts;\n  }\n  return resource;\n};\n\n/**\n * Called when a resource fails to load. This will call the retryCallback function if defined until retryAttempts is reached.\n *\n * @param {RequestErrorEvent} [error] The error that was encountered.\n *\n * @returns {Promise<boolean>} A promise to a boolean, that if true will cause the resource request to be retried.\n *\n * @private\n */\nResource.prototype.retryOnError = function (error) {\n  const retryCallback = this.retryCallback;\n  if (typeof retryCallback !== \"function\" || this._retryCount >= this.retryAttempts) {\n    return Promise.resolve(false);\n  }\n  const that = this;\n  return Promise.resolve(retryCallback(this, error)).then(function (result) {\n    ++that._retryCount;\n    return result;\n  });\n};\n\n/**\n * Duplicates a Resource instance.\n *\n * @param {Resource} [result] The object onto which to store the result.\n *\n * @returns {Resource} The modified result parameter or a new Resource instance if one was not provided.\n */\nResource.prototype.clone = function (result) {\n  if (!defined(result)) {\n    return new Resource({\n      url: this._url,\n      queryParameters: this.queryParameters,\n      templateValues: this.templateValues,\n      headers: this.headers,\n      proxy: this.proxy,\n      retryCallback: this.retryCallback,\n      retryAttempts: this.retryAttempts,\n      request: this.request.clone(),\n      parseUrl: false,\n      credits: defined(this.credits) ? this.credits.slice() : undefined\n    });\n  }\n  result._url = this._url;\n  result._queryParameters = clone(this._queryParameters);\n  result._templateValues = clone(this._templateValues);\n  result.headers = clone(this.headers);\n  result.proxy = this.proxy;\n  result.retryCallback = this.retryCallback;\n  result.retryAttempts = this.retryAttempts;\n  result._retryCount = 0;\n  result.request = this.request.clone();\n  return result;\n};\n\n/**\n * Returns the base path of the Resource.\n *\n * @param {boolean} [includeQuery = false] Whether or not to include the query string and fragment form the uri\n *\n * @returns {string} The base URI of the resource\n */\nResource.prototype.getBaseUri = function (includeQuery) {\n  return getBaseUri(this.getUrlComponent(includeQuery), includeQuery);\n};\n\n/**\n * Appends a forward slash to the URL.\n */\nResource.prototype.appendForwardSlash = function () {\n  this._url = appendForwardSlash(this._url);\n};\n\n/**\n * Asynchronously loads the resource as raw binary data.  Returns a promise that will resolve to\n * an ArrayBuffer once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @returns {Promise<ArrayBuffer>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n * @example\n * // load a single URL asynchronously\n * resource.fetchArrayBuffer().then(function(arrayBuffer) {\n *     // use the data\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchArrayBuffer = function () {\n  return this.fetch({\n    responseType: \"arraybuffer\"\n  });\n};\n\n/**\n * Creates a Resource and calls fetchArrayBuffer() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @returns {Promise<ArrayBuffer>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchArrayBuffer = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchArrayBuffer();\n};\n\n/**\n * Asynchronously loads the given resource as a blob.  Returns a promise that will resolve to\n * a Blob once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @returns {Promise<Blob>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n * @example\n * // load a single URL asynchronously\n * resource.fetchBlob().then(function(blob) {\n *     // use the data\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchBlob = function () {\n  return this.fetch({\n    responseType: \"blob\"\n  });\n};\n\n/**\n * Creates a Resource and calls fetchBlob() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @returns {Promise<Blob>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchBlob = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchBlob();\n};\n\n/**\n * Asynchronously loads the given image resource.  Returns a promise that will resolve to\n * an {@link https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap|ImageBitmap} if <code>preferImageBitmap</code> is true and the browser supports <code>createImageBitmap</code> or otherwise an\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement|Image} once loaded, or reject if the image failed to load.\n *\n * @param {object} [options] An object with the following properties.\n * @param {boolean} [options.preferBlob=false] If true, we will load the image via a blob.\n * @param {boolean} [options.preferImageBitmap=false] If true, image will be decoded during fetch and an <code>ImageBitmap</code> is returned.\n * @param {boolean} [options.flipY=false] If true, image will be vertically flipped during decode. Only applies if the browser supports <code>createImageBitmap</code>.\n * @param {boolean} [options.skipColorSpaceConversion=false] If true, any custom gamma or color profiles in the image will be ignored. Only applies if the browser supports <code>createImageBitmap</code>.\n * @returns {Promise<ImageBitmap|HTMLImageElement>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * // load a single image asynchronously\n * resource.fetchImage().then(function(image) {\n *     // use the loaded image\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * // load several images in parallel\n * Promise.all([resource1.fetchImage(), resource2.fetchImage()]).then(function(images) {\n *     // images is an array containing all the loaded images\n * });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchImage = function (options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n  const preferImageBitmap = defaultValue(options.preferImageBitmap, false);\n  const preferBlob = defaultValue(options.preferBlob, false);\n  const flipY = defaultValue(options.flipY, false);\n  const skipColorSpaceConversion = defaultValue(options.skipColorSpaceConversion, false);\n  checkAndResetRequest(this.request);\n  // We try to load the image normally if\n  // 1. Blobs aren't supported\n  // 2. It's a data URI\n  // 3. It's a blob URI\n  // 4. It doesn't have request headers and we preferBlob is false\n  if (!xhrBlobSupported || this.isDataUri || this.isBlobUri || !this.hasHeaders && !preferBlob) {\n    return fetchImage({\n      resource: this,\n      flipY: flipY,\n      skipColorSpaceConversion: skipColorSpaceConversion,\n      preferImageBitmap: preferImageBitmap\n    });\n  }\n  const blobPromise = this.fetchBlob();\n  if (!defined(blobPromise)) {\n    return;\n  }\n  let supportsImageBitmap;\n  let useImageBitmap;\n  let generatedBlobResource;\n  let generatedBlob;\n  return Resource.supportsImageBitmapOptions().then(function (result) {\n    supportsImageBitmap = result;\n    useImageBitmap = supportsImageBitmap && preferImageBitmap;\n    return blobPromise;\n  }).then(function (blob) {\n    if (!defined(blob)) {\n      return;\n    }\n    generatedBlob = blob;\n    if (useImageBitmap) {\n      return Resource.createImageBitmapFromBlob(blob, {\n        flipY: flipY,\n        premultiplyAlpha: false,\n        skipColorSpaceConversion: skipColorSpaceConversion\n      });\n    }\n    const blobUrl = window.URL.createObjectURL(blob);\n    generatedBlobResource = new Resource({\n      url: blobUrl\n    });\n    return fetchImage({\n      resource: generatedBlobResource,\n      flipY: flipY,\n      skipColorSpaceConversion: skipColorSpaceConversion,\n      preferImageBitmap: false\n    });\n  }).then(function (image) {\n    if (!defined(image)) {\n      return;\n    }\n\n    // The blob object may be needed for use by a TileDiscardPolicy,\n    // so attach it to the image.\n    image.blob = generatedBlob;\n    if (useImageBitmap) {\n      return image;\n    }\n    window.URL.revokeObjectURL(generatedBlobResource.url);\n    return image;\n  }).catch(function (error) {\n    if (defined(generatedBlobResource)) {\n      window.URL.revokeObjectURL(generatedBlobResource.url);\n    }\n\n    // If the blob load succeeded but the image decode failed, attach the blob\n    // to the error object for use by a TileDiscardPolicy.\n    // In particular, BingMapsImageryProvider uses this to detect the\n    // zero-length response that is returned when a tile is not available.\n    error.blob = generatedBlob;\n    return Promise.reject(error);\n  });\n};\n\n/**\n * Fetches an image and returns a promise to it.\n *\n * @param {object} [options] An object with the following properties.\n * @param {Resource} [options.resource] Resource object that points to an image to fetch.\n * @param {boolean} [options.preferImageBitmap] If true, image will be decoded during fetch and an <code>ImageBitmap</code> is returned.\n * @param {boolean} [options.flipY] If true, image will be vertically flipped during decode. Only applies if the browser supports <code>createImageBitmap</code>.\n * @param {boolean} [options.skipColorSpaceConversion=false] If true, any custom gamma or color profiles in the image will be ignored. Only applies if the browser supports <code>createImageBitmap</code>.\n * @private\n */\nfunction fetchImage(options) {\n  const resource = options.resource;\n  const flipY = options.flipY;\n  const skipColorSpaceConversion = options.skipColorSpaceConversion;\n  const preferImageBitmap = options.preferImageBitmap;\n  const request = resource.request;\n  request.url = resource.url;\n  request.requestFunction = function () {\n    let crossOrigin = false;\n\n    // data URIs can't have crossorigin set.\n    if (!resource.isDataUri && !resource.isBlobUri) {\n      crossOrigin = resource.isCrossOriginUrl;\n    }\n    const deferred = defer();\n    Resource._Implementations.createImage(request, crossOrigin, deferred, flipY, skipColorSpaceConversion, preferImageBitmap);\n    return deferred.promise;\n  };\n  const promise = RequestScheduler.request(request);\n  if (!defined(promise)) {\n    return;\n  }\n  return promise.catch(function (e) {\n    // Don't retry cancelled or otherwise aborted requests\n    if (request.state !== RequestState.FAILED) {\n      return Promise.reject(e);\n    }\n    return resource.retryOnError(e).then(function (retry) {\n      if (retry) {\n        // Reset request so it can try again\n        request.state = RequestState.UNISSUED;\n        request.deferred = undefined;\n        return fetchImage({\n          resource: resource,\n          flipY: flipY,\n          skipColorSpaceConversion: skipColorSpaceConversion,\n          preferImageBitmap: preferImageBitmap\n        });\n      }\n      return Promise.reject(e);\n    });\n  });\n}\n\n/**\n * Creates a Resource and calls fetchImage() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {boolean} [options.flipY=false] Whether to vertically flip the image during fetch and decode. Only applies when requesting an image and the browser supports <code>createImageBitmap</code>.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {boolean} [options.preferBlob=false]  If true, we will load the image via a blob.\n * @param {boolean} [options.preferImageBitmap=false] If true, image will be decoded during fetch and an <code>ImageBitmap</code> is returned.\n * @param {boolean} [options.skipColorSpaceConversion=false] If true, any custom gamma or color profiles in the image will be ignored. Only applies when requesting an image and the browser supports <code>createImageBitmap</code>.\n * @returns {Promise<ImageBitmap|HTMLImageElement>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchImage = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchImage({\n    flipY: options.flipY,\n    skipColorSpaceConversion: options.skipColorSpaceConversion,\n    preferBlob: options.preferBlob,\n    preferImageBitmap: options.preferImageBitmap\n  });\n};\n\n/**\n * Asynchronously loads the given resource as text.  Returns a promise that will resolve to\n * a String once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @returns {Promise<string>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n * @example\n * // load text from a URL, setting a custom header\n * const resource = new Resource({\n *   url: 'http://someUrl.com/someJson.txt',\n *   headers: {\n *     'X-Custom-Header' : 'some value'\n *   }\n * });\n * resource.fetchText().then(function(text) {\n *     // Do something with the text\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest|XMLHttpRequest}\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchText = function () {\n  return this.fetch({\n    responseType: \"text\"\n  });\n};\n\n/**\n * Creates a Resource and calls fetchText() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @returns {Promise<string>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchText = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchText();\n};\n\n// note: &#42;&#47;&#42; below is */* but that ends the comment block early\n/**\n * Asynchronously loads the given resource as JSON.  Returns a promise that will resolve to\n * a JSON object once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled. This function\n * adds 'Accept: application/json,&#42;&#47;&#42;;q=0.01' to the request headers, if not\n * already specified.\n *\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.fetchJson().then(function(jsonData) {\n *     // Do something with the JSON object\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchJson = function () {\n  const promise = this.fetch({\n    responseType: \"text\",\n    headers: {\n      Accept: \"application/json,*/*;q=0.01\"\n    }\n  });\n  if (!defined(promise)) {\n    return undefined;\n  }\n  return promise.then(function (value) {\n    if (!defined(value)) {\n      return;\n    }\n    return JSON.parse(value);\n  });\n};\n\n/**\n * Creates a Resource and calls fetchJson() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchJson = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchJson();\n};\n\n/**\n * Asynchronously loads the given resource as XML.  Returns a promise that will resolve to\n * an XML Document once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @returns {Promise<XMLDocument>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * // load XML from a URL, setting a custom header\n * Cesium.loadXML('http://someUrl.com/someXML.xml', {\n *   'X-Custom-Header' : 'some value'\n * }).then(function(document) {\n *     // Do something with the document\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest|XMLHttpRequest}\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchXML = function () {\n  return this.fetch({\n    responseType: \"document\",\n    overrideMimeType: \"text/xml\"\n  });\n};\n\n/**\n * Creates a Resource and calls fetchXML() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @returns {Promise<XMLDocument>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchXML = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchXML();\n};\n\n/**\n * Requests a resource using JSONP.\n *\n * @param {string} [callbackParameterName='callback'] The callback parameter name that the server expects.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * // load a data asynchronously\n * resource.fetchJsonp().then(function(data) {\n *     // use the loaded data\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchJsonp = function (callbackParameterName) {\n  callbackParameterName = defaultValue(callbackParameterName, \"callback\");\n  checkAndResetRequest(this.request);\n\n  //generate a unique function name\n  let functionName;\n  do {\n    functionName = `loadJsonp${CesiumMath.nextRandomNumber().toString().substring(2, 8)}`;\n  } while (defined(window[functionName]));\n  return fetchJsonp(this, callbackParameterName, functionName);\n};\nfunction fetchJsonp(resource, callbackParameterName, functionName) {\n  const callbackQuery = {};\n  callbackQuery[callbackParameterName] = functionName;\n  resource.setQueryParameters(callbackQuery);\n  const request = resource.request;\n  const url = resource.url;\n  request.url = url;\n  request.requestFunction = function () {\n    const deferred = defer();\n\n    //assign a function with that name in the global scope\n    window[functionName] = function (data) {\n      deferred.resolve(data);\n      try {\n        delete window[functionName];\n      } catch (e) {\n        window[functionName] = undefined;\n      }\n    };\n    Resource._Implementations.loadAndExecuteScript(url, functionName, deferred);\n    return deferred.promise;\n  };\n  const promise = RequestScheduler.request(request);\n  if (!defined(promise)) {\n    return;\n  }\n  return promise.catch(function (e) {\n    if (request.state !== RequestState.FAILED) {\n      return Promise.reject(e);\n    }\n    return resource.retryOnError(e).then(function (retry) {\n      if (retry) {\n        // Reset request so it can try again\n        request.state = RequestState.UNISSUED;\n        request.deferred = undefined;\n        return fetchJsonp(resource, callbackParameterName, functionName);\n      }\n      return Promise.reject(e);\n    });\n  });\n}\n\n/**\n * Creates a Resource from a URL and calls fetchJsonp() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.callbackParameterName='callback'] The callback parameter name that the server expects.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchJsonp = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchJsonp(options.callbackParameterName);\n};\n\n/**\n * @private\n */\nResource.prototype._makeRequest = function (options) {\n  const resource = this;\n  checkAndResetRequest(resource.request);\n  const request = resource.request;\n  const url = resource.url;\n  request.url = url;\n  request.requestFunction = function () {\n    const responseType = options.responseType;\n    const headers = combine(options.headers, resource.headers);\n    const overrideMimeType = options.overrideMimeType;\n    const method = options.method;\n    const data = options.data;\n    const deferred = defer();\n    const xhr = Resource._Implementations.loadWithXhr(url, responseType, method, data, headers, deferred, overrideMimeType);\n    if (defined(xhr) && defined(xhr.abort)) {\n      request.cancelFunction = function () {\n        xhr.abort();\n      };\n    }\n    return deferred.promise;\n  };\n  const promise = RequestScheduler.request(request);\n  if (!defined(promise)) {\n    return;\n  }\n  return promise.then(function (data) {\n    // explicitly set to undefined to ensure GC of request response data. See #8843\n    request.cancelFunction = undefined;\n    return data;\n  }).catch(function (e) {\n    request.cancelFunction = undefined;\n    if (request.state !== RequestState.FAILED) {\n      return Promise.reject(e);\n    }\n    return resource.retryOnError(e).then(function (retry) {\n      if (retry) {\n        // Reset request so it can try again\n        request.state = RequestState.UNISSUED;\n        request.deferred = undefined;\n        return resource.fetch(options);\n      }\n      return Promise.reject(e);\n    });\n  });\n};\n\n/**\n * Checks to make sure the Resource isn't already being requested.\n *\n * @param {Request} request The request to check.\n *\n * @private\n */\nfunction checkAndResetRequest(request) {\n  if (request.state === RequestState.ISSUED || request.state === RequestState.ACTIVE) {\n    throw new RuntimeError(\"The Resource is already being fetched.\");\n  }\n  request.state = RequestState.UNISSUED;\n  request.deferred = undefined;\n}\nconst dataUriRegex = /^data:(.*?)(;base64)?,(.*)$/;\nfunction decodeDataUriText(isBase64, data) {\n  const result = decodeURIComponent(data);\n  if (isBase64) {\n    return atob(result);\n  }\n  return result;\n}\nfunction decodeDataUriArrayBuffer(isBase64, data) {\n  const byteString = decodeDataUriText(isBase64, data);\n  const buffer = new ArrayBuffer(byteString.length);\n  const view = new Uint8Array(buffer);\n  for (let i = 0; i < byteString.length; i++) {\n    view[i] = byteString.charCodeAt(i);\n  }\n  return buffer;\n}\nfunction decodeDataUri(dataUriRegexResult, responseType) {\n  responseType = defaultValue(responseType, \"\");\n  const mimeType = dataUriRegexResult[1];\n  const isBase64 = !!dataUriRegexResult[2];\n  const data = dataUriRegexResult[3];\n  let buffer;\n  let parser;\n  switch (responseType) {\n    case \"\":\n    case \"text\":\n      return decodeDataUriText(isBase64, data);\n    case \"arraybuffer\":\n      return decodeDataUriArrayBuffer(isBase64, data);\n    case \"blob\":\n      buffer = decodeDataUriArrayBuffer(isBase64, data);\n      return new Blob([buffer], {\n        type: mimeType\n      });\n    case \"document\":\n      parser = new DOMParser();\n      return parser.parseFromString(decodeDataUriText(isBase64, data), mimeType);\n    case \"json\":\n      return JSON.parse(decodeDataUriText(isBase64, data));\n    default:\n      //>>includeStart('debug', pragmas.debug);\n      throw new DeveloperError(`Unhandled responseType: ${responseType}`);\n    //>>includeEnd('debug');\n  }\n}\n\n/**\n * Asynchronously loads the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled. It's recommended that you use\n * the more specific functions eg. fetchJson, fetchBlob, etc.\n *\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.fetch()\n *   .then(function(body) {\n *       // use the data\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetch = function (options) {\n  options = defaultClone(options, {});\n  options.method = \"GET\";\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls fetch() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetch = function (options) {\n  const resource = new Resource(options);\n  return resource.fetch({\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to fetch\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType\n  });\n};\n\n/**\n * Asynchronously deletes the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.delete()\n *   .then(function(body) {\n *       // use the data\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.delete = function (options) {\n  options = defaultClone(options, {});\n  options.method = \"DELETE\";\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls delete() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.data] Data that is posted with the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.delete = function (options) {\n  const resource = new Resource(options);\n  return resource.delete({\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to fetch\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType,\n    data: options.data\n  });\n};\n\n/**\n * Asynchronously gets headers the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.head()\n *   .then(function(headers) {\n *       // use the data\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.head = function (options) {\n  options = defaultClone(options, {});\n  options.method = \"HEAD\";\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls head() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.head = function (options) {\n  const resource = new Resource(options);\n  return resource.head({\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to fetch\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType\n  });\n};\n\n/**\n * Asynchronously gets options the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.options()\n *   .then(function(headers) {\n *       // use the data\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.options = function (options) {\n  options = defaultClone(options, {});\n  options.method = \"OPTIONS\";\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls options() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.options = function (options) {\n  const resource = new Resource(options);\n  return resource.options({\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to fetch\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType\n  });\n};\n\n/**\n * Asynchronously posts data to the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} data Data that is posted with the resource.\n * @param {object} [options] Object with the following properties:\n * @param {object} [options.data] Data that is posted with the resource.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.post(data)\n *   .then(function(result) {\n *       // use the result\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.post = function (data, options) {\n  Check.defined(\"data\", data);\n  options = defaultClone(options, {});\n  options.method = \"POST\";\n  options.data = data;\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls post() on it.\n *\n * @param {object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} options.data Data that is posted with the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.post = function (options) {\n  const resource = new Resource(options);\n  return resource.post(options.data, {\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to post\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType\n  });\n};\n\n/**\n * Asynchronously puts data to the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} data Data that is posted with the resource.\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.put(data)\n *   .then(function(result) {\n *       // use the result\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.put = function (data, options) {\n  Check.defined(\"data\", data);\n  options = defaultClone(options, {});\n  options.method = \"PUT\";\n  options.data = data;\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls put() on it.\n *\n * @param {object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} options.data Data that is posted with the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.put = function (options) {\n  const resource = new Resource(options);\n  return resource.put(options.data, {\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to post\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType\n  });\n};\n\n/**\n * Asynchronously patches data to the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} data Data that is posted with the resource.\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.patch(data)\n *   .then(function(result) {\n *       // use the result\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.patch = function (data, options) {\n  Check.defined(\"data\", data);\n  options = defaultClone(options, {});\n  options.method = \"PATCH\";\n  options.data = data;\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls patch() on it.\n *\n * @param {object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} options.data Data that is posted with the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.patch = function (options) {\n  const resource = new Resource(options);\n  return resource.patch(options.data, {\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to post\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType\n  });\n};\n\n/**\n * Contains implementations of functions that can be replaced for testing\n *\n * @private\n */\nResource._Implementations = {};\nResource._Implementations.loadImageElement = function (url, crossOrigin, deferred) {\n  const image = new Image();\n  image.onload = function () {\n    // work-around a known issue with Firefox and dimensionless SVG, see:\n    //   - https://github.com/whatwg/html/issues/3510\n    //   - https://bugzilla.mozilla.org/show_bug.cgi?id=700533\n    if (image.naturalWidth === 0 && image.naturalHeight === 0 && image.width === 0 && image.height === 0) {\n      // these values affect rasterization and will likely mar the content\n      // until Firefox takes a stance on the issue, marred content is better than no content\n      // Chromium uses a more refined heuristic about its choice given nil viewBox, and a better stance and solution is\n      // proposed later in the original issue thread:\n      //   - Chromium behavior: https://github.com/CesiumGS/cesium/issues/9188#issuecomment-704400825\n      //   - Cesium's stance/solve: https://github.com/CesiumGS/cesium/issues/9188#issuecomment-720645777\n      image.width = 300;\n      image.height = 150;\n    }\n    deferred.resolve(image);\n  };\n  image.onerror = function (e) {\n    deferred.reject(e);\n  };\n  if (crossOrigin) {\n    if (TrustedServers.contains(url)) {\n      image.crossOrigin = \"use-credentials\";\n    } else {\n      image.crossOrigin = \"\";\n    }\n  }\n  image.src = url;\n};\nResource._Implementations.createImage = function (request, crossOrigin, deferred, flipY, skipColorSpaceConversion, preferImageBitmap) {\n  const url = request.url;\n  // Passing an Image to createImageBitmap will force it to run on the main thread\n  // since DOM elements don't exist on workers. We convert it to a blob so it's non-blocking.\n  // See:\n  //    https://bugzilla.mozilla.org/show_bug.cgi?id=1044102#c38\n  //    https://bugs.chromium.org/p/chromium/issues/detail?id=580202#c10\n  Resource.supportsImageBitmapOptions().then(function (supportsImageBitmap) {\n    // We can only use ImageBitmap if we can flip on decode.\n    // See: https://github.com/CesiumGS/cesium/pull/7579#issuecomment-466146898\n    if (!(supportsImageBitmap && preferImageBitmap)) {\n      Resource._Implementations.loadImageElement(url, crossOrigin, deferred);\n      return;\n    }\n    const responseType = \"blob\";\n    const method = \"GET\";\n    const xhrDeferred = defer();\n    const xhr = Resource._Implementations.loadWithXhr(url, responseType, method, undefined, undefined, xhrDeferred, undefined, undefined, undefined);\n    if (defined(xhr) && defined(xhr.abort)) {\n      request.cancelFunction = function () {\n        xhr.abort();\n      };\n    }\n    return xhrDeferred.promise.then(function (blob) {\n      if (!defined(blob)) {\n        deferred.reject(new RuntimeError(`Successfully retrieved ${url} but it contained no content.`));\n        return;\n      }\n      return Resource.createImageBitmapFromBlob(blob, {\n        flipY: flipY,\n        premultiplyAlpha: false,\n        skipColorSpaceConversion: skipColorSpaceConversion\n      });\n    }).then(function (image) {\n      deferred.resolve(image);\n    });\n  }).catch(function (e) {\n    deferred.reject(e);\n  });\n};\n\n/**\n * Wrapper for createImageBitmap\n *\n * @private\n */\nResource.createImageBitmapFromBlob = function (blob, options) {\n  Check.defined(\"options\", options);\n  Check.typeOf.bool(\"options.flipY\", options.flipY);\n  Check.typeOf.bool(\"options.premultiplyAlpha\", options.premultiplyAlpha);\n  Check.typeOf.bool(\"options.skipColorSpaceConversion\", options.skipColorSpaceConversion);\n  return createImageBitmap(blob, {\n    imageOrientation: options.flipY ? \"flipY\" : \"none\",\n    premultiplyAlpha: options.premultiplyAlpha ? \"premultiply\" : \"none\",\n    colorSpaceConversion: options.skipColorSpaceConversion ? \"none\" : \"default\"\n  });\n};\nfunction loadWithHttpRequest(url, responseType, method, data, headers, deferred, overrideMimeType) {\n  // Note: only the 'json' and 'text' responseTypes transforms the loaded buffer\n  fetch(url, {\n    method,\n    headers\n  }).then(async response => {\n    if (!response.ok) {\n      const responseHeaders = {};\n      response.headers.forEach((value, key) => {\n        responseHeaders[key] = value;\n      });\n      deferred.reject(new RequestErrorEvent(response.status, response, responseHeaders));\n      return;\n    }\n    switch (responseType) {\n      case \"text\":\n        deferred.resolve(response.text());\n        break;\n      case \"json\":\n        deferred.resolve(response.json());\n        break;\n      default:\n        deferred.resolve(new Uint8Array(await response.arrayBuffer()).buffer);\n        break;\n    }\n  }).catch(() => {\n    deferred.reject(new RequestErrorEvent());\n  });\n}\nconst noXMLHttpRequest = typeof XMLHttpRequest === \"undefined\";\nResource._Implementations.loadWithXhr = function (url, responseType, method, data, headers, deferred, overrideMimeType) {\n  const dataUriRegexResult = dataUriRegex.exec(url);\n  if (dataUriRegexResult !== null) {\n    deferred.resolve(decodeDataUri(dataUriRegexResult, responseType));\n    return;\n  }\n  if (noXMLHttpRequest) {\n    loadWithHttpRequest(url, responseType, method, data, headers, deferred, overrideMimeType);\n    return;\n  }\n  const xhr = new XMLHttpRequest();\n  if (TrustedServers.contains(url)) {\n    xhr.withCredentials = true;\n  }\n  xhr.open(method, url, true);\n  if (defined(overrideMimeType) && defined(xhr.overrideMimeType)) {\n    xhr.overrideMimeType(overrideMimeType);\n  }\n  if (defined(headers)) {\n    for (const key in headers) {\n      if (headers.hasOwnProperty(key)) {\n        xhr.setRequestHeader(key, headers[key]);\n      }\n    }\n  }\n  if (defined(responseType)) {\n    xhr.responseType = responseType;\n  }\n\n  // While non-standard, file protocol always returns a status of 0 on success\n  let localFile = false;\n  if (typeof url === \"string\") {\n    localFile = url.indexOf(\"file://\") === 0 || typeof window !== \"undefined\" && window.location.origin === \"file://\";\n  }\n  xhr.onload = function () {\n    if ((xhr.status < 200 || xhr.status >= 300) && !(localFile && xhr.status === 0)) {\n      deferred.reject(new RequestErrorEvent(xhr.status, xhr.response, xhr.getAllResponseHeaders()));\n      return;\n    }\n    const response = xhr.response;\n    const browserResponseType = xhr.responseType;\n    if (method === \"HEAD\" || method === \"OPTIONS\") {\n      const responseHeaderString = xhr.getAllResponseHeaders();\n      const splitHeaders = responseHeaderString.trim().split(/[\\r\\n]+/);\n      const responseHeaders = {};\n      splitHeaders.forEach(function (line) {\n        const parts = line.split(\": \");\n        const header = parts.shift();\n        responseHeaders[header] = parts.join(\": \");\n      });\n      deferred.resolve(responseHeaders);\n      return;\n    }\n\n    //All modern browsers will go into either the first or second if block or last else block.\n    //Other code paths support older browsers that either do not support the supplied responseType\n    //or do not support the xhr.response property.\n    if (xhr.status === 204) {\n      // accept no content\n      deferred.resolve(undefined);\n    } else if (defined(response) && (!defined(responseType) || browserResponseType === responseType)) {\n      deferred.resolve(response);\n    } else if (responseType === \"json\" && typeof response === \"string\") {\n      try {\n        deferred.resolve(JSON.parse(response));\n      } catch (e) {\n        deferred.reject(e);\n      }\n    } else if ((browserResponseType === \"\" || browserResponseType === \"document\") && defined(xhr.responseXML) && xhr.responseXML.hasChildNodes()) {\n      deferred.resolve(xhr.responseXML);\n    } else if ((browserResponseType === \"\" || browserResponseType === \"text\") && defined(xhr.responseText)) {\n      deferred.resolve(xhr.responseText);\n    } else {\n      deferred.reject(new RuntimeError(\"Invalid XMLHttpRequest response type.\"));\n    }\n  };\n  xhr.onerror = function (e) {\n    deferred.reject(new RequestErrorEvent());\n  };\n  xhr.send(data);\n  return xhr;\n};\nResource._Implementations.loadAndExecuteScript = function (url, functionName, deferred) {\n  return loadAndExecuteScript(url, functionName).catch(function (e) {\n    deferred.reject(e);\n  });\n};\n\n/**\n * The default implementations\n *\n * @private\n */\nResource._DefaultImplementations = {};\nResource._DefaultImplementations.createImage = Resource._Implementations.createImage;\nResource._DefaultImplementations.loadWithXhr = Resource._Implementations.loadWithXhr;\nResource._DefaultImplementations.loadAndExecuteScript = Resource._Implementations.loadAndExecuteScript;\n\n/**\n * A resource instance initialized to the current browser location\n *\n * @type {Resource}\n * @constant\n */\nResource.DEFAULT = Object.freeze(new Resource({\n  url: typeof document === \"undefined\" ? \"\" : document.location.href.split(\"?\")[0]\n}));\n\n/**\n * A function that returns the value of the property.\n * @callback Resource.RetryCallback\n *\n * @param {Resource} [resource] The resource that failed to load.\n * @param {RequestErrorEvent} [error] The error that occurred during the loading of the resource.\n * @returns {boolean|Promise<boolean>} If true or a promise that resolved to true, the resource will be retried. Otherwise the failure will be returned.\n */\nexport default Resource;","map":{"version":3,"names":["Uri","appendForwardSlash","Check","clone","combine","defaultValue","defer","defined","DeveloperError","getAbsoluteUri","getBaseUri","getExtensionFromUri","getImagePixels","isBlobUri","isCrossOriginUrl","isDataUri","loadAndExecuteScript","CesiumMath","objectToQuery","queryToObject","Request","RequestErrorEvent","RequestScheduler","RequestState","RuntimeError","TrustedServers","xhrBlobSupported","xhr","XMLHttpRequest","open","responseType","e","Resource","options","EMPTY_OBJECT","url","typeOf","string","_url","undefined","_templateValues","defaultClone","templateValues","_queryParameters","queryParameters","headers","request","proxy","retryCallback","retryAttempts","_retryCount","parseUrl","_credits","credits","value","createIfNeeded","resource","getDerivedResource","supportsImageBitmapOptionsPromise","supportsImageBitmapOptions","createImageBitmap","Promise","resolve","imageDataUri","fetchBlob","then","blob","imageBitmapOptions","imageOrientation","premultiplyAlpha","colorSpaceConversion","all","imageBitmaps","colorWithOptions","colorWithDefaults","catch","Object","defineProperties","isBlobSupported","get","prototype","getUrlComponent","set","extension","hasHeaders","keys","length","toString","merge","preserveQuery","baseUrl","uri","query","parseQueryString","combineQueryParameters","search","fragment","scheme","absoluteTo","queryString","indexOf","q1","q2","preserveQueryParameters","result","param","hasOwnProperty","q2Value","Array","isArray","concat","slice","stringifyQuery","replace","match","key","replacement","encodeURIComponent","getURL","queryObject","setQueryParameters","params","useAsDefault","appendQueryParameters","setTemplateValues","template","retryOnError","error","that","includeQuery","fetchArrayBuffer","fetch","fetchImage","preferImageBitmap","preferBlob","flipY","skipColorSpaceConversion","checkAndResetRequest","blobPromise","supportsImageBitmap","useImageBitmap","generatedBlobResource","generatedBlob","createImageBitmapFromBlob","blobUrl","window","URL","createObjectURL","image","revokeObjectURL","reject","requestFunction","crossOrigin","deferred","_Implementations","createImage","promise","state","FAILED","retry","UNISSUED","fetchText","fetchJson","Accept","JSON","parse","fetchXML","overrideMimeType","fetchJsonp","callbackParameterName","functionName","nextRandomNumber","substring","callbackQuery","data","_makeRequest","method","loadWithXhr","abort","cancelFunction","ISSUED","ACTIVE","dataUriRegex","decodeDataUriText","isBase64","decodeURIComponent","atob","decodeDataUriArrayBuffer","byteString","buffer","ArrayBuffer","view","Uint8Array","i","charCodeAt","decodeDataUri","dataUriRegexResult","mimeType","parser","Blob","type","DOMParser","parseFromString","delete","head","post","put","patch","loadImageElement","Image","onload","naturalWidth","naturalHeight","width","height","onerror","contains","src","xhrDeferred","bool","loadWithHttpRequest","response","ok","responseHeaders","forEach","status","text","json","arrayBuffer","noXMLHttpRequest","exec","withCredentials","setRequestHeader","localFile","location","origin","getAllResponseHeaders","browserResponseType","responseHeaderString","splitHeaders","trim","split","line","parts","header","shift","join","responseXML","hasChildNodes","responseText","send","_DefaultImplementations","DEFAULT","freeze","document","href"],"sources":["/Users/mac/Desktop/IWL_Fresh_Start/Lab4gps-Love-In-Action/node_modules/@cesium/engine/Source/Core/Resource.js"],"sourcesContent":["import Uri from \"urijs\";\nimport appendForwardSlash from \"./appendForwardSlash.js\";\nimport Check from \"./Check.js\";\nimport clone from \"./clone.js\";\nimport combine from \"./combine.js\";\nimport defaultValue from \"./defaultValue.js\";\nimport defer from \"./defer.js\";\nimport defined from \"./defined.js\";\nimport DeveloperError from \"./DeveloperError.js\";\nimport getAbsoluteUri from \"./getAbsoluteUri.js\";\nimport getBaseUri from \"./getBaseUri.js\";\nimport getExtensionFromUri from \"./getExtensionFromUri.js\";\nimport getImagePixels from \"./getImagePixels.js\";\nimport isBlobUri from \"./isBlobUri.js\";\nimport isCrossOriginUrl from \"./isCrossOriginUrl.js\";\nimport isDataUri from \"./isDataUri.js\";\nimport loadAndExecuteScript from \"./loadAndExecuteScript.js\";\nimport CesiumMath from \"./Math.js\";\nimport objectToQuery from \"./objectToQuery.js\";\nimport queryToObject from \"./queryToObject.js\";\nimport Request from \"./Request.js\";\nimport RequestErrorEvent from \"./RequestErrorEvent.js\";\nimport RequestScheduler from \"./RequestScheduler.js\";\nimport RequestState from \"./RequestState.js\";\nimport RuntimeError from \"./RuntimeError.js\";\nimport TrustedServers from \"./TrustedServers.js\";\n\nconst xhrBlobSupported = (function () {\n  try {\n    const xhr = new XMLHttpRequest();\n    xhr.open(\"GET\", \"#\", true);\n    xhr.responseType = \"blob\";\n    return xhr.responseType === \"blob\";\n  } catch (e) {\n    return false;\n  }\n})();\n\n/**\n * @typedef {object} Resource.ConstructorOptions\n *\n * Initialization options for the Resource constructor\n *\n * @property {string} url The url of the resource.\n * @property {object} [queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @property {object} [templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @property {object} [headers={}] Additional HTTP headers that will be sent.\n * @property {Proxy} [proxy] A proxy to be used when loading the resource.\n * @property {Resource.RetryCallback} [retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @property {number} [retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @property {Request} [request] A Request object that will be used. Intended for internal use only.\n * @property {boolean} [parseUrl=true] If true, parse the url for query parameters; otherwise store the url without change\n */\n\n/**\n * A resource that includes the location and any other parameters we need to retrieve it or create derived resources. It also provides the ability to retry requests.\n *\n * @alias Resource\n * @constructor\n *\n * @param {string|Resource.ConstructorOptions} options A url or an object describing initialization options\n *\n * @example\n * function refreshTokenRetryCallback(resource, error) {\n *   if (error.statusCode === 403) {\n *     // 403 status code means a new token should be generated\n *     return getNewAccessToken()\n *       .then(function(token) {\n *         resource.queryParameters.access_token = token;\n *         return true;\n *       })\n *       .catch(function() {\n *         return false;\n *       });\n *   }\n *\n *   return false;\n * }\n *\n * const resource = new Resource({\n *    url: 'http://server.com/path/to/resource.json',\n *    proxy: new DefaultProxy('/proxy/'),\n *    headers: {\n *      'X-My-Header': 'valueOfHeader'\n *    },\n *    queryParameters: {\n *      'access_token': '123-435-456-000'\n *    },\n *    retryCallback: refreshTokenRetryCallback,\n *    retryAttempts: 1\n * });\n */\nfunction Resource(options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n  if (typeof options === \"string\") {\n    options = {\n      url: options,\n    };\n  }\n\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.string(\"options.url\", options.url);\n  //>>includeEnd('debug');\n\n  this._url = undefined;\n  this._templateValues = defaultClone(options.templateValues, {});\n  this._queryParameters = defaultClone(options.queryParameters, {});\n\n  /**\n   * Additional HTTP headers that will be sent with the request.\n   *\n   * @type {object}\n   */\n  this.headers = defaultClone(options.headers, {});\n\n  /**\n   * A Request object that will be used. Intended for internal use only.\n   *\n   * @type {Request}\n   */\n  this.request = defaultValue(options.request, new Request());\n\n  /**\n   * A proxy to be used when loading the resource.\n   *\n   * @type {Proxy}\n   */\n  this.proxy = options.proxy;\n\n  /**\n   * Function to call when a request for this resource fails. If it returns true or a Promise that resolves to true, the request will be retried.\n   *\n   * @type {Function}\n   */\n  this.retryCallback = options.retryCallback;\n\n  /**\n   * The number of times the retryCallback should be called before giving up.\n   *\n   * @type {number}\n   */\n  this.retryAttempts = defaultValue(options.retryAttempts, 0);\n  this._retryCount = 0;\n\n  const parseUrl = defaultValue(options.parseUrl, true);\n  if (parseUrl) {\n    this.parseUrl(options.url, true, true);\n  } else {\n    this._url = options.url;\n  }\n\n  this._credits = options.credits;\n}\n\n/**\n * Clones a value if it is defined, otherwise returns the default value\n *\n * @param {object} [value] The value to clone.\n * @param {object} [defaultValue] The default value.\n *\n * @returns {object} A clone of value or the defaultValue.\n *\n * @private\n */\nfunction defaultClone(value, defaultValue) {\n  return defined(value) ? clone(value) : defaultValue;\n}\n\n/**\n * A helper function to create a resource depending on whether we have a String or a Resource\n *\n * @param {Resource|string} resource A Resource or a String to use when creating a new Resource.\n *\n * @returns {Resource} If resource is a String, a Resource constructed with the url and options. Otherwise the resource parameter is returned.\n *\n * @private\n */\nResource.createIfNeeded = function (resource) {\n  if (resource instanceof Resource) {\n    // Keep existing request object. This function is used internally to duplicate a Resource, so that it can't\n    //  be modified outside of a class that holds it (eg. an imagery or terrain provider). Since the Request objects\n    //  are managed outside of the providers, by the tile loading code, we want to keep the request property the same so if it is changed\n    //  in the underlying tiling code the requests for this resource will use it.\n    return resource.getDerivedResource({\n      request: resource.request,\n    });\n  }\n\n  if (typeof resource !== \"string\") {\n    return resource;\n  }\n\n  return new Resource({\n    url: resource,\n  });\n};\n\nlet supportsImageBitmapOptionsPromise;\n/**\n * A helper function to check whether createImageBitmap supports passing ImageBitmapOptions.\n *\n * @returns {Promise<boolean>} A promise that resolves to true if this browser supports creating an ImageBitmap with options.\n *\n * @private\n */\nResource.supportsImageBitmapOptions = function () {\n  // Until the HTML folks figure out what to do about this, we need to actually try loading an image to\n  // know if this browser supports passing options to the createImageBitmap function.\n  // https://github.com/whatwg/html/pull/4248\n  //\n  // We also need to check whether the colorSpaceConversion option is supported.\n  // We do this by loading a PNG with an embedded color profile, first with\n  // colorSpaceConversion: \"none\" and then with colorSpaceConversion: \"default\".\n  // If the pixel color is different then we know the option is working.\n  // As of Webkit 17612.3.6.1.6 the createImageBitmap promise resolves but the\n  // option is not actually supported.\n  if (defined(supportsImageBitmapOptionsPromise)) {\n    return supportsImageBitmapOptionsPromise;\n  }\n\n  if (typeof createImageBitmap !== \"function\") {\n    supportsImageBitmapOptionsPromise = Promise.resolve(false);\n    return supportsImageBitmapOptionsPromise;\n  }\n\n  const imageDataUri =\n    \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAABGdBTUEAAE4g3rEiDgAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAADElEQVQI12Ng6GAAAAEUAIngE3ZiAAAAAElFTkSuQmCC\";\n\n  supportsImageBitmapOptionsPromise = Resource.fetchBlob({\n    url: imageDataUri,\n  })\n    .then(function (blob) {\n      const imageBitmapOptions = {\n        imageOrientation: \"flipY\", // default is \"none\"\n        premultiplyAlpha: \"none\", // default is \"default\"\n        colorSpaceConversion: \"none\", // default is \"default\"\n      };\n      return Promise.all([\n        createImageBitmap(blob, imageBitmapOptions),\n        createImageBitmap(blob),\n      ]);\n    })\n    .then(function (imageBitmaps) {\n      // Check whether the colorSpaceConversion option had any effect on the green channel\n      const colorWithOptions = getImagePixels(imageBitmaps[0]);\n      const colorWithDefaults = getImagePixels(imageBitmaps[1]);\n      return colorWithOptions[1] !== colorWithDefaults[1];\n    })\n    .catch(function () {\n      return false;\n    });\n\n  return supportsImageBitmapOptionsPromise;\n};\n\nObject.defineProperties(Resource, {\n  /**\n   * Returns true if blobs are supported.\n   *\n   * @memberof Resource\n   * @type {boolean}\n   *\n   * @readonly\n   */\n  isBlobSupported: {\n    get: function () {\n      return xhrBlobSupported;\n    },\n  },\n});\n\nObject.defineProperties(Resource.prototype, {\n  /**\n   * Query parameters appended to the url.\n   *\n   * @memberof Resource.prototype\n   * @type {object}\n   *\n   * @readonly\n   */\n  queryParameters: {\n    get: function () {\n      return this._queryParameters;\n    },\n  },\n\n  /**\n   * The key/value pairs used to replace template parameters in the url.\n   *\n   * @memberof Resource.prototype\n   * @type {object}\n   *\n   * @readonly\n   */\n  templateValues: {\n    get: function () {\n      return this._templateValues;\n    },\n  },\n\n  /**\n   * The url to the resource with template values replaced, query string appended and encoded by proxy if one was set.\n   *\n   * @memberof Resource.prototype\n   * @type {string}\n   */\n  url: {\n    get: function () {\n      return this.getUrlComponent(true, true);\n    },\n    set: function (value) {\n      this.parseUrl(value, false, false);\n    },\n  },\n\n  /**\n   * The file extension of the resource.\n   *\n   * @memberof Resource.prototype\n   * @type {string}\n   *\n   * @readonly\n   */\n  extension: {\n    get: function () {\n      return getExtensionFromUri(this._url);\n    },\n  },\n\n  /**\n   * True if the Resource refers to a data URI.\n   *\n   * @memberof Resource.prototype\n   * @type {boolean}\n   */\n  isDataUri: {\n    get: function () {\n      return isDataUri(this._url);\n    },\n  },\n\n  /**\n   * True if the Resource refers to a blob URI.\n   *\n   * @memberof Resource.prototype\n   * @type {boolean}\n   */\n  isBlobUri: {\n    get: function () {\n      return isBlobUri(this._url);\n    },\n  },\n\n  /**\n   * True if the Resource refers to a cross origin URL.\n   *\n   * @memberof Resource.prototype\n   * @type {boolean}\n   */\n  isCrossOriginUrl: {\n    get: function () {\n      return isCrossOriginUrl(this._url);\n    },\n  },\n\n  /**\n   * True if the Resource has request headers. This is equivalent to checking if the headers property has any keys.\n   *\n   * @memberof Resource.prototype\n   * @type {boolean}\n   */\n  hasHeaders: {\n    get: function () {\n      return Object.keys(this.headers).length > 0;\n    },\n  },\n\n  /**\n   * Gets the credits required for attribution of an asset.\n   * @private\n   */\n  credits: {\n    get: function () {\n      return this._credits;\n    },\n  },\n});\n\n/**\n * Override Object#toString so that implicit string conversion gives the\n * complete URL represented by this Resource.\n *\n * @returns {string} The URL represented by this Resource\n */\nResource.prototype.toString = function () {\n  return this.getUrlComponent(true, true);\n};\n\n/**\n * Parse a url string, and store its info\n *\n * @param {string} url The input url string.\n * @param {boolean} merge If true, we'll merge with the resource's existing queryParameters. Otherwise they will be replaced.\n * @param {boolean} preserveQuery If true duplicate parameters will be concatenated into an array. If false, keys in url will take precedence.\n * @param {string} [baseUrl] If supplied, and input url is a relative url, it will be made absolute relative to baseUrl\n *\n * @private\n */\nResource.prototype.parseUrl = function (url, merge, preserveQuery, baseUrl) {\n  let uri = new Uri(url);\n  const query = parseQueryString(uri.query());\n\n  this._queryParameters = merge\n    ? combineQueryParameters(query, this.queryParameters, preserveQuery)\n    : query;\n\n  // Remove unneeded info from the Uri\n  uri.search(\"\");\n  uri.fragment(\"\");\n\n  if (defined(baseUrl) && uri.scheme() === \"\") {\n    uri = uri.absoluteTo(getAbsoluteUri(baseUrl));\n  }\n\n  this._url = uri.toString();\n};\n\n/**\n * Parses a query string and returns the object equivalent.\n *\n * @param {string} queryString The query string\n * @returns {object}\n *\n * @private\n */\nfunction parseQueryString(queryString) {\n  if (queryString.length === 0) {\n    return {};\n  }\n\n  // Special case where the querystring is just a string, not key/value pairs\n  if (queryString.indexOf(\"=\") === -1) {\n    return { [queryString]: undefined };\n  }\n\n  return queryToObject(queryString);\n}\n\n/**\n * This combines a map of query parameters.\n *\n * @param {object} q1 The first map of query parameters. Values in this map will take precedence if preserveQueryParameters is false.\n * @param {object} q2 The second map of query parameters.\n * @param {boolean} preserveQueryParameters If true duplicate parameters will be concatenated into an array. If false, keys in q1 will take precedence.\n *\n * @returns {object} The combined map of query parameters.\n *\n * @example\n * const q1 = {\n *   a: 1,\n *   b: 2\n * };\n * const q2 = {\n *   a: 3,\n *   c: 4\n * };\n * const q3 = {\n *   b: [5, 6],\n *   d: 7\n * }\n *\n * // Returns\n * // {\n * //   a: [1, 3],\n * //   b: 2,\n * //   c: 4\n * // };\n * combineQueryParameters(q1, q2, true);\n *\n * // Returns\n * // {\n * //   a: 1,\n * //   b: 2,\n * //   c: 4\n * // };\n * combineQueryParameters(q1, q2, false);\n *\n * // Returns\n * // {\n * //   a: 1,\n * //   b: [2, 5, 6],\n * //   d: 7\n * // };\n * combineQueryParameters(q1, q3, true);\n *\n * // Returns\n * // {\n * //   a: 1,\n * //   b: 2,\n * //   d: 7\n * // };\n * combineQueryParameters(q1, q3, false);\n *\n * @private\n */\nfunction combineQueryParameters(q1, q2, preserveQueryParameters) {\n  if (!preserveQueryParameters) {\n    return combine(q1, q2);\n  }\n\n  const result = clone(q1, true);\n  for (const param in q2) {\n    if (q2.hasOwnProperty(param)) {\n      let value = result[param];\n      const q2Value = q2[param];\n      if (defined(value)) {\n        if (!Array.isArray(value)) {\n          value = result[param] = [value];\n        }\n\n        result[param] = value.concat(q2Value);\n      } else {\n        result[param] = Array.isArray(q2Value) ? q2Value.slice() : q2Value;\n      }\n    }\n  }\n\n  return result;\n}\n\n/**\n * Returns the url, optional with the query string and processed by a proxy.\n *\n * @param {boolean} [query=false] If true, the query string is included.\n * @param {boolean} [proxy=false] If true, the url is processed by the proxy object, if defined.\n *\n * @returns {string} The url with all the requested components.\n */\nResource.prototype.getUrlComponent = function (query, proxy) {\n  if (this.isDataUri) {\n    return this._url;\n  }\n\n  let url = this._url;\n  if (query) {\n    url = `${url}${stringifyQuery(this.queryParameters)}`;\n  }\n\n  // Restore the placeholders, which may have been escaped in objectToQuery or elsewhere\n  url = url.replace(/%7B/g, \"{\").replace(/%7D/g, \"}\");\n\n  const templateValues = this._templateValues;\n  if (Object.keys(templateValues).length > 0) {\n    url = url.replace(/{(.*?)}/g, function (match, key) {\n      const replacement = templateValues[key];\n      if (defined(replacement)) {\n        // use the replacement value from templateValues if there is one...\n        return encodeURIComponent(replacement);\n      }\n      // otherwise leave it unchanged\n      return match;\n    });\n  }\n\n  if (proxy && defined(this.proxy)) {\n    url = this.proxy.getURL(url);\n  }\n\n  return url;\n};\n\n/**\n * Converts a query object into a string.\n *\n * @param {object} queryObject The object with query parameters\n * @returns {string}\n *\n * @private\n */\nfunction stringifyQuery(queryObject) {\n  const keys = Object.keys(queryObject);\n\n  if (keys.length === 0) {\n    return \"\";\n  }\n  if (keys.length === 1 && !defined(queryObject[keys[0]])) {\n    // We have 1 key with an undefined value, so this is just a string, not key/value pairs\n    return `?${keys[0]}`;\n  }\n\n  return `?${objectToQuery(queryObject)}`;\n}\n\n/**\n * Combines the specified object and the existing query parameters. This allows you to add many parameters at once,\n *  as opposed to adding them one at a time to the queryParameters property. If a value is already set, it will be replaced with the new value.\n *\n * @param {object} params The query parameters\n * @param {boolean} [useAsDefault=false] If true the params will be used as the default values, so they will only be set if they are undefined.\n */\nResource.prototype.setQueryParameters = function (params, useAsDefault) {\n  if (useAsDefault) {\n    this._queryParameters = combineQueryParameters(\n      this._queryParameters,\n      params,\n      false,\n    );\n  } else {\n    this._queryParameters = combineQueryParameters(\n      params,\n      this._queryParameters,\n      false,\n    );\n  }\n};\n\n/**\n * Combines the specified object and the existing query parameters. This allows you to add many parameters at once,\n *  as opposed to adding them one at a time to the queryParameters property.\n *\n * @param {object} params The query parameters\n */\nResource.prototype.appendQueryParameters = function (params) {\n  this._queryParameters = combineQueryParameters(\n    params,\n    this._queryParameters,\n    true,\n  );\n};\n\n/**\n * Combines the specified object and the existing template values. This allows you to add many values at once,\n *  as opposed to adding them one at a time to the templateValues property. If a value is already set, it will become an array and the new value will be appended.\n *\n * @param {object} template The template values\n * @param {boolean} [useAsDefault=false] If true the values will be used as the default values, so they will only be set if they are undefined.\n */\nResource.prototype.setTemplateValues = function (template, useAsDefault) {\n  if (useAsDefault) {\n    this._templateValues = combine(this._templateValues, template);\n  } else {\n    this._templateValues = combine(template, this._templateValues);\n  }\n};\n\n/**\n * Returns a resource relative to the current instance. All properties remain the same as the current instance unless overridden in options.\n *\n * @param {object} options An object with the following properties\n * @param {string} [options.url]  The url that will be resolved relative to the url of the current instance.\n * @param {object} [options.queryParameters] An object containing query parameters that will be combined with those of the current instance.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}). These will be combined with those of the current instance.\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The function to call when loading the resource fails.\n * @param {number} [options.retryAttempts] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {boolean} [options.preserveQueryParameters=false] If true, this will keep all query parameters from the current resource and derived resource. If false, derived parameters will replace those of the current resource.\n *\n * @returns {Resource} The resource derived from the current one.\n */\nResource.prototype.getDerivedResource = function (options) {\n  const resource = this.clone();\n  resource._retryCount = 0;\n\n  if (defined(options.url)) {\n    const preserveQuery = defaultValue(options.preserveQueryParameters, false);\n    resource.parseUrl(options.url, true, preserveQuery, this._url);\n  }\n\n  if (defined(options.queryParameters)) {\n    resource._queryParameters = combine(\n      options.queryParameters,\n      resource.queryParameters,\n    );\n  }\n  if (defined(options.templateValues)) {\n    resource._templateValues = combine(\n      options.templateValues,\n      resource.templateValues,\n    );\n  }\n  if (defined(options.headers)) {\n    resource.headers = combine(options.headers, resource.headers);\n  }\n  if (defined(options.proxy)) {\n    resource.proxy = options.proxy;\n  }\n  if (defined(options.request)) {\n    resource.request = options.request;\n  }\n  if (defined(options.retryCallback)) {\n    resource.retryCallback = options.retryCallback;\n  }\n  if (defined(options.retryAttempts)) {\n    resource.retryAttempts = options.retryAttempts;\n  }\n\n  return resource;\n};\n\n/**\n * Called when a resource fails to load. This will call the retryCallback function if defined until retryAttempts is reached.\n *\n * @param {RequestErrorEvent} [error] The error that was encountered.\n *\n * @returns {Promise<boolean>} A promise to a boolean, that if true will cause the resource request to be retried.\n *\n * @private\n */\nResource.prototype.retryOnError = function (error) {\n  const retryCallback = this.retryCallback;\n  if (\n    typeof retryCallback !== \"function\" ||\n    this._retryCount >= this.retryAttempts\n  ) {\n    return Promise.resolve(false);\n  }\n\n  const that = this;\n  return Promise.resolve(retryCallback(this, error)).then(function (result) {\n    ++that._retryCount;\n\n    return result;\n  });\n};\n\n/**\n * Duplicates a Resource instance.\n *\n * @param {Resource} [result] The object onto which to store the result.\n *\n * @returns {Resource} The modified result parameter or a new Resource instance if one was not provided.\n */\nResource.prototype.clone = function (result) {\n  if (!defined(result)) {\n    return new Resource({\n      url: this._url,\n      queryParameters: this.queryParameters,\n      templateValues: this.templateValues,\n      headers: this.headers,\n      proxy: this.proxy,\n      retryCallback: this.retryCallback,\n      retryAttempts: this.retryAttempts,\n      request: this.request.clone(),\n      parseUrl: false,\n      credits: defined(this.credits) ? this.credits.slice() : undefined,\n    });\n  }\n\n  result._url = this._url;\n  result._queryParameters = clone(this._queryParameters);\n  result._templateValues = clone(this._templateValues);\n  result.headers = clone(this.headers);\n  result.proxy = this.proxy;\n  result.retryCallback = this.retryCallback;\n  result.retryAttempts = this.retryAttempts;\n  result._retryCount = 0;\n  result.request = this.request.clone();\n\n  return result;\n};\n\n/**\n * Returns the base path of the Resource.\n *\n * @param {boolean} [includeQuery = false] Whether or not to include the query string and fragment form the uri\n *\n * @returns {string} The base URI of the resource\n */\nResource.prototype.getBaseUri = function (includeQuery) {\n  return getBaseUri(this.getUrlComponent(includeQuery), includeQuery);\n};\n\n/**\n * Appends a forward slash to the URL.\n */\nResource.prototype.appendForwardSlash = function () {\n  this._url = appendForwardSlash(this._url);\n};\n\n/**\n * Asynchronously loads the resource as raw binary data.  Returns a promise that will resolve to\n * an ArrayBuffer once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @returns {Promise<ArrayBuffer>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n * @example\n * // load a single URL asynchronously\n * resource.fetchArrayBuffer().then(function(arrayBuffer) {\n *     // use the data\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchArrayBuffer = function () {\n  return this.fetch({\n    responseType: \"arraybuffer\",\n  });\n};\n\n/**\n * Creates a Resource and calls fetchArrayBuffer() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @returns {Promise<ArrayBuffer>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchArrayBuffer = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchArrayBuffer();\n};\n\n/**\n * Asynchronously loads the given resource as a blob.  Returns a promise that will resolve to\n * a Blob once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @returns {Promise<Blob>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n * @example\n * // load a single URL asynchronously\n * resource.fetchBlob().then(function(blob) {\n *     // use the data\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchBlob = function () {\n  return this.fetch({\n    responseType: \"blob\",\n  });\n};\n\n/**\n * Creates a Resource and calls fetchBlob() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @returns {Promise<Blob>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchBlob = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchBlob();\n};\n\n/**\n * Asynchronously loads the given image resource.  Returns a promise that will resolve to\n * an {@link https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap|ImageBitmap} if <code>preferImageBitmap</code> is true and the browser supports <code>createImageBitmap</code> or otherwise an\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement|Image} once loaded, or reject if the image failed to load.\n *\n * @param {object} [options] An object with the following properties.\n * @param {boolean} [options.preferBlob=false] If true, we will load the image via a blob.\n * @param {boolean} [options.preferImageBitmap=false] If true, image will be decoded during fetch and an <code>ImageBitmap</code> is returned.\n * @param {boolean} [options.flipY=false] If true, image will be vertically flipped during decode. Only applies if the browser supports <code>createImageBitmap</code>.\n * @param {boolean} [options.skipColorSpaceConversion=false] If true, any custom gamma or color profiles in the image will be ignored. Only applies if the browser supports <code>createImageBitmap</code>.\n * @returns {Promise<ImageBitmap|HTMLImageElement>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * // load a single image asynchronously\n * resource.fetchImage().then(function(image) {\n *     // use the loaded image\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * // load several images in parallel\n * Promise.all([resource1.fetchImage(), resource2.fetchImage()]).then(function(images) {\n *     // images is an array containing all the loaded images\n * });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchImage = function (options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n  const preferImageBitmap = defaultValue(options.preferImageBitmap, false);\n  const preferBlob = defaultValue(options.preferBlob, false);\n  const flipY = defaultValue(options.flipY, false);\n  const skipColorSpaceConversion = defaultValue(\n    options.skipColorSpaceConversion,\n    false,\n  );\n\n  checkAndResetRequest(this.request);\n  // We try to load the image normally if\n  // 1. Blobs aren't supported\n  // 2. It's a data URI\n  // 3. It's a blob URI\n  // 4. It doesn't have request headers and we preferBlob is false\n  if (\n    !xhrBlobSupported ||\n    this.isDataUri ||\n    this.isBlobUri ||\n    (!this.hasHeaders && !preferBlob)\n  ) {\n    return fetchImage({\n      resource: this,\n      flipY: flipY,\n      skipColorSpaceConversion: skipColorSpaceConversion,\n      preferImageBitmap: preferImageBitmap,\n    });\n  }\n\n  const blobPromise = this.fetchBlob();\n  if (!defined(blobPromise)) {\n    return;\n  }\n\n  let supportsImageBitmap;\n  let useImageBitmap;\n  let generatedBlobResource;\n  let generatedBlob;\n  return Resource.supportsImageBitmapOptions()\n    .then(function (result) {\n      supportsImageBitmap = result;\n      useImageBitmap = supportsImageBitmap && preferImageBitmap;\n      return blobPromise;\n    })\n    .then(function (blob) {\n      if (!defined(blob)) {\n        return;\n      }\n      generatedBlob = blob;\n      if (useImageBitmap) {\n        return Resource.createImageBitmapFromBlob(blob, {\n          flipY: flipY,\n          premultiplyAlpha: false,\n          skipColorSpaceConversion: skipColorSpaceConversion,\n        });\n      }\n      const blobUrl = window.URL.createObjectURL(blob);\n      generatedBlobResource = new Resource({\n        url: blobUrl,\n      });\n\n      return fetchImage({\n        resource: generatedBlobResource,\n        flipY: flipY,\n        skipColorSpaceConversion: skipColorSpaceConversion,\n        preferImageBitmap: false,\n      });\n    })\n    .then(function (image) {\n      if (!defined(image)) {\n        return;\n      }\n\n      // The blob object may be needed for use by a TileDiscardPolicy,\n      // so attach it to the image.\n      image.blob = generatedBlob;\n\n      if (useImageBitmap) {\n        return image;\n      }\n\n      window.URL.revokeObjectURL(generatedBlobResource.url);\n      return image;\n    })\n    .catch(function (error) {\n      if (defined(generatedBlobResource)) {\n        window.URL.revokeObjectURL(generatedBlobResource.url);\n      }\n\n      // If the blob load succeeded but the image decode failed, attach the blob\n      // to the error object for use by a TileDiscardPolicy.\n      // In particular, BingMapsImageryProvider uses this to detect the\n      // zero-length response that is returned when a tile is not available.\n      error.blob = generatedBlob;\n\n      return Promise.reject(error);\n    });\n};\n\n/**\n * Fetches an image and returns a promise to it.\n *\n * @param {object} [options] An object with the following properties.\n * @param {Resource} [options.resource] Resource object that points to an image to fetch.\n * @param {boolean} [options.preferImageBitmap] If true, image will be decoded during fetch and an <code>ImageBitmap</code> is returned.\n * @param {boolean} [options.flipY] If true, image will be vertically flipped during decode. Only applies if the browser supports <code>createImageBitmap</code>.\n * @param {boolean} [options.skipColorSpaceConversion=false] If true, any custom gamma or color profiles in the image will be ignored. Only applies if the browser supports <code>createImageBitmap</code>.\n * @private\n */\nfunction fetchImage(options) {\n  const resource = options.resource;\n  const flipY = options.flipY;\n  const skipColorSpaceConversion = options.skipColorSpaceConversion;\n  const preferImageBitmap = options.preferImageBitmap;\n\n  const request = resource.request;\n  request.url = resource.url;\n  request.requestFunction = function () {\n    let crossOrigin = false;\n\n    // data URIs can't have crossorigin set.\n    if (!resource.isDataUri && !resource.isBlobUri) {\n      crossOrigin = resource.isCrossOriginUrl;\n    }\n\n    const deferred = defer();\n    Resource._Implementations.createImage(\n      request,\n      crossOrigin,\n      deferred,\n      flipY,\n      skipColorSpaceConversion,\n      preferImageBitmap,\n    );\n\n    return deferred.promise;\n  };\n\n  const promise = RequestScheduler.request(request);\n  if (!defined(promise)) {\n    return;\n  }\n\n  return promise.catch(function (e) {\n    // Don't retry cancelled or otherwise aborted requests\n    if (request.state !== RequestState.FAILED) {\n      return Promise.reject(e);\n    }\n    return resource.retryOnError(e).then(function (retry) {\n      if (retry) {\n        // Reset request so it can try again\n        request.state = RequestState.UNISSUED;\n        request.deferred = undefined;\n\n        return fetchImage({\n          resource: resource,\n          flipY: flipY,\n          skipColorSpaceConversion: skipColorSpaceConversion,\n          preferImageBitmap: preferImageBitmap,\n        });\n      }\n      return Promise.reject(e);\n    });\n  });\n}\n\n/**\n * Creates a Resource and calls fetchImage() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {boolean} [options.flipY=false] Whether to vertically flip the image during fetch and decode. Only applies when requesting an image and the browser supports <code>createImageBitmap</code>.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {boolean} [options.preferBlob=false]  If true, we will load the image via a blob.\n * @param {boolean} [options.preferImageBitmap=false] If true, image will be decoded during fetch and an <code>ImageBitmap</code> is returned.\n * @param {boolean} [options.skipColorSpaceConversion=false] If true, any custom gamma or color profiles in the image will be ignored. Only applies when requesting an image and the browser supports <code>createImageBitmap</code>.\n * @returns {Promise<ImageBitmap|HTMLImageElement>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchImage = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchImage({\n    flipY: options.flipY,\n    skipColorSpaceConversion: options.skipColorSpaceConversion,\n    preferBlob: options.preferBlob,\n    preferImageBitmap: options.preferImageBitmap,\n  });\n};\n\n/**\n * Asynchronously loads the given resource as text.  Returns a promise that will resolve to\n * a String once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @returns {Promise<string>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n * @example\n * // load text from a URL, setting a custom header\n * const resource = new Resource({\n *   url: 'http://someUrl.com/someJson.txt',\n *   headers: {\n *     'X-Custom-Header' : 'some value'\n *   }\n * });\n * resource.fetchText().then(function(text) {\n *     // Do something with the text\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest|XMLHttpRequest}\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchText = function () {\n  return this.fetch({\n    responseType: \"text\",\n  });\n};\n\n/**\n * Creates a Resource and calls fetchText() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @returns {Promise<string>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchText = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchText();\n};\n\n// note: &#42;&#47;&#42; below is */* but that ends the comment block early\n/**\n * Asynchronously loads the given resource as JSON.  Returns a promise that will resolve to\n * a JSON object once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled. This function\n * adds 'Accept: application/json,&#42;&#47;&#42;;q=0.01' to the request headers, if not\n * already specified.\n *\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.fetchJson().then(function(jsonData) {\n *     // Do something with the JSON object\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchJson = function () {\n  const promise = this.fetch({\n    responseType: \"text\",\n    headers: {\n      Accept: \"application/json,*/*;q=0.01\",\n    },\n  });\n\n  if (!defined(promise)) {\n    return undefined;\n  }\n\n  return promise.then(function (value) {\n    if (!defined(value)) {\n      return;\n    }\n    return JSON.parse(value);\n  });\n};\n\n/**\n * Creates a Resource and calls fetchJson() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchJson = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchJson();\n};\n\n/**\n * Asynchronously loads the given resource as XML.  Returns a promise that will resolve to\n * an XML Document once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @returns {Promise<XMLDocument>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * // load XML from a URL, setting a custom header\n * Cesium.loadXML('http://someUrl.com/someXML.xml', {\n *   'X-Custom-Header' : 'some value'\n * }).then(function(document) {\n *     // Do something with the document\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest|XMLHttpRequest}\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchXML = function () {\n  return this.fetch({\n    responseType: \"document\",\n    overrideMimeType: \"text/xml\",\n  });\n};\n\n/**\n * Creates a Resource and calls fetchXML() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @returns {Promise<XMLDocument>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchXML = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchXML();\n};\n\n/**\n * Requests a resource using JSONP.\n *\n * @param {string} [callbackParameterName='callback'] The callback parameter name that the server expects.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * // load a data asynchronously\n * resource.fetchJsonp().then(function(data) {\n *     // use the loaded data\n * }).catch(function(error) {\n *     // an error occurred\n * });\n *\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetchJsonp = function (callbackParameterName) {\n  callbackParameterName = defaultValue(callbackParameterName, \"callback\");\n\n  checkAndResetRequest(this.request);\n\n  //generate a unique function name\n  let functionName;\n  do {\n    functionName = `loadJsonp${CesiumMath.nextRandomNumber()\n      .toString()\n      .substring(2, 8)}`;\n  } while (defined(window[functionName]));\n\n  return fetchJsonp(this, callbackParameterName, functionName);\n};\n\nfunction fetchJsonp(resource, callbackParameterName, functionName) {\n  const callbackQuery = {};\n  callbackQuery[callbackParameterName] = functionName;\n  resource.setQueryParameters(callbackQuery);\n\n  const request = resource.request;\n  const url = resource.url;\n  request.url = url;\n  request.requestFunction = function () {\n    const deferred = defer();\n\n    //assign a function with that name in the global scope\n    window[functionName] = function (data) {\n      deferred.resolve(data);\n\n      try {\n        delete window[functionName];\n      } catch (e) {\n        window[functionName] = undefined;\n      }\n    };\n\n    Resource._Implementations.loadAndExecuteScript(url, functionName, deferred);\n    return deferred.promise;\n  };\n\n  const promise = RequestScheduler.request(request);\n  if (!defined(promise)) {\n    return;\n  }\n\n  return promise.catch(function (e) {\n    if (request.state !== RequestState.FAILED) {\n      return Promise.reject(e);\n    }\n\n    return resource.retryOnError(e).then(function (retry) {\n      if (retry) {\n        // Reset request so it can try again\n        request.state = RequestState.UNISSUED;\n        request.deferred = undefined;\n\n        return fetchJsonp(resource, callbackParameterName, functionName);\n      }\n\n      return Promise.reject(e);\n    });\n  });\n}\n\n/**\n * Creates a Resource from a URL and calls fetchJsonp() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.callbackParameterName='callback'] The callback parameter name that the server expects.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetchJsonp = function (options) {\n  const resource = new Resource(options);\n  return resource.fetchJsonp(options.callbackParameterName);\n};\n\n/**\n * @private\n */\nResource.prototype._makeRequest = function (options) {\n  const resource = this;\n  checkAndResetRequest(resource.request);\n\n  const request = resource.request;\n  const url = resource.url;\n  request.url = url;\n\n  request.requestFunction = function () {\n    const responseType = options.responseType;\n    const headers = combine(options.headers, resource.headers);\n    const overrideMimeType = options.overrideMimeType;\n    const method = options.method;\n    const data = options.data;\n    const deferred = defer();\n    const xhr = Resource._Implementations.loadWithXhr(\n      url,\n      responseType,\n      method,\n      data,\n      headers,\n      deferred,\n      overrideMimeType,\n    );\n    if (defined(xhr) && defined(xhr.abort)) {\n      request.cancelFunction = function () {\n        xhr.abort();\n      };\n    }\n    return deferred.promise;\n  };\n\n  const promise = RequestScheduler.request(request);\n  if (!defined(promise)) {\n    return;\n  }\n\n  return promise\n    .then(function (data) {\n      // explicitly set to undefined to ensure GC of request response data. See #8843\n      request.cancelFunction = undefined;\n      return data;\n    })\n    .catch(function (e) {\n      request.cancelFunction = undefined;\n      if (request.state !== RequestState.FAILED) {\n        return Promise.reject(e);\n      }\n\n      return resource.retryOnError(e).then(function (retry) {\n        if (retry) {\n          // Reset request so it can try again\n          request.state = RequestState.UNISSUED;\n          request.deferred = undefined;\n\n          return resource.fetch(options);\n        }\n\n        return Promise.reject(e);\n      });\n    });\n};\n\n/**\n * Checks to make sure the Resource isn't already being requested.\n *\n * @param {Request} request The request to check.\n *\n * @private\n */\nfunction checkAndResetRequest(request) {\n  if (\n    request.state === RequestState.ISSUED ||\n    request.state === RequestState.ACTIVE\n  ) {\n    throw new RuntimeError(\"The Resource is already being fetched.\");\n  }\n\n  request.state = RequestState.UNISSUED;\n  request.deferred = undefined;\n}\n\nconst dataUriRegex = /^data:(.*?)(;base64)?,(.*)$/;\n\nfunction decodeDataUriText(isBase64, data) {\n  const result = decodeURIComponent(data);\n  if (isBase64) {\n    return atob(result);\n  }\n  return result;\n}\n\nfunction decodeDataUriArrayBuffer(isBase64, data) {\n  const byteString = decodeDataUriText(isBase64, data);\n  const buffer = new ArrayBuffer(byteString.length);\n  const view = new Uint8Array(buffer);\n  for (let i = 0; i < byteString.length; i++) {\n    view[i] = byteString.charCodeAt(i);\n  }\n  return buffer;\n}\n\nfunction decodeDataUri(dataUriRegexResult, responseType) {\n  responseType = defaultValue(responseType, \"\");\n  const mimeType = dataUriRegexResult[1];\n  const isBase64 = !!dataUriRegexResult[2];\n  const data = dataUriRegexResult[3];\n  let buffer;\n  let parser;\n\n  switch (responseType) {\n    case \"\":\n    case \"text\":\n      return decodeDataUriText(isBase64, data);\n    case \"arraybuffer\":\n      return decodeDataUriArrayBuffer(isBase64, data);\n    case \"blob\":\n      buffer = decodeDataUriArrayBuffer(isBase64, data);\n      return new Blob([buffer], {\n        type: mimeType,\n      });\n    case \"document\":\n      parser = new DOMParser();\n      return parser.parseFromString(\n        decodeDataUriText(isBase64, data),\n        mimeType,\n      );\n    case \"json\":\n      return JSON.parse(decodeDataUriText(isBase64, data));\n    default:\n      //>>includeStart('debug', pragmas.debug);\n      throw new DeveloperError(`Unhandled responseType: ${responseType}`);\n    //>>includeEnd('debug');\n  }\n}\n\n/**\n * Asynchronously loads the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled. It's recommended that you use\n * the more specific functions eg. fetchJson, fetchBlob, etc.\n *\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.fetch()\n *   .then(function(body) {\n *       // use the data\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.fetch = function (options) {\n  options = defaultClone(options, {});\n  options.method = \"GET\";\n\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls fetch() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.fetch = function (options) {\n  const resource = new Resource(options);\n  return resource.fetch({\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to fetch\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType,\n  });\n};\n\n/**\n * Asynchronously deletes the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.delete()\n *   .then(function(body) {\n *       // use the data\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.delete = function (options) {\n  options = defaultClone(options, {});\n  options.method = \"DELETE\";\n\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls delete() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.data] Data that is posted with the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.delete = function (options) {\n  const resource = new Resource(options);\n  return resource.delete({\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to fetch\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType,\n    data: options.data,\n  });\n};\n\n/**\n * Asynchronously gets headers the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.head()\n *   .then(function(headers) {\n *       // use the data\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.head = function (options) {\n  options = defaultClone(options, {});\n  options.method = \"HEAD\";\n\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls head() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.head = function (options) {\n  const resource = new Resource(options);\n  return resource.head({\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to fetch\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType,\n  });\n};\n\n/**\n * Asynchronously gets options the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.options()\n *   .then(function(headers) {\n *       // use the data\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.options = function (options) {\n  options = defaultClone(options, {});\n  options.method = \"OPTIONS\";\n\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls options() on it.\n *\n * @param {string|object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.options = function (options) {\n  const resource = new Resource(options);\n  return resource.options({\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to fetch\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType,\n  });\n};\n\n/**\n * Asynchronously posts data to the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} data Data that is posted with the resource.\n * @param {object} [options] Object with the following properties:\n * @param {object} [options.data] Data that is posted with the resource.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.post(data)\n *   .then(function(result) {\n *       // use the result\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.post = function (data, options) {\n  Check.defined(\"data\", data);\n\n  options = defaultClone(options, {});\n  options.method = \"POST\";\n  options.data = data;\n\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls post() on it.\n *\n * @param {object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} options.data Data that is posted with the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.post = function (options) {\n  const resource = new Resource(options);\n  return resource.post(options.data, {\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to post\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType,\n  });\n};\n\n/**\n * Asynchronously puts data to the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} data Data that is posted with the resource.\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.put(data)\n *   .then(function(result) {\n *       // use the result\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.put = function (data, options) {\n  Check.defined(\"data\", data);\n\n  options = defaultClone(options, {});\n  options.method = \"PUT\";\n  options.data = data;\n\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls put() on it.\n *\n * @param {object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} options.data Data that is posted with the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.put = function (options) {\n  const resource = new Resource(options);\n  return resource.put(options.data, {\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to post\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType,\n  });\n};\n\n/**\n * Asynchronously patches data to the given resource.  Returns a promise that will resolve to\n * the result once loaded, or reject if the resource failed to load.  The data is loaded\n * using XMLHttpRequest, which means that in order to make requests to another origin,\n * the server must have Cross-Origin Resource Sharing (CORS) headers enabled.\n *\n * @param {object} data Data that is posted with the resource.\n * @param {object} [options] Object with the following properties:\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {object} [options.headers] Additional HTTP headers to send with the request, if any.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n *\n *\n * @example\n * resource.patch(data)\n *   .then(function(result) {\n *       // use the result\n *   }).catch(function(error) {\n *       // an error occurred\n *   });\n *\n * @see {@link http://www.w3.org/TR/cors/|Cross-Origin Resource Sharing}\n * @see {@link http://wiki.commonjs.org/wiki/Promises/A|CommonJS Promises/A}\n */\nResource.prototype.patch = function (data, options) {\n  Check.defined(\"data\", data);\n\n  options = defaultClone(options, {});\n  options.method = \"PATCH\";\n  options.data = data;\n\n  return this._makeRequest(options);\n};\n\n/**\n * Creates a Resource from a URL and calls patch() on it.\n *\n * @param {object} options A url or an object with the following properties\n * @param {string} options.url The url of the resource.\n * @param {object} options.data Data that is posted with the resource.\n * @param {object} [options.queryParameters] An object containing query parameters that will be sent when retrieving the resource.\n * @param {object} [options.templateValues] Key/Value pairs that are used to replace template values (eg. {x}).\n * @param {object} [options.headers={}] Additional HTTP headers that will be sent.\n * @param {Proxy} [options.proxy] A proxy to be used when loading the resource.\n * @param {Resource.RetryCallback} [options.retryCallback] The Function to call when a request for this resource fails. If it returns true, the request will be retried.\n * @param {number} [options.retryAttempts=0] The number of times the retryCallback should be called before giving up.\n * @param {Request} [options.request] A Request object that will be used. Intended for internal use only.\n * @param {string} [options.responseType] The type of response.  This controls the type of item returned.\n * @param {string} [options.overrideMimeType] Overrides the MIME type returned by the server.\n * @returns {Promise<any>|undefined} a promise that will resolve to the requested data when loaded. Returns undefined if <code>request.throttle</code> is true and the request does not have high enough priority.\n */\nResource.patch = function (options) {\n  const resource = new Resource(options);\n  return resource.patch(options.data, {\n    // Make copy of just the needed fields because headers can be passed to both the constructor and to post\n    responseType: options.responseType,\n    overrideMimeType: options.overrideMimeType,\n  });\n};\n\n/**\n * Contains implementations of functions that can be replaced for testing\n *\n * @private\n */\nResource._Implementations = {};\n\nResource._Implementations.loadImageElement = function (\n  url,\n  crossOrigin,\n  deferred,\n) {\n  const image = new Image();\n\n  image.onload = function () {\n    // work-around a known issue with Firefox and dimensionless SVG, see:\n    //   - https://github.com/whatwg/html/issues/3510\n    //   - https://bugzilla.mozilla.org/show_bug.cgi?id=700533\n    if (\n      image.naturalWidth === 0 &&\n      image.naturalHeight === 0 &&\n      image.width === 0 &&\n      image.height === 0\n    ) {\n      // these values affect rasterization and will likely mar the content\n      // until Firefox takes a stance on the issue, marred content is better than no content\n      // Chromium uses a more refined heuristic about its choice given nil viewBox, and a better stance and solution is\n      // proposed later in the original issue thread:\n      //   - Chromium behavior: https://github.com/CesiumGS/cesium/issues/9188#issuecomment-704400825\n      //   - Cesium's stance/solve: https://github.com/CesiumGS/cesium/issues/9188#issuecomment-720645777\n      image.width = 300;\n      image.height = 150;\n    }\n    deferred.resolve(image);\n  };\n\n  image.onerror = function (e) {\n    deferred.reject(e);\n  };\n\n  if (crossOrigin) {\n    if (TrustedServers.contains(url)) {\n      image.crossOrigin = \"use-credentials\";\n    } else {\n      image.crossOrigin = \"\";\n    }\n  }\n\n  image.src = url;\n};\n\nResource._Implementations.createImage = function (\n  request,\n  crossOrigin,\n  deferred,\n  flipY,\n  skipColorSpaceConversion,\n  preferImageBitmap,\n) {\n  const url = request.url;\n  // Passing an Image to createImageBitmap will force it to run on the main thread\n  // since DOM elements don't exist on workers. We convert it to a blob so it's non-blocking.\n  // See:\n  //    https://bugzilla.mozilla.org/show_bug.cgi?id=1044102#c38\n  //    https://bugs.chromium.org/p/chromium/issues/detail?id=580202#c10\n  Resource.supportsImageBitmapOptions()\n    .then(function (supportsImageBitmap) {\n      // We can only use ImageBitmap if we can flip on decode.\n      // See: https://github.com/CesiumGS/cesium/pull/7579#issuecomment-466146898\n      if (!(supportsImageBitmap && preferImageBitmap)) {\n        Resource._Implementations.loadImageElement(url, crossOrigin, deferred);\n        return;\n      }\n      const responseType = \"blob\";\n      const method = \"GET\";\n      const xhrDeferred = defer();\n      const xhr = Resource._Implementations.loadWithXhr(\n        url,\n        responseType,\n        method,\n        undefined,\n        undefined,\n        xhrDeferred,\n        undefined,\n        undefined,\n        undefined,\n      );\n\n      if (defined(xhr) && defined(xhr.abort)) {\n        request.cancelFunction = function () {\n          xhr.abort();\n        };\n      }\n      return xhrDeferred.promise\n        .then(function (blob) {\n          if (!defined(blob)) {\n            deferred.reject(\n              new RuntimeError(\n                `Successfully retrieved ${url} but it contained no content.`,\n              ),\n            );\n            return;\n          }\n\n          return Resource.createImageBitmapFromBlob(blob, {\n            flipY: flipY,\n            premultiplyAlpha: false,\n            skipColorSpaceConversion: skipColorSpaceConversion,\n          });\n        })\n        .then(function (image) {\n          deferred.resolve(image);\n        });\n    })\n    .catch(function (e) {\n      deferred.reject(e);\n    });\n};\n\n/**\n * Wrapper for createImageBitmap\n *\n * @private\n */\nResource.createImageBitmapFromBlob = function (blob, options) {\n  Check.defined(\"options\", options);\n  Check.typeOf.bool(\"options.flipY\", options.flipY);\n  Check.typeOf.bool(\"options.premultiplyAlpha\", options.premultiplyAlpha);\n  Check.typeOf.bool(\n    \"options.skipColorSpaceConversion\",\n    options.skipColorSpaceConversion,\n  );\n\n  return createImageBitmap(blob, {\n    imageOrientation: options.flipY ? \"flipY\" : \"none\",\n    premultiplyAlpha: options.premultiplyAlpha ? \"premultiply\" : \"none\",\n    colorSpaceConversion: options.skipColorSpaceConversion ? \"none\" : \"default\",\n  });\n};\n\nfunction loadWithHttpRequest(\n  url,\n  responseType,\n  method,\n  data,\n  headers,\n  deferred,\n  overrideMimeType,\n) {\n  // Note: only the 'json' and 'text' responseTypes transforms the loaded buffer\n  fetch(url, {\n    method,\n    headers,\n  })\n    .then(async (response) => {\n      if (!response.ok) {\n        const responseHeaders = {};\n        response.headers.forEach((value, key) => {\n          responseHeaders[key] = value;\n        });\n        deferred.reject(\n          new RequestErrorEvent(response.status, response, responseHeaders),\n        );\n        return;\n      }\n\n      switch (responseType) {\n        case \"text\":\n          deferred.resolve(response.text());\n          break;\n        case \"json\":\n          deferred.resolve(response.json());\n          break;\n        default:\n          deferred.resolve(new Uint8Array(await response.arrayBuffer()).buffer);\n          break;\n      }\n    })\n    .catch(() => {\n      deferred.reject(new RequestErrorEvent());\n    });\n}\n\nconst noXMLHttpRequest = typeof XMLHttpRequest === \"undefined\";\nResource._Implementations.loadWithXhr = function (\n  url,\n  responseType,\n  method,\n  data,\n  headers,\n  deferred,\n  overrideMimeType,\n) {\n  const dataUriRegexResult = dataUriRegex.exec(url);\n  if (dataUriRegexResult !== null) {\n    deferred.resolve(decodeDataUri(dataUriRegexResult, responseType));\n    return;\n  }\n\n  if (noXMLHttpRequest) {\n    loadWithHttpRequest(\n      url,\n      responseType,\n      method,\n      data,\n      headers,\n      deferred,\n      overrideMimeType,\n    );\n    return;\n  }\n\n  const xhr = new XMLHttpRequest();\n\n  if (TrustedServers.contains(url)) {\n    xhr.withCredentials = true;\n  }\n\n  xhr.open(method, url, true);\n\n  if (defined(overrideMimeType) && defined(xhr.overrideMimeType)) {\n    xhr.overrideMimeType(overrideMimeType);\n  }\n\n  if (defined(headers)) {\n    for (const key in headers) {\n      if (headers.hasOwnProperty(key)) {\n        xhr.setRequestHeader(key, headers[key]);\n      }\n    }\n  }\n\n  if (defined(responseType)) {\n    xhr.responseType = responseType;\n  }\n\n  // While non-standard, file protocol always returns a status of 0 on success\n  let localFile = false;\n  if (typeof url === \"string\") {\n    localFile =\n      url.indexOf(\"file://\") === 0 ||\n      (typeof window !== \"undefined\" && window.location.origin === \"file://\");\n  }\n\n  xhr.onload = function () {\n    if (\n      (xhr.status < 200 || xhr.status >= 300) &&\n      !(localFile && xhr.status === 0)\n    ) {\n      deferred.reject(\n        new RequestErrorEvent(\n          xhr.status,\n          xhr.response,\n          xhr.getAllResponseHeaders(),\n        ),\n      );\n      return;\n    }\n\n    const response = xhr.response;\n    const browserResponseType = xhr.responseType;\n\n    if (method === \"HEAD\" || method === \"OPTIONS\") {\n      const responseHeaderString = xhr.getAllResponseHeaders();\n      const splitHeaders = responseHeaderString.trim().split(/[\\r\\n]+/);\n\n      const responseHeaders = {};\n      splitHeaders.forEach(function (line) {\n        const parts = line.split(\": \");\n        const header = parts.shift();\n        responseHeaders[header] = parts.join(\": \");\n      });\n\n      deferred.resolve(responseHeaders);\n      return;\n    }\n\n    //All modern browsers will go into either the first or second if block or last else block.\n    //Other code paths support older browsers that either do not support the supplied responseType\n    //or do not support the xhr.response property.\n    if (xhr.status === 204) {\n      // accept no content\n      deferred.resolve(undefined);\n    } else if (\n      defined(response) &&\n      (!defined(responseType) || browserResponseType === responseType)\n    ) {\n      deferred.resolve(response);\n    } else if (responseType === \"json\" && typeof response === \"string\") {\n      try {\n        deferred.resolve(JSON.parse(response));\n      } catch (e) {\n        deferred.reject(e);\n      }\n    } else if (\n      (browserResponseType === \"\" || browserResponseType === \"document\") &&\n      defined(xhr.responseXML) &&\n      xhr.responseXML.hasChildNodes()\n    ) {\n      deferred.resolve(xhr.responseXML);\n    } else if (\n      (browserResponseType === \"\" || browserResponseType === \"text\") &&\n      defined(xhr.responseText)\n    ) {\n      deferred.resolve(xhr.responseText);\n    } else {\n      deferred.reject(\n        new RuntimeError(\"Invalid XMLHttpRequest response type.\"),\n      );\n    }\n  };\n\n  xhr.onerror = function (e) {\n    deferred.reject(new RequestErrorEvent());\n  };\n\n  xhr.send(data);\n\n  return xhr;\n};\n\nResource._Implementations.loadAndExecuteScript = function (\n  url,\n  functionName,\n  deferred,\n) {\n  return loadAndExecuteScript(url, functionName).catch(function (e) {\n    deferred.reject(e);\n  });\n};\n\n/**\n * The default implementations\n *\n * @private\n */\nResource._DefaultImplementations = {};\nResource._DefaultImplementations.createImage =\n  Resource._Implementations.createImage;\nResource._DefaultImplementations.loadWithXhr =\n  Resource._Implementations.loadWithXhr;\nResource._DefaultImplementations.loadAndExecuteScript =\n  Resource._Implementations.loadAndExecuteScript;\n\n/**\n * A resource instance initialized to the current browser location\n *\n * @type {Resource}\n * @constant\n */\nResource.DEFAULT = Object.freeze(\n  new Resource({\n    url:\n      typeof document === \"undefined\"\n        ? \"\"\n        : document.location.href.split(\"?\")[0],\n  }),\n);\n\n/**\n * A function that returns the value of the property.\n * @callback Resource.RetryCallback\n *\n * @param {Resource} [resource] The resource that failed to load.\n * @param {RequestErrorEvent} [error] The error that occurred during the loading of the resource.\n * @returns {boolean|Promise<boolean>} If true or a promise that resolved to true, the resource will be retried. Otherwise the failure will be returned.\n */\nexport default Resource;\n"],"mappings":"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lD,IAAI,CAACqC,IAAI,GAAGrC,kBAAkB,CAAC,IAAI,CAACqC,IAAI,CAAC;AAC3C,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAN,QAAQ,CAACgD,SAAS,CAACkD,gBAAgB,GAAG,YAAY;EAChD,OAAO,IAAI,CAACC,KAAK,CAAC;IAChBrG,YAAY,EAAE;EAChB,CAAC,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAE,QAAQ,CAACkG,gBAAgB,GAAG,UAAUjG,OAAO,EAAE;EAC7C,MAAMuB,QAAQ,GAAG,IAAIxB,QAAQ,CAACC,OAAO,CAAC;EACtC,OAAOuB,QAAQ,CAAC0E,gBAAgB,CAAC,CAAC;AACpC,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAlG,QAAQ,CAACgD,SAAS,CAAChB,SAAS,GAAG,YAAY;EACzC,OAAO,IAAI,CAACmE,KAAK,CAAC;IAChBrG,YAAY,EAAE;EAChB,CAAC,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAE,QAAQ,CAACgC,SAAS,GAAG,UAAU/B,OAAO,EAAE;EACtC,MAAMuB,QAAQ,GAAG,IAAIxB,QAAQ,CAACC,OAAO,CAAC;EACtC,OAAOuB,QAAQ,CAACQ,SAAS,CAAC,CAAC;AAC7B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAhC,QAAQ,CAACgD,SAAS,CAACoD,UAAU,GAAG,UAAUnG,OAAO,EAAE;EACjDA,OAAO,GAAG5B,YAAY,CAAC4B,OAAO,EAAE5B,YAAY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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import BoundingSphere from \"../../Core/BoundingSphere.js\";\nimport Cartesian3 from \"../../Core/Cartesian3.js\";\nimport Cartographic from \"../../Core/Cartographic.js\";\nimport Check from \"../../Core/Check.js\";\nimport Credit from \"../../Core/Credit.js\";\nimport Color from \"../../Core/Color.js\";\nimport defined from \"../../Core/defined.js\";\nimport defaultValue from \"../../Core/defaultValue.js\";\nimport DeveloperError from \"../../Core/DeveloperError.js\";\nimport destroyObject from \"../../Core/destroyObject.js\";\nimport DistanceDisplayCondition from \"../../Core/DistanceDisplayCondition.js\";\nimport Ellipsoid from \"../../Core/Ellipsoid.js\";\nimport Event from \"../../Core/Event.js\";\nimport Matrix3 from \"../../Core/Matrix3.js\";\nimport Matrix4 from \"../../Core/Matrix4.js\";\nimport Resource from \"../../Core/Resource.js\";\nimport RuntimeError from \"../../Core/RuntimeError.js\";\nimport Pass from \"../../Renderer/Pass.js\";\nimport ClippingPlaneCollection from \"../ClippingPlaneCollection.js\";\nimport ClippingPolygonCollection from \"../ClippingPolygonCollection.js\";\nimport DynamicEnvironmentMapManager from \"../DynamicEnvironmentMapManager.js\";\nimport ColorBlendMode from \"../ColorBlendMode.js\";\nimport GltfLoader from \"../GltfLoader.js\";\nimport HeightReference, { isHeightReferenceRelative } from \"../HeightReference.js\";\nimport ImageBasedLighting from \"../ImageBasedLighting.js\";\nimport PointCloudShading from \"../PointCloudShading.js\";\nimport SceneMode from \"../SceneMode.js\";\nimport SceneTransforms from \"../SceneTransforms.js\";\nimport ShadowMode from \"../ShadowMode.js\";\nimport SplitDirection from \"../SplitDirection.js\";\nimport B3dmLoader from \"./B3dmLoader.js\";\nimport GeoJsonLoader from \"./GeoJsonLoader.js\";\nimport I3dmLoader from \"./I3dmLoader.js\";\nimport ModelAnimationCollection from \"./ModelAnimationCollection.js\";\nimport ModelFeatureTable from \"./ModelFeatureTable.js\";\nimport ModelSceneGraph from \"./ModelSceneGraph.js\";\nimport ModelStatistics from \"./ModelStatistics.js\";\nimport ModelType from \"./ModelType.js\";\nimport ModelUtility from \"./ModelUtility.js\";\nimport oneTimeWarning from \"../../Core/oneTimeWarning.js\";\nimport PntsLoader from \"./PntsLoader.js\";\nimport StyleCommandsNeeded from \"./StyleCommandsNeeded.js\";\nimport pickModel from \"./pickModel.js\";\n\n/**\n * <div class=\"notice\">\n * To construct a Model, call {@link Model.fromGltfAsync}. Do not call the constructor directly.\n * </div>\n * A 3D model based on glTF, the runtime asset format for WebGL, OpenGL ES, and OpenGL.\n * <p>\n * Cesium supports glTF assets with the following extensions:\n * <ul>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/AGI_articulations/README.md|AGI_articulations}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/master/extensions/1.0/Vendor/CESIUM_RTC/README.md|CESIUM_RTC}\n *  </li>\n *  <li>\n *  {@link https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_instance_features|EXT_instance_features}\n *  </li>\n *  <li>\n *  {@link https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_mesh_features|EXT_mesh_features}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/EXT_mesh_gpu_instancing|EXT_mesh_gpu_instancing}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/EXT_meshopt_compression|EXT_meshopt_compression}\n *  </li>\n *  <li>\n *  {@link https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata|EXT_structural_metadata}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/EXT_texture_webp|EXT_texture_webp}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_draco_mesh_compression/README.md|KHR_draco_mesh_compression}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Archived/KHR_techniques_webgl/README.md|KHR_techniques_webgl}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/main/extensions/1.0/Khronos/KHR_materials_common/README.md|KHR_materials_common}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Archived/KHR_materials_pbrSpecularGlossiness|KHR_materials_pbrSpecularGlossiness}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit/README.md|KHR_materials_unlit}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_mesh_quantization|KHR_mesh_quantization}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_texture_basisu|KHR_texture_basisu}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_texture_transform/README.md|KHR_texture_transform}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/main/extensions/1.0/Vendor/WEB3D_quantized_attributes/README.md|WEB3D_quantized_attributes}\n *  </li>\n *  <li>\n *  {@link https://nsgreg.nga.mil/csmwg.jsp|NGA_gpm_local (experimental)}\n *  </li>\n * </ul>\n * </p>\n * <p>\n * Note: for models with compressed textures using the KHR_texture_basisu extension, we recommend power of 2 textures in both dimensions\n * for maximum compatibility. This is because some samplers require power of 2 textures ({@link https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL|Using textures in WebGL})\n * and KHR_texture_basisu requires multiple of 4 dimensions ({@link https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_texture_basisu/README.md#additional-requirements|KHR_texture_basisu additional requirements}).\n * </p>\n *\n * @alias Model\n * @internalConstructor\n *\n * @privateParam {ResourceLoader} options.loader The loader used to load resources for this model.\n * @privateParam {ModelType} options.type Type of this model, to distinguish individual glTF files from 3D Tiles internally.\n * @privateParam {object} options Object with the following properties:\n * @privateParam {Resource} options.resource The Resource to the 3D model.\n * @privateParam {boolean} [options.show=true] Whether or not to render the model.\n * @privateParam {Matrix4} [options.modelMatrix=Matrix4.IDENTITY]  The 4x4 transformation matrix that transforms the model from model to world coordinates.\n * @privateParam {number} [options.scale=1.0] A uniform scale applied to this model.\n * @privateParam {boolean} [options.enableVerticalExaggeration=true] If <code>true</code>, the model is exaggerated along the ellipsoid normal when {@link Scene.verticalExaggeration} is set to a value other than <code>1.0</code>.\n * @privateParam {number} [options.minimumPixelSize=0.0] The approximate minimum pixel size of the model regardless of zoom.\n * @privateParam {number} [options.maximumScale] The maximum scale size of a model. An upper limit for minimumPixelSize.\n * @privateParam {object} [options.id] A user-defined object to return when the model is picked with {@link Scene#pick}.\n * @privateParam {boolean} [options.allowPicking=true] When <code>true</code>, each primitive is pickable with {@link Scene#pick}.\n * @privateParam {boolean} [options.clampAnimations=true] Determines if the model's animations should hold a pose over frames where no keyframes are specified.\n * @privateParam {ShadowMode} [options.shadows=ShadowMode.ENABLED] Determines whether the model casts or receives shadows from light sources.\n * @privateParam {boolean} [options.debugShowBoundingVolume=false] For debugging only. Draws the bounding sphere for each draw command in the model.\n * @privateParam {boolean} [options.enableDebugWireframe=false] For debugging only. This must be set to true for debugWireframe to work in WebGL1. This cannot be set after the model has loaded.\n * @privateParam {boolean} [options.debugWireframe=false] For debugging only. Draws the model in wireframe. Will only work for WebGL1 if enableDebugWireframe is set to true.\n * @privateParam {boolean} [options.cull=true]  Whether or not to cull the model using frustum/horizon culling. If the model is part of a 3D Tiles tileset, this property will always be false, since the 3D Tiles culling system is used.\n * @privateParam {boolean} [options.opaquePass=Pass.OPAQUE] The pass to use in the {@link DrawCommand} for the opaque portions of the model.\n * @privateParam {CustomShader} [options.customShader] A custom shader. This will add user-defined GLSL code to the vertex and fragment shaders. Using custom shaders with a {@link Cesium3DTileStyle} may lead to undefined behavior.\n * @privateParam {Cesium3DTileContent} [options.content] The tile content this model belongs to. This property will be undefined if model is not loaded as part of a tileset.\n * @privateParam {HeightReference} [options.heightReference=HeightReference.NONE] Determines how the model is drawn relative to terrain.\n * @privateParam {Scene} [options.scene] Must be passed in for models that use the height reference property.\n * @privateParam {DistanceDisplayCondition} [options.distanceDisplayCondition] The condition specifying at what distance from the camera that this model will be displayed.\n * @privateParam {Color} [options.color] A color that blends with the model's rendered color.\n * @privateParam {ColorBlendMode} [options.colorBlendMode=ColorBlendMode.HIGHLIGHT] Defines how the color blends with the model.\n * @privateParam {number} [options.colorBlendAmount=0.5] Value used to determine the color strength when the <code>colorBlendMode</code> is <code>MIX</code>. A value of 0.0 results in the model's rendered color while a value of 1.0 results in a solid color, with any value in-between resulting in a mix of the two.\n * @privateParam {Color} [options.silhouetteColor=Color.RED] The silhouette color. If more than 256 models have silhouettes enabled, there is a small chance that overlapping models will have minor artifacts.\n * @privateParam {number} [options.silhouetteSize=0.0] The size of the silhouette in pixels.\n * @privateParam {boolean} [options.enableShowOutline=true] Whether to enable outlines for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. This can be set to false to avoid the additional processing of geometry at load time. When false, the showOutlines and outlineColor options are ignored.\n * @privateParam {boolean} [options.showOutline=true] Whether to display the outline for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. When true, outlines are displayed. When false, outlines are not displayed.\n * @privateParam {Color} [options.outlineColor=Color.BLACK] The color to use when rendering outlines.\n * @privateParam {ClippingPlaneCollection} [options.clippingPlanes] The {@link ClippingPlaneCollection} used to selectively disable rendering the model.\n * @privateParam {ClippingPolygonCollection} [options.clippingPolygons] The {@link ClippingPolygonCollection} used to selectively disable rendering the model.\n * @privateParam {Cartesian3} [options.lightColor] The light color when shading the model. When <code>undefined</code> the scene's light color is used instead.\n * @privateParam {ImageBasedLighting} [options.imageBasedLighting] The properties for managing image-based lighting on this model.\n * @privateParam {DynamicEnvironmentMapManager.ConstructorOptions} [options.environmentMapOptions] The properties for managing dynamic environment maps on this model. Affects lighting.\n * @privateParam {boolean} [options.backFaceCulling=true] Whether to cull back-facing geometry. When true, back face culling is determined by the material's doubleSided property; when false, back face culling is disabled. Back faces are not culled if the model's color is translucent.\n * @privateParam {Credit|string} [options.credit] A credit for the data source, which is displayed on the canvas.\n * @privateParam {boolean} [options.showCreditsOnScreen=false] Whether to display the credits of this model on screen.\n * @privateParam {SplitDirection} [options.splitDirection=SplitDirection.NONE] The {@link SplitDirection} split to apply to this model.\n * @privateParam {boolean} [options.projectTo2D=false] Whether to accurately project the model's positions in 2D. If this is true, the model will be projected accurately to 2D, but it will use more memory to do so. If this is false, the model will use less memory and will still render in 2D / CV mode, but its positions may be inaccurate. This disables minimumPixelSize and prevents future modification to the model matrix. This also cannot be set after the model has loaded.\n * @privateParam {boolean} [options.enablePick=false] Whether to allow CPU picking with <code>pick</code> when not using WebGL 2 or above. If using WebGL 2 or above, this option will be ignored. If using WebGL 1 and this is true, the <code>pick</code> operation will work correctly, but it will use more memory to do so. If running with WebGL 1 and this is false, the model will use less memory, but <code>pick</code> will always return <code>undefined</code>. This cannot be set after the model has loaded.\n * @privateParam {string|number} [options.featureIdLabel=\"featureId_0\"] Label of the feature ID set to use for picking and styling. For EXT_mesh_features, this is the feature ID's label property, or \"featureId_N\" (where N is the index in the featureIds array) when not specified. EXT_feature_metadata did not have a label field, so such feature ID sets are always labeled \"featureId_N\" where N is the index in the list of all feature Ids, where feature ID attributes are listed before feature ID textures. If featureIdLabel is an integer N, it is converted to the string \"featureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @privateParam {string|number} [options.instanceFeatureIdLabel=\"instanceFeatureId_0\"] Label of the instance feature ID set used for picking and styling. If instanceFeatureIdLabel is set to an integer N, it is converted to the string \"instanceFeatureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @privateParam {object} [options.pointCloudShading] Options for constructing a {@link PointCloudShading} object to control point attenuation based on geometric error and lighting.\n * @privateParam {ClassificationType} [options.classificationType] Determines whether terrain, 3D Tiles or both will be classified by this model. This cannot be set after the model has loaded.\n *\n *\n * @see Model.fromGltfAsync\n *\n * @demo {@link https://sandcastle.cesium.com/index.html?src=3D%20Models.html|Cesium Sandcastle Models Demo}\n */\nfunction Model(options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.object(\"options.loader\", options.loader);\n  Check.typeOf.object(\"options.resource\", options.resource);\n  //>>includeEnd('debug');\n\n  /**\n   * The loader used to load resources for this model.\n   *\n   * @type {ResourceLoader}\n   * @private\n   */\n  this._loader = options.loader;\n  this._resource = options.resource;\n\n  /**\n   * Type of this model, to distinguish individual glTF files from 3D Tiles\n   * internally.\n   *\n   * @type {ModelType}\n   * @readonly\n   *\n   * @private\n   */\n  this.type = defaultValue(options.type, ModelType.GLTF);\n\n  /**\n   * The 4x4 transformation matrix that transforms the model from model to world coordinates.\n   * When this is the identity matrix, the model is drawn in world coordinates, i.e., Earth's Cartesian WGS84 coordinates.\n   * Local reference frames can be used by providing a different transformation matrix, like that returned\n   * by {@link Transforms.eastNorthUpToFixedFrame}.\n   *\n   * @type {Matrix4}\n    * @default {@link Matrix4.IDENTITY}\n   *\n   * @example\n   * const origin = Cesium.Cartesian3.fromDegrees(-95.0, 40.0, 200000.0);\n   * m.modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(origin);\n   */\n  this.modelMatrix = Matrix4.clone(defaultValue(options.modelMatrix, Matrix4.IDENTITY));\n  this._modelMatrix = Matrix4.clone(this.modelMatrix);\n  this._scale = defaultValue(options.scale, 1.0);\n  this._minimumPixelSize = defaultValue(options.minimumPixelSize, 0.0);\n  this._maximumScale = options.maximumScale;\n\n  /**\n   * The scale value after being clamped by the maximum scale parameter.\n   * Used to adjust bounding spheres without repeated calculation.\n   *\n   * @type {number}\n   * @private\n   */\n  this._clampedScale = defined(this._maximumScale) ? Math.min(this._scale, this._maximumScale) : this._scale;\n  this._computedScale = this._clampedScale;\n\n  /**\n   * Whether or not the ModelSceneGraph should call updateModelMatrix.\n   * This will be true if any of the model matrix, scale, minimum pixel size, or maximum scale are dirty.\n   *\n   * @type {number}\n   * @private\n   */\n  this._updateModelMatrix = false;\n\n  /**\n   * If defined, this matrix is used to transform miscellaneous properties like\n   * clipping planes and image-based lighting instead of the modelMatrix. This is\n   * so that when models are part of a tileset, these properties get transformed\n   * relative to a common reference (such as the root).\n   *\n   * @type {Matrix4}\n   * @private\n   */\n  this.referenceMatrix = undefined;\n  this._iblReferenceFrameMatrix = Matrix3.clone(Matrix3.IDENTITY); // Derived from reference matrix and the current view matrix\n\n  this._resourcesLoaded = false;\n  this._drawCommandsBuilt = false;\n  this._ready = false;\n  this._customShader = options.customShader;\n  this._content = options.content;\n  this._texturesLoaded = false;\n  this._defaultTexture = undefined;\n  this._activeAnimations = new ModelAnimationCollection(this);\n  this._clampAnimations = defaultValue(options.clampAnimations, true);\n\n  // This flag is true when the Cesium API, not a glTF animation, changes\n  // the transform of a node in the model.\n  this._userAnimationDirty = false;\n  this._id = options.id;\n  this._idDirty = false;\n  this._color = Color.clone(options.color);\n  this._colorBlendMode = defaultValue(options.colorBlendMode, ColorBlendMode.HIGHLIGHT);\n  this._colorBlendAmount = defaultValue(options.colorBlendAmount, 0.5);\n  const silhouetteColor = defaultValue(options.silhouetteColor, Color.RED);\n  this._silhouetteColor = Color.clone(silhouetteColor);\n  this._silhouetteSize = defaultValue(options.silhouetteSize, 0.0);\n  this._silhouetteDirty = false;\n\n  // If silhouettes are used for the model, this will be set to the number\n  // of the stencil buffer used for rendering the silhouette. This is set\n  // by ModelSilhouettePipelineStage, not by Model itself.\n  this._silhouetteId = undefined;\n  this._cull = defaultValue(options.cull, true);\n  this._opaquePass = defaultValue(options.opaquePass, Pass.OPAQUE);\n  this._allowPicking = defaultValue(options.allowPicking, true);\n  this._show = defaultValue(options.show, true);\n  this._style = undefined;\n  this._styleDirty = false;\n  this._styleCommandsNeeded = undefined;\n  let featureIdLabel = defaultValue(options.featureIdLabel, \"featureId_0\");\n  if (typeof featureIdLabel === \"number\") {\n    featureIdLabel = `featureId_${featureIdLabel}`;\n  }\n  this._featureIdLabel = featureIdLabel;\n  let instanceFeatureIdLabel = defaultValue(options.instanceFeatureIdLabel, \"instanceFeatureId_0\");\n  if (typeof instanceFeatureIdLabel === \"number\") {\n    instanceFeatureIdLabel = `instanceFeatureId_${instanceFeatureIdLabel}`;\n  }\n  this._instanceFeatureIdLabel = instanceFeatureIdLabel;\n  this._featureTables = [];\n  this._featureTableId = undefined;\n  this._featureTableIdDirty = true;\n\n  // Keeps track of resources that need to be destroyed when the draw commands are reset.\n  this._pipelineResources = [];\n\n  // Keeps track of resources that need to be destroyed when the Model is destroyed.\n  this._modelResources = [];\n\n  // Keeps track of the pick IDs for this model. These are stored and destroyed in the\n  // pipeline resources array; the purpose of this array is to separate them from other\n  // resources and update their ID objects when necessary.\n  this._pickIds = [];\n\n  // The model's bounding sphere and its initial radius are computed\n  // in ModelSceneGraph.\n  this._boundingSphere = new BoundingSphere();\n  this._initialRadius = undefined;\n  this._heightReference = defaultValue(options.heightReference, HeightReference.NONE);\n  this._heightDirty = this._heightReference !== HeightReference.NONE;\n  this._removeUpdateHeightCallback = undefined;\n  this._enableVerticalExaggeration = defaultValue(options.enableVerticalExaggeration, true);\n  this._hasVerticalExaggeration = false;\n  this._clampedModelMatrix = undefined; // For use with height reference\n\n  const scene = options.scene;\n  if (defined(scene) && defined(scene.terrainProviderChanged)) {\n    this._terrainProviderChangedCallback = scene.terrainProviderChanged.addEventListener(() => {\n      this._heightDirty = true;\n    });\n  }\n  this._scene = scene;\n  this._distanceDisplayCondition = options.distanceDisplayCondition;\n  const pointCloudShading = new PointCloudShading(options.pointCloudShading);\n  this._pointCloudShading = pointCloudShading;\n  this._attenuation = pointCloudShading.attenuation;\n  this._pointCloudBackFaceCulling = pointCloudShading.backFaceCulling;\n\n  // If the given clipping planes don't have an owner, make this model its owner.\n  // Otherwise, the clipping planes are passed down from a tileset.\n  const clippingPlanes = options.clippingPlanes;\n  if (defined(clippingPlanes) && clippingPlanes.owner === undefined) {\n    ClippingPlaneCollection.setOwner(clippingPlanes, this, \"_clippingPlanes\");\n  } else {\n    this._clippingPlanes = clippingPlanes;\n  }\n  this._clippingPlanesState = 0; // If this value changes, the shaders need to be regenerated.\n  this._clippingPlanesMatrix = Matrix4.clone(Matrix4.IDENTITY); // Derived from reference matrix and the current view matrix\n\n  // If the given clipping polygons don't have an owner, make this model its owner.\n  // Otherwise, the clipping polygons are passed down from a tileset.\n  const clippingPolygons = options.clippingPolygons;\n  if (defined(clippingPolygons) && clippingPolygons.owner === undefined) {\n    ClippingPolygonCollection.setOwner(clippingPolygons, this, \"_clippingPolygons\");\n  } else {\n    this._clippingPolygons = clippingPolygons;\n  }\n  this._clippingPolygonsState = 0; // If this value changes, the shaders need to be regenerated.\n\n  this._lightColor = Cartesian3.clone(options.lightColor);\n  this._imageBasedLighting = defined(options.imageBasedLighting) ? options.imageBasedLighting : new ImageBasedLighting();\n  this._shouldDestroyImageBasedLighting = !defined(options.imageBasedLighting);\n  this._environmentMapManager = undefined;\n  const environmentMapManager = new DynamicEnvironmentMapManager(options.environmentMapOptions);\n  DynamicEnvironmentMapManager.setOwner(environmentMapManager, this, \"_environmentMapManager\");\n  this._backFaceCulling = defaultValue(options.backFaceCulling, true);\n  this._backFaceCullingDirty = false;\n  this._shadows = defaultValue(options.shadows, ShadowMode.ENABLED);\n  this._shadowsDirty = false;\n  this._debugShowBoundingVolumeDirty = false;\n  this._debugShowBoundingVolume = defaultValue(options.debugShowBoundingVolume, false);\n  this._enableDebugWireframe = defaultValue(options.enableDebugWireframe, false);\n  this._enableShowOutline = defaultValue(options.enableShowOutline, true);\n  this._debugWireframe = defaultValue(options.debugWireframe, false);\n\n  // Warning for improper setup of debug wireframe\n  if (this._debugWireframe === true && this._enableDebugWireframe === false && this.type === ModelType.GLTF) {\n    oneTimeWarning(\"model-debug-wireframe-ignored\", \"enableDebugWireframe must be set to true in Model.fromGltf, otherwise debugWireframe will be ignored.\");\n  }\n\n  // Credit specified by the user.\n  let credit = options.credit;\n  if (typeof credit === \"string\") {\n    credit = new Credit(credit);\n  }\n  this._credits = [];\n  this._credit = credit;\n\n  // Credits to be added from the Resource (if it is an IonResource)\n  this._resourceCredits = [];\n\n  // Credits parsed from the glTF by GltfLoader.\n  this._gltfCredits = [];\n  this._showCreditsOnScreen = defaultValue(options.showCreditsOnScreen, false);\n  this._showCreditsOnScreenDirty = true;\n  this._splitDirection = defaultValue(options.splitDirection, SplitDirection.NONE);\n  this._enableShowOutline = defaultValue(options.enableShowOutline, true);\n\n  /**\n   * Whether to display the outline for models using the\n   * {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension.\n   * When true, outlines are displayed. When false, outlines are not displayed.\n   *\n   * @type {boolean}\n   *\n   * @default true\n   */\n  this.showOutline = defaultValue(options.showOutline, true);\n\n  /**\n   * The color to use when rendering outlines.\n   *\n   * @type {Color}\n   *\n   * @default Color.BLACK\n   */\n  this.outlineColor = defaultValue(options.outlineColor, Color.BLACK);\n  this._classificationType = options.classificationType;\n  this._statistics = new ModelStatistics();\n  this._sceneMode = undefined;\n  this._projectTo2D = defaultValue(options.projectTo2D, false);\n  this._enablePick = defaultValue(options.enablePick, false);\n  this._fogRenderable = undefined;\n  this._skipLevelOfDetail = false;\n  this._ignoreCommands = defaultValue(options.ignoreCommands, false);\n  this._errorEvent = new Event();\n  this._readyEvent = new Event();\n  this._texturesReadyEvent = new Event();\n  this._sceneGraph = undefined;\n  this._nodesByName = {}; // Stores the nodes by their names in the glTF.\n\n  /**\n   * Used for picking primitives that wrap a model.\n   *\n   * @private\n   */\n  this.pickObject = options.pickObject;\n}\nfunction handleError(model, error) {\n  if (model._errorEvent.numberOfListeners > 0) {\n    model._errorEvent.raiseEvent(error);\n    return;\n  }\n  console.log(error);\n}\nfunction createModelFeatureTables(model, structuralMetadata) {\n  const featureTables = model._featureTables;\n  const propertyTables = structuralMetadata.propertyTables;\n  const length = propertyTables.length;\n  for (let i = 0; i < length; i++) {\n    const propertyTable = propertyTables[i];\n    const modelFeatureTable = new ModelFeatureTable({\n      model: model,\n      propertyTable: propertyTable\n    });\n    featureTables.push(modelFeatureTable);\n  }\n  return featureTables;\n}\nfunction selectFeatureTableId(components, model) {\n  const featureIdLabel = model._featureIdLabel;\n  const instanceFeatureIdLabel = model._instanceFeatureIdLabel;\n  let i, j;\n  let featureIdAttribute;\n  let node;\n  // Scan the nodes till we find one with instances, get the feature table ID\n  // if the feature ID attribute of the user-selected index is present.\n  for (i = 0; i < components.nodes.length; i++) {\n    node = components.nodes[i];\n    if (defined(node.instances)) {\n      featureIdAttribute = ModelUtility.getFeatureIdsByLabel(node.instances.featureIds, instanceFeatureIdLabel);\n      if (defined(featureIdAttribute) && defined(featureIdAttribute.propertyTableId)) {\n        return featureIdAttribute.propertyTableId;\n      }\n    }\n  }\n\n  // Scan the primitives till we find one with textures or attributes, get the feature table ID\n  // if the feature ID attribute/texture of the user-selected index is present.\n  for (i = 0; i < components.nodes.length; i++) {\n    node = components.nodes[i];\n    for (j = 0; j < node.primitives.length; j++) {\n      const primitive = node.primitives[j];\n      const featureIds = ModelUtility.getFeatureIdsByLabel(primitive.featureIds, featureIdLabel);\n      if (defined(featureIds)) {\n        return featureIds.propertyTableId;\n      }\n    }\n  }\n\n  // If there's only one feature table, then select it by default. This is\n  // to ensure backwards compatibility with the older handling of b3dm models.\n  if (model._featureTables.length === 1) {\n    return 0;\n  }\n}\n\n/**\n *  Returns whether the alpha state has changed between invisible,\n *  translucent, or opaque.\n *\n *  @private\n */\nfunction isColorAlphaDirty(currentColor, previousColor) {\n  if (!defined(currentColor) && !defined(previousColor)) {\n    return false;\n  }\n  if (defined(currentColor) !== defined(previousColor)) {\n    return true;\n  }\n  const currentAlpha = currentColor.alpha;\n  const previousAlpha = previousColor.alpha;\n  return Math.floor(currentAlpha) !== Math.floor(previousAlpha) || Math.ceil(currentAlpha) !== Math.ceil(previousAlpha);\n}\nObject.defineProperties(Model.prototype, {\n  /**\n   * When <code>true</code>, this model is ready to render, i.e., the external binary, image,\n   * and shader files were downloaded and the WebGL resources were created.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   * @readonly\n   *\n   * @default false\n   */\n  ready: {\n    get: function () {\n      return this._ready;\n    }\n  },\n  /**\n   * Gets an event that is raised when the model encounters an asynchronous rendering error.  By subscribing\n   * to the event, you will be notified of the error and can potentially recover from it.  Event listeners\n   * are passed an instance of {@link ModelError}.\n   * @memberof Model.prototype\n   * @type {Event}\n   * @readonly\n   */\n  errorEvent: {\n    get: function () {\n      return this._errorEvent;\n    }\n  },\n  /**\n   * Gets an event that is raised when the model is loaded and ready for rendering, i.e. when the external resources\n   * have been downloaded and the WebGL resources are created. Event listeners\n   * are passed an instance of the {@link Model}.\n   *\n   * <p>\n   * If {@link Model.incrementallyLoadTextures} is true, this event will be raised before all textures are loaded and ready for rendering. Subscribe to {@link Model.texturesReadyEvent} to be notified when the textures are ready.\n   * </p>\n   *\n   * @memberof Model.prototype\n   * @type {Event}\n   * @readonly\n   */\n  readyEvent: {\n    get: function () {\n      return this._readyEvent;\n    }\n  },\n  /**\n   * Returns true if textures are loaded separately from the other glTF resources.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   * @readonly\n   * @private\n   */\n  incrementallyLoadTextures: {\n    get: function () {\n      return defaultValue(this._loader.incrementallyLoadTextures, false);\n    }\n  },\n  /**\n   * Gets an event that, if {@link Model.incrementallyLoadTextures} is true, is raised when the model textures are loaded and ready for rendering, i.e. when the external resources\n   * have been downloaded and the WebGL resources are created. Event listeners\n   * are passed an instance of the {@link Model}.\n   *\n   * @memberof Model.prototype\n   * @type {Event}\n   * @readonly\n   */\n  texturesReadyEvent: {\n    get: function () {\n      return this._texturesReadyEvent;\n    }\n  },\n  /**\n   * @private\n   */\n  loader: {\n    get: function () {\n      return this._loader;\n    }\n  },\n  /**\n   * Get the estimated memory usage statistics for this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ModelStatistics}\n   * @readonly\n   *\n   * @private\n   */\n  statistics: {\n    get: function () {\n      return this._statistics;\n    }\n  },\n  /**\n   * The currently playing glTF animations.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ModelAnimationCollection}\n   * @readonly\n   */\n  activeAnimations: {\n    get: function () {\n      return this._activeAnimations;\n    }\n  },\n  /**\n   * Determines if the model's animations should hold a pose over frames where no keyframes are specified.\n   *\n   * @memberof Model.prototype\n   * @type {boolean}\n   *\n   * @default true\n   */\n  clampAnimations: {\n    get: function () {\n      return this._clampAnimations;\n    },\n    set: function (value) {\n      this._clampAnimations = value;\n    }\n  },\n  /**\n   * Whether or not to cull the model using frustum/horizon culling. If the model is part of a 3D Tiles tileset, this property\n   * will always be false, since the 3D Tiles culling system is used.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   * @readonly\n   *\n   * @private\n   */\n  cull: {\n    get: function () {\n      return this._cull;\n    }\n  },\n  /**\n   * The pass to use in the {@link DrawCommand} for the opaque portions of the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Pass}\n   * @readonly\n   *\n   * @private\n   */\n  opaquePass: {\n    get: function () {\n      return this._opaquePass;\n    }\n  },\n  /**\n   * Point cloud shading settings for controlling point cloud attenuation\n   * and lighting. For 3D Tiles, this is inherited from the\n   * {@link Cesium3DTileset}.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {PointCloudShading}\n   */\n  pointCloudShading: {\n    get: function () {\n      return this._pointCloudShading;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.defined(\"pointCloudShading\", value);\n      //>>includeEnd('debug');\n      if (value !== this._pointCloudShading) {\n        this.resetDrawCommands();\n      }\n      this._pointCloudShading = value;\n    }\n  },\n  /**\n   * The model's custom shader, if it exists. Using custom shaders with a {@link Cesium3DTileStyle}\n   * may lead to undefined behavior.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {CustomShader}\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  customShader: {\n    get: function () {\n      return this._customShader;\n    },\n    set: function (value) {\n      if (value !== this._customShader) {\n        this.resetDrawCommands();\n      }\n      this._customShader = value;\n    }\n  },\n  /**\n   * The scene graph of this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ModelSceneGraph}\n   * @private\n   */\n  sceneGraph: {\n    get: function () {\n      return this._sceneGraph;\n    }\n  },\n  /**\n   * The tile content this model belongs to, if it is loaded as part of a {@link Cesium3DTileset}.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Cesium3DTileContent}\n   * @readonly\n   *\n   * @private\n   */\n  content: {\n    get: function () {\n      return this._content;\n    }\n  },\n  /**\n   * The height reference of the model, which determines how the model is drawn\n   * relative to terrain.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {HeightReference}\n   * @default {HeightReference.NONE}\n   *\n   */\n  heightReference: {\n    get: function () {\n      return this._heightReference;\n    },\n    set: function (value) {\n      if (value !== this._heightReference) {\n        this._heightDirty = true;\n      }\n      this._heightReference = value;\n    }\n  },\n  /**\n   * Gets or sets the distance display condition, which specifies at what distance\n   * from the camera this model will be displayed.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {DistanceDisplayCondition}\n   *\n   * @default undefined\n   *\n   */\n  distanceDisplayCondition: {\n    get: function () {\n      return this._distanceDisplayCondition;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      if (defined(value) && value.far <= value.near) {\n        throw new DeveloperError(\"far must be greater than near\");\n      }\n      //>>includeEnd('debug');\n      this._distanceDisplayCondition = DistanceDisplayCondition.clone(value, this._distanceDisplayCondition);\n    }\n  },\n  /**\n   * The structural metadata from the EXT_structural_metadata extension\n   *\n   * @memberof Model.prototype\n   *\n   * @type {StructuralMetadata}\n   * @readonly\n   *\n   * @private\n   */\n  structuralMetadata: {\n    get: function () {\n      return this._sceneGraph.components.structuralMetadata;\n    }\n  },\n  /**\n   * The ID for the feature table to use for picking and styling in this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   *\n   * @private\n   */\n  featureTableId: {\n    get: function () {\n      return this._featureTableId;\n    },\n    set: function (value) {\n      this._featureTableId = value;\n    }\n  },\n  /**\n   * The feature tables for this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Array}\n   * @readonly\n   *\n   * @private\n   */\n  featureTables: {\n    get: function () {\n      return this._featureTables;\n    },\n    set: function (value) {\n      this._featureTables = value;\n    }\n  },\n  /**\n   * A user-defined object that is returned when the model is picked.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {object}\n   *\n   * @default undefined\n   *\n   * @see Scene#pick\n   */\n  id: {\n    get: function () {\n      return this._id;\n    },\n    set: function (value) {\n      if (value !== this._id) {\n        this._idDirty = true;\n      }\n      this._id = value;\n    }\n  },\n  /**\n   * When <code>true</code>, each primitive is pickable with {@link Scene#pick}.  When <code>false</code>, GPU memory is saved.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   * @readonly\n   *\n   * @private\n   */\n  allowPicking: {\n    get: function () {\n      return this._allowPicking;\n    }\n  },\n  /**\n   * The style to apply to the features in the model. Cannot be applied if a {@link CustomShader} is also applied.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Cesium3DTileStyle}\n   */\n  style: {\n    get: function () {\n      return this._style;\n    },\n    set: function (value) {\n      this._style = value;\n      this._styleDirty = true;\n    }\n  },\n  /**\n   * The color to blend with the model's rendered color.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Color}\n   *\n   * @default undefined\n   */\n  color: {\n    get: function () {\n      return this._color;\n    },\n    set: function (value) {\n      if (isColorAlphaDirty(value, this._color)) {\n        this.resetDrawCommands();\n      }\n      this._color = Color.clone(value, this._color);\n    }\n  },\n  /**\n   * Defines how the color blends with the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Cesium3DTileColorBlendMode|ColorBlendMode}\n   *\n   * @default ColorBlendMode.HIGHLIGHT\n   */\n  colorBlendMode: {\n    get: function () {\n      return this._colorBlendMode;\n    },\n    set: function (value) {\n      this._colorBlendMode = value;\n    }\n  },\n  /**\n   * Value used to determine the color strength when the <code>colorBlendMode</code> is <code>MIX</code>. A value of 0.0 results in the model's rendered color while a value of 1.0 results in a solid color, with any value in-between resulting in a mix of the two.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   *\n   * @default 0.5\n   */\n  colorBlendAmount: {\n    get: function () {\n      return this._colorBlendAmount;\n    },\n    set: function (value) {\n      this._colorBlendAmount = value;\n    }\n  },\n  /**\n   * The silhouette color.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Color}\n   *\n   * @default Color.RED\n   */\n  silhouetteColor: {\n    get: function () {\n      return this._silhouetteColor;\n    },\n    set: function (value) {\n      if (!Color.equals(value, this._silhouetteColor)) {\n        const alphaDirty = isColorAlphaDirty(value, this._silhouetteColor);\n        this._silhouetteDirty = this._silhouetteDirty || alphaDirty;\n      }\n      this._silhouetteColor = Color.clone(value, this._silhouetteColor);\n    }\n  },\n  /**\n   * The size of the silhouette in pixels.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   *\n   * @default 0.0\n   */\n  silhouetteSize: {\n    get: function () {\n      return this._silhouetteSize;\n    },\n    set: function (value) {\n      if (value !== this._silhouetteSize) {\n        const currentSize = this._silhouetteSize;\n        const sizeDirty = value > 0.0 && currentSize === 0.0 || value === 0.0 && currentSize > 0.0;\n        this._silhouetteDirty = this._silhouetteDirty || sizeDirty;\n\n        // Back-face culling needs to be updated in case the silhouette size\n        // is greater than zero.\n        this._backFaceCullingDirty = this._backFaceCullingDirty || sizeDirty;\n      }\n      this._silhouetteSize = value;\n    }\n  },\n  /**\n   * Gets the model's bounding sphere in world space. This does not take into account\n   * glTF animations, skins, or morph targets. It also does not account for\n   * {@link Model#minimumPixelSize}.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {BoundingSphere}\n   * @readonly\n   */\n  boundingSphere: {\n    get: function () {\n      //>>includeStart('debug', pragmas.debug);\n      if (!this._ready) {\n        throw new DeveloperError(\"The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\");\n      }\n      //>>includeEnd('debug');\n\n      const modelMatrix = defined(this._clampedModelMatrix) ? this._clampedModelMatrix : this.modelMatrix;\n      updateBoundingSphere(this, modelMatrix);\n      return this._boundingSphere;\n    }\n  },\n  /**\n   * This property is for debugging only; it is not for production use nor is it optimized.\n   * <p>\n   * Draws the bounding sphere for each draw command in the model.\n   * </p>\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   *\n   * @default false\n   */\n  debugShowBoundingVolume: {\n    get: function () {\n      return this._debugShowBoundingVolume;\n    },\n    set: function (value) {\n      if (this._debugShowBoundingVolume !== value) {\n        this._debugShowBoundingVolumeDirty = true;\n      }\n      this._debugShowBoundingVolume = value;\n    }\n  },\n  /**\n   * This property is for debugging only; it is not for production use nor is it optimized.\n   * <p>\n   * Draws the model in wireframe.\n   * </p>\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   *\n   * @default false\n   */\n  debugWireframe: {\n    get: function () {\n      return this._debugWireframe;\n    },\n    set: function (value) {\n      if (this._debugWireframe !== value) {\n        this.resetDrawCommands();\n      }\n      this._debugWireframe = value;\n\n      // Warning for improper setup of debug wireframe\n      if (this._debugWireframe === true && this._enableDebugWireframe === false && this.type === ModelType.GLTF) {\n        oneTimeWarning(\"model-debug-wireframe-ignored\", \"enableDebugWireframe must be set to true in Model.fromGltfAsync, otherwise debugWireframe will be ignored.\");\n      }\n    }\n  },\n  /**\n   * Whether or not to render the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   *\n   * @default true\n   */\n  show: {\n    get: function () {\n      return this._show;\n    },\n    set: function (value) {\n      this._show = value;\n    }\n  },\n  /**\n   * Label of the feature ID set to use for picking and styling.\n   * <p>\n   * For EXT_mesh_features, this is the feature ID's label property, or\n   * \"featureId_N\" (where N is the index in the featureIds array) when not\n   * specified. EXT_feature_metadata did not have a label field, so such\n   * feature ID sets are always labeled \"featureId_N\" where N is the index in\n   * the list of all feature Ids, where feature ID attributes are listed before\n   * feature ID textures.\n   * </p>\n   * <p>\n   * If featureIdLabel is set to an integer N, it is converted to\n   * the string \"featureId_N\" automatically. If both per-primitive and\n   * per-instance feature IDs are present, the instance feature IDs take\n   * priority.\n   * </p>\n   *\n   * @memberof Model.prototype\n   *\n   * @type {string}\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  featureIdLabel: {\n    get: function () {\n      return this._featureIdLabel;\n    },\n    set: function (value) {\n      // indices get converted into featureId_N\n      if (typeof value === \"number\") {\n        value = `featureId_${value}`;\n      }\n\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.string(\"value\", value);\n      //>>includeEnd('debug');\n\n      if (value !== this._featureIdLabel) {\n        this._featureTableIdDirty = true;\n      }\n      this._featureIdLabel = value;\n    }\n  },\n  /**\n   * Label of the instance feature ID set used for picking and styling.\n   * <p>\n   * If instanceFeatureIdLabel is set to an integer N, it is converted to\n   * the string \"instanceFeatureId_N\" automatically.\n   * If both per-primitive and per-instance feature IDs are present, the\n   * instance feature IDs take priority.\n   * </p>\n   *\n   * @memberof Model.prototype\n   *\n   * @type {string}\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  instanceFeatureIdLabel: {\n    get: function () {\n      return this._instanceFeatureIdLabel;\n    },\n    set: function (value) {\n      // indices get converted into instanceFeatureId_N\n      if (typeof value === \"number\") {\n        value = `instanceFeatureId_${value}`;\n      }\n\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.string(\"value\", value);\n      //>>includeEnd('debug');\n\n      if (value !== this._instanceFeatureIdLabel) {\n        this._featureTableIdDirty = true;\n      }\n      this._instanceFeatureIdLabel = value;\n    }\n  },\n  /**\n   * The {@link ClippingPlaneCollection} used to selectively disable rendering the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ClippingPlaneCollection}\n   */\n  clippingPlanes: {\n    get: function () {\n      return this._clippingPlanes;\n    },\n    set: function (value) {\n      if (value !== this._clippingPlanes) {\n        // Handle destroying old clipping planes, new clipping planes ownership\n        ClippingPlaneCollection.setOwner(value, this, \"_clippingPlanes\");\n        this.resetDrawCommands();\n      }\n    }\n  },\n  /**\n   * The {@link ClippingPolygonCollection} used to selectively disable rendering the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ClippingPolygonCollection}\n   */\n  clippingPolygons: {\n    get: function () {\n      return this._clippingPolygons;\n    },\n    set: function (value) {\n      if (value !== this._clippingPolygons) {\n        // Handle destroying old clipping polygons, new clipping polygons ownership\n        ClippingPolygonCollection.setOwner(value, this, \"_clippingPolygons\");\n        this.resetDrawCommands();\n      }\n    }\n  },\n  /**\n   * If <code>true</code>, the model is exaggerated along the ellipsoid normal when {@link Scene.verticalExaggeration} is set to a value other than <code>1.0</code>.\n   *\n   * @memberof Model.prototype\n   * @type {boolean}\n   * @default true\n   *\n   * @example\n   * // Exaggerate terrain by a factor of 2, but prevent model exaggeration\n   * scene.verticalExaggeration = 2.0;\n   * model.enableVerticalExaggeration = false;\n   */\n  enableVerticalExaggeration: {\n    get: function () {\n      return this._enableVerticalExaggeration;\n    },\n    set: function (value) {\n      if (value !== this._enableVerticalExaggeration) {\n        this.resetDrawCommands();\n      }\n      this._enableVerticalExaggeration = value;\n    }\n  },\n  /**\n   * If <code>true</code>, the model is vertically exaggerated along the ellipsoid normal.\n   *\n   * @memberof Model.prototype\n   * @type {boolean}\n   * @default true\n   * @readonly\n   * @private\n   */\n  hasVerticalExaggeration: {\n    get: function () {\n      return this._hasVerticalExaggeration;\n    }\n  },\n  /**\n   * The directional light color when shading the model. When <code>undefined</code> the scene's light color is used instead.\n   * <p>\n   * Disabling additional light sources by setting\n   * <code>model.imageBasedLighting.imageBasedLightingFactor = new Cartesian2(0.0, 0.0)</code>\n   * will make the model much darker. Here, increasing the intensity of the light source will make the model brighter.\n   * </p>\n   * @memberof Model.prototype\n   *\n   * @type {Cartesian3}\n   *\n   * @default undefined\n   */\n  lightColor: {\n    get: function () {\n      return this._lightColor;\n    },\n    set: function (value) {\n      if (defined(value) !== defined(this._lightColor)) {\n        this.resetDrawCommands();\n      }\n      this._lightColor = Cartesian3.clone(value, this._lightColor);\n    }\n  },\n  /**\n   * The properties for managing image-based lighting on this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ImageBasedLighting}\n   */\n  imageBasedLighting: {\n    get: function () {\n      return this._imageBasedLighting;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.object(\"imageBasedLighting\", value);\n      //>>includeEnd('debug');\n\n      if (value !== this._imageBasedLighting) {\n        if (this._shouldDestroyImageBasedLighting && !this._imageBasedLighting.isDestroyed()) {\n          this._imageBasedLighting.destroy();\n        }\n        this._imageBasedLighting = value;\n        this._shouldDestroyImageBasedLighting = false;\n        this.resetDrawCommands();\n      }\n    }\n  },\n  /**\n   * The properties for managing dynamic environment maps on this model. Affects lighting.\n   * @memberof Model.prototype\n   * @readonly\n   *\n   * @example\n   * // Change the ground color used for a model's environment map to a forest green\n   * const environmentMapManager = model.environmentMapManager;\n   * environmentMapManager.groundColor = Cesium.Color.fromCssColorString(\"#203b34\");\n   *\n   * @type {DynamicEnvironmentMapManager}\n   */\n  environmentMapManager: {\n    get: function () {\n      return this._environmentMapManager;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.object(\"environmentMapManager\", value);\n      //>>includeEnd('debug');\n\n      if (value !== this.environmentMapManager) {\n        DynamicEnvironmentMapManager.setOwner(value, this, \"_environmentMapManager\");\n        this.resetDrawCommands();\n      }\n    }\n  },\n  /**\n   * Whether to cull back-facing geometry. When true, back face culling is\n   * determined by the material's doubleSided property; when false, back face\n   * culling is disabled. Back faces are not culled if {@link Model#color}\n   * is translucent or {@link Model#silhouetteSize} is greater than 0.0.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   *\n   * @default true\n   */\n  backFaceCulling: {\n    get: function () {\n      return this._backFaceCulling;\n    },\n    set: function (value) {\n      if (value !== this._backFaceCulling) {\n        this._backFaceCullingDirty = true;\n      }\n      this._backFaceCulling = value;\n    }\n  },\n  /**\n   * A uniform scale applied to this model before the {@link Model#modelMatrix}.\n   * Values greater than <code>1.0</code> increase the size of the model; values\n   * less than <code>1.0</code> decrease.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   *\n   * @default 1.0\n   */\n  scale: {\n    get: function () {\n      return this._scale;\n    },\n    set: function (value) {\n      if (value !== this._scale) {\n        this._updateModelMatrix = true;\n      }\n      this._scale = value;\n    }\n  },\n  /**\n   * The true scale of the model after being affected by the model's scale,\n   * minimum pixel size, and maximum scale parameters.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   * @readonly\n   *\n   * @private\n   */\n  computedScale: {\n    get: function () {\n      return this._computedScale;\n    }\n  },\n  /**\n   * The approximate minimum pixel size of the model regardless of zoom.\n   * This can be used to ensure that a model is visible even when the viewer\n   * zooms out.  When <code>0.0</code>, no minimum size is enforced.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   *\n   * @default 0.0\n   */\n  minimumPixelSize: {\n    get: function () {\n      return this._minimumPixelSize;\n    },\n    set: function (value) {\n      if (value !== this._minimumPixelSize) {\n        this._updateModelMatrix = true;\n      }\n      this._minimumPixelSize = value;\n    }\n  },\n  /**\n   * The maximum scale size for a model. This can be used to give\n   * an upper limit to the {@link Model#minimumPixelSize}, ensuring that the model\n   * is never an unreasonable scale.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   */\n  maximumScale: {\n    get: function () {\n      return this._maximumScale;\n    },\n    set: function (value) {\n      if (value !== this._maximumScale) {\n        this._updateModelMatrix = true;\n      }\n      this._maximumScale = value;\n    }\n  },\n  /**\n   * Determines whether the model casts or receives shadows from light sources.\n    * @memberof Model.prototype\n   *\n   * @type {ShadowMode}\n   *\n   * @default ShadowMode.ENABLED\n   */\n  shadows: {\n    get: function () {\n      return this._shadows;\n    },\n    set: function (value) {\n      if (value !== this._shadows) {\n        this._shadowsDirty = true;\n      }\n      this._shadows = value;\n    }\n  },\n  /**\n   * Gets the credit that will be displayed for the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Credit}\n   * @readonly\n   */\n  credit: {\n    get: function () {\n      return this._credit;\n    }\n  },\n  /**\n   * Gets or sets whether the credits of the model will be displayed\n   * on the screen.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   *\n   * @default false\n   */\n  showCreditsOnScreen: {\n    get: function () {\n      return this._showCreditsOnScreen;\n    },\n    set: function (value) {\n      if (this._showCreditsOnScreen !== value) {\n        this._showCreditsOnScreenDirty = true;\n      }\n      this._showCreditsOnScreen = value;\n    }\n  },\n  /**\n   * The {@link SplitDirection} to apply to this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {SplitDirection}\n   *\n   * @default {@link SplitDirection.NONE}\n   */\n  splitDirection: {\n    get: function () {\n      return this._splitDirection;\n    },\n    set: function (value) {\n      if (this._splitDirection !== value) {\n        this.resetDrawCommands();\n      }\n      this._splitDirection = value;\n    }\n  },\n  /**\n   * Gets the model's classification type. This determines whether terrain,\n   * 3D Tiles, or both will be classified by this model.\n   * <p>\n   * Additionally, there are a few requirements/limitations:\n   * <ul>\n   *     <li>The glTF cannot contain morph targets, skins, or animations.</li>\n   *     <li>The glTF cannot contain the <code>EXT_mesh_gpu_instancing</code> extension.</li>\n   *     <li>Only meshes with TRIANGLES can be used to classify other assets.</li>\n   *     <li>The meshes must be watertight.</li>\n   *     <li>The POSITION attribute is required.</li>\n   *     <li>If feature IDs and an index buffer are both present, all indices with the same feature id must occupy contiguous sections of the index buffer.</li>\n   *     <li>If feature IDs are present without an index buffer, all positions with the same feature id must occupy contiguous sections of the position buffer.</li>\n   * </ul>\n   * </p>\n   * <p>\n   * The 3D Tiles or terrain receiving the classification must be opaque.\n   * </p>\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ClassificationType}\n   * @default undefined\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   * @readonly\n   */\n  classificationType: {\n    get: function () {\n      return this._classificationType;\n    }\n  },\n  /**\n   * Reference to the pick IDs. This is only used internally, e.g. for\n   * per-feature post-processing in {@link PostProcessStage}.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {PickId[]}\n   * @readonly\n   *\n   * @private\n   */\n  pickIds: {\n    get: function () {\n      return this._pickIds;\n    }\n  },\n  /**\n   * The {@link StyleCommandsNeeded} for the style currently applied to\n   * the features in the model. This is used internally by the {@link ModelDrawCommand}\n   * when determining which commands to submit in an update.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {StyleCommandsNeeded}\n   * @readonly\n   *\n   * @private\n   */\n  styleCommandsNeeded: {\n    get: function () {\n      return this._styleCommandsNeeded;\n    }\n  }\n});\n\n/**\n * Returns the node with the given <code>name</code> in the glTF. This is used to\n * modify a node's transform for user-defined animation.\n *\n * @param {string} name The name of the node in the glTF.\n * @returns {ModelNode} The node, or <code>undefined</code> if no node with the <code>name</code> exists.\n *\n * @exception {DeveloperError} The model is not loaded.  Use Model.readyEvent or wait for Model.ready to be true.\n *\n * @example\n * // Apply non-uniform scale to node \"Hand\"\n * const node = model.getNode(\"Hand\");\n * node.matrix = Cesium.Matrix4.fromScale(new Cesium.Cartesian3(5.0, 1.0, 1.0), node.matrix);\n */\nModel.prototype.getNode = function (name) {\n  //>>includeStart('debug', pragmas.debug);\n  if (!this._ready) {\n    throw new DeveloperError(\"The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\");\n  }\n  Check.typeOf.string(\"name\", name);\n  //>>includeEnd('debug');\n\n  return this._nodesByName[name];\n};\n\n/**\n * Sets the current value of an articulation stage.  After setting one or\n * multiple stage values, call Model.applyArticulations() to\n * cause the node matrices to be recalculated.\n *\n * @param {string} articulationStageKey The name of the articulation, a space, and the name of the stage.\n * @param {number} value The numeric value of this stage of the articulation.\n *\n * @exception {DeveloperError} The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\n *\n * @see Model#applyArticulations\n *\n * @example\n * // Sets the value of the stage named \"MoveX\" belonging to the articulation named \"SampleArticulation\"\n * model.setArticulationStage(\"SampleArticulation MoveX\", 50.0);\n */\nModel.prototype.setArticulationStage = function (articulationStageKey, value) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.number(\"value\", value);\n  if (!this._ready) {\n    throw new DeveloperError(\"The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\");\n  }\n  //>>includeEnd('debug');\n\n  this._sceneGraph.setArticulationStage(articulationStageKey, value);\n};\n\n/**\n * Applies any modified articulation stages to the matrix of each node that\n * participates in any articulation. Note that this will overwrite any node\n * transformations on participating nodes.\n *\n * @exception {DeveloperError} The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\n */\nModel.prototype.applyArticulations = function () {\n  //>>includeStart('debug', pragmas.debug);\n  if (!this._ready) {\n    throw new DeveloperError(\"The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\");\n  }\n  //>>includeEnd('debug');\n\n  this._sceneGraph.applyArticulations();\n};\n\n/**\n * Returns the object that was created for the given extension.\n *\n * The given name may be the name of a glTF extension, like `\"EXT_example_extension\"`.\n * If the specified extension was present in the root of the underlying glTF asset,\n * and a loder for the specified extension has processed the extension data, then\n * this will return the model representation of the extension.\n *\n * @param {string} extensionName The name of the extension\n * @returns {object|undefined} The object, or `undefined`\n * @exception {DeveloperError} The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\n *\n * @experimental This feature is not final and is subject to change without Cesium's standard deprecation policy.\n */\nModel.prototype.getExtension = function (extensionName) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.string(\"extensionName\", extensionName);\n  if (!this._ready) {\n    throw new DeveloperError(\"The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\");\n  }\n  //>>includeEnd('debug');\n  const components = this._loader.components;\n  return components.extensions[extensionName];\n};\n\n/**\n * Marks the model's {@link Model#style} as dirty, which forces all features\n * to re-evaluate the style in the next frame the model is visible.\n */\nModel.prototype.makeStyleDirty = function () {\n  this._styleDirty = true;\n};\n\n/**\n * Resets the draw commands for this model.\n *\n * @private\n */\nModel.prototype.resetDrawCommands = function () {\n  this._drawCommandsBuilt = false;\n};\nconst scratchIBLReferenceFrameMatrix4 = new Matrix4();\nconst scratchIBLReferenceFrameMatrix3 = new Matrix3();\nconst scratchClippingPlanesMatrix = new Matrix4();\n\n/**\n * Called when {@link Viewer} or {@link CesiumWidget} render the scene to\n * get the draw commands needed to render this primitive.\n * <p>\n * Do not call this function directly.  This is documented just to\n * list the exceptions that may be propagated when the scene is rendered:\n * </p>\n *\n * @exception {RuntimeError} Failed to load external reference.\n */\nModel.prototype.update = function (frameState) {\n  let finishedProcessing = false;\n  try {\n    // Keep processing the model every frame until the main resources\n    // (buffer views) and textures (which may be loaded asynchronously)\n    // are processed.\n    finishedProcessing = processLoader(this, frameState);\n  } catch (error) {\n    if (!this._loader.incrementallyLoadTextures && error.name === \"TextureError\") {\n      handleError(this, error);\n    } else {\n      const runtimeError = ModelUtility.getError(\"model\", this._resource, error);\n      handleError(this, runtimeError);\n    }\n  }\n\n  // A custom shader may have to load texture uniforms.\n  updateCustomShader(this, frameState);\n\n  // Environment maps, specular maps, and spherical harmonics may need to be updated or regenerated\n  updateEnvironmentMap(this, frameState);\n\n  // The image-based lighting may have to load texture uniforms\n  // for specular maps.\n  updateImageBasedLighting(this, frameState);\n  if (!this._resourcesLoaded && finishedProcessing) {\n    this._resourcesLoaded = true;\n    const components = this._loader.components;\n    if (!defined(components)) {\n      if (this._loader.isUnloaded()) {\n        return;\n      }\n      const error = ModelUtility.getError(\"model\", this._resource, new RuntimeError(\"Failed to load model.\"));\n      handleError(error);\n      this._rejectLoad = this._rejectLoad && this._rejectLoad(error);\n    }\n    const structuralMetadata = components.structuralMetadata;\n    if (defined(structuralMetadata) && structuralMetadata.propertyTableCount > 0) {\n      createModelFeatureTables(this, structuralMetadata);\n    }\n    const sceneGraph = new ModelSceneGraph({\n      model: this,\n      modelComponents: components\n    });\n    this._sceneGraph = sceneGraph;\n    this._gltfCredits = sceneGraph.components.asset.credits;\n  }\n\n  // Short-circuit if the model resources aren't ready or the scene\n  // is currently morphing.\n  if (!this._resourcesLoaded || frameState.mode === SceneMode.MORPHING) {\n    return;\n  }\n  updateFeatureTableId(this);\n  updateStyle(this);\n  updateFeatureTables(this, frameState);\n  updatePointCloudShading(this);\n  updateSilhouette(this, frameState);\n  updateSkipLevelOfDetail(this, frameState);\n  updateClippingPlanes(this, frameState);\n  updateClippingPolygons(this, frameState);\n  updateSceneMode(this, frameState);\n  updateFog(this, frameState);\n  updateVerticalExaggeration(this, frameState);\n  this._defaultTexture = frameState.context.defaultTexture;\n  buildDrawCommands(this, frameState);\n  updateModelMatrix(this, frameState);\n\n  // Many features (e.g. image-based lighting, clipping planes) depend on the model\n  // matrix being updated for the current height reference, so update it first.\n  updateClamping(this);\n  updateBoundingSphereAndScale(this, frameState);\n  updateReferenceMatrices(this, frameState);\n\n  // This check occurs after the bounding sphere has been updated so that\n  // zooming to the bounding sphere can account for any modifications\n  // from the clamp-to-ground setting.\n  if (!this._ready) {\n    // Set the model as ready after the first frame render since the user might set up events subscribed to\n    // the post render event, and the model may not be ready for those past the first frame.\n    frameState.afterRender.push(() => {\n      this._ready = true;\n      this._readyEvent.raiseEvent(this);\n    });\n\n    // Don't render until the next frame after the ready event has been raised.\n    return;\n  }\n  if (this._loader.incrementallyLoadTextures && !this._texturesLoaded && this._loader.texturesLoaded) {\n    // Re-run the pipeline so texture memory statistics are re-computed\n    this.resetDrawCommands();\n    this._texturesLoaded = true;\n    this._texturesReadyEvent.raiseEvent(this);\n  }\n  updatePickIds(this);\n\n  // Update the scene graph and draw commands for any changes in model's properties\n  // (e.g. model matrix, back-face culling)\n  updateSceneGraph(this, frameState);\n  updateShowCreditsOnScreen(this);\n  submitDrawCommands(this, frameState);\n};\nfunction processLoader(model, frameState) {\n  if (!model._resourcesLoaded || model._loader.incrementallyLoadTextures && !model._texturesLoaded) {\n    // Ensures frames continue to render in requestRender mode while resources are processing\n    frameState.afterRender.push(() => true);\n    return model._loader.process(frameState);\n  }\n  return true;\n}\nfunction updateCustomShader(model, frameState) {\n  if (defined(model._customShader)) {\n    model._customShader.update(frameState);\n  }\n}\nfunction updateEnvironmentMap(model, frameState) {\n  const environmentMapManager = model._environmentMapManager;\n  const picking = frameState.passes.pick || frameState.passes.pickVoxel;\n  if (model._ready && environmentMapManager.owner === model && !picking) {\n    environmentMapManager.position = model._boundingSphere.center;\n    environmentMapManager.shouldUpdate = !defined(model._imageBasedLighting.sphericalHarmonicCoefficients) || !defined(model._imageBasedLighting.specularEnvironmentMaps);\n    environmentMapManager.update(frameState);\n    if (environmentMapManager.shouldRegenerateShaders) {\n      model.resetDrawCommands();\n    }\n  }\n}\nfunction updateImageBasedLighting(model, frameState) {\n  model._imageBasedLighting.update(frameState);\n  if (model._imageBasedLighting.shouldRegenerateShaders) {\n    model.resetDrawCommands();\n  }\n}\nfunction updateFeatureTableId(model) {\n  if (!model._featureTableIdDirty) {\n    return;\n  }\n  model._featureTableIdDirty = false;\n  const components = model._sceneGraph.components;\n  const structuralMetadata = components.structuralMetadata;\n  if (defined(structuralMetadata) && structuralMetadata.propertyTableCount > 0) {\n    model.featureTableId = selectFeatureTableId(components, model);\n\n    // Mark the style dirty to re-apply it and reflect the new feature ID table.\n    model._styleDirty = true;\n\n    // Trigger a rebuild of the draw commands.\n    model.resetDrawCommands();\n  }\n}\nfunction updateStyle(model) {\n  if (model._styleDirty) {\n    model.applyStyle(model._style);\n    model._styleDirty = false;\n  }\n}\nfunction updateFeatureTables(model, frameState) {\n  const featureTables = model._featureTables;\n  const length = featureTables.length;\n  let styleCommandsNeededDirty = false;\n  for (let i = 0; i < length; i++) {\n    featureTables[i].update(frameState);\n    // Check if the types of style commands needed have changed and trigger a reset of the draw commands\n    // to ensure that translucent and opaque features are handled in the correct passes.\n    if (featureTables[i].styleCommandsNeededDirty) {\n      styleCommandsNeededDirty = true;\n    }\n  }\n  if (styleCommandsNeededDirty) {\n    updateStyleCommandsNeeded(model);\n  }\n}\nfunction updateStyleCommandsNeeded(model) {\n  const featureTable = model.featureTables[model.featureTableId];\n  model._styleCommandsNeeded = StyleCommandsNeeded.getStyleCommandsNeeded(featureTable.featuresLength, featureTable.batchTexture.translucentFeaturesLength);\n}\nfunction updatePointCloudShading(model) {\n  const pointCloudShading = model.pointCloudShading;\n\n  // Check if the shader needs to be updated for point cloud attenuation\n  // settings.\n  if (pointCloudShading.attenuation !== model._attenuation) {\n    model.resetDrawCommands();\n    model._attenuation = pointCloudShading.attenuation;\n  }\n  if (pointCloudShading.backFaceCulling !== model._pointCloudBackFaceCulling) {\n    model.resetDrawCommands();\n    model._pointCloudBackFaceCulling = pointCloudShading.backFaceCulling;\n  }\n}\nfunction updateSilhouette(model, frameState) {\n  if (model._silhouetteDirty) {\n    // Only rebuild draw commands if silhouettes are supported in the first place.\n    if (supportsSilhouettes(frameState)) {\n      model.resetDrawCommands();\n    }\n    model._silhouetteDirty = false;\n  }\n}\nfunction updateSkipLevelOfDetail(model, frameState) {\n  const skipLevelOfDetail = model.hasSkipLevelOfDetail(frameState);\n  if (skipLevelOfDetail !== model._skipLevelOfDetail) {\n    model.resetDrawCommands();\n    model._skipLevelOfDetail = skipLevelOfDetail;\n  }\n}\nfunction updateClippingPlanes(model, frameState) {\n  // Update the clipping planes collection / state for this model to detect any changes.\n  let currentClippingPlanesState = 0;\n  if (model.isClippingEnabled()) {\n    if (model._clippingPlanes.owner === model) {\n      model._clippingPlanes.update(frameState);\n    }\n    currentClippingPlanesState = model._clippingPlanes.clippingPlanesState;\n  }\n  if (currentClippingPlanesState !== model._clippingPlanesState) {\n    model.resetDrawCommands();\n    model._clippingPlanesState = currentClippingPlanesState;\n  }\n}\nfunction updateClippingPolygons(model, frameState) {\n  // Update the clipping polygon collection / state for this model to detect any changes.\n  let currentClippingPolygonsState = 0;\n  if (model.isClippingPolygonsEnabled()) {\n    if (model._clippingPolygons.owner === model) {\n      model._clippingPolygons.update(frameState);\n      model._clippingPolygons.queueCommands(frameState);\n    }\n    currentClippingPolygonsState = model._clippingPolygons.clippingPolygonsState;\n  }\n  if (currentClippingPolygonsState !== model._clippingPolygonsState) {\n    model.resetDrawCommands();\n    model._clippingPolygonsState = currentClippingPolygonsState;\n  }\n}\nfunction updateSceneMode(model, frameState) {\n  if (frameState.mode !== model._sceneMode) {\n    if (model._projectTo2D) {\n      model.resetDrawCommands();\n    } else {\n      model._updateModelMatrix = true;\n    }\n    model._sceneMode = frameState.mode;\n  }\n}\nfunction updateFog(model, frameState) {\n  const fogRenderable = frameState.fog.enabled && frameState.fog.renderable;\n  if (fogRenderable !== model._fogRenderable) {\n    model.resetDrawCommands();\n    model._fogRenderable = fogRenderable;\n  }\n}\nfunction updateVerticalExaggeration(model, frameState) {\n  if (model.enableVerticalExaggeration) {\n    const verticalExaggerationNeeded = frameState.verticalExaggeration !== 1.0;\n    if (model.hasVerticalExaggeration !== verticalExaggerationNeeded) {\n      model.resetDrawCommands();\n      model._hasVerticalExaggeration = verticalExaggerationNeeded;\n    }\n  } else if (model.hasVerticalExaggeration) {\n    model.resetDrawCommands(); //if verticalExaggeration was on, reset.\n    model._hasVerticalExaggeration = false;\n  }\n}\nfunction buildDrawCommands(model, frameState) {\n  if (!model._drawCommandsBuilt) {\n    model.destroyPipelineResources();\n    model._sceneGraph.buildDrawCommands(frameState);\n    model._drawCommandsBuilt = true;\n  }\n}\nfunction updateModelMatrix(model, frameState) {\n  // This is done without a dirty flag so that the model matrix can be updated in-place\n  // without needing to use a setter.\n  if (!Matrix4.equals(model.modelMatrix, model._modelMatrix)) {\n    //>>includeStart('debug', pragmas.debug);\n    if (frameState.mode !== SceneMode.SCENE3D && model._projectTo2D) {\n      throw new DeveloperError(\"Model.modelMatrix cannot be changed in 2D or Columbus View if projectTo2D is true.\");\n    }\n    //>>includeEnd('debug');\n    model._updateModelMatrix = true;\n    model._modelMatrix = Matrix4.clone(model.modelMatrix, model._modelMatrix);\n  }\n}\nconst scratchPosition = new Cartesian3();\nconst scratchCartographic = new Cartographic();\nfunction updateClamping(model) {\n  if (!model._updateModelMatrix && !model._heightDirty && model._minimumPixelSize === 0.0) {\n    return;\n  }\n  if (defined(model._removeUpdateHeightCallback)) {\n    model._removeUpdateHeightCallback();\n    model._removeUpdateHeightCallback = undefined;\n  }\n  const scene = model._scene;\n  if (!defined(scene) || model.heightReference === HeightReference.NONE) {\n    //>>includeStart('debug', pragmas.debug);\n    if (model.heightReference !== HeightReference.NONE) {\n      throw new DeveloperError(\"Height reference is not supported without a scene.\");\n    }\n    //>>includeEnd('debug');\n    model._clampedModelMatrix = undefined;\n    return;\n  }\n  const ellipsoid = defaultValue(scene.ellipsoid, Ellipsoid.default);\n\n  // Compute cartographic position so we don't recompute every update\n  const modelMatrix = model.modelMatrix;\n  scratchPosition.x = modelMatrix[12];\n  scratchPosition.y = modelMatrix[13];\n  scratchPosition.z = modelMatrix[14];\n  const cartoPosition = ellipsoid.cartesianToCartographic(scratchPosition);\n  if (!defined(model._clampedModelMatrix)) {\n    model._clampedModelMatrix = Matrix4.clone(modelMatrix, new Matrix4());\n  }\n\n  // Install callback to handle updating of terrain tiles\n  model._removeUpdateHeightCallback = scene.updateHeight(cartoPosition, getUpdateHeightCallback(model, ellipsoid, cartoPosition), model.heightReference);\n\n  // Set the correct height now\n  const height = scene.getHeight(cartoPosition, model.heightReference);\n  if (defined(height)) {\n    // Get callback with cartoPosition being the non-clamped position\n    const callback = getUpdateHeightCallback(model, ellipsoid, cartoPosition);\n\n    // Compute the clamped cartesian and call updateHeight callback\n    Cartographic.clone(cartoPosition, scratchCartographic);\n    scratchCartographic.height = height;\n    callback(scratchCartographic);\n  }\n  model._heightDirty = false;\n  model._updateModelMatrix = true;\n}\nfunction updateBoundingSphereAndScale(model, frameState) {\n  if (!model._updateModelMatrix && model._minimumPixelSize === 0.0) {\n    return;\n  }\n  const modelMatrix = defined(model._clampedModelMatrix) ? model._clampedModelMatrix : model.modelMatrix;\n  updateBoundingSphere(model, modelMatrix);\n  updateComputedScale(model, modelMatrix, frameState);\n}\nfunction updateBoundingSphere(model, modelMatrix) {\n  model._clampedScale = defined(model._maximumScale) ? Math.min(model._scale, model._maximumScale) : model._scale;\n  model._boundingSphere.center = Cartesian3.multiplyByScalar(model._sceneGraph.boundingSphere.center, model._clampedScale, model._boundingSphere.center);\n  model._boundingSphere.radius = model._initialRadius * model._clampedScale;\n  model._boundingSphere = BoundingSphere.transform(model._boundingSphere, modelMatrix, model._boundingSphere);\n}\nfunction updateComputedScale(model, modelMatrix, frameState) {\n  let scale = model.scale;\n  if (model.minimumPixelSize !== 0.0 && !model._projectTo2D) {\n    // Compute size of bounding sphere in pixels\n    const context = frameState.context;\n    const maxPixelSize = Math.max(context.drawingBufferWidth, context.drawingBufferHeight);\n    Matrix4.getTranslation(modelMatrix, scratchPosition);\n    if (model._sceneMode !== SceneMode.SCENE3D) {\n      SceneTransforms.computeActualEllipsoidPosition(frameState, scratchPosition, scratchPosition);\n    }\n    const radius = model._boundingSphere.radius;\n    const metersPerPixel = scaleInPixels(scratchPosition, radius, frameState);\n\n    // metersPerPixel is always > 0.0\n    const pixelsPerMeter = 1.0 / metersPerPixel;\n    const diameterInPixels = Math.min(pixelsPerMeter * (2.0 * radius), maxPixelSize);\n\n    // Maintain model's minimum pixel size\n    if (diameterInPixels < model.minimumPixelSize) {\n      scale = model.minimumPixelSize * metersPerPixel / (2.0 * model._initialRadius);\n    }\n  }\n  model._computedScale = defined(model.maximumScale) ? Math.min(model.maximumScale, scale) : scale;\n}\nfunction updatePickIds(model) {\n  if (!model._idDirty) {\n    return;\n  }\n  model._idDirty = false;\n  const id = model._id;\n  const pickIds = model._pickIds;\n  const length = pickIds.length;\n  for (let i = 0; i < length; ++i) {\n    pickIds[i].object.id = id;\n  }\n}\n\n// Matrix3 is a row-major constructor.\n// The same constructor in GLSL will produce the transpose of this.\nconst yUpToZUp = new Matrix3(1, 0, 0, 0, 0, 1, 0, -1, 0);\nfunction updateReferenceMatrices(model, frameState) {\n  const modelMatrix = defined(model._clampedModelMatrix) ? model._clampedModelMatrix : model.modelMatrix;\n  const referenceMatrix = defaultValue(model.referenceMatrix, modelMatrix);\n  const context = frameState.context;\n  let iblReferenceFrameMatrix3 = scratchIBLReferenceFrameMatrix3;\n  let iblReferenceFrameMatrix4 = scratchIBLReferenceFrameMatrix4;\n  iblReferenceFrameMatrix4 = Matrix4.multiply(context.uniformState.view3D, referenceMatrix, iblReferenceFrameMatrix4);\n  iblReferenceFrameMatrix3 = Matrix4.getRotation(iblReferenceFrameMatrix4, iblReferenceFrameMatrix3);\n  iblReferenceFrameMatrix3 = Matrix3.transpose(iblReferenceFrameMatrix3, iblReferenceFrameMatrix3);\n  model._iblReferenceFrameMatrix = Matrix3.multiply(yUpToZUp, iblReferenceFrameMatrix3, model._iblReferenceFrameMatrix);\n  if (model.isClippingEnabled()) {\n    let clippingPlanesMatrix = scratchClippingPlanesMatrix;\n    clippingPlanesMatrix = Matrix4.multiply(context.uniformState.view3D, referenceMatrix, clippingPlanesMatrix);\n    clippingPlanesMatrix = Matrix4.multiply(clippingPlanesMatrix, model._clippingPlanes.modelMatrix, clippingPlanesMatrix);\n    model._clippingPlanesMatrix = Matrix4.inverseTranspose(clippingPlanesMatrix, model._clippingPlanesMatrix);\n  }\n}\nfunction updateSceneGraph(model, frameState) {\n  const sceneGraph = model._sceneGraph;\n  if (model._updateModelMatrix || model._minimumPixelSize !== 0.0) {\n    const modelMatrix = defined(model._clampedModelMatrix) ? model._clampedModelMatrix : model.modelMatrix;\n    sceneGraph.updateModelMatrix(modelMatrix, frameState);\n    model._updateModelMatrix = false;\n  }\n  if (model._backFaceCullingDirty) {\n    sceneGraph.updateBackFaceCulling(model._backFaceCulling);\n    model._backFaceCullingDirty = false;\n  }\n  if (model._shadowsDirty) {\n    sceneGraph.updateShadows(model._shadows);\n    model._shadowsDirty = false;\n  }\n  if (model._debugShowBoundingVolumeDirty) {\n    sceneGraph.updateShowBoundingVolume(model._debugShowBoundingVolume);\n    model._debugShowBoundingVolumeDirty = false;\n  }\n  let updateForAnimations = false;\n  // Animations are disabled for classification models.\n  if (!defined(model.classificationType)) {\n    updateForAnimations = model._userAnimationDirty || model._activeAnimations.update(frameState);\n  }\n  sceneGraph.update(frameState, updateForAnimations);\n  model._userAnimationDirty = false;\n}\nfunction updateShowCreditsOnScreen(model) {\n  if (!model._showCreditsOnScreenDirty) {\n    return;\n  }\n  model._showCreditsOnScreenDirty = false;\n  model._credits.length = 0;\n  const showOnScreen = model._showCreditsOnScreen;\n  if (defined(model._credit)) {\n    const credit = Credit.clone(model._credit);\n    credit.showOnScreen = credit.showOnScreen || showOnScreen;\n    model._credits.push(credit);\n  }\n  const resourceCredits = model._resourceCredits;\n  const resourceCreditsLength = resourceCredits.length;\n  for (let i = 0; i < resourceCreditsLength; i++) {\n    const credit = Credit.clone(resourceCredits[i]);\n    credit.showOnScreen = credit.showOnScreen || showOnScreen;\n    model._credits.push(credit);\n  }\n  const gltfCredits = model._gltfCredits;\n  const gltfCreditsLength = gltfCredits.length;\n  for (let i = 0; i < gltfCreditsLength; i++) {\n    const credit = Credit.clone(gltfCredits[i]);\n    credit.showOnScreen = credit.showOnScreen || showOnScreen;\n    model._credits.push(credit);\n  }\n}\nfunction submitDrawCommands(model, frameState) {\n  // Check that show is true after draw commands are built;\n  // we want the user to be able to instantly see the model\n  // when show is set to true.\n\n  const displayConditionPassed = passesDistanceDisplayCondition(model, frameState);\n  const invisible = model.isInvisible();\n  const silhouette = model.hasSilhouette(frameState);\n\n  // If the model is invisible but has a silhouette, it still\n  // needs to draw in order to write to the stencil buffer and\n  // render the silhouette.\n  const showModel = model._show && model._computedScale !== 0 && displayConditionPassed && (!invisible || silhouette);\n  const passes = frameState.passes;\n  const submitCommandsForPass = passes.render || passes.pick && model.allowPicking;\n  if (showModel && !model._ignoreCommands && submitCommandsForPass) {\n    addCreditsToCreditDisplay(model, frameState);\n    model._sceneGraph.pushDrawCommands(frameState);\n  }\n}\nconst scratchBoundingSphere = new BoundingSphere();\nfunction scaleInPixels(positionWC, radius, frameState) {\n  scratchBoundingSphere.center = positionWC;\n  scratchBoundingSphere.radius = radius;\n  return frameState.camera.getPixelSize(scratchBoundingSphere, frameState.context.drawingBufferWidth, frameState.context.drawingBufferHeight);\n}\nconst scratchUpdateHeightCartesian = new Cartesian3();\nfunction getUpdateHeightCallback(model, ellipsoid, originalPostition) {\n  return function (clampedPosition) {\n    if (isHeightReferenceRelative(model.heightReference)) {\n      clampedPosition.height += originalPostition.height;\n    }\n    ellipsoid.cartographicToCartesian(clampedPosition, scratchUpdateHeightCartesian);\n    const clampedModelMatrix = model._clampedModelMatrix;\n\n    // Modify clamped model matrix to use new height\n    Matrix4.clone(model.modelMatrix, clampedModelMatrix);\n    clampedModelMatrix[12] = scratchUpdateHeightCartesian.x;\n    clampedModelMatrix[13] = scratchUpdateHeightCartesian.y;\n    clampedModelMatrix[14] = scratchUpdateHeightCartesian.z;\n    model._heightDirty = true;\n  };\n}\nconst scratchDisplayConditionCartesian = new Cartesian3();\nfunction passesDistanceDisplayCondition(model, frameState) {\n  const condition = model.distanceDisplayCondition;\n  if (!defined(condition)) {\n    return true;\n  }\n  const nearSquared = condition.near * condition.near;\n  const farSquared = condition.far * condition.far;\n  let distanceSquared;\n  if (frameState.mode === SceneMode.SCENE2D) {\n    const frustum2DWidth = frameState.camera.frustum.right - frameState.camera.frustum.left;\n    const distance = frustum2DWidth * 0.5;\n    distanceSquared = distance * distance;\n  } else {\n    // Distance to center of primitive's reference frame\n    const position = Matrix4.getTranslation(model.modelMatrix, scratchDisplayConditionCartesian);\n\n    // This will project the position if the scene is in Columbus View,\n    // but leave the position as-is in 3D mode.\n    SceneTransforms.computeActualEllipsoidPosition(frameState, position, position);\n    distanceSquared = Cartesian3.distanceSquared(position, frameState.camera.positionWC);\n  }\n  return distanceSquared >= nearSquared && distanceSquared <= farSquared;\n}\nfunction addCreditsToCreditDisplay(model, frameState) {\n  const creditDisplay = frameState.creditDisplay;\n  const credits = model._credits;\n  const creditsLength = credits.length;\n  for (let c = 0; c < creditsLength; c++) {\n    creditDisplay.addCreditToNextFrame(credits[c]);\n  }\n}\n\n/**\n * Gets whether or not the model is translucent based on its assigned model color.\n * If the model color's alpha is equal to zero, then it is considered invisible,\n * not translucent.\n *\n * @returns {boolean} <code>true</code> if the model is translucent, otherwise <code>false</code>.\n * @private\n */\nModel.prototype.isTranslucent = function () {\n  const color = this.color;\n  return defined(color) && color.alpha > 0.0 && color.alpha < 1.0;\n};\n\n/**\n * Gets whether or not the model is invisible, i.e. if the model color's alpha\n * is equal to zero.\n *\n * @returns {boolean} <code>true</code> if the model is invisible, otherwise <code>false</code>.\n * @private\n */\nModel.prototype.isInvisible = function () {\n  const color = this.color;\n  return defined(color) && color.alpha === 0.0;\n};\nfunction supportsSilhouettes(frameState) {\n  return frameState.context.stencilBuffer;\n}\n\n/**\n * Gets whether or not the model has a silhouette. This accounts for whether\n * silhouettes are supported (i.e. the context supports stencil buffers).\n * <p>\n * If the model classifies another model, its silhouette will be disabled.\n * </p>\n *\n * @param {FrameState} The frame state.\n * @returns {boolean} <code>true</code> if the model has silhouettes, otherwise <code>false</code>.\n * @private\n */\nModel.prototype.hasSilhouette = function (frameState) {\n  return supportsSilhouettes(frameState) && this._silhouetteSize > 0.0 && this._silhouetteColor.alpha > 0.0 && !defined(this._classificationType);\n};\n\n/**\n * Gets whether or not the model is part of a tileset that uses the\n * skipLevelOfDetail optimization. This accounts for whether skipLevelOfDetail\n * is supported (i.e. the context supports stencil buffers).\n *\n * @param {FrameState} frameState The frame state.\n * @returns {boolean} <code>true</code> if the model is part of a tileset that uses the skipLevelOfDetail optimization, <code>false</code> otherwise.\n * @private\n */\nModel.prototype.hasSkipLevelOfDetail = function (frameState) {\n  if (!ModelType.is3DTiles(this.type)) {\n    return false;\n  }\n  const supportsSkipLevelOfDetail = frameState.context.stencilBuffer;\n  const tileset = this._content.tileset;\n  return supportsSkipLevelOfDetail && tileset.isSkippingLevelOfDetail;\n};\n\n/**\n * Gets whether or not clipping planes are enabled for this model.\n *\n * @returns {boolean} <code>true</code> if clipping planes are enabled for this model, <code>false</code>.\n * @private\n */\nModel.prototype.isClippingEnabled = function () {\n  const clippingPlanes = this._clippingPlanes;\n  return defined(clippingPlanes) && clippingPlanes.enabled && clippingPlanes.length !== 0;\n};\n\n/**\n * Find an intersection between a ray and the model surface that was rendered. The ray must be given in world coordinates.\n *\n * @param {Ray} ray The ray to test for intersection.\n * @param {FrameState} frameState The frame state.\n * @param {number} [verticalExaggeration=1.0] A scalar used to exaggerate the height of a position relative to the ellipsoid. If the value is 1.0 there will be no effect.\n * @param {number} [relativeHeight=0.0] The height above the ellipsoid relative to which a position is exaggerated. If the value is 0.0 the position will be exaggerated relative to the ellipsoid surface.\n * @param {Cartesian3|undefined} [result] The intersection or <code>undefined</code> if none was found.\n * @returns {Cartesian3|undefined} The intersection or <code>undefined</code> if none was found.\n *\n * @private\n */\nModel.prototype.pick = function (ray, frameState, verticalExaggeration, relativeHeight, result) {\n  return pickModel(this, ray, frameState, verticalExaggeration, relativeHeight, result);\n};\n\n/**\n * Gets whether or not clipping polygons are enabled for this model.\n *\n * @returns {boolean} <code>true</code> if clipping polygons are enabled for this model, <code>false</code>.\n * @private\n */\nModel.prototype.isClippingPolygonsEnabled = function () {\n  const clippingPolygons = this._clippingPolygons;\n  return defined(clippingPolygons) && clippingPolygons.enabled && clippingPolygons.length !== 0;\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <br /><br />\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n *\n * @returns {boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n *\n * @see Model#destroy\n */\nModel.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n * <br /><br />\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * model = model && model.destroy();\n *\n * @see Model#isDestroyed\n */\nModel.prototype.destroy = function () {\n  const loader = this._loader;\n  if (defined(loader)) {\n    loader.destroy();\n  }\n  const featureTables = this._featureTables;\n  if (defined(featureTables)) {\n    const length = featureTables.length;\n    for (let i = 0; i < length; i++) {\n      featureTables[i].destroy();\n    }\n  }\n  this.destroyPipelineResources();\n  this.destroyModelResources();\n\n  // Remove callbacks for height reference behavior.\n  if (defined(this._removeUpdateHeightCallback)) {\n    this._removeUpdateHeightCallback();\n    this._removeUpdateHeightCallback = undefined;\n  }\n  if (defined(this._terrainProviderChangedCallback)) {\n    this._terrainProviderChangedCallback();\n    this._terrainProviderChangedCallback = undefined;\n  }\n\n  // Only destroy the ClippingPlaneCollection if this is the owner.\n  const clippingPlaneCollection = this._clippingPlanes;\n  if (defined(clippingPlaneCollection) && !clippingPlaneCollection.isDestroyed() && clippingPlaneCollection.owner === this) {\n    clippingPlaneCollection.destroy();\n  }\n  this._clippingPlanes = undefined;\n\n  // Only destroy the ClippingPolygonCollection if this is the owner.\n  const clippingPolygonCollection = this._clippingPolygons;\n  if (defined(clippingPolygonCollection) && !clippingPolygonCollection.isDestroyed() && clippingPolygonCollection.owner === this) {\n    clippingPolygonCollection.destroy();\n  }\n  this._clippingPolygons = undefined;\n\n  // Only destroy the ImageBasedLighting if this is the owner.\n  if (this._shouldDestroyImageBasedLighting && !this._imageBasedLighting.isDestroyed()) {\n    this._imageBasedLighting.destroy();\n  }\n  this._imageBasedLighting = undefined;\n\n  // Only destroy the environment map manager if this is the owner.\n  const environmentMapManager = this._environmentMapManager;\n  if (!environmentMapManager.isDestroyed() && environmentMapManager.owner === this) {\n    environmentMapManager.destroy();\n  }\n  this._environmentMapManager = undefined;\n  destroyObject(this);\n};\n\n/**\n * Destroys resources generated in the pipeline stages\n * that must be destroyed when draw commands are rebuilt.\n * @private\n */\nModel.prototype.destroyPipelineResources = function () {\n  const resources = this._pipelineResources;\n  for (let i = 0; i < resources.length; i++) {\n    resources[i].destroy();\n  }\n  this._pipelineResources.length = 0;\n  this._pickIds.length = 0;\n};\n\n/**\n * Destroys resources generated in the pipeline stages\n * that exist for the lifetime of the model.\n * @private\n */\nModel.prototype.destroyModelResources = function () {\n  const resources = this._modelResources;\n  for (let i = 0; i < resources.length; i++) {\n    resources[i].destroy();\n  }\n  this._modelResources.length = 0;\n};\n\n/**\n * <p>\n * Asynchronously creates a model from a glTF asset. This function returns a promise that resolves when the model is ready to render, i.e., when the external binary, image,\n * and shader files are downloaded and the WebGL resources are created.\n * </p>\n * <p>\n * The model can be a traditional glTF asset with a .gltf extension or a Binary glTF using the .glb extension.\n *\n * @param {object} options Object with the following properties:\n * @param {string|Resource} options.url The url to the .gltf or .glb file.\n * @param {string|Resource} [options.basePath=''] The base path that paths in the glTF JSON are relative to.\n * @param {boolean} [options.show=true] Whether or not to render the model.\n * @param {Matrix4} [options.modelMatrix=Matrix4.IDENTITY] The 4x4 transformation matrix that transforms the model from model to world coordinates.\n * @param {number} [options.scale=1.0] A uniform scale applied to this model.\n * @param {boolean} [options.enableVerticalExaggeration=true] If <code>true</code>, the model is exaggerated along the ellipsoid normal when {@link Scene.verticalExaggeration} is set to a value other than <code>1.0</code>.\n * @param {number} [options.minimumPixelSize=0.0] The approximate minimum pixel size of the model regardless of zoom.\n * @param {number} [options.maximumScale] The maximum scale size of a model. An upper limit for minimumPixelSize.\n * @param {object} [options.id] A user-defined object to return when the model is picked with {@link Scene#pick}.\n * @param {boolean} [options.allowPicking=true] When <code>true</code>, each primitive is pickable with {@link Scene#pick}.\n * @param {boolean} [options.incrementallyLoadTextures=true] Determine if textures may continue to stream in after the model is loaded.\n * @param {boolean} [options.asynchronous=true] Determines if model WebGL resource creation will be spread out over several frames or block until completion once all glTF files are loaded.\n * @param {boolean} [options.clampAnimations=true] Determines if the model's animations should hold a pose over frames where no keyframes are specified.\n * @param {ShadowMode} [options.shadows=ShadowMode.ENABLED] Determines whether the model casts or receives shadows from light sources.\n * @param {boolean} [options.releaseGltfJson=false] When true, the glTF JSON is released once the glTF is loaded. This is is especially useful for cases like 3D Tiles, where each .gltf model is unique and caching the glTF JSON is not effective.\n * @param {boolean} [options.debugShowBoundingVolume=false] For debugging only. Draws the bounding sphere for each draw command in the model.\n * @param {boolean} [options.enableDebugWireframe=false] For debugging only. This must be set to true for debugWireframe to work in WebGL1. This cannot be set after the model has loaded.\n * @param {boolean} [options.debugWireframe=false] For debugging only. Draws the model in wireframe. Will only work for WebGL1 if enableDebugWireframe is set to true.\n * @param {boolean} [options.cull=true]  Whether or not to cull the model using frustum/horizon culling. If the model is part of a 3D Tiles tileset, this property will always be false, since the 3D Tiles culling system is used.\n * @param {boolean} [options.opaquePass=Pass.OPAQUE] The pass to use in the {@link DrawCommand} for the opaque portions of the model.\n * @param {Axis} [options.upAxis=Axis.Y] The up-axis of the glTF model.\n * @param {Axis} [options.forwardAxis=Axis.Z] The forward-axis of the glTF model.\n * @param {CustomShader} [options.customShader] A custom shader. This will add user-defined GLSL code to the vertex and fragment shaders. Using custom shaders with a {@link Cesium3DTileStyle} may lead to undefined behavior.\n * @param {Cesium3DTileContent} [options.content] The tile content this model belongs to. This property will be undefined if model is not loaded as part of a tileset.\n * @param {HeightReference} [options.heightReference=HeightReference.NONE] Determines how the model is drawn relative to terrain.\n * @param {Scene} [options.scene] Must be passed in for models that use the height reference property.\n * @param {DistanceDisplayCondition} [options.distanceDisplayCondition] The condition specifying at what distance from the camera that this model will be displayed.\n * @param {Color} [options.color] A color that blends with the model's rendered color.\n * @param {ColorBlendMode} [options.colorBlendMode=ColorBlendMode.HIGHLIGHT] Defines how the color blends with the model.\n * @param {number} [options.colorBlendAmount=0.5] Value used to determine the color strength when the <code>colorBlendMode</code> is <code>MIX</code>. A value of 0.0 results in the model's rendered color while a value of 1.0 results in a solid color, with any value in-between resulting in a mix of the two.\n * @param {Color} [options.silhouetteColor=Color.RED] The silhouette color. If more than 256 models have silhouettes enabled, there is a small chance that overlapping models will have minor artifacts.\n * @param {number} [options.silhouetteSize=0.0] The size of the silhouette in pixels.\n * @param {boolean} [options.enableShowOutline=true] Whether to enable outlines for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. This can be set false to avoid post-processing geometry at load time. When false, the showOutlines and outlineColor options are ignored.\n * @param {boolean} [options.showOutline=true] Whether to display the outline for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. When true, outlines are displayed. When false, outlines are not displayed.\n * @param {Color} [options.outlineColor=Color.BLACK] The color to use when rendering outlines.\n * @param {ClippingPlaneCollection} [options.clippingPlanes] The {@link ClippingPlaneCollection} used to selectively disable rendering the model.\n * @param {ClippingPolygonCollection} [options.clippingPolygons] The {@link ClippingPolygonCollection} used to selectively disable rendering the model.\n * @param {Cartesian3} [options.lightColor] The light color when shading the model. When <code>undefined</code> the scene's light color is used instead.\n * @param {ImageBasedLighting} [options.imageBasedLighting] The properties for managing image-based lighting on this model.\n * @param {DynamicEnvironmentMapManager.ConstructorOptions} [options.environmentMapOptions] The properties for managing dynamic environment maps on this model.\n * @param {boolean} [options.backFaceCulling=true] Whether to cull back-facing geometry. When true, back face culling is determined by the material's doubleSided property; when false, back face culling is disabled. Back faces are not culled if the model's color is translucent.\n * @param {Credit|string} [options.credit] A credit for the data source, which is displayed on the canvas.\n * @param {boolean} [options.showCreditsOnScreen=false] Whether to display the credits of this model on screen.\n * @param {SplitDirection} [options.splitDirection=SplitDirection.NONE] The {@link SplitDirection} split to apply to this model.\n * @param {boolean} [options.projectTo2D=false] Whether to accurately project the model's positions in 2D. If this is true, the model will be projected accurately to 2D, but it will use more memory to do so. If this is false, the model will use less memory and will still render in 2D / CV mode, but its positions may be inaccurate. This disables minimumPixelSize and prevents future modification to the model matrix. This also cannot be set after the model has loaded.\n * @param {boolean} [options.enablePick=false] Whether to allow with CPU picking with <code>pick</code> when not using WebGL 2 or above. If using WebGL 2 or above, this option will be ignored. If using WebGL 1 and this is true, the <code>pick</code> operation will work correctly, but it will use more memory to do so. If running with WebGL 1 and this is false, the model will use less memory, but <code>pick</code> will always return <code>undefined</code>. This cannot be set after the model has loaded.\n * @param {string|number} [options.featureIdLabel=\"featureId_0\"] Label of the feature ID set to use for picking and styling. For EXT_mesh_features, this is the feature ID's label property, or \"featureId_N\" (where N is the index in the featureIds array) when not specified. EXT_feature_metadata did not have a label field, so such feature ID sets are always labeled \"featureId_N\" where N is the index in the list of all feature Ids, where feature ID attributes are listed before feature ID textures. If featureIdLabel is an integer N, it is converted to the string \"featureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @param {string|number} [options.instanceFeatureIdLabel=\"instanceFeatureId_0\"] Label of the instance feature ID set used for picking and styling. If instanceFeatureIdLabel is set to an integer N, it is converted to the string \"instanceFeatureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @param {object} [options.pointCloudShading] Options for constructing a {@link PointCloudShading} object to control point attenuation and lighting.\n * @param {ClassificationType} [options.classificationType] Determines whether terrain, 3D Tiles or both will be classified by this model. This cannot be set after the model has loaded.\n * @param {Model.GltfCallback} [options.gltfCallback] A function that is called with the loaded gltf object once loaded.\n *\n * @returns {Promise<Model>} A promise that resolves to the created model when it is ready to render.\n *\n * @exception {RuntimeError} The model failed to load.\n * @exception {RuntimeError} Unsupported glTF version.\n * @exception {RuntimeError} Unsupported glTF Extension\n *\n * @example\n * // Load a model and add it to the scene\n * try {\n *  const model = await Cesium.Model.fromGltfAsync({\n *    url: \"../../SampleData/models/CesiumMan/Cesium_Man.glb\"\n *  });\n *  viewer.scene.primitives.add(model);\n * } catch (error) {\n *  console.log(`Failed to load model. ${error}`);\n * }\n *\n * @example\n * // Position a model with modelMatrix and display it with a minimum size of 128 pixels\n * const position = Cesium.Cartesian3.fromDegrees(\n *   -123.0744619,\n *   44.0503706,\n *   5000.0\n * );\n * const headingPositionRoll = new Cesium.HeadingPitchRoll();\n * const fixedFrameTransform = Cesium.Transforms.localFrameToFixedFrameGenerator(\n *   \"north\",\n *   \"west\"\n * );\n * try {\n *  const model = await Cesium.Model.fromGltfAsync({\n *    url: \"../../SampleData/models/CesiumAir/Cesium_Air.glb\",\n *    modelMatrix: Cesium.Transforms.headingPitchRollToFixedFrame(\n *      position,\n *      headingPositionRoll,\n *      Cesium.Ellipsoid.WGS84,\n *      fixedFrameTransform\n *    ),\n *    minimumPixelSize: 128,\n *  });\n *  viewer.scene.primitives.add(model);\n * } catch (error) {\n *  console.log(`Failed to load model. ${error}`);\n * }\n *\n * @example\n * // Load a model and play the last animation at half speed\n * let animations;\n * try {\n *  const model = await Cesium.Model.fromGltfAsync({\n *    url: \"../../SampleData/models/CesiumMan/Cesium_Man.glb\",\n *    gltfCallback: gltf => {\n *      animations = gltf.animations\n *    }\n *  });\n *  viewer.scene.primitives.add(model);\n *  model.readyEvent.addEventListener(() => {\n *    model.activeAnimations.add({\n *      index: animations.length - 1,\n *      loop: Cesium.ModelAnimationLoop.REPEAT,\n *      multiplier: 0.5,\n *    });\n *  });\n * } catch (error) {\n *  console.log(`Failed to load model. ${error}`);\n * }\n */\nModel.fromGltfAsync = async function (options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n  //>>includeStart('debug', pragmas.debug);\n  if (!defined(options.url) && !defined(options.gltf)) {\n    throw new DeveloperError(\"options.url is required.\");\n  }\n  //>>includeEnd('debug');\n\n  // options.gltf is used internally for 3D Tiles. It can be a Resource, a URL\n  // to a glTF/glb file, a binary glTF buffer, or a JSON object containing the\n  // glTF contents.\n  const gltf = defaultValue(options.url, options.gltf);\n  const loaderOptions = {\n    releaseGltfJson: options.releaseGltfJson,\n    asynchronous: options.asynchronous,\n    incrementallyLoadTextures: options.incrementallyLoadTextures,\n    upAxis: options.upAxis,\n    forwardAxis: options.forwardAxis,\n    loadAttributesFor2D: options.projectTo2D,\n    enablePick: options.enablePick,\n    loadIndicesForWireframe: options.enableDebugWireframe,\n    loadPrimitiveOutline: options.enableShowOutline,\n    loadForClassification: defined(options.classificationType)\n  };\n  const basePath = defaultValue(options.basePath, \"\");\n  const baseResource = Resource.createIfNeeded(basePath);\n  if (defined(gltf.asset)) {\n    loaderOptions.gltfJson = gltf;\n    loaderOptions.baseResource = baseResource;\n    loaderOptions.gltfResource = baseResource;\n  } else if (gltf instanceof Uint8Array) {\n    loaderOptions.typedArray = gltf;\n    loaderOptions.baseResource = baseResource;\n    loaderOptions.gltfResource = baseResource;\n  } else {\n    loaderOptions.gltfResource = Resource.createIfNeeded(gltf);\n  }\n  const loader = new GltfLoader(loaderOptions);\n  const is3DTiles = defined(options.content);\n  const type = is3DTiles ? ModelType.TILE_GLTF : ModelType.GLTF;\n  const resource = loaderOptions.gltfResource;\n  const modelOptions = makeModelOptions(loader, type, options);\n  modelOptions.resource = resource;\n  modelOptions.environmentMapOptions = options.environmentMapOptions;\n  try {\n    // This load the gltf JSON and ensures the gltf is valid\n    // Further resource loading is handled synchronously in loader.process(), and requires\n    // hooking into model's update() as the frameState is needed\n    await loader.load();\n  } catch (error) {\n    loader.destroy();\n    throw ModelUtility.getError(\"model\", resource, error);\n  }\n  const gltfCallback = options.gltfCallback;\n  if (defined(gltfCallback)) {\n    //>>includeStart('debug', pragmas.debug);\n    Check.typeOf.func(\"options.gltfCallback\", gltfCallback);\n    //>>includeEnd('debug');\n\n    gltfCallback(loader.gltfJson);\n  }\n  const model = new Model(modelOptions);\n  const resourceCredits = model._resource.credits;\n  if (defined(resourceCredits)) {\n    const length = resourceCredits.length;\n    for (let i = 0; i < length; i++) {\n      model._resourceCredits.push(Credit.clone(resourceCredits[i]));\n    }\n  }\n  return model;\n};\n\n/*\n * @private\n */\nModel.fromB3dm = async function (options) {\n  const loaderOptions = {\n    b3dmResource: options.resource,\n    arrayBuffer: options.arrayBuffer,\n    byteOffset: options.byteOffset,\n    releaseGltfJson: options.releaseGltfJson,\n    asynchronous: options.asynchronous,\n    incrementallyLoadTextures: options.incrementallyLoadTextures,\n    upAxis: options.upAxis,\n    forwardAxis: options.forwardAxis,\n    loadAttributesFor2D: options.projectTo2D,\n    enablePick: options.enablePick,\n    loadIndicesForWireframe: options.enableDebugWireframe,\n    loadPrimitiveOutline: options.enableShowOutline,\n    loadForClassification: defined(options.classificationType)\n  };\n  const loader = new B3dmLoader(loaderOptions);\n  try {\n    await loader.load();\n    const modelOptions = makeModelOptions(loader, ModelType.TILE_B3DM, options);\n    const model = new Model(modelOptions);\n    return model;\n  } catch (error) {\n    loader.destroy();\n    throw error;\n  }\n};\n\n/**\n * @private\n */\nModel.fromPnts = async function (options) {\n  const loaderOptions = {\n    arrayBuffer: options.arrayBuffer,\n    byteOffset: options.byteOffset,\n    loadAttributesFor2D: options.projectTo2D\n  };\n  const loader = new PntsLoader(loaderOptions);\n  try {\n    await loader.load();\n    const modelOptions = makeModelOptions(loader, ModelType.TILE_PNTS, options);\n    const model = new Model(modelOptions);\n    return model;\n  } catch (error) {\n    loader.destroy();\n    throw error;\n  }\n};\n\n/*\n * @private\n */\nModel.fromI3dm = async function (options) {\n  const loaderOptions = {\n    i3dmResource: options.resource,\n    arrayBuffer: options.arrayBuffer,\n    byteOffset: options.byteOffset,\n    releaseGltfJson: options.releaseGltfJson,\n    asynchronous: options.asynchronous,\n    incrementallyLoadTextures: options.incrementallyLoadTextures,\n    upAxis: options.upAxis,\n    forwardAxis: options.forwardAxis,\n    loadAttributesFor2D: options.projectTo2D,\n    enablePick: options.enablePick,\n    loadIndicesForWireframe: options.enableDebugWireframe,\n    loadPrimitiveOutline: options.enableShowOutline\n  };\n  const loader = new I3dmLoader(loaderOptions);\n  try {\n    await loader.load();\n    const modelOptions = makeModelOptions(loader, ModelType.TILE_I3DM, options);\n    const model = new Model(modelOptions);\n    return model;\n  } catch (error) {\n    loader.destroy();\n    throw error;\n  }\n};\n\n/*\n * @private\n */\nModel.fromGeoJson = async function (options) {\n  const loaderOptions = {\n    geoJson: options.geoJson\n  };\n  const loader = new GeoJsonLoader(loaderOptions);\n  const modelOptions = makeModelOptions(loader, ModelType.TILE_GEOJSON, options);\n  const model = new Model(modelOptions);\n  return model;\n};\nconst scratchColor = new Color();\n\n/**\n * @private\n */\nModel.prototype.applyColorAndShow = function (style) {\n  const previousColor = Color.clone(this._color, scratchColor);\n  const hasColorStyle = defined(style) && defined(style.color);\n  const hasShowStyle = defined(style) && defined(style.show);\n  this._color = hasColorStyle ? style.color.evaluateColor(undefined, this._color) : Color.clone(Color.WHITE, this._color);\n  this._show = hasShowStyle ? style.show.evaluate(undefined) : true;\n  if (isColorAlphaDirty(previousColor, this._color)) {\n    this.resetDrawCommands();\n  }\n};\n\n/**\n * @private\n */\nModel.prototype.applyStyle = function (style) {\n  const isPnts = this.type === ModelType.TILE_PNTS;\n  const hasFeatureTable = defined(this.featureTableId) && this.featureTables[this.featureTableId].featuresLength > 0;\n  const propertyAttributes = defined(this.structuralMetadata) ? this.structuralMetadata.propertyAttributes : undefined;\n  const hasPropertyAttributes = defined(propertyAttributes) && defined(propertyAttributes[0]);\n\n  // Point clouds will be styled on the GPU unless they contain a batch table.\n  // That is, CPU styling will not be applied if:\n  // - points have no metadata at all, or\n  // - points have metadata stored as a property attribute\n  if (isPnts && (!hasFeatureTable || hasPropertyAttributes)) {\n    // Commands are rebuilt for point cloud styling since the new style may\n    // contain different shader functions.\n    this.resetDrawCommands();\n    return;\n  }\n\n  // The style is only set by the ModelFeatureTable. If there are no features,\n  // the color and show from the style are directly applied.\n  if (hasFeatureTable) {\n    const featureTable = this.featureTables[this.featureTableId];\n    featureTable.applyStyle(style);\n    updateStyleCommandsNeeded(this, style);\n  } else {\n    this.applyColorAndShow(style);\n    this._styleCommandsNeeded = undefined;\n  }\n};\nfunction makeModelOptions(loader, modelType, options) {\n  return {\n    loader: loader,\n    type: modelType,\n    resource: options.resource,\n    show: options.show,\n    modelMatrix: options.modelMatrix,\n    scale: options.scale,\n    enableVerticalExaggeration: options.enableVerticalExaggeration,\n    minimumPixelSize: options.minimumPixelSize,\n    maximumScale: options.maximumScale,\n    id: options.id,\n    allowPicking: options.allowPicking,\n    clampAnimations: options.clampAnimations,\n    shadows: options.shadows,\n    debugShowBoundingVolume: options.debugShowBoundingVolume,\n    enableDebugWireframe: options.enableDebugWireframe,\n    debugWireframe: options.debugWireframe,\n    cull: options.cull,\n    opaquePass: options.opaquePass,\n    customShader: options.customShader,\n    content: options.content,\n    heightReference: options.heightReference,\n    scene: options.scene,\n    distanceDisplayCondition: options.distanceDisplayCondition,\n    color: options.color,\n    colorBlendAmount: options.colorBlendAmount,\n    colorBlendMode: options.colorBlendMode,\n    silhouetteColor: options.silhouetteColor,\n    silhouetteSize: options.silhouetteSize,\n    enableShowOutline: options.enableShowOutline,\n    showOutline: options.showOutline,\n    outlineColor: options.outlineColor,\n    clippingPlanes: options.clippingPlanes,\n    clippingPolygons: options.clippingPolygons,\n    lightColor: options.lightColor,\n    imageBasedLighting: options.imageBasedLighting,\n    backFaceCulling: options.backFaceCulling,\n    credit: options.credit,\n    showCreditsOnScreen: options.showCreditsOnScreen,\n    splitDirection: options.splitDirection,\n    projectTo2D: options.projectTo2D,\n    enablePick: options.enablePick,\n    featureIdLabel: options.featureIdLabel,\n    instanceFeatureIdLabel: options.instanceFeatureIdLabel,\n    pointCloudShading: options.pointCloudShading,\n    classificationType: options.classificationType,\n    pickObject: options.pickObject\n  };\n}\n\n/**\n * Interface for the function that is called with the loaded gltf object once loaded.\n * @callback Model.GltfCallback\n *\n * @param {object} gltf The gltf object\n */\n\nexport default Model;","map":{"version":3,"names":["BoundingSphere","Cartesian3","Cartographic","Check","Credit","Color","defined","defaultValue","DeveloperError","destroyObject","DistanceDisplayCondition","Ellipsoid","Event","Matrix3","Matrix4","Resource","RuntimeError","Pass","ClippingPlaneCollection","ClippingPolygonCollection","DynamicEnvironmentMapManager","ColorBlendMode","GltfLoader","HeightReference","isHeightReferenceRelative","ImageBasedLighting","PointCloudShading","SceneMode","SceneTransforms","ShadowMode","SplitDirection","B3dmLoader","GeoJsonLoader","I3dmLoader","ModelAnimationCollection","ModelFeatureTable","ModelSceneGraph","ModelStatistics","ModelType","ModelUtility","oneTimeWarning","PntsLoader","StyleCommandsNeeded","pickModel","Model","options","EMPTY_OBJECT","typeOf","object","loader","resource","_loader","_resource","type","GLTF","modelMatrix","clone","IDENTITY","_modelMatrix","_scale","scale","_minimumPixelSize","minimumPixelSize","_maximumScale","maximumScale","_clampedScale","Math","min","_computedScale","_updateModelMatrix","referenceMatrix","undefined","_iblReferenceFrameMatrix","_resourcesLoaded","_drawCommandsBuilt","_ready","_customShader","customShader","_content","content","_texturesLoaded","_defaultTexture","_activeAnimations","_clampAnimations","clampAnimations","_userAnimationDirty","_id","id","_idDirty","_color","color","_colorBlendMode","colorBlendMode","HIGHLIGHT","_colorBlendAmount","colorBlendAmount","silhouetteColor","RED","_silhouetteColor","_silhouetteSize","silhouetteSize","_silhouetteDirty","_silhouetteId","_cull","cull","_opaquePass","opaquePass","OPAQUE","_allowPicking","allowPicking","_show","show","_style","_styleDirty","_styleCommandsNeeded","featureIdLabel","_featureIdLabel","instanceFeatureIdLabel","_instanceFeatureIdLabel","_featureTables","_featureTableId","_featureTableIdDirty","_pipelineResources","_modelResources","_pickIds","_boundingSphere","_initialRadius","_heightReference","heightReference","NONE","_heightDirty","_removeUpdateHeightCallback","_enableVerticalExaggeration","enableVerticalExaggeration","_hasVerticalExaggeration","_clampedModelMatrix","scene","terrainProviderChanged","_terrainProviderChangedCallback","addEventListener","_scene","_distanceDisplayCondition","distanceDisplayCondition","pointCloudShading","_pointCloudShading","_attenuation","attenuation","_pointCloudBackFaceCulling","backFaceCulling","clippingPlanes","owner","setOwner","_clippingPlanes","_clippingPlanesState","_clippingPlanesMatrix","clippingPolygons","_clippingPolygons","_clippingPolygonsState","_lightColor","lightColor","_imageBasedLighting","imageBasedLighting","_shouldDestroyImageBasedLighting","_environmentMapManager","environmentMapManager","environmentMapOptions","_backFaceCulling","_backFaceCullingDirty","_shadows","shadows","ENABLED","_shadowsDirty","_debugShowBoundingVolumeDirty","_debugShowBoundingVolume","debugShowBoundingVolume","_enableDebugWireframe","enableDebugWireframe","_enableShowOutline","enableShowOutline","_debugWireframe","debugWireframe","credit","_credits","_credit","_resourceCredits","_gltfCredits","_showCreditsOnScreen","showCreditsOnScreen","_showCreditsOnScreenDirty","_splitDirection","splitDirection","showOutline","outlineColor","BLACK","_classificationType","classificationType","_statistics","_sceneMode","_projectTo2D","projectTo2D","_enablePick","enablePick","_fogRenderable","_skipLevelOfDetail","_ignoreCommands","ignoreCommands","_errorEvent","_readyEvent","_texturesReadyEvent","_sceneGraph","_nodesByName","pickObject","handleError","model","error","numberOfListeners","raiseEvent","console","log","createModelFeatureTables","structuralMetadata","featureTables","propertyTables","length","i","propertyTable","modelFeatureTable","push","selectFeatureTableId","components","j","featureIdAttribute","node","nodes","instances","getFeatureIdsByLabel","featureIds","propertyTableId","primitives","primitive","isColorAlphaDirty","currentColor","previousColor","currentAlpha","alpha","previousAlpha","floor","ceil","Object","defineProperties","prototype","ready","get","errorEvent","readyEvent","incrementallyLoadTextures","texturesReadyEvent","statistics","activeAnimations","set","value","resetDrawCommands","sceneGraph","far","near","featureTableId","style","equals","alphaDirty","currentSize","sizeDirty","boundingSphere","updateBoundingSphere","string","hasVerticalExaggeration","isDestroyed","destroy","computedScale","pickIds","styleCommandsNeeded","getNode","name","setArticulationStage","articulationStageKey","number","applyArticulations","getExtension","extensionName","extensions","makeStyleDirty","scratchIBLReferenceFrameMatrix4","scratchIBLReferenceFrameMatrix3","scratchClippingPlanesMatrix","update","frameState","finishedProcessing","processLoader","runtimeError","getError","updateCustomShader","updateEnvironmentMap","updateImageBasedLighting","isUnloaded","_rejectLoad","propertyTableCount","modelComponents","asset","credits","mode","MORPHING","updateFeatureTableId","updateStyle","updateFeatureTables","updatePointCloudShading","updateSilhouette","updateSkipLevelOfDetail","updateClippingPlanes","updateClippingPolygons","updateSceneMode","updateFog","updateVerticalExaggeration","context","defaultTexture","buildDrawCommands","updateModelMatrix","updateClamping","updateBoundingSphereAndScale","updateReferenceMatrices","afterRender","texturesLoaded","updatePickIds","updateSceneGraph","updateShowCreditsOnScreen","submitDrawCommands","process","picking","passes","pick","pickVoxel","position","center","shouldUpdate","sphericalHarmonicCoefficients","specularEnvironmentMaps","shouldRegenerateShaders","applyStyle","styleCommandsNeededDirty","updateStyleCommandsNeeded","featureTable","getStyleCommandsNeeded","featuresLength","batchTexture","translucentFeaturesLength","supportsSilhouettes","skipLevelOfDetail","hasSkipLevelOfDetail","currentClippingPlanesState","isClippingEnabled","clippingPlanesState","currentClippingPolygonsState","isClippingPolygonsEnabled","queueCommands","clippingPolygonsState","fogRenderable","fog","enabled","renderable","verticalExaggerationNeeded","verticalExaggeration","destroyPipelineResources","SCENE3D","scratchPosition","scratchCartographic","ellipsoid","default","x","y","z","cartoPosition","cartesianToCartographic","updateHeight","getUpdateHeightCallback","height","getHeight","callback","updateComputedScale","multiplyByScalar","radius","transform","maxPixelSize","max","drawingBufferWidth","drawingBufferHeight","getTranslation","computeActualEllipsoidPosition","metersPerPixel","scaleInPixels","pixelsPerMeter","diameterInPixels","yUpToZUp","iblReferenceFrameMatrix3","iblReferenceFrameMatrix4","multiply","uniformState","view3D","getRotation","transpose","clippingPlanesMatrix","inverseTranspose","updateBackFaceCulling","updateShadows","updateShowBoundingVolume","updateForAnimations","showOnScreen","resourceCredits","resourceCreditsLength","gltfCredits","gltfCreditsLength","displayConditionPassed","passesDistanceDisplayCondition","invisible","isInvisible","silhouette","hasSilhouette","showModel","submitCommandsForPass","render","addCreditsToCreditDisplay","pushDrawCommands","scratchBoundingSphere","positionWC","camera","getPixelSize","scratchUpdateHeightCartesian","originalPostition","clampedPosition","cartographicToCartesian","clampedModelMatrix","scratchDisplayConditionCartesian","condition","nearSquared","farSquared","distanceSquared","SCENE2D","frustum2DWidth","frustum","right","left","distance","creditDisplay","creditsLength","c","addCreditToNextFrame","isTranslucent","stencilBuffer","is3DTiles","supportsSkipLevelOfDetail","tileset","isSkippingLevelOfDetail","ray","relativeHeight","result","destroyModelResources","clippingPlaneCollection","clippingPolygonCollection","resources","fromGltfAsync","url","gltf","loaderOptions","releaseGltfJson","asynchronous","upAxis","forwardAxis","loadAttributesFor2D","loadIndicesForWireframe","loadPrimitiveOutline","loadForClassification","basePath","baseResource","createIfNeeded","gltfJson","gltfResource","Uint8Array","typedArray","TILE_GLTF","modelOptions","makeModelOptions","load","gltfCallback","func","fromB3dm","b3dmResource","arrayBuffer","byteOffset","TILE_B3DM","fromPnts","TILE_PNTS","fromI3dm","i3dmResource","TILE_I3DM","fromGeoJson","geoJson","TILE_GEOJSON","scratchColor","applyColorAndShow","hasColorStyle","hasShowStyle","evaluateColor","WHITE","evaluate","isPnts","hasFeatureTable","propertyAttributes","hasPropertyAttributes","modelType"],"sources":["/Users/mac/Desktop/IWL_Fresh_Start/Lab4gps-Love-In-Action/node_modules/@cesium/engine/Source/Scene/Model/Model.js"],"sourcesContent":["import BoundingSphere from \"../../Core/BoundingSphere.js\";\nimport Cartesian3 from \"../../Core/Cartesian3.js\";\nimport Cartographic from \"../../Core/Cartographic.js\";\nimport Check from \"../../Core/Check.js\";\nimport Credit from \"../../Core/Credit.js\";\nimport Color from \"../../Core/Color.js\";\nimport defined from \"../../Core/defined.js\";\nimport defaultValue from \"../../Core/defaultValue.js\";\nimport DeveloperError from \"../../Core/DeveloperError.js\";\nimport destroyObject from \"../../Core/destroyObject.js\";\nimport DistanceDisplayCondition from \"../../Core/DistanceDisplayCondition.js\";\nimport Ellipsoid from \"../../Core/Ellipsoid.js\";\nimport Event from \"../../Core/Event.js\";\nimport Matrix3 from \"../../Core/Matrix3.js\";\nimport Matrix4 from \"../../Core/Matrix4.js\";\nimport Resource from \"../../Core/Resource.js\";\nimport RuntimeError from \"../../Core/RuntimeError.js\";\nimport Pass from \"../../Renderer/Pass.js\";\nimport ClippingPlaneCollection from \"../ClippingPlaneCollection.js\";\nimport ClippingPolygonCollection from \"../ClippingPolygonCollection.js\";\nimport DynamicEnvironmentMapManager from \"../DynamicEnvironmentMapManager.js\";\nimport ColorBlendMode from \"../ColorBlendMode.js\";\nimport GltfLoader from \"../GltfLoader.js\";\nimport HeightReference, {\n  isHeightReferenceRelative,\n} from \"../HeightReference.js\";\nimport ImageBasedLighting from \"../ImageBasedLighting.js\";\nimport PointCloudShading from \"../PointCloudShading.js\";\nimport SceneMode from \"../SceneMode.js\";\nimport SceneTransforms from \"../SceneTransforms.js\";\nimport ShadowMode from \"../ShadowMode.js\";\nimport SplitDirection from \"../SplitDirection.js\";\nimport B3dmLoader from \"./B3dmLoader.js\";\nimport GeoJsonLoader from \"./GeoJsonLoader.js\";\nimport I3dmLoader from \"./I3dmLoader.js\";\nimport ModelAnimationCollection from \"./ModelAnimationCollection.js\";\nimport ModelFeatureTable from \"./ModelFeatureTable.js\";\nimport ModelSceneGraph from \"./ModelSceneGraph.js\";\nimport ModelStatistics from \"./ModelStatistics.js\";\nimport ModelType from \"./ModelType.js\";\nimport ModelUtility from \"./ModelUtility.js\";\nimport oneTimeWarning from \"../../Core/oneTimeWarning.js\";\nimport PntsLoader from \"./PntsLoader.js\";\nimport StyleCommandsNeeded from \"./StyleCommandsNeeded.js\";\nimport pickModel from \"./pickModel.js\";\n\n/**\n * <div class=\"notice\">\n * To construct a Model, call {@link Model.fromGltfAsync}. Do not call the constructor directly.\n * </div>\n * A 3D model based on glTF, the runtime asset format for WebGL, OpenGL ES, and OpenGL.\n * <p>\n * Cesium supports glTF assets with the following extensions:\n * <ul>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/AGI_articulations/README.md|AGI_articulations}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/master/extensions/1.0/Vendor/CESIUM_RTC/README.md|CESIUM_RTC}\n *  </li>\n *  <li>\n *  {@link https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_instance_features|EXT_instance_features}\n *  </li>\n *  <li>\n *  {@link https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_mesh_features|EXT_mesh_features}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/EXT_mesh_gpu_instancing|EXT_mesh_gpu_instancing}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/EXT_meshopt_compression|EXT_meshopt_compression}\n *  </li>\n *  <li>\n *  {@link https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata|EXT_structural_metadata}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/EXT_texture_webp|EXT_texture_webp}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_draco_mesh_compression/README.md|KHR_draco_mesh_compression}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Archived/KHR_techniques_webgl/README.md|KHR_techniques_webgl}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/main/extensions/1.0/Khronos/KHR_materials_common/README.md|KHR_materials_common}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Archived/KHR_materials_pbrSpecularGlossiness|KHR_materials_pbrSpecularGlossiness}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit/README.md|KHR_materials_unlit}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_mesh_quantization|KHR_mesh_quantization}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_texture_basisu|KHR_texture_basisu}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_texture_transform/README.md|KHR_texture_transform}\n *  </li>\n *  <li>\n *  {@link https://github.com/KhronosGroup/glTF/blob/main/extensions/1.0/Vendor/WEB3D_quantized_attributes/README.md|WEB3D_quantized_attributes}\n *  </li>\n *  <li>\n *  {@link https://nsgreg.nga.mil/csmwg.jsp|NGA_gpm_local (experimental)}\n *  </li>\n * </ul>\n * </p>\n * <p>\n * Note: for models with compressed textures using the KHR_texture_basisu extension, we recommend power of 2 textures in both dimensions\n * for maximum compatibility. This is because some samplers require power of 2 textures ({@link https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL|Using textures in WebGL})\n * and KHR_texture_basisu requires multiple of 4 dimensions ({@link https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_texture_basisu/README.md#additional-requirements|KHR_texture_basisu additional requirements}).\n * </p>\n *\n * @alias Model\n * @internalConstructor\n *\n * @privateParam {ResourceLoader} options.loader The loader used to load resources for this model.\n * @privateParam {ModelType} options.type Type of this model, to distinguish individual glTF files from 3D Tiles internally.\n * @privateParam {object} options Object with the following properties:\n * @privateParam {Resource} options.resource The Resource to the 3D model.\n * @privateParam {boolean} [options.show=true] Whether or not to render the model.\n * @privateParam {Matrix4} [options.modelMatrix=Matrix4.IDENTITY]  The 4x4 transformation matrix that transforms the model from model to world coordinates.\n * @privateParam {number} [options.scale=1.0] A uniform scale applied to this model.\n * @privateParam {boolean} [options.enableVerticalExaggeration=true] If <code>true</code>, the model is exaggerated along the ellipsoid normal when {@link Scene.verticalExaggeration} is set to a value other than <code>1.0</code>.\n * @privateParam {number} [options.minimumPixelSize=0.0] The approximate minimum pixel size of the model regardless of zoom.\n * @privateParam {number} [options.maximumScale] The maximum scale size of a model. An upper limit for minimumPixelSize.\n * @privateParam {object} [options.id] A user-defined object to return when the model is picked with {@link Scene#pick}.\n * @privateParam {boolean} [options.allowPicking=true] When <code>true</code>, each primitive is pickable with {@link Scene#pick}.\n * @privateParam {boolean} [options.clampAnimations=true] Determines if the model's animations should hold a pose over frames where no keyframes are specified.\n * @privateParam {ShadowMode} [options.shadows=ShadowMode.ENABLED] Determines whether the model casts or receives shadows from light sources.\n * @privateParam {boolean} [options.debugShowBoundingVolume=false] For debugging only. Draws the bounding sphere for each draw command in the model.\n * @privateParam {boolean} [options.enableDebugWireframe=false] For debugging only. This must be set to true for debugWireframe to work in WebGL1. This cannot be set after the model has loaded.\n * @privateParam {boolean} [options.debugWireframe=false] For debugging only. Draws the model in wireframe. Will only work for WebGL1 if enableDebugWireframe is set to true.\n * @privateParam {boolean} [options.cull=true]  Whether or not to cull the model using frustum/horizon culling. If the model is part of a 3D Tiles tileset, this property will always be false, since the 3D Tiles culling system is used.\n * @privateParam {boolean} [options.opaquePass=Pass.OPAQUE] The pass to use in the {@link DrawCommand} for the opaque portions of the model.\n * @privateParam {CustomShader} [options.customShader] A custom shader. This will add user-defined GLSL code to the vertex and fragment shaders. Using custom shaders with a {@link Cesium3DTileStyle} may lead to undefined behavior.\n * @privateParam {Cesium3DTileContent} [options.content] The tile content this model belongs to. This property will be undefined if model is not loaded as part of a tileset.\n * @privateParam {HeightReference} [options.heightReference=HeightReference.NONE] Determines how the model is drawn relative to terrain.\n * @privateParam {Scene} [options.scene] Must be passed in for models that use the height reference property.\n * @privateParam {DistanceDisplayCondition} [options.distanceDisplayCondition] The condition specifying at what distance from the camera that this model will be displayed.\n * @privateParam {Color} [options.color] A color that blends with the model's rendered color.\n * @privateParam {ColorBlendMode} [options.colorBlendMode=ColorBlendMode.HIGHLIGHT] Defines how the color blends with the model.\n * @privateParam {number} [options.colorBlendAmount=0.5] Value used to determine the color strength when the <code>colorBlendMode</code> is <code>MIX</code>. A value of 0.0 results in the model's rendered color while a value of 1.0 results in a solid color, with any value in-between resulting in a mix of the two.\n * @privateParam {Color} [options.silhouetteColor=Color.RED] The silhouette color. If more than 256 models have silhouettes enabled, there is a small chance that overlapping models will have minor artifacts.\n * @privateParam {number} [options.silhouetteSize=0.0] The size of the silhouette in pixels.\n * @privateParam {boolean} [options.enableShowOutline=true] Whether to enable outlines for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. This can be set to false to avoid the additional processing of geometry at load time. When false, the showOutlines and outlineColor options are ignored.\n * @privateParam {boolean} [options.showOutline=true] Whether to display the outline for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. When true, outlines are displayed. When false, outlines are not displayed.\n * @privateParam {Color} [options.outlineColor=Color.BLACK] The color to use when rendering outlines.\n * @privateParam {ClippingPlaneCollection} [options.clippingPlanes] The {@link ClippingPlaneCollection} used to selectively disable rendering the model.\n * @privateParam {ClippingPolygonCollection} [options.clippingPolygons] The {@link ClippingPolygonCollection} used to selectively disable rendering the model.\n * @privateParam {Cartesian3} [options.lightColor] The light color when shading the model. When <code>undefined</code> the scene's light color is used instead.\n * @privateParam {ImageBasedLighting} [options.imageBasedLighting] The properties for managing image-based lighting on this model.\n * @privateParam {DynamicEnvironmentMapManager.ConstructorOptions} [options.environmentMapOptions] The properties for managing dynamic environment maps on this model. Affects lighting.\n * @privateParam {boolean} [options.backFaceCulling=true] Whether to cull back-facing geometry. When true, back face culling is determined by the material's doubleSided property; when false, back face culling is disabled. Back faces are not culled if the model's color is translucent.\n * @privateParam {Credit|string} [options.credit] A credit for the data source, which is displayed on the canvas.\n * @privateParam {boolean} [options.showCreditsOnScreen=false] Whether to display the credits of this model on screen.\n * @privateParam {SplitDirection} [options.splitDirection=SplitDirection.NONE] The {@link SplitDirection} split to apply to this model.\n * @privateParam {boolean} [options.projectTo2D=false] Whether to accurately project the model's positions in 2D. If this is true, the model will be projected accurately to 2D, but it will use more memory to do so. If this is false, the model will use less memory and will still render in 2D / CV mode, but its positions may be inaccurate. This disables minimumPixelSize and prevents future modification to the model matrix. This also cannot be set after the model has loaded.\n * @privateParam {boolean} [options.enablePick=false] Whether to allow CPU picking with <code>pick</code> when not using WebGL 2 or above. If using WebGL 2 or above, this option will be ignored. If using WebGL 1 and this is true, the <code>pick</code> operation will work correctly, but it will use more memory to do so. If running with WebGL 1 and this is false, the model will use less memory, but <code>pick</code> will always return <code>undefined</code>. This cannot be set after the model has loaded.\n * @privateParam {string|number} [options.featureIdLabel=\"featureId_0\"] Label of the feature ID set to use for picking and styling. For EXT_mesh_features, this is the feature ID's label property, or \"featureId_N\" (where N is the index in the featureIds array) when not specified. EXT_feature_metadata did not have a label field, so such feature ID sets are always labeled \"featureId_N\" where N is the index in the list of all feature Ids, where feature ID attributes are listed before feature ID textures. If featureIdLabel is an integer N, it is converted to the string \"featureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @privateParam {string|number} [options.instanceFeatureIdLabel=\"instanceFeatureId_0\"] Label of the instance feature ID set used for picking and styling. If instanceFeatureIdLabel is set to an integer N, it is converted to the string \"instanceFeatureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @privateParam {object} [options.pointCloudShading] Options for constructing a {@link PointCloudShading} object to control point attenuation based on geometric error and lighting.\n * @privateParam {ClassificationType} [options.classificationType] Determines whether terrain, 3D Tiles or both will be classified by this model. This cannot be set after the model has loaded.\n *\n *\n * @see Model.fromGltfAsync\n *\n * @demo {@link https://sandcastle.cesium.com/index.html?src=3D%20Models.html|Cesium Sandcastle Models Demo}\n */\nfunction Model(options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.object(\"options.loader\", options.loader);\n  Check.typeOf.object(\"options.resource\", options.resource);\n  //>>includeEnd('debug');\n\n  /**\n   * The loader used to load resources for this model.\n   *\n   * @type {ResourceLoader}\n   * @private\n   */\n  this._loader = options.loader;\n  this._resource = options.resource;\n\n  /**\n   * Type of this model, to distinguish individual glTF files from 3D Tiles\n   * internally.\n   *\n   * @type {ModelType}\n   * @readonly\n   *\n   * @private\n   */\n  this.type = defaultValue(options.type, ModelType.GLTF);\n\n  /**\n   * The 4x4 transformation matrix that transforms the model from model to world coordinates.\n   * When this is the identity matrix, the model is drawn in world coordinates, i.e., Earth's Cartesian WGS84 coordinates.\n   * Local reference frames can be used by providing a different transformation matrix, like that returned\n   * by {@link Transforms.eastNorthUpToFixedFrame}.\n   *\n   * @type {Matrix4}\n\n   * @default {@link Matrix4.IDENTITY}\n   *\n   * @example\n   * const origin = Cesium.Cartesian3.fromDegrees(-95.0, 40.0, 200000.0);\n   * m.modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(origin);\n   */\n  this.modelMatrix = Matrix4.clone(\n    defaultValue(options.modelMatrix, Matrix4.IDENTITY),\n  );\n  this._modelMatrix = Matrix4.clone(this.modelMatrix);\n  this._scale = defaultValue(options.scale, 1.0);\n\n  this._minimumPixelSize = defaultValue(options.minimumPixelSize, 0.0);\n\n  this._maximumScale = options.maximumScale;\n\n  /**\n   * The scale value after being clamped by the maximum scale parameter.\n   * Used to adjust bounding spheres without repeated calculation.\n   *\n   * @type {number}\n   * @private\n   */\n  this._clampedScale = defined(this._maximumScale)\n    ? Math.min(this._scale, this._maximumScale)\n    : this._scale;\n\n  this._computedScale = this._clampedScale;\n\n  /**\n   * Whether or not the ModelSceneGraph should call updateModelMatrix.\n   * This will be true if any of the model matrix, scale, minimum pixel size, or maximum scale are dirty.\n   *\n   * @type {number}\n   * @private\n   */\n  this._updateModelMatrix = false;\n\n  /**\n   * If defined, this matrix is used to transform miscellaneous properties like\n   * clipping planes and image-based lighting instead of the modelMatrix. This is\n   * so that when models are part of a tileset, these properties get transformed\n   * relative to a common reference (such as the root).\n   *\n   * @type {Matrix4}\n   * @private\n   */\n  this.referenceMatrix = undefined;\n  this._iblReferenceFrameMatrix = Matrix3.clone(Matrix3.IDENTITY); // Derived from reference matrix and the current view matrix\n\n  this._resourcesLoaded = false;\n  this._drawCommandsBuilt = false;\n\n  this._ready = false;\n  this._customShader = options.customShader;\n  this._content = options.content;\n\n  this._texturesLoaded = false;\n  this._defaultTexture = undefined;\n\n  this._activeAnimations = new ModelAnimationCollection(this);\n  this._clampAnimations = defaultValue(options.clampAnimations, true);\n\n  // This flag is true when the Cesium API, not a glTF animation, changes\n  // the transform of a node in the model.\n  this._userAnimationDirty = false;\n\n  this._id = options.id;\n  this._idDirty = false;\n\n  this._color = Color.clone(options.color);\n  this._colorBlendMode = defaultValue(\n    options.colorBlendMode,\n    ColorBlendMode.HIGHLIGHT,\n  );\n  this._colorBlendAmount = defaultValue(options.colorBlendAmount, 0.5);\n\n  const silhouetteColor = defaultValue(options.silhouetteColor, Color.RED);\n  this._silhouetteColor = Color.clone(silhouetteColor);\n  this._silhouetteSize = defaultValue(options.silhouetteSize, 0.0);\n  this._silhouetteDirty = false;\n\n  // If silhouettes are used for the model, this will be set to the number\n  // of the stencil buffer used for rendering the silhouette. This is set\n  // by ModelSilhouettePipelineStage, not by Model itself.\n  this._silhouetteId = undefined;\n\n  this._cull = defaultValue(options.cull, true);\n  this._opaquePass = defaultValue(options.opaquePass, Pass.OPAQUE);\n  this._allowPicking = defaultValue(options.allowPicking, true);\n  this._show = defaultValue(options.show, true);\n\n  this._style = undefined;\n  this._styleDirty = false;\n  this._styleCommandsNeeded = undefined;\n\n  let featureIdLabel = defaultValue(options.featureIdLabel, \"featureId_0\");\n  if (typeof featureIdLabel === \"number\") {\n    featureIdLabel = `featureId_${featureIdLabel}`;\n  }\n  this._featureIdLabel = featureIdLabel;\n\n  let instanceFeatureIdLabel = defaultValue(\n    options.instanceFeatureIdLabel,\n    \"instanceFeatureId_0\",\n  );\n  if (typeof instanceFeatureIdLabel === \"number\") {\n    instanceFeatureIdLabel = `instanceFeatureId_${instanceFeatureIdLabel}`;\n  }\n  this._instanceFeatureIdLabel = instanceFeatureIdLabel;\n\n  this._featureTables = [];\n  this._featureTableId = undefined;\n  this._featureTableIdDirty = true;\n\n  // Keeps track of resources that need to be destroyed when the draw commands are reset.\n  this._pipelineResources = [];\n\n  // Keeps track of resources that need to be destroyed when the Model is destroyed.\n  this._modelResources = [];\n\n  // Keeps track of the pick IDs for this model. These are stored and destroyed in the\n  // pipeline resources array; the purpose of this array is to separate them from other\n  // resources and update their ID objects when necessary.\n  this._pickIds = [];\n\n  // The model's bounding sphere and its initial radius are computed\n  // in ModelSceneGraph.\n  this._boundingSphere = new BoundingSphere();\n  this._initialRadius = undefined;\n\n  this._heightReference = defaultValue(\n    options.heightReference,\n    HeightReference.NONE,\n  );\n  this._heightDirty = this._heightReference !== HeightReference.NONE;\n  this._removeUpdateHeightCallback = undefined;\n\n  this._enableVerticalExaggeration = defaultValue(\n    options.enableVerticalExaggeration,\n    true,\n  );\n  this._hasVerticalExaggeration = false;\n\n  this._clampedModelMatrix = undefined; // For use with height reference\n\n  const scene = options.scene;\n  if (defined(scene) && defined(scene.terrainProviderChanged)) {\n    this._terrainProviderChangedCallback =\n      scene.terrainProviderChanged.addEventListener(() => {\n        this._heightDirty = true;\n      });\n  }\n  this._scene = scene;\n\n  this._distanceDisplayCondition = options.distanceDisplayCondition;\n\n  const pointCloudShading = new PointCloudShading(options.pointCloudShading);\n  this._pointCloudShading = pointCloudShading;\n  this._attenuation = pointCloudShading.attenuation;\n  this._pointCloudBackFaceCulling = pointCloudShading.backFaceCulling;\n\n  // If the given clipping planes don't have an owner, make this model its owner.\n  // Otherwise, the clipping planes are passed down from a tileset.\n  const clippingPlanes = options.clippingPlanes;\n  if (defined(clippingPlanes) && clippingPlanes.owner === undefined) {\n    ClippingPlaneCollection.setOwner(clippingPlanes, this, \"_clippingPlanes\");\n  } else {\n    this._clippingPlanes = clippingPlanes;\n  }\n  this._clippingPlanesState = 0; // If this value changes, the shaders need to be regenerated.\n  this._clippingPlanesMatrix = Matrix4.clone(Matrix4.IDENTITY); // Derived from reference matrix and the current view matrix\n\n  // If the given clipping polygons don't have an owner, make this model its owner.\n  // Otherwise, the clipping polygons are passed down from a tileset.\n  const clippingPolygons = options.clippingPolygons;\n  if (defined(clippingPolygons) && clippingPolygons.owner === undefined) {\n    ClippingPolygonCollection.setOwner(\n      clippingPolygons,\n      this,\n      \"_clippingPolygons\",\n    );\n  } else {\n    this._clippingPolygons = clippingPolygons;\n  }\n  this._clippingPolygonsState = 0; // If this value changes, the shaders need to be regenerated.\n\n  this._lightColor = Cartesian3.clone(options.lightColor);\n\n  this._imageBasedLighting = defined(options.imageBasedLighting)\n    ? options.imageBasedLighting\n    : new ImageBasedLighting();\n  this._shouldDestroyImageBasedLighting = !defined(options.imageBasedLighting);\n\n  this._environmentMapManager = undefined;\n  const environmentMapManager = new DynamicEnvironmentMapManager(\n    options.environmentMapOptions,\n  );\n  DynamicEnvironmentMapManager.setOwner(\n    environmentMapManager,\n    this,\n    \"_environmentMapManager\",\n  );\n\n  this._backFaceCulling = defaultValue(options.backFaceCulling, true);\n  this._backFaceCullingDirty = false;\n\n  this._shadows = defaultValue(options.shadows, ShadowMode.ENABLED);\n  this._shadowsDirty = false;\n\n  this._debugShowBoundingVolumeDirty = false;\n  this._debugShowBoundingVolume = defaultValue(\n    options.debugShowBoundingVolume,\n    false,\n  );\n\n  this._enableDebugWireframe = defaultValue(\n    options.enableDebugWireframe,\n    false,\n  );\n  this._enableShowOutline = defaultValue(options.enableShowOutline, true);\n  this._debugWireframe = defaultValue(options.debugWireframe, false);\n\n  // Warning for improper setup of debug wireframe\n  if (\n    this._debugWireframe === true &&\n    this._enableDebugWireframe === false &&\n    this.type === ModelType.GLTF\n  ) {\n    oneTimeWarning(\n      \"model-debug-wireframe-ignored\",\n      \"enableDebugWireframe must be set to true in Model.fromGltf, otherwise debugWireframe will be ignored.\",\n    );\n  }\n\n  // Credit specified by the user.\n  let credit = options.credit;\n  if (typeof credit === \"string\") {\n    credit = new Credit(credit);\n  }\n\n  this._credits = [];\n  this._credit = credit;\n\n  // Credits to be added from the Resource (if it is an IonResource)\n  this._resourceCredits = [];\n\n  // Credits parsed from the glTF by GltfLoader.\n  this._gltfCredits = [];\n\n  this._showCreditsOnScreen = defaultValue(options.showCreditsOnScreen, false);\n  this._showCreditsOnScreenDirty = true;\n\n  this._splitDirection = defaultValue(\n    options.splitDirection,\n    SplitDirection.NONE,\n  );\n\n  this._enableShowOutline = defaultValue(options.enableShowOutline, true);\n\n  /**\n   * Whether to display the outline for models using the\n   * {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension.\n   * When true, outlines are displayed. When false, outlines are not displayed.\n   *\n   * @type {boolean}\n   *\n   * @default true\n   */\n  this.showOutline = defaultValue(options.showOutline, true);\n\n  /**\n   * The color to use when rendering outlines.\n   *\n   * @type {Color}\n   *\n   * @default Color.BLACK\n   */\n  this.outlineColor = defaultValue(options.outlineColor, Color.BLACK);\n\n  this._classificationType = options.classificationType;\n\n  this._statistics = new ModelStatistics();\n\n  this._sceneMode = undefined;\n  this._projectTo2D = defaultValue(options.projectTo2D, false);\n  this._enablePick = defaultValue(options.enablePick, false);\n\n  this._fogRenderable = undefined;\n\n  this._skipLevelOfDetail = false;\n  this._ignoreCommands = defaultValue(options.ignoreCommands, false);\n\n  this._errorEvent = new Event();\n  this._readyEvent = new Event();\n  this._texturesReadyEvent = new Event();\n\n  this._sceneGraph = undefined;\n  this._nodesByName = {}; // Stores the nodes by their names in the glTF.\n\n  /**\n   * Used for picking primitives that wrap a model.\n   *\n   * @private\n   */\n  this.pickObject = options.pickObject;\n}\n\nfunction handleError(model, error) {\n  if (model._errorEvent.numberOfListeners > 0) {\n    model._errorEvent.raiseEvent(error);\n    return;\n  }\n\n  console.log(error);\n}\n\nfunction createModelFeatureTables(model, structuralMetadata) {\n  const featureTables = model._featureTables;\n\n  const propertyTables = structuralMetadata.propertyTables;\n  const length = propertyTables.length;\n  for (let i = 0; i < length; i++) {\n    const propertyTable = propertyTables[i];\n    const modelFeatureTable = new ModelFeatureTable({\n      model: model,\n      propertyTable: propertyTable,\n    });\n\n    featureTables.push(modelFeatureTable);\n  }\n\n  return featureTables;\n}\n\nfunction selectFeatureTableId(components, model) {\n  const featureIdLabel = model._featureIdLabel;\n  const instanceFeatureIdLabel = model._instanceFeatureIdLabel;\n\n  let i, j;\n  let featureIdAttribute;\n\n  let node;\n  // Scan the nodes till we find one with instances, get the feature table ID\n  // if the feature ID attribute of the user-selected index is present.\n  for (i = 0; i < components.nodes.length; i++) {\n    node = components.nodes[i];\n    if (defined(node.instances)) {\n      featureIdAttribute = ModelUtility.getFeatureIdsByLabel(\n        node.instances.featureIds,\n        instanceFeatureIdLabel,\n      );\n      if (\n        defined(featureIdAttribute) &&\n        defined(featureIdAttribute.propertyTableId)\n      ) {\n        return featureIdAttribute.propertyTableId;\n      }\n    }\n  }\n\n  // Scan the primitives till we find one with textures or attributes, get the feature table ID\n  // if the feature ID attribute/texture of the user-selected index is present.\n  for (i = 0; i < components.nodes.length; i++) {\n    node = components.nodes[i];\n    for (j = 0; j < node.primitives.length; j++) {\n      const primitive = node.primitives[j];\n      const featureIds = ModelUtility.getFeatureIdsByLabel(\n        primitive.featureIds,\n        featureIdLabel,\n      );\n\n      if (defined(featureIds)) {\n        return featureIds.propertyTableId;\n      }\n    }\n  }\n\n  // If there's only one feature table, then select it by default. This is\n  // to ensure backwards compatibility with the older handling of b3dm models.\n  if (model._featureTables.length === 1) {\n    return 0;\n  }\n}\n\n/**\n *  Returns whether the alpha state has changed between invisible,\n *  translucent, or opaque.\n *\n *  @private\n */\nfunction isColorAlphaDirty(currentColor, previousColor) {\n  if (!defined(currentColor) && !defined(previousColor)) {\n    return false;\n  }\n\n  if (defined(currentColor) !== defined(previousColor)) {\n    return true;\n  }\n\n  const currentAlpha = currentColor.alpha;\n  const previousAlpha = previousColor.alpha;\n  return (\n    Math.floor(currentAlpha) !== Math.floor(previousAlpha) ||\n    Math.ceil(currentAlpha) !== Math.ceil(previousAlpha)\n  );\n}\n\nObject.defineProperties(Model.prototype, {\n  /**\n   * When <code>true</code>, this model is ready to render, i.e., the external binary, image,\n   * and shader files were downloaded and the WebGL resources were created.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   * @readonly\n   *\n   * @default false\n   */\n  ready: {\n    get: function () {\n      return this._ready;\n    },\n  },\n\n  /**\n   * Gets an event that is raised when the model encounters an asynchronous rendering error.  By subscribing\n   * to the event, you will be notified of the error and can potentially recover from it.  Event listeners\n   * are passed an instance of {@link ModelError}.\n   * @memberof Model.prototype\n   * @type {Event}\n   * @readonly\n   */\n  errorEvent: {\n    get: function () {\n      return this._errorEvent;\n    },\n  },\n\n  /**\n   * Gets an event that is raised when the model is loaded and ready for rendering, i.e. when the external resources\n   * have been downloaded and the WebGL resources are created. Event listeners\n   * are passed an instance of the {@link Model}.\n   *\n   * <p>\n   * If {@link Model.incrementallyLoadTextures} is true, this event will be raised before all textures are loaded and ready for rendering. Subscribe to {@link Model.texturesReadyEvent} to be notified when the textures are ready.\n   * </p>\n   *\n   * @memberof Model.prototype\n   * @type {Event}\n   * @readonly\n   */\n  readyEvent: {\n    get: function () {\n      return this._readyEvent;\n    },\n  },\n\n  /**\n   * Returns true if textures are loaded separately from the other glTF resources.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   * @readonly\n   * @private\n   */\n  incrementallyLoadTextures: {\n    get: function () {\n      return defaultValue(this._loader.incrementallyLoadTextures, false);\n    },\n  },\n\n  /**\n   * Gets an event that, if {@link Model.incrementallyLoadTextures} is true, is raised when the model textures are loaded and ready for rendering, i.e. when the external resources\n   * have been downloaded and the WebGL resources are created. Event listeners\n   * are passed an instance of the {@link Model}.\n   *\n   * @memberof Model.prototype\n   * @type {Event}\n   * @readonly\n   */\n  texturesReadyEvent: {\n    get: function () {\n      return this._texturesReadyEvent;\n    },\n  },\n\n  /**\n   * @private\n   */\n  loader: {\n    get: function () {\n      return this._loader;\n    },\n  },\n\n  /**\n   * Get the estimated memory usage statistics for this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ModelStatistics}\n   * @readonly\n   *\n   * @private\n   */\n  statistics: {\n    get: function () {\n      return this._statistics;\n    },\n  },\n\n  /**\n   * The currently playing glTF animations.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ModelAnimationCollection}\n   * @readonly\n   */\n  activeAnimations: {\n    get: function () {\n      return this._activeAnimations;\n    },\n  },\n\n  /**\n   * Determines if the model's animations should hold a pose over frames where no keyframes are specified.\n   *\n   * @memberof Model.prototype\n   * @type {boolean}\n   *\n   * @default true\n   */\n  clampAnimations: {\n    get: function () {\n      return this._clampAnimations;\n    },\n    set: function (value) {\n      this._clampAnimations = value;\n    },\n  },\n\n  /**\n   * Whether or not to cull the model using frustum/horizon culling. If the model is part of a 3D Tiles tileset, this property\n   * will always be false, since the 3D Tiles culling system is used.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   * @readonly\n   *\n   * @private\n   */\n  cull: {\n    get: function () {\n      return this._cull;\n    },\n  },\n\n  /**\n   * The pass to use in the {@link DrawCommand} for the opaque portions of the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Pass}\n   * @readonly\n   *\n   * @private\n   */\n  opaquePass: {\n    get: function () {\n      return this._opaquePass;\n    },\n  },\n\n  /**\n   * Point cloud shading settings for controlling point cloud attenuation\n   * and lighting. For 3D Tiles, this is inherited from the\n   * {@link Cesium3DTileset}.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {PointCloudShading}\n   */\n  pointCloudShading: {\n    get: function () {\n      return this._pointCloudShading;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.defined(\"pointCloudShading\", value);\n      //>>includeEnd('debug');\n      if (value !== this._pointCloudShading) {\n        this.resetDrawCommands();\n      }\n      this._pointCloudShading = value;\n    },\n  },\n\n  /**\n   * The model's custom shader, if it exists. Using custom shaders with a {@link Cesium3DTileStyle}\n   * may lead to undefined behavior.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {CustomShader}\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  customShader: {\n    get: function () {\n      return this._customShader;\n    },\n    set: function (value) {\n      if (value !== this._customShader) {\n        this.resetDrawCommands();\n      }\n      this._customShader = value;\n    },\n  },\n\n  /**\n   * The scene graph of this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ModelSceneGraph}\n   * @private\n   */\n  sceneGraph: {\n    get: function () {\n      return this._sceneGraph;\n    },\n  },\n\n  /**\n   * The tile content this model belongs to, if it is loaded as part of a {@link Cesium3DTileset}.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Cesium3DTileContent}\n   * @readonly\n   *\n   * @private\n   */\n  content: {\n    get: function () {\n      return this._content;\n    },\n  },\n\n  /**\n   * The height reference of the model, which determines how the model is drawn\n   * relative to terrain.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {HeightReference}\n   * @default {HeightReference.NONE}\n   *\n   */\n  heightReference: {\n    get: function () {\n      return this._heightReference;\n    },\n    set: function (value) {\n      if (value !== this._heightReference) {\n        this._heightDirty = true;\n      }\n      this._heightReference = value;\n    },\n  },\n\n  /**\n   * Gets or sets the distance display condition, which specifies at what distance\n   * from the camera this model will be displayed.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {DistanceDisplayCondition}\n   *\n   * @default undefined\n   *\n   */\n  distanceDisplayCondition: {\n    get: function () {\n      return this._distanceDisplayCondition;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      if (defined(value) && value.far <= value.near) {\n        throw new DeveloperError(\"far must be greater than near\");\n      }\n      //>>includeEnd('debug');\n      this._distanceDisplayCondition = DistanceDisplayCondition.clone(\n        value,\n        this._distanceDisplayCondition,\n      );\n    },\n  },\n\n  /**\n   * The structural metadata from the EXT_structural_metadata extension\n   *\n   * @memberof Model.prototype\n   *\n   * @type {StructuralMetadata}\n   * @readonly\n   *\n   * @private\n   */\n  structuralMetadata: {\n    get: function () {\n      return this._sceneGraph.components.structuralMetadata;\n    },\n  },\n\n  /**\n   * The ID for the feature table to use for picking and styling in this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   *\n   * @private\n   */\n  featureTableId: {\n    get: function () {\n      return this._featureTableId;\n    },\n    set: function (value) {\n      this._featureTableId = value;\n    },\n  },\n\n  /**\n   * The feature tables for this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Array}\n   * @readonly\n   *\n   * @private\n   */\n  featureTables: {\n    get: function () {\n      return this._featureTables;\n    },\n    set: function (value) {\n      this._featureTables = value;\n    },\n  },\n\n  /**\n   * A user-defined object that is returned when the model is picked.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {object}\n   *\n   * @default undefined\n   *\n   * @see Scene#pick\n   */\n  id: {\n    get: function () {\n      return this._id;\n    },\n    set: function (value) {\n      if (value !== this._id) {\n        this._idDirty = true;\n      }\n\n      this._id = value;\n    },\n  },\n\n  /**\n   * When <code>true</code>, each primitive is pickable with {@link Scene#pick}.  When <code>false</code>, GPU memory is saved.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   * @readonly\n   *\n   * @private\n   */\n  allowPicking: {\n    get: function () {\n      return this._allowPicking;\n    },\n  },\n\n  /**\n   * The style to apply to the features in the model. Cannot be applied if a {@link CustomShader} is also applied.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Cesium3DTileStyle}\n   */\n  style: {\n    get: function () {\n      return this._style;\n    },\n    set: function (value) {\n      this._style = value;\n      this._styleDirty = true;\n    },\n  },\n\n  /**\n   * The color to blend with the model's rendered color.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Color}\n   *\n   * @default undefined\n   */\n  color: {\n    get: function () {\n      return this._color;\n    },\n    set: function (value) {\n      if (isColorAlphaDirty(value, this._color)) {\n        this.resetDrawCommands();\n      }\n      this._color = Color.clone(value, this._color);\n    },\n  },\n\n  /**\n   * Defines how the color blends with the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Cesium3DTileColorBlendMode|ColorBlendMode}\n   *\n   * @default ColorBlendMode.HIGHLIGHT\n   */\n  colorBlendMode: {\n    get: function () {\n      return this._colorBlendMode;\n    },\n    set: function (value) {\n      this._colorBlendMode = value;\n    },\n  },\n\n  /**\n   * Value used to determine the color strength when the <code>colorBlendMode</code> is <code>MIX</code>. A value of 0.0 results in the model's rendered color while a value of 1.0 results in a solid color, with any value in-between resulting in a mix of the two.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   *\n   * @default 0.5\n   */\n  colorBlendAmount: {\n    get: function () {\n      return this._colorBlendAmount;\n    },\n    set: function (value) {\n      this._colorBlendAmount = value;\n    },\n  },\n\n  /**\n   * The silhouette color.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Color}\n   *\n   * @default Color.RED\n   */\n  silhouetteColor: {\n    get: function () {\n      return this._silhouetteColor;\n    },\n    set: function (value) {\n      if (!Color.equals(value, this._silhouetteColor)) {\n        const alphaDirty = isColorAlphaDirty(value, this._silhouetteColor);\n        this._silhouetteDirty = this._silhouetteDirty || alphaDirty;\n      }\n\n      this._silhouetteColor = Color.clone(value, this._silhouetteColor);\n    },\n  },\n\n  /**\n   * The size of the silhouette in pixels.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   *\n   * @default 0.0\n   */\n  silhouetteSize: {\n    get: function () {\n      return this._silhouetteSize;\n    },\n    set: function (value) {\n      if (value !== this._silhouetteSize) {\n        const currentSize = this._silhouetteSize;\n        const sizeDirty =\n          (value > 0.0 && currentSize === 0.0) ||\n          (value === 0.0 && currentSize > 0.0);\n        this._silhouetteDirty = this._silhouetteDirty || sizeDirty;\n\n        // Back-face culling needs to be updated in case the silhouette size\n        // is greater than zero.\n        this._backFaceCullingDirty = this._backFaceCullingDirty || sizeDirty;\n      }\n\n      this._silhouetteSize = value;\n    },\n  },\n\n  /**\n   * Gets the model's bounding sphere in world space. This does not take into account\n   * glTF animations, skins, or morph targets. It also does not account for\n   * {@link Model#minimumPixelSize}.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {BoundingSphere}\n   * @readonly\n   */\n  boundingSphere: {\n    get: function () {\n      //>>includeStart('debug', pragmas.debug);\n      if (!this._ready) {\n        throw new DeveloperError(\n          \"The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\",\n        );\n      }\n      //>>includeEnd('debug');\n\n      const modelMatrix = defined(this._clampedModelMatrix)\n        ? this._clampedModelMatrix\n        : this.modelMatrix;\n      updateBoundingSphere(this, modelMatrix);\n\n      return this._boundingSphere;\n    },\n  },\n\n  /**\n   * This property is for debugging only; it is not for production use nor is it optimized.\n   * <p>\n   * Draws the bounding sphere for each draw command in the model.\n   * </p>\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   *\n   * @default false\n   */\n  debugShowBoundingVolume: {\n    get: function () {\n      return this._debugShowBoundingVolume;\n    },\n    set: function (value) {\n      if (this._debugShowBoundingVolume !== value) {\n        this._debugShowBoundingVolumeDirty = true;\n      }\n      this._debugShowBoundingVolume = value;\n    },\n  },\n\n  /**\n   * This property is for debugging only; it is not for production use nor is it optimized.\n   * <p>\n   * Draws the model in wireframe.\n   * </p>\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   *\n   * @default false\n   */\n  debugWireframe: {\n    get: function () {\n      return this._debugWireframe;\n    },\n    set: function (value) {\n      if (this._debugWireframe !== value) {\n        this.resetDrawCommands();\n      }\n      this._debugWireframe = value;\n\n      // Warning for improper setup of debug wireframe\n      if (\n        this._debugWireframe === true &&\n        this._enableDebugWireframe === false &&\n        this.type === ModelType.GLTF\n      ) {\n        oneTimeWarning(\n          \"model-debug-wireframe-ignored\",\n          \"enableDebugWireframe must be set to true in Model.fromGltfAsync, otherwise debugWireframe will be ignored.\",\n        );\n      }\n    },\n  },\n\n  /**\n   * Whether or not to render the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   *\n   * @default true\n   */\n  show: {\n    get: function () {\n      return this._show;\n    },\n    set: function (value) {\n      this._show = value;\n    },\n  },\n\n  /**\n   * Label of the feature ID set to use for picking and styling.\n   * <p>\n   * For EXT_mesh_features, this is the feature ID's label property, or\n   * \"featureId_N\" (where N is the index in the featureIds array) when not\n   * specified. EXT_feature_metadata did not have a label field, so such\n   * feature ID sets are always labeled \"featureId_N\" where N is the index in\n   * the list of all feature Ids, where feature ID attributes are listed before\n   * feature ID textures.\n   * </p>\n   * <p>\n   * If featureIdLabel is set to an integer N, it is converted to\n   * the string \"featureId_N\" automatically. If both per-primitive and\n   * per-instance feature IDs are present, the instance feature IDs take\n   * priority.\n   * </p>\n   *\n   * @memberof Model.prototype\n   *\n   * @type {string}\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  featureIdLabel: {\n    get: function () {\n      return this._featureIdLabel;\n    },\n    set: function (value) {\n      // indices get converted into featureId_N\n      if (typeof value === \"number\") {\n        value = `featureId_${value}`;\n      }\n\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.string(\"value\", value);\n      //>>includeEnd('debug');\n\n      if (value !== this._featureIdLabel) {\n        this._featureTableIdDirty = true;\n      }\n\n      this._featureIdLabel = value;\n    },\n  },\n\n  /**\n   * Label of the instance feature ID set used for picking and styling.\n   * <p>\n   * If instanceFeatureIdLabel is set to an integer N, it is converted to\n   * the string \"instanceFeatureId_N\" automatically.\n   * If both per-primitive and per-instance feature IDs are present, the\n   * instance feature IDs take priority.\n   * </p>\n   *\n   * @memberof Model.prototype\n   *\n   * @type {string}\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   */\n  instanceFeatureIdLabel: {\n    get: function () {\n      return this._instanceFeatureIdLabel;\n    },\n    set: function (value) {\n      // indices get converted into instanceFeatureId_N\n      if (typeof value === \"number\") {\n        value = `instanceFeatureId_${value}`;\n      }\n\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.string(\"value\", value);\n      //>>includeEnd('debug');\n\n      if (value !== this._instanceFeatureIdLabel) {\n        this._featureTableIdDirty = true;\n      }\n\n      this._instanceFeatureIdLabel = value;\n    },\n  },\n\n  /**\n   * The {@link ClippingPlaneCollection} used to selectively disable rendering the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ClippingPlaneCollection}\n   */\n  clippingPlanes: {\n    get: function () {\n      return this._clippingPlanes;\n    },\n    set: function (value) {\n      if (value !== this._clippingPlanes) {\n        // Handle destroying old clipping planes, new clipping planes ownership\n        ClippingPlaneCollection.setOwner(value, this, \"_clippingPlanes\");\n        this.resetDrawCommands();\n      }\n    },\n  },\n\n  /**\n   * The {@link ClippingPolygonCollection} used to selectively disable rendering the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ClippingPolygonCollection}\n   */\n  clippingPolygons: {\n    get: function () {\n      return this._clippingPolygons;\n    },\n    set: function (value) {\n      if (value !== this._clippingPolygons) {\n        // Handle destroying old clipping polygons, new clipping polygons ownership\n        ClippingPolygonCollection.setOwner(value, this, \"_clippingPolygons\");\n        this.resetDrawCommands();\n      }\n    },\n  },\n\n  /**\n   * If <code>true</code>, the model is exaggerated along the ellipsoid normal when {@link Scene.verticalExaggeration} is set to a value other than <code>1.0</code>.\n   *\n   * @memberof Model.prototype\n   * @type {boolean}\n   * @default true\n   *\n   * @example\n   * // Exaggerate terrain by a factor of 2, but prevent model exaggeration\n   * scene.verticalExaggeration = 2.0;\n   * model.enableVerticalExaggeration = false;\n   */\n  enableVerticalExaggeration: {\n    get: function () {\n      return this._enableVerticalExaggeration;\n    },\n    set: function (value) {\n      if (value !== this._enableVerticalExaggeration) {\n        this.resetDrawCommands();\n      }\n      this._enableVerticalExaggeration = value;\n    },\n  },\n\n  /**\n   * If <code>true</code>, the model is vertically exaggerated along the ellipsoid normal.\n   *\n   * @memberof Model.prototype\n   * @type {boolean}\n   * @default true\n   * @readonly\n   * @private\n   */\n  hasVerticalExaggeration: {\n    get: function () {\n      return this._hasVerticalExaggeration;\n    },\n  },\n\n  /**\n   * The directional light color when shading the model. When <code>undefined</code> the scene's light color is used instead.\n   * <p>\n   * Disabling additional light sources by setting\n   * <code>model.imageBasedLighting.imageBasedLightingFactor = new Cartesian2(0.0, 0.0)</code>\n   * will make the model much darker. Here, increasing the intensity of the light source will make the model brighter.\n   * </p>\n   * @memberof Model.prototype\n   *\n   * @type {Cartesian3}\n   *\n   * @default undefined\n   */\n  lightColor: {\n    get: function () {\n      return this._lightColor;\n    },\n    set: function (value) {\n      if (defined(value) !== defined(this._lightColor)) {\n        this.resetDrawCommands();\n      }\n\n      this._lightColor = Cartesian3.clone(value, this._lightColor);\n    },\n  },\n\n  /**\n   * The properties for managing image-based lighting on this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ImageBasedLighting}\n   */\n  imageBasedLighting: {\n    get: function () {\n      return this._imageBasedLighting;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.object(\"imageBasedLighting\", value);\n      //>>includeEnd('debug');\n\n      if (value !== this._imageBasedLighting) {\n        if (\n          this._shouldDestroyImageBasedLighting &&\n          !this._imageBasedLighting.isDestroyed()\n        ) {\n          this._imageBasedLighting.destroy();\n        }\n        this._imageBasedLighting = value;\n        this._shouldDestroyImageBasedLighting = false;\n        this.resetDrawCommands();\n      }\n    },\n  },\n\n  /**\n   * The properties for managing dynamic environment maps on this model. Affects lighting.\n   * @memberof Model.prototype\n   * @readonly\n   *\n   * @example\n   * // Change the ground color used for a model's environment map to a forest green\n   * const environmentMapManager = model.environmentMapManager;\n   * environmentMapManager.groundColor = Cesium.Color.fromCssColorString(\"#203b34\");\n   *\n   * @type {DynamicEnvironmentMapManager}\n   */\n  environmentMapManager: {\n    get: function () {\n      return this._environmentMapManager;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      Check.typeOf.object(\"environmentMapManager\", value);\n      //>>includeEnd('debug');\n\n      if (value !== this.environmentMapManager) {\n        DynamicEnvironmentMapManager.setOwner(\n          value,\n          this,\n          \"_environmentMapManager\",\n        );\n        this.resetDrawCommands();\n      }\n    },\n  },\n\n  /**\n   * Whether to cull back-facing geometry. When true, back face culling is\n   * determined by the material's doubleSided property; when false, back face\n   * culling is disabled. Back faces are not culled if {@link Model#color}\n   * is translucent or {@link Model#silhouetteSize} is greater than 0.0.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   *\n   * @default true\n   */\n  backFaceCulling: {\n    get: function () {\n      return this._backFaceCulling;\n    },\n    set: function (value) {\n      if (value !== this._backFaceCulling) {\n        this._backFaceCullingDirty = true;\n      }\n\n      this._backFaceCulling = value;\n    },\n  },\n\n  /**\n   * A uniform scale applied to this model before the {@link Model#modelMatrix}.\n   * Values greater than <code>1.0</code> increase the size of the model; values\n   * less than <code>1.0</code> decrease.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   *\n   * @default 1.0\n   */\n  scale: {\n    get: function () {\n      return this._scale;\n    },\n    set: function (value) {\n      if (value !== this._scale) {\n        this._updateModelMatrix = true;\n      }\n      this._scale = value;\n    },\n  },\n\n  /**\n   * The true scale of the model after being affected by the model's scale,\n   * minimum pixel size, and maximum scale parameters.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   * @readonly\n   *\n   * @private\n   */\n  computedScale: {\n    get: function () {\n      return this._computedScale;\n    },\n  },\n\n  /**\n   * The approximate minimum pixel size of the model regardless of zoom.\n   * This can be used to ensure that a model is visible even when the viewer\n   * zooms out.  When <code>0.0</code>, no minimum size is enforced.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   *\n   * @default 0.0\n   */\n  minimumPixelSize: {\n    get: function () {\n      return this._minimumPixelSize;\n    },\n    set: function (value) {\n      if (value !== this._minimumPixelSize) {\n        this._updateModelMatrix = true;\n      }\n      this._minimumPixelSize = value;\n    },\n  },\n\n  /**\n   * The maximum scale size for a model. This can be used to give\n   * an upper limit to the {@link Model#minimumPixelSize}, ensuring that the model\n   * is never an unreasonable scale.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {number}\n   */\n  maximumScale: {\n    get: function () {\n      return this._maximumScale;\n    },\n    set: function (value) {\n      if (value !== this._maximumScale) {\n        this._updateModelMatrix = true;\n      }\n      this._maximumScale = value;\n    },\n  },\n\n  /**\n   * Determines whether the model casts or receives shadows from light sources.\n\n   * @memberof Model.prototype\n   *\n   * @type {ShadowMode}\n   *\n   * @default ShadowMode.ENABLED\n   */\n  shadows: {\n    get: function () {\n      return this._shadows;\n    },\n    set: function (value) {\n      if (value !== this._shadows) {\n        this._shadowsDirty = true;\n      }\n\n      this._shadows = value;\n    },\n  },\n\n  /**\n   * Gets the credit that will be displayed for the model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {Credit}\n   * @readonly\n   */\n  credit: {\n    get: function () {\n      return this._credit;\n    },\n  },\n\n  /**\n   * Gets or sets whether the credits of the model will be displayed\n   * on the screen.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {boolean}\n   *\n   * @default false\n   */\n  showCreditsOnScreen: {\n    get: function () {\n      return this._showCreditsOnScreen;\n    },\n    set: function (value) {\n      if (this._showCreditsOnScreen !== value) {\n        this._showCreditsOnScreenDirty = true;\n      }\n\n      this._showCreditsOnScreen = value;\n    },\n  },\n\n  /**\n   * The {@link SplitDirection} to apply to this model.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {SplitDirection}\n   *\n   * @default {@link SplitDirection.NONE}\n   */\n  splitDirection: {\n    get: function () {\n      return this._splitDirection;\n    },\n    set: function (value) {\n      if (this._splitDirection !== value) {\n        this.resetDrawCommands();\n      }\n      this._splitDirection = value;\n    },\n  },\n\n  /**\n   * Gets the model's classification type. This determines whether terrain,\n   * 3D Tiles, or both will be classified by this model.\n   * <p>\n   * Additionally, there are a few requirements/limitations:\n   * <ul>\n   *     <li>The glTF cannot contain morph targets, skins, or animations.</li>\n   *     <li>The glTF cannot contain the <code>EXT_mesh_gpu_instancing</code> extension.</li>\n   *     <li>Only meshes with TRIANGLES can be used to classify other assets.</li>\n   *     <li>The meshes must be watertight.</li>\n   *     <li>The POSITION attribute is required.</li>\n   *     <li>If feature IDs and an index buffer are both present, all indices with the same feature id must occupy contiguous sections of the index buffer.</li>\n   *     <li>If feature IDs are present without an index buffer, all positions with the same feature id must occupy contiguous sections of the position buffer.</li>\n   * </ul>\n   * </p>\n   * <p>\n   * The 3D Tiles or terrain receiving the classification must be opaque.\n   * </p>\n   *\n   * @memberof Model.prototype\n   *\n   * @type {ClassificationType}\n   * @default undefined\n   *\n   * @experimental This feature is using part of the 3D Tiles spec that is not final and is subject to change without Cesium's standard deprecation policy.\n   * @readonly\n   */\n  classificationType: {\n    get: function () {\n      return this._classificationType;\n    },\n  },\n\n  /**\n   * Reference to the pick IDs. This is only used internally, e.g. for\n   * per-feature post-processing in {@link PostProcessStage}.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {PickId[]}\n   * @readonly\n   *\n   * @private\n   */\n  pickIds: {\n    get: function () {\n      return this._pickIds;\n    },\n  },\n\n  /**\n   * The {@link StyleCommandsNeeded} for the style currently applied to\n   * the features in the model. This is used internally by the {@link ModelDrawCommand}\n   * when determining which commands to submit in an update.\n   *\n   * @memberof Model.prototype\n   *\n   * @type {StyleCommandsNeeded}\n   * @readonly\n   *\n   * @private\n   */\n  styleCommandsNeeded: {\n    get: function () {\n      return this._styleCommandsNeeded;\n    },\n  },\n});\n\n/**\n * Returns the node with the given <code>name</code> in the glTF. This is used to\n * modify a node's transform for user-defined animation.\n *\n * @param {string} name The name of the node in the glTF.\n * @returns {ModelNode} The node, or <code>undefined</code> if no node with the <code>name</code> exists.\n *\n * @exception {DeveloperError} The model is not loaded.  Use Model.readyEvent or wait for Model.ready to be true.\n *\n * @example\n * // Apply non-uniform scale to node \"Hand\"\n * const node = model.getNode(\"Hand\");\n * node.matrix = Cesium.Matrix4.fromScale(new Cesium.Cartesian3(5.0, 1.0, 1.0), node.matrix);\n */\nModel.prototype.getNode = function (name) {\n  //>>includeStart('debug', pragmas.debug);\n  if (!this._ready) {\n    throw new DeveloperError(\n      \"The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\",\n    );\n  }\n  Check.typeOf.string(\"name\", name);\n  //>>includeEnd('debug');\n\n  return this._nodesByName[name];\n};\n\n/**\n * Sets the current value of an articulation stage.  After setting one or\n * multiple stage values, call Model.applyArticulations() to\n * cause the node matrices to be recalculated.\n *\n * @param {string} articulationStageKey The name of the articulation, a space, and the name of the stage.\n * @param {number} value The numeric value of this stage of the articulation.\n *\n * @exception {DeveloperError} The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\n *\n * @see Model#applyArticulations\n *\n * @example\n * // Sets the value of the stage named \"MoveX\" belonging to the articulation named \"SampleArticulation\"\n * model.setArticulationStage(\"SampleArticulation MoveX\", 50.0);\n */\nModel.prototype.setArticulationStage = function (articulationStageKey, value) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.number(\"value\", value);\n  if (!this._ready) {\n    throw new DeveloperError(\n      \"The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\",\n    );\n  }\n  //>>includeEnd('debug');\n\n  this._sceneGraph.setArticulationStage(articulationStageKey, value);\n};\n\n/**\n * Applies any modified articulation stages to the matrix of each node that\n * participates in any articulation. Note that this will overwrite any node\n * transformations on participating nodes.\n *\n * @exception {DeveloperError} The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\n */\nModel.prototype.applyArticulations = function () {\n  //>>includeStart('debug', pragmas.debug);\n  if (!this._ready) {\n    throw new DeveloperError(\n      \"The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\",\n    );\n  }\n  //>>includeEnd('debug');\n\n  this._sceneGraph.applyArticulations();\n};\n\n/**\n * Returns the object that was created for the given extension.\n *\n * The given name may be the name of a glTF extension, like `\"EXT_example_extension\"`.\n * If the specified extension was present in the root of the underlying glTF asset,\n * and a loder for the specified extension has processed the extension data, then\n * this will return the model representation of the extension.\n *\n * @param {string} extensionName The name of the extension\n * @returns {object|undefined} The object, or `undefined`\n * @exception {DeveloperError} The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\n *\n * @experimental This feature is not final and is subject to change without Cesium's standard deprecation policy.\n */\nModel.prototype.getExtension = function (extensionName) {\n  //>>includeStart('debug', pragmas.debug);\n  Check.typeOf.string(\"extensionName\", extensionName);\n  if (!this._ready) {\n    throw new DeveloperError(\n      \"The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.\",\n    );\n  }\n  //>>includeEnd('debug');\n  const components = this._loader.components;\n  return components.extensions[extensionName];\n};\n\n/**\n * Marks the model's {@link Model#style} as dirty, which forces all features\n * to re-evaluate the style in the next frame the model is visible.\n */\nModel.prototype.makeStyleDirty = function () {\n  this._styleDirty = true;\n};\n\n/**\n * Resets the draw commands for this model.\n *\n * @private\n */\nModel.prototype.resetDrawCommands = function () {\n  this._drawCommandsBuilt = false;\n};\n\nconst scratchIBLReferenceFrameMatrix4 = new Matrix4();\nconst scratchIBLReferenceFrameMatrix3 = new Matrix3();\nconst scratchClippingPlanesMatrix = new Matrix4();\n\n/**\n * Called when {@link Viewer} or {@link CesiumWidget} render the scene to\n * get the draw commands needed to render this primitive.\n * <p>\n * Do not call this function directly.  This is documented just to\n * list the exceptions that may be propagated when the scene is rendered:\n * </p>\n *\n * @exception {RuntimeError} Failed to load external reference.\n */\nModel.prototype.update = function (frameState) {\n  let finishedProcessing = false;\n  try {\n    // Keep processing the model every frame until the main resources\n    // (buffer views) and textures (which may be loaded asynchronously)\n    // are processed.\n    finishedProcessing = processLoader(this, frameState);\n  } catch (error) {\n    if (\n      !this._loader.incrementallyLoadTextures &&\n      error.name === \"TextureError\"\n    ) {\n      handleError(this, error);\n    } else {\n      const runtimeError = ModelUtility.getError(\n        \"model\",\n        this._resource,\n        error,\n      );\n      handleError(this, runtimeError);\n    }\n  }\n\n  // A custom shader may have to load texture uniforms.\n  updateCustomShader(this, frameState);\n\n  // Environment maps, specular maps, and spherical harmonics may need to be updated or regenerated\n  updateEnvironmentMap(this, frameState);\n\n  // The image-based lighting may have to load texture uniforms\n  // for specular maps.\n  updateImageBasedLighting(this, frameState);\n\n  if (!this._resourcesLoaded && finishedProcessing) {\n    this._resourcesLoaded = true;\n\n    const components = this._loader.components;\n    if (!defined(components)) {\n      if (this._loader.isUnloaded()) {\n        return;\n      }\n\n      const error = ModelUtility.getError(\n        \"model\",\n        this._resource,\n        new RuntimeError(\"Failed to load model.\"),\n      );\n      handleError(error);\n      this._rejectLoad = this._rejectLoad && this._rejectLoad(error);\n    }\n\n    const structuralMetadata = components.structuralMetadata;\n    if (\n      defined(structuralMetadata) &&\n      structuralMetadata.propertyTableCount > 0\n    ) {\n      createModelFeatureTables(this, structuralMetadata);\n    }\n\n    const sceneGraph = new ModelSceneGraph({\n      model: this,\n      modelComponents: components,\n    });\n\n    this._sceneGraph = sceneGraph;\n    this._gltfCredits = sceneGraph.components.asset.credits;\n  }\n\n  // Short-circuit if the model resources aren't ready or the scene\n  // is currently morphing.\n  if (!this._resourcesLoaded || frameState.mode === SceneMode.MORPHING) {\n    return;\n  }\n\n  updateFeatureTableId(this);\n  updateStyle(this);\n  updateFeatureTables(this, frameState);\n  updatePointCloudShading(this);\n  updateSilhouette(this, frameState);\n  updateSkipLevelOfDetail(this, frameState);\n  updateClippingPlanes(this, frameState);\n  updateClippingPolygons(this, frameState);\n  updateSceneMode(this, frameState);\n  updateFog(this, frameState);\n  updateVerticalExaggeration(this, frameState);\n\n  this._defaultTexture = frameState.context.defaultTexture;\n\n  buildDrawCommands(this, frameState);\n  updateModelMatrix(this, frameState);\n\n  // Many features (e.g. image-based lighting, clipping planes) depend on the model\n  // matrix being updated for the current height reference, so update it first.\n  updateClamping(this);\n\n  updateBoundingSphereAndScale(this, frameState);\n  updateReferenceMatrices(this, frameState);\n\n  // This check occurs after the bounding sphere has been updated so that\n  // zooming to the bounding sphere can account for any modifications\n  // from the clamp-to-ground setting.\n  if (!this._ready) {\n    // Set the model as ready after the first frame render since the user might set up events subscribed to\n    // the post render event, and the model may not be ready for those past the first frame.\n    frameState.afterRender.push(() => {\n      this._ready = true;\n      this._readyEvent.raiseEvent(this);\n    });\n\n    // Don't render until the next frame after the ready event has been raised.\n    return;\n  }\n\n  if (\n    this._loader.incrementallyLoadTextures &&\n    !this._texturesLoaded &&\n    this._loader.texturesLoaded\n  ) {\n    // Re-run the pipeline so texture memory statistics are re-computed\n    this.resetDrawCommands();\n\n    this._texturesLoaded = true;\n    this._texturesReadyEvent.raiseEvent(this);\n  }\n\n  updatePickIds(this);\n\n  // Update the scene graph and draw commands for any changes in model's properties\n  // (e.g. model matrix, back-face culling)\n  updateSceneGraph(this, frameState);\n  updateShowCreditsOnScreen(this);\n  submitDrawCommands(this, frameState);\n};\n\nfunction processLoader(model, frameState) {\n  if (\n    !model._resourcesLoaded ||\n    (model._loader.incrementallyLoadTextures && !model._texturesLoaded)\n  ) {\n    // Ensures frames continue to render in requestRender mode while resources are processing\n    frameState.afterRender.push(() => true);\n    return model._loader.process(frameState);\n  }\n\n  return true;\n}\n\nfunction updateCustomShader(model, frameState) {\n  if (defined(model._customShader)) {\n    model._customShader.update(frameState);\n  }\n}\n\nfunction updateEnvironmentMap(model, frameState) {\n  const environmentMapManager = model._environmentMapManager;\n  const picking = frameState.passes.pick || frameState.passes.pickVoxel;\n  if (model._ready && environmentMapManager.owner === model && !picking) {\n    environmentMapManager.position = model._boundingSphere.center;\n    environmentMapManager.shouldUpdate =\n      !defined(model._imageBasedLighting.sphericalHarmonicCoefficients) ||\n      !defined(model._imageBasedLighting.specularEnvironmentMaps);\n\n    environmentMapManager.update(frameState);\n\n    if (environmentMapManager.shouldRegenerateShaders) {\n      model.resetDrawCommands();\n    }\n  }\n}\n\nfunction updateImageBasedLighting(model, frameState) {\n  model._imageBasedLighting.update(frameState);\n  if (model._imageBasedLighting.shouldRegenerateShaders) {\n    model.resetDrawCommands();\n  }\n}\n\nfunction updateFeatureTableId(model) {\n  if (!model._featureTableIdDirty) {\n    return;\n  }\n  model._featureTableIdDirty = false;\n\n  const components = model._sceneGraph.components;\n  const structuralMetadata = components.structuralMetadata;\n\n  if (\n    defined(structuralMetadata) &&\n    structuralMetadata.propertyTableCount > 0\n  ) {\n    model.featureTableId = selectFeatureTableId(components, model);\n\n    // Mark the style dirty to re-apply it and reflect the new feature ID table.\n    model._styleDirty = true;\n\n    // Trigger a rebuild of the draw commands.\n    model.resetDrawCommands();\n  }\n}\n\nfunction updateStyle(model) {\n  if (model._styleDirty) {\n    model.applyStyle(model._style);\n    model._styleDirty = false;\n  }\n}\n\nfunction updateFeatureTables(model, frameState) {\n  const featureTables = model._featureTables;\n  const length = featureTables.length;\n\n  let styleCommandsNeededDirty = false;\n  for (let i = 0; i < length; i++) {\n    featureTables[i].update(frameState);\n    // Check if the types of style commands needed have changed and trigger a reset of the draw commands\n    // to ensure that translucent and opaque features are handled in the correct passes.\n    if (featureTables[i].styleCommandsNeededDirty) {\n      styleCommandsNeededDirty = true;\n    }\n  }\n\n  if (styleCommandsNeededDirty) {\n    updateStyleCommandsNeeded(model);\n  }\n}\n\nfunction updateStyleCommandsNeeded(model) {\n  const featureTable = model.featureTables[model.featureTableId];\n  model._styleCommandsNeeded = StyleCommandsNeeded.getStyleCommandsNeeded(\n    featureTable.featuresLength,\n    featureTable.batchTexture.translucentFeaturesLength,\n  );\n}\n\nfunction updatePointCloudShading(model) {\n  const pointCloudShading = model.pointCloudShading;\n\n  // Check if the shader needs to be updated for point cloud attenuation\n  // settings.\n  if (pointCloudShading.attenuation !== model._attenuation) {\n    model.resetDrawCommands();\n    model._attenuation = pointCloudShading.attenuation;\n  }\n\n  if (pointCloudShading.backFaceCulling !== model._pointCloudBackFaceCulling) {\n    model.resetDrawCommands();\n    model._pointCloudBackFaceCulling = pointCloudShading.backFaceCulling;\n  }\n}\n\nfunction updateSilhouette(model, frameState) {\n  if (model._silhouetteDirty) {\n    // Only rebuild draw commands if silhouettes are supported in the first place.\n    if (supportsSilhouettes(frameState)) {\n      model.resetDrawCommands();\n    }\n\n    model._silhouetteDirty = false;\n  }\n}\n\nfunction updateSkipLevelOfDetail(model, frameState) {\n  const skipLevelOfDetail = model.hasSkipLevelOfDetail(frameState);\n  if (skipLevelOfDetail !== model._skipLevelOfDetail) {\n    model.resetDrawCommands();\n    model._skipLevelOfDetail = skipLevelOfDetail;\n  }\n}\n\nfunction updateClippingPlanes(model, frameState) {\n  // Update the clipping planes collection / state for this model to detect any changes.\n  let currentClippingPlanesState = 0;\n  if (model.isClippingEnabled()) {\n    if (model._clippingPlanes.owner === model) {\n      model._clippingPlanes.update(frameState);\n    }\n    currentClippingPlanesState = model._clippingPlanes.clippingPlanesState;\n  }\n\n  if (currentClippingPlanesState !== model._clippingPlanesState) {\n    model.resetDrawCommands();\n    model._clippingPlanesState = currentClippingPlanesState;\n  }\n}\n\nfunction updateClippingPolygons(model, frameState) {\n  // Update the clipping polygon collection / state for this model to detect any changes.\n  let currentClippingPolygonsState = 0;\n  if (model.isClippingPolygonsEnabled()) {\n    if (model._clippingPolygons.owner === model) {\n      model._clippingPolygons.update(frameState);\n      model._clippingPolygons.queueCommands(frameState);\n    }\n    currentClippingPolygonsState =\n      model._clippingPolygons.clippingPolygonsState;\n  }\n\n  if (currentClippingPolygonsState !== model._clippingPolygonsState) {\n    model.resetDrawCommands();\n    model._clippingPolygonsState = currentClippingPolygonsState;\n  }\n}\n\nfunction updateSceneMode(model, frameState) {\n  if (frameState.mode !== model._sceneMode) {\n    if (model._projectTo2D) {\n      model.resetDrawCommands();\n    } else {\n      model._updateModelMatrix = true;\n    }\n    model._sceneMode = frameState.mode;\n  }\n}\n\nfunction updateFog(model, frameState) {\n  const fogRenderable = frameState.fog.enabled && frameState.fog.renderable;\n  if (fogRenderable !== model._fogRenderable) {\n    model.resetDrawCommands();\n    model._fogRenderable = fogRenderable;\n  }\n}\n\nfunction updateVerticalExaggeration(model, frameState) {\n  if (model.enableVerticalExaggeration) {\n    const verticalExaggerationNeeded = frameState.verticalExaggeration !== 1.0;\n    if (model.hasVerticalExaggeration !== verticalExaggerationNeeded) {\n      model.resetDrawCommands();\n      model._hasVerticalExaggeration = verticalExaggerationNeeded;\n    }\n  } else if (model.hasVerticalExaggeration) {\n    model.resetDrawCommands(); //if verticalExaggeration was on, reset.\n    model._hasVerticalExaggeration = false;\n  }\n}\n\nfunction buildDrawCommands(model, frameState) {\n  if (!model._drawCommandsBuilt) {\n    model.destroyPipelineResources();\n    model._sceneGraph.buildDrawCommands(frameState);\n    model._drawCommandsBuilt = true;\n  }\n}\n\nfunction updateModelMatrix(model, frameState) {\n  // This is done without a dirty flag so that the model matrix can be updated in-place\n  // without needing to use a setter.\n  if (!Matrix4.equals(model.modelMatrix, model._modelMatrix)) {\n    //>>includeStart('debug', pragmas.debug);\n    if (frameState.mode !== SceneMode.SCENE3D && model._projectTo2D) {\n      throw new DeveloperError(\n        \"Model.modelMatrix cannot be changed in 2D or Columbus View if projectTo2D is true.\",\n      );\n    }\n    //>>includeEnd('debug');\n    model._updateModelMatrix = true;\n    model._modelMatrix = Matrix4.clone(model.modelMatrix, model._modelMatrix);\n  }\n}\n\nconst scratchPosition = new Cartesian3();\nconst scratchCartographic = new Cartographic();\n\nfunction updateClamping(model) {\n  if (\n    !model._updateModelMatrix &&\n    !model._heightDirty &&\n    model._minimumPixelSize === 0.0\n  ) {\n    return;\n  }\n\n  if (defined(model._removeUpdateHeightCallback)) {\n    model._removeUpdateHeightCallback();\n    model._removeUpdateHeightCallback = undefined;\n  }\n\n  const scene = model._scene;\n  if (!defined(scene) || model.heightReference === HeightReference.NONE) {\n    //>>includeStart('debug', pragmas.debug);\n    if (model.heightReference !== HeightReference.NONE) {\n      throw new DeveloperError(\n        \"Height reference is not supported without a scene.\",\n      );\n    }\n    //>>includeEnd('debug');\n    model._clampedModelMatrix = undefined;\n    return;\n  }\n\n  const ellipsoid = defaultValue(scene.ellipsoid, Ellipsoid.default);\n\n  // Compute cartographic position so we don't recompute every update\n  const modelMatrix = model.modelMatrix;\n  scratchPosition.x = modelMatrix[12];\n  scratchPosition.y = modelMatrix[13];\n  scratchPosition.z = modelMatrix[14];\n  const cartoPosition = ellipsoid.cartesianToCartographic(scratchPosition);\n\n  if (!defined(model._clampedModelMatrix)) {\n    model._clampedModelMatrix = Matrix4.clone(modelMatrix, new Matrix4());\n  }\n\n  // Install callback to handle updating of terrain tiles\n  model._removeUpdateHeightCallback = scene.updateHeight(\n    cartoPosition,\n    getUpdateHeightCallback(model, ellipsoid, cartoPosition),\n    model.heightReference,\n  );\n\n  // Set the correct height now\n  const height = scene.getHeight(cartoPosition, model.heightReference);\n  if (defined(height)) {\n    // Get callback with cartoPosition being the non-clamped position\n    const callback = getUpdateHeightCallback(model, ellipsoid, cartoPosition);\n\n    // Compute the clamped cartesian and call updateHeight callback\n    Cartographic.clone(cartoPosition, scratchCartographic);\n    scratchCartographic.height = height;\n    callback(scratchCartographic);\n  }\n\n  model._heightDirty = false;\n  model._updateModelMatrix = true;\n}\n\nfunction updateBoundingSphereAndScale(model, frameState) {\n  if (!model._updateModelMatrix && model._minimumPixelSize === 0.0) {\n    return;\n  }\n\n  const modelMatrix = defined(model._clampedModelMatrix)\n    ? model._clampedModelMatrix\n    : model.modelMatrix;\n\n  updateBoundingSphere(model, modelMatrix);\n  updateComputedScale(model, modelMatrix, frameState);\n}\n\nfunction updateBoundingSphere(model, modelMatrix) {\n  model._clampedScale = defined(model._maximumScale)\n    ? Math.min(model._scale, model._maximumScale)\n    : model._scale;\n\n  model._boundingSphere.center = Cartesian3.multiplyByScalar(\n    model._sceneGraph.boundingSphere.center,\n    model._clampedScale,\n    model._boundingSphere.center,\n  );\n  model._boundingSphere.radius = model._initialRadius * model._clampedScale;\n\n  model._boundingSphere = BoundingSphere.transform(\n    model._boundingSphere,\n    modelMatrix,\n    model._boundingSphere,\n  );\n}\n\nfunction updateComputedScale(model, modelMatrix, frameState) {\n  let scale = model.scale;\n\n  if (model.minimumPixelSize !== 0.0 && !model._projectTo2D) {\n    // Compute size of bounding sphere in pixels\n    const context = frameState.context;\n    const maxPixelSize = Math.max(\n      context.drawingBufferWidth,\n      context.drawingBufferHeight,\n    );\n\n    Matrix4.getTranslation(modelMatrix, scratchPosition);\n\n    if (model._sceneMode !== SceneMode.SCENE3D) {\n      SceneTransforms.computeActualEllipsoidPosition(\n        frameState,\n        scratchPosition,\n        scratchPosition,\n      );\n    }\n\n    const radius = model._boundingSphere.radius;\n    const metersPerPixel = scaleInPixels(scratchPosition, radius, frameState);\n\n    // metersPerPixel is always > 0.0\n    const pixelsPerMeter = 1.0 / metersPerPixel;\n    const diameterInPixels = Math.min(\n      pixelsPerMeter * (2.0 * radius),\n      maxPixelSize,\n    );\n\n    // Maintain model's minimum pixel size\n    if (diameterInPixels < model.minimumPixelSize) {\n      scale =\n        (model.minimumPixelSize * metersPerPixel) /\n        (2.0 * model._initialRadius);\n    }\n  }\n\n  model._computedScale = defined(model.maximumScale)\n    ? Math.min(model.maximumScale, scale)\n    : scale;\n}\n\nfunction updatePickIds(model) {\n  if (!model._idDirty) {\n    return;\n  }\n  model._idDirty = false;\n\n  const id = model._id;\n  const pickIds = model._pickIds;\n  const length = pickIds.length;\n  for (let i = 0; i < length; ++i) {\n    pickIds[i].object.id = id;\n  }\n}\n\n// Matrix3 is a row-major constructor.\n// The same constructor in GLSL will produce the transpose of this.\nconst yUpToZUp = new Matrix3(1, 0, 0, 0, 0, 1, 0, -1, 0);\n\nfunction updateReferenceMatrices(model, frameState) {\n  const modelMatrix = defined(model._clampedModelMatrix)\n    ? model._clampedModelMatrix\n    : model.modelMatrix;\n  const referenceMatrix = defaultValue(model.referenceMatrix, modelMatrix);\n  const context = frameState.context;\n\n  let iblReferenceFrameMatrix3 = scratchIBLReferenceFrameMatrix3;\n  let iblReferenceFrameMatrix4 = scratchIBLReferenceFrameMatrix4;\n\n  iblReferenceFrameMatrix4 = Matrix4.multiply(\n    context.uniformState.view3D,\n    referenceMatrix,\n    iblReferenceFrameMatrix4,\n  );\n  iblReferenceFrameMatrix3 = Matrix4.getRotation(\n    iblReferenceFrameMatrix4,\n    iblReferenceFrameMatrix3,\n  );\n  iblReferenceFrameMatrix3 = Matrix3.transpose(\n    iblReferenceFrameMatrix3,\n    iblReferenceFrameMatrix3,\n  );\n  model._iblReferenceFrameMatrix = Matrix3.multiply(\n    yUpToZUp,\n    iblReferenceFrameMatrix3,\n    model._iblReferenceFrameMatrix,\n  );\n\n  if (model.isClippingEnabled()) {\n    let clippingPlanesMatrix = scratchClippingPlanesMatrix;\n    clippingPlanesMatrix = Matrix4.multiply(\n      context.uniformState.view3D,\n      referenceMatrix,\n      clippingPlanesMatrix,\n    );\n    clippingPlanesMatrix = Matrix4.multiply(\n      clippingPlanesMatrix,\n      model._clippingPlanes.modelMatrix,\n      clippingPlanesMatrix,\n    );\n    model._clippingPlanesMatrix = Matrix4.inverseTranspose(\n      clippingPlanesMatrix,\n      model._clippingPlanesMatrix,\n    );\n  }\n}\n\nfunction updateSceneGraph(model, frameState) {\n  const sceneGraph = model._sceneGraph;\n  if (model._updateModelMatrix || model._minimumPixelSize !== 0.0) {\n    const modelMatrix = defined(model._clampedModelMatrix)\n      ? model._clampedModelMatrix\n      : model.modelMatrix;\n    sceneGraph.updateModelMatrix(modelMatrix, frameState);\n    model._updateModelMatrix = false;\n  }\n\n  if (model._backFaceCullingDirty) {\n    sceneGraph.updateBackFaceCulling(model._backFaceCulling);\n    model._backFaceCullingDirty = false;\n  }\n\n  if (model._shadowsDirty) {\n    sceneGraph.updateShadows(model._shadows);\n    model._shadowsDirty = false;\n  }\n\n  if (model._debugShowBoundingVolumeDirty) {\n    sceneGraph.updateShowBoundingVolume(model._debugShowBoundingVolume);\n    model._debugShowBoundingVolumeDirty = false;\n  }\n\n  let updateForAnimations = false;\n  // Animations are disabled for classification models.\n  if (!defined(model.classificationType)) {\n    updateForAnimations =\n      model._userAnimationDirty || model._activeAnimations.update(frameState);\n  }\n  sceneGraph.update(frameState, updateForAnimations);\n  model._userAnimationDirty = false;\n}\n\nfunction updateShowCreditsOnScreen(model) {\n  if (!model._showCreditsOnScreenDirty) {\n    return;\n  }\n  model._showCreditsOnScreenDirty = false;\n  model._credits.length = 0;\n\n  const showOnScreen = model._showCreditsOnScreen;\n  if (defined(model._credit)) {\n    const credit = Credit.clone(model._credit);\n    credit.showOnScreen = credit.showOnScreen || showOnScreen;\n    model._credits.push(credit);\n  }\n\n  const resourceCredits = model._resourceCredits;\n  const resourceCreditsLength = resourceCredits.length;\n  for (let i = 0; i < resourceCreditsLength; i++) {\n    const credit = Credit.clone(resourceCredits[i]);\n    credit.showOnScreen = credit.showOnScreen || showOnScreen;\n    model._credits.push(credit);\n  }\n\n  const gltfCredits = model._gltfCredits;\n  const gltfCreditsLength = gltfCredits.length;\n  for (let i = 0; i < gltfCreditsLength; i++) {\n    const credit = Credit.clone(gltfCredits[i]);\n    credit.showOnScreen = credit.showOnScreen || showOnScreen;\n    model._credits.push(credit);\n  }\n}\n\nfunction submitDrawCommands(model, frameState) {\n  // Check that show is true after draw commands are built;\n  // we want the user to be able to instantly see the model\n  // when show is set to true.\n\n  const displayConditionPassed = passesDistanceDisplayCondition(\n    model,\n    frameState,\n  );\n\n  const invisible = model.isInvisible();\n  const silhouette = model.hasSilhouette(frameState);\n\n  // If the model is invisible but has a silhouette, it still\n  // needs to draw in order to write to the stencil buffer and\n  // render the silhouette.\n  const showModel =\n    model._show &&\n    model._computedScale !== 0 &&\n    displayConditionPassed &&\n    (!invisible || silhouette);\n\n  const passes = frameState.passes;\n  const submitCommandsForPass =\n    passes.render || (passes.pick && model.allowPicking);\n\n  if (showModel && !model._ignoreCommands && submitCommandsForPass) {\n    addCreditsToCreditDisplay(model, frameState);\n    model._sceneGraph.pushDrawCommands(frameState);\n  }\n}\n\nconst scratchBoundingSphere = new BoundingSphere();\n\nfunction scaleInPixels(positionWC, radius, frameState) {\n  scratchBoundingSphere.center = positionWC;\n  scratchBoundingSphere.radius = radius;\n  return frameState.camera.getPixelSize(\n    scratchBoundingSphere,\n    frameState.context.drawingBufferWidth,\n    frameState.context.drawingBufferHeight,\n  );\n}\n\nconst scratchUpdateHeightCartesian = new Cartesian3();\nfunction getUpdateHeightCallback(model, ellipsoid, originalPostition) {\n  return function (clampedPosition) {\n    if (isHeightReferenceRelative(model.heightReference)) {\n      clampedPosition.height += originalPostition.height;\n    }\n\n    ellipsoid.cartographicToCartesian(\n      clampedPosition,\n      scratchUpdateHeightCartesian,\n    );\n\n    const clampedModelMatrix = model._clampedModelMatrix;\n\n    // Modify clamped model matrix to use new height\n    Matrix4.clone(model.modelMatrix, clampedModelMatrix);\n    clampedModelMatrix[12] = scratchUpdateHeightCartesian.x;\n    clampedModelMatrix[13] = scratchUpdateHeightCartesian.y;\n    clampedModelMatrix[14] = scratchUpdateHeightCartesian.z;\n\n    model._heightDirty = true;\n  };\n}\n\nconst scratchDisplayConditionCartesian = new Cartesian3();\n\nfunction passesDistanceDisplayCondition(model, frameState) {\n  const condition = model.distanceDisplayCondition;\n  if (!defined(condition)) {\n    return true;\n  }\n\n  const nearSquared = condition.near * condition.near;\n  const farSquared = condition.far * condition.far;\n  let distanceSquared;\n\n  if (frameState.mode === SceneMode.SCENE2D) {\n    const frustum2DWidth =\n      frameState.camera.frustum.right - frameState.camera.frustum.left;\n    const distance = frustum2DWidth * 0.5;\n    distanceSquared = distance * distance;\n  } else {\n    // Distance to center of primitive's reference frame\n    const position = Matrix4.getTranslation(\n      model.modelMatrix,\n      scratchDisplayConditionCartesian,\n    );\n\n    // This will project the position if the scene is in Columbus View,\n    // but leave the position as-is in 3D mode.\n    SceneTransforms.computeActualEllipsoidPosition(\n      frameState,\n      position,\n      position,\n    );\n\n    distanceSquared = Cartesian3.distanceSquared(\n      position,\n      frameState.camera.positionWC,\n    );\n  }\n\n  return distanceSquared >= nearSquared && distanceSquared <= farSquared;\n}\n\nfunction addCreditsToCreditDisplay(model, frameState) {\n  const creditDisplay = frameState.creditDisplay;\n  const credits = model._credits;\n  const creditsLength = credits.length;\n  for (let c = 0; c < creditsLength; c++) {\n    creditDisplay.addCreditToNextFrame(credits[c]);\n  }\n}\n\n/**\n * Gets whether or not the model is translucent based on its assigned model color.\n * If the model color's alpha is equal to zero, then it is considered invisible,\n * not translucent.\n *\n * @returns {boolean} <code>true</code> if the model is translucent, otherwise <code>false</code>.\n * @private\n */\nModel.prototype.isTranslucent = function () {\n  const color = this.color;\n  return defined(color) && color.alpha > 0.0 && color.alpha < 1.0;\n};\n\n/**\n * Gets whether or not the model is invisible, i.e. if the model color's alpha\n * is equal to zero.\n *\n * @returns {boolean} <code>true</code> if the model is invisible, otherwise <code>false</code>.\n * @private\n */\nModel.prototype.isInvisible = function () {\n  const color = this.color;\n  return defined(color) && color.alpha === 0.0;\n};\n\nfunction supportsSilhouettes(frameState) {\n  return frameState.context.stencilBuffer;\n}\n\n/**\n * Gets whether or not the model has a silhouette. This accounts for whether\n * silhouettes are supported (i.e. the context supports stencil buffers).\n * <p>\n * If the model classifies another model, its silhouette will be disabled.\n * </p>\n *\n * @param {FrameState} The frame state.\n * @returns {boolean} <code>true</code> if the model has silhouettes, otherwise <code>false</code>.\n * @private\n */\nModel.prototype.hasSilhouette = function (frameState) {\n  return (\n    supportsSilhouettes(frameState) &&\n    this._silhouetteSize > 0.0 &&\n    this._silhouetteColor.alpha > 0.0 &&\n    !defined(this._classificationType)\n  );\n};\n\n/**\n * Gets whether or not the model is part of a tileset that uses the\n * skipLevelOfDetail optimization. This accounts for whether skipLevelOfDetail\n * is supported (i.e. the context supports stencil buffers).\n *\n * @param {FrameState} frameState The frame state.\n * @returns {boolean} <code>true</code> if the model is part of a tileset that uses the skipLevelOfDetail optimization, <code>false</code> otherwise.\n * @private\n */\nModel.prototype.hasSkipLevelOfDetail = function (frameState) {\n  if (!ModelType.is3DTiles(this.type)) {\n    return false;\n  }\n\n  const supportsSkipLevelOfDetail = frameState.context.stencilBuffer;\n  const tileset = this._content.tileset;\n  return supportsSkipLevelOfDetail && tileset.isSkippingLevelOfDetail;\n};\n\n/**\n * Gets whether or not clipping planes are enabled for this model.\n *\n * @returns {boolean} <code>true</code> if clipping planes are enabled for this model, <code>false</code>.\n * @private\n */\nModel.prototype.isClippingEnabled = function () {\n  const clippingPlanes = this._clippingPlanes;\n  return (\n    defined(clippingPlanes) &&\n    clippingPlanes.enabled &&\n    clippingPlanes.length !== 0\n  );\n};\n\n/**\n * Find an intersection between a ray and the model surface that was rendered. The ray must be given in world coordinates.\n *\n * @param {Ray} ray The ray to test for intersection.\n * @param {FrameState} frameState The frame state.\n * @param {number} [verticalExaggeration=1.0] A scalar used to exaggerate the height of a position relative to the ellipsoid. If the value is 1.0 there will be no effect.\n * @param {number} [relativeHeight=0.0] The height above the ellipsoid relative to which a position is exaggerated. If the value is 0.0 the position will be exaggerated relative to the ellipsoid surface.\n * @param {Cartesian3|undefined} [result] The intersection or <code>undefined</code> if none was found.\n * @returns {Cartesian3|undefined} The intersection or <code>undefined</code> if none was found.\n *\n * @private\n */\nModel.prototype.pick = function (\n  ray,\n  frameState,\n  verticalExaggeration,\n  relativeHeight,\n  result,\n) {\n  return pickModel(\n    this,\n    ray,\n    frameState,\n    verticalExaggeration,\n    relativeHeight,\n    result,\n  );\n};\n\n/**\n * Gets whether or not clipping polygons are enabled for this model.\n *\n * @returns {boolean} <code>true</code> if clipping polygons are enabled for this model, <code>false</code>.\n * @private\n */\nModel.prototype.isClippingPolygonsEnabled = function () {\n  const clippingPolygons = this._clippingPolygons;\n  return (\n    defined(clippingPolygons) &&\n    clippingPolygons.enabled &&\n    clippingPolygons.length !== 0\n  );\n};\n\n/**\n * Returns true if this object was destroyed; otherwise, false.\n * <br /><br />\n * If this object was destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.\n *\n * @returns {boolean} <code>true</code> if this object was destroyed; otherwise, <code>false</code>.\n *\n * @see Model#destroy\n */\nModel.prototype.isDestroyed = function () {\n  return false;\n};\n\n/**\n * Destroys the WebGL resources held by this object.  Destroying an object allows for deterministic\n * release of WebGL resources, instead of relying on the garbage collector to destroy this object.\n * <br /><br />\n * Once an object is destroyed, it should not be used; calling any function other than\n * <code>isDestroyed</code> will result in a {@link DeveloperError} exception.  Therefore,\n * assign the return value (<code>undefined</code>) to the object as done in the example.\n *\n * @exception {DeveloperError} This object was destroyed, i.e., destroy() was called.\n *\n *\n * @example\n * model = model && model.destroy();\n *\n * @see Model#isDestroyed\n */\nModel.prototype.destroy = function () {\n  const loader = this._loader;\n  if (defined(loader)) {\n    loader.destroy();\n  }\n\n  const featureTables = this._featureTables;\n  if (defined(featureTables)) {\n    const length = featureTables.length;\n    for (let i = 0; i < length; i++) {\n      featureTables[i].destroy();\n    }\n  }\n\n  this.destroyPipelineResources();\n  this.destroyModelResources();\n\n  // Remove callbacks for height reference behavior.\n  if (defined(this._removeUpdateHeightCallback)) {\n    this._removeUpdateHeightCallback();\n    this._removeUpdateHeightCallback = undefined;\n  }\n\n  if (defined(this._terrainProviderChangedCallback)) {\n    this._terrainProviderChangedCallback();\n    this._terrainProviderChangedCallback = undefined;\n  }\n\n  // Only destroy the ClippingPlaneCollection if this is the owner.\n  const clippingPlaneCollection = this._clippingPlanes;\n  if (\n    defined(clippingPlaneCollection) &&\n    !clippingPlaneCollection.isDestroyed() &&\n    clippingPlaneCollection.owner === this\n  ) {\n    clippingPlaneCollection.destroy();\n  }\n  this._clippingPlanes = undefined;\n\n  // Only destroy the ClippingPolygonCollection if this is the owner.\n  const clippingPolygonCollection = this._clippingPolygons;\n  if (\n    defined(clippingPolygonCollection) &&\n    !clippingPolygonCollection.isDestroyed() &&\n    clippingPolygonCollection.owner === this\n  ) {\n    clippingPolygonCollection.destroy();\n  }\n  this._clippingPolygons = undefined;\n\n  // Only destroy the ImageBasedLighting if this is the owner.\n  if (\n    this._shouldDestroyImageBasedLighting &&\n    !this._imageBasedLighting.isDestroyed()\n  ) {\n    this._imageBasedLighting.destroy();\n  }\n  this._imageBasedLighting = undefined;\n\n  // Only destroy the environment map manager if this is the owner.\n  const environmentMapManager = this._environmentMapManager;\n  if (\n    !environmentMapManager.isDestroyed() &&\n    environmentMapManager.owner === this\n  ) {\n    environmentMapManager.destroy();\n  }\n  this._environmentMapManager = undefined;\n\n  destroyObject(this);\n};\n\n/**\n * Destroys resources generated in the pipeline stages\n * that must be destroyed when draw commands are rebuilt.\n * @private\n */\nModel.prototype.destroyPipelineResources = function () {\n  const resources = this._pipelineResources;\n  for (let i = 0; i < resources.length; i++) {\n    resources[i].destroy();\n  }\n  this._pipelineResources.length = 0;\n  this._pickIds.length = 0;\n};\n\n/**\n * Destroys resources generated in the pipeline stages\n * that exist for the lifetime of the model.\n * @private\n */\nModel.prototype.destroyModelResources = function () {\n  const resources = this._modelResources;\n  for (let i = 0; i < resources.length; i++) {\n    resources[i].destroy();\n  }\n  this._modelResources.length = 0;\n};\n\n/**\n * <p>\n * Asynchronously creates a model from a glTF asset. This function returns a promise that resolves when the model is ready to render, i.e., when the external binary, image,\n * and shader files are downloaded and the WebGL resources are created.\n * </p>\n * <p>\n * The model can be a traditional glTF asset with a .gltf extension or a Binary glTF using the .glb extension.\n *\n * @param {object} options Object with the following properties:\n * @param {string|Resource} options.url The url to the .gltf or .glb file.\n * @param {string|Resource} [options.basePath=''] The base path that paths in the glTF JSON are relative to.\n * @param {boolean} [options.show=true] Whether or not to render the model.\n * @param {Matrix4} [options.modelMatrix=Matrix4.IDENTITY] The 4x4 transformation matrix that transforms the model from model to world coordinates.\n * @param {number} [options.scale=1.0] A uniform scale applied to this model.\n * @param {boolean} [options.enableVerticalExaggeration=true] If <code>true</code>, the model is exaggerated along the ellipsoid normal when {@link Scene.verticalExaggeration} is set to a value other than <code>1.0</code>.\n * @param {number} [options.minimumPixelSize=0.0] The approximate minimum pixel size of the model regardless of zoom.\n * @param {number} [options.maximumScale] The maximum scale size of a model. An upper limit for minimumPixelSize.\n * @param {object} [options.id] A user-defined object to return when the model is picked with {@link Scene#pick}.\n * @param {boolean} [options.allowPicking=true] When <code>true</code>, each primitive is pickable with {@link Scene#pick}.\n * @param {boolean} [options.incrementallyLoadTextures=true] Determine if textures may continue to stream in after the model is loaded.\n * @param {boolean} [options.asynchronous=true] Determines if model WebGL resource creation will be spread out over several frames or block until completion once all glTF files are loaded.\n * @param {boolean} [options.clampAnimations=true] Determines if the model's animations should hold a pose over frames where no keyframes are specified.\n * @param {ShadowMode} [options.shadows=ShadowMode.ENABLED] Determines whether the model casts or receives shadows from light sources.\n * @param {boolean} [options.releaseGltfJson=false] When true, the glTF JSON is released once the glTF is loaded. This is is especially useful for cases like 3D Tiles, where each .gltf model is unique and caching the glTF JSON is not effective.\n * @param {boolean} [options.debugShowBoundingVolume=false] For debugging only. Draws the bounding sphere for each draw command in the model.\n * @param {boolean} [options.enableDebugWireframe=false] For debugging only. This must be set to true for debugWireframe to work in WebGL1. This cannot be set after the model has loaded.\n * @param {boolean} [options.debugWireframe=false] For debugging only. Draws the model in wireframe. Will only work for WebGL1 if enableDebugWireframe is set to true.\n * @param {boolean} [options.cull=true]  Whether or not to cull the model using frustum/horizon culling. If the model is part of a 3D Tiles tileset, this property will always be false, since the 3D Tiles culling system is used.\n * @param {boolean} [options.opaquePass=Pass.OPAQUE] The pass to use in the {@link DrawCommand} for the opaque portions of the model.\n * @param {Axis} [options.upAxis=Axis.Y] The up-axis of the glTF model.\n * @param {Axis} [options.forwardAxis=Axis.Z] The forward-axis of the glTF model.\n * @param {CustomShader} [options.customShader] A custom shader. This will add user-defined GLSL code to the vertex and fragment shaders. Using custom shaders with a {@link Cesium3DTileStyle} may lead to undefined behavior.\n * @param {Cesium3DTileContent} [options.content] The tile content this model belongs to. This property will be undefined if model is not loaded as part of a tileset.\n * @param {HeightReference} [options.heightReference=HeightReference.NONE] Determines how the model is drawn relative to terrain.\n * @param {Scene} [options.scene] Must be passed in for models that use the height reference property.\n * @param {DistanceDisplayCondition} [options.distanceDisplayCondition] The condition specifying at what distance from the camera that this model will be displayed.\n * @param {Color} [options.color] A color that blends with the model's rendered color.\n * @param {ColorBlendMode} [options.colorBlendMode=ColorBlendMode.HIGHLIGHT] Defines how the color blends with the model.\n * @param {number} [options.colorBlendAmount=0.5] Value used to determine the color strength when the <code>colorBlendMode</code> is <code>MIX</code>. A value of 0.0 results in the model's rendered color while a value of 1.0 results in a solid color, with any value in-between resulting in a mix of the two.\n * @param {Color} [options.silhouetteColor=Color.RED] The silhouette color. If more than 256 models have silhouettes enabled, there is a small chance that overlapping models will have minor artifacts.\n * @param {number} [options.silhouetteSize=0.0] The size of the silhouette in pixels.\n * @param {boolean} [options.enableShowOutline=true] Whether to enable outlines for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. This can be set false to avoid post-processing geometry at load time. When false, the showOutlines and outlineColor options are ignored.\n * @param {boolean} [options.showOutline=true] Whether to display the outline for models using the {@link https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/CESIUM_primitive_outline|CESIUM_primitive_outline} extension. When true, outlines are displayed. When false, outlines are not displayed.\n * @param {Color} [options.outlineColor=Color.BLACK] The color to use when rendering outlines.\n * @param {ClippingPlaneCollection} [options.clippingPlanes] The {@link ClippingPlaneCollection} used to selectively disable rendering the model.\n * @param {ClippingPolygonCollection} [options.clippingPolygons] The {@link ClippingPolygonCollection} used to selectively disable rendering the model.\n * @param {Cartesian3} [options.lightColor] The light color when shading the model. When <code>undefined</code> the scene's light color is used instead.\n * @param {ImageBasedLighting} [options.imageBasedLighting] The properties for managing image-based lighting on this model.\n * @param {DynamicEnvironmentMapManager.ConstructorOptions} [options.environmentMapOptions] The properties for managing dynamic environment maps on this model.\n * @param {boolean} [options.backFaceCulling=true] Whether to cull back-facing geometry. When true, back face culling is determined by the material's doubleSided property; when false, back face culling is disabled. Back faces are not culled if the model's color is translucent.\n * @param {Credit|string} [options.credit] A credit for the data source, which is displayed on the canvas.\n * @param {boolean} [options.showCreditsOnScreen=false] Whether to display the credits of this model on screen.\n * @param {SplitDirection} [options.splitDirection=SplitDirection.NONE] The {@link SplitDirection} split to apply to this model.\n * @param {boolean} [options.projectTo2D=false] Whether to accurately project the model's positions in 2D. If this is true, the model will be projected accurately to 2D, but it will use more memory to do so. If this is false, the model will use less memory and will still render in 2D / CV mode, but its positions may be inaccurate. This disables minimumPixelSize and prevents future modification to the model matrix. This also cannot be set after the model has loaded.\n * @param {boolean} [options.enablePick=false] Whether to allow with CPU picking with <code>pick</code> when not using WebGL 2 or above. If using WebGL 2 or above, this option will be ignored. If using WebGL 1 and this is true, the <code>pick</code> operation will work correctly, but it will use more memory to do so. If running with WebGL 1 and this is false, the model will use less memory, but <code>pick</code> will always return <code>undefined</code>. This cannot be set after the model has loaded.\n * @param {string|number} [options.featureIdLabel=\"featureId_0\"] Label of the feature ID set to use for picking and styling. For EXT_mesh_features, this is the feature ID's label property, or \"featureId_N\" (where N is the index in the featureIds array) when not specified. EXT_feature_metadata did not have a label field, so such feature ID sets are always labeled \"featureId_N\" where N is the index in the list of all feature Ids, where feature ID attributes are listed before feature ID textures. If featureIdLabel is an integer N, it is converted to the string \"featureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @param {string|number} [options.instanceFeatureIdLabel=\"instanceFeatureId_0\"] Label of the instance feature ID set used for picking and styling. If instanceFeatureIdLabel is set to an integer N, it is converted to the string \"instanceFeatureId_N\" automatically. If both per-primitive and per-instance feature IDs are present, the instance feature IDs take priority.\n * @param {object} [options.pointCloudShading] Options for constructing a {@link PointCloudShading} object to control point attenuation and lighting.\n * @param {ClassificationType} [options.classificationType] Determines whether terrain, 3D Tiles or both will be classified by this model. This cannot be set after the model has loaded.\n * @param {Model.GltfCallback} [options.gltfCallback] A function that is called with the loaded gltf object once loaded.\n *\n * @returns {Promise<Model>} A promise that resolves to the created model when it is ready to render.\n *\n * @exception {RuntimeError} The model failed to load.\n * @exception {RuntimeError} Unsupported glTF version.\n * @exception {RuntimeError} Unsupported glTF Extension\n *\n * @example\n * // Load a model and add it to the scene\n * try {\n *  const model = await Cesium.Model.fromGltfAsync({\n *    url: \"../../SampleData/models/CesiumMan/Cesium_Man.glb\"\n *  });\n *  viewer.scene.primitives.add(model);\n * } catch (error) {\n *  console.log(`Failed to load model. ${error}`);\n * }\n *\n * @example\n * // Position a model with modelMatrix and display it with a minimum size of 128 pixels\n * const position = Cesium.Cartesian3.fromDegrees(\n *   -123.0744619,\n *   44.0503706,\n *   5000.0\n * );\n * const headingPositionRoll = new Cesium.HeadingPitchRoll();\n * const fixedFrameTransform = Cesium.Transforms.localFrameToFixedFrameGenerator(\n *   \"north\",\n *   \"west\"\n * );\n * try {\n *  const model = await Cesium.Model.fromGltfAsync({\n *    url: \"../../SampleData/models/CesiumAir/Cesium_Air.glb\",\n *    modelMatrix: Cesium.Transforms.headingPitchRollToFixedFrame(\n *      position,\n *      headingPositionRoll,\n *      Cesium.Ellipsoid.WGS84,\n *      fixedFrameTransform\n *    ),\n *    minimumPixelSize: 128,\n *  });\n *  viewer.scene.primitives.add(model);\n * } catch (error) {\n *  console.log(`Failed to load model. ${error}`);\n * }\n *\n * @example\n * // Load a model and play the last animation at half speed\n * let animations;\n * try {\n *  const model = await Cesium.Model.fromGltfAsync({\n *    url: \"../../SampleData/models/CesiumMan/Cesium_Man.glb\",\n *    gltfCallback: gltf => {\n *      animations = gltf.animations\n *    }\n *  });\n *  viewer.scene.primitives.add(model);\n *  model.readyEvent.addEventListener(() => {\n *    model.activeAnimations.add({\n *      index: animations.length - 1,\n *      loop: Cesium.ModelAnimationLoop.REPEAT,\n *      multiplier: 0.5,\n *    });\n *  });\n * } catch (error) {\n *  console.log(`Failed to load model. ${error}`);\n * }\n */\nModel.fromGltfAsync = async function (options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n\n  //>>includeStart('debug', pragmas.debug);\n  if (!defined(options.url) && !defined(options.gltf)) {\n    throw new DeveloperError(\"options.url is required.\");\n  }\n  //>>includeEnd('debug');\n\n  // options.gltf is used internally for 3D Tiles. It can be a Resource, a URL\n  // to a glTF/glb file, a binary glTF buffer, or a JSON object containing the\n  // glTF contents.\n  const gltf = defaultValue(options.url, options.gltf);\n\n  const loaderOptions = {\n    releaseGltfJson: options.releaseGltfJson,\n    asynchronous: options.asynchronous,\n    incrementallyLoadTextures: options.incrementallyLoadTextures,\n    upAxis: options.upAxis,\n    forwardAxis: options.forwardAxis,\n    loadAttributesFor2D: options.projectTo2D,\n    enablePick: options.enablePick,\n    loadIndicesForWireframe: options.enableDebugWireframe,\n    loadPrimitiveOutline: options.enableShowOutline,\n    loadForClassification: defined(options.classificationType),\n  };\n\n  const basePath = defaultValue(options.basePath, \"\");\n  const baseResource = Resource.createIfNeeded(basePath);\n\n  if (defined(gltf.asset)) {\n    loaderOptions.gltfJson = gltf;\n    loaderOptions.baseResource = baseResource;\n    loaderOptions.gltfResource = baseResource;\n  } else if (gltf instanceof Uint8Array) {\n    loaderOptions.typedArray = gltf;\n    loaderOptions.baseResource = baseResource;\n    loaderOptions.gltfResource = baseResource;\n  } else {\n    loaderOptions.gltfResource = Resource.createIfNeeded(gltf);\n  }\n\n  const loader = new GltfLoader(loaderOptions);\n\n  const is3DTiles = defined(options.content);\n  const type = is3DTiles ? ModelType.TILE_GLTF : ModelType.GLTF;\n\n  const resource = loaderOptions.gltfResource;\n\n  const modelOptions = makeModelOptions(loader, type, options);\n  modelOptions.resource = resource;\n  modelOptions.environmentMapOptions = options.environmentMapOptions;\n\n  try {\n    // This load the gltf JSON and ensures the gltf is valid\n    // Further resource loading is handled synchronously in loader.process(), and requires\n    // hooking into model's update() as the frameState is needed\n    await loader.load();\n  } catch (error) {\n    loader.destroy();\n    throw ModelUtility.getError(\"model\", resource, error);\n  }\n\n  const gltfCallback = options.gltfCallback;\n  if (defined(gltfCallback)) {\n    //>>includeStart('debug', pragmas.debug);\n    Check.typeOf.func(\"options.gltfCallback\", gltfCallback);\n    //>>includeEnd('debug');\n\n    gltfCallback(loader.gltfJson);\n  }\n\n  const model = new Model(modelOptions);\n\n  const resourceCredits = model._resource.credits;\n  if (defined(resourceCredits)) {\n    const length = resourceCredits.length;\n    for (let i = 0; i < length; i++) {\n      model._resourceCredits.push(Credit.clone(resourceCredits[i]));\n    }\n  }\n\n  return model;\n};\n\n/*\n * @private\n */\nModel.fromB3dm = async function (options) {\n  const loaderOptions = {\n    b3dmResource: options.resource,\n    arrayBuffer: options.arrayBuffer,\n    byteOffset: options.byteOffset,\n    releaseGltfJson: options.releaseGltfJson,\n    asynchronous: options.asynchronous,\n    incrementallyLoadTextures: options.incrementallyLoadTextures,\n    upAxis: options.upAxis,\n    forwardAxis: options.forwardAxis,\n    loadAttributesFor2D: options.projectTo2D,\n    enablePick: options.enablePick,\n    loadIndicesForWireframe: options.enableDebugWireframe,\n    loadPrimitiveOutline: options.enableShowOutline,\n    loadForClassification: defined(options.classificationType),\n  };\n\n  const loader = new B3dmLoader(loaderOptions);\n\n  try {\n    await loader.load();\n\n    const modelOptions = makeModelOptions(loader, ModelType.TILE_B3DM, options);\n    const model = new Model(modelOptions);\n    return model;\n  } catch (error) {\n    loader.destroy();\n    throw error;\n  }\n};\n\n/**\n * @private\n */\nModel.fromPnts = async function (options) {\n  const loaderOptions = {\n    arrayBuffer: options.arrayBuffer,\n    byteOffset: options.byteOffset,\n    loadAttributesFor2D: options.projectTo2D,\n  };\n  const loader = new PntsLoader(loaderOptions);\n\n  try {\n    await loader.load();\n    const modelOptions = makeModelOptions(loader, ModelType.TILE_PNTS, options);\n    const model = new Model(modelOptions);\n    return model;\n  } catch (error) {\n    loader.destroy();\n    throw error;\n  }\n};\n\n/*\n * @private\n */\nModel.fromI3dm = async function (options) {\n  const loaderOptions = {\n    i3dmResource: options.resource,\n    arrayBuffer: options.arrayBuffer,\n    byteOffset: options.byteOffset,\n    releaseGltfJson: options.releaseGltfJson,\n    asynchronous: options.asynchronous,\n    incrementallyLoadTextures: options.incrementallyLoadTextures,\n    upAxis: options.upAxis,\n    forwardAxis: options.forwardAxis,\n    loadAttributesFor2D: options.projectTo2D,\n    enablePick: options.enablePick,\n    loadIndicesForWireframe: options.enableDebugWireframe,\n    loadPrimitiveOutline: options.enableShowOutline,\n  };\n  const loader = new I3dmLoader(loaderOptions);\n\n  try {\n    await loader.load();\n\n    const modelOptions = makeModelOptions(loader, ModelType.TILE_I3DM, options);\n    const model = new Model(modelOptions);\n    return model;\n  } catch (error) {\n    loader.destroy();\n    throw error;\n  }\n};\n\n/*\n * @private\n */\nModel.fromGeoJson = async function (options) {\n  const loaderOptions = {\n    geoJson: options.geoJson,\n  };\n  const loader = new GeoJsonLoader(loaderOptions);\n  const modelOptions = makeModelOptions(\n    loader,\n    ModelType.TILE_GEOJSON,\n    options,\n  );\n  const model = new Model(modelOptions);\n  return model;\n};\n\nconst scratchColor = new Color();\n\n/**\n * @private\n */\nModel.prototype.applyColorAndShow = function (style) {\n  const previousColor = Color.clone(this._color, scratchColor);\n  const hasColorStyle = defined(style) && defined(style.color);\n  const hasShowStyle = defined(style) && defined(style.show);\n\n  this._color = hasColorStyle\n    ? style.color.evaluateColor(undefined, this._color)\n    : Color.clone(Color.WHITE, this._color);\n  this._show = hasShowStyle ? style.show.evaluate(undefined) : true;\n\n  if (isColorAlphaDirty(previousColor, this._color)) {\n    this.resetDrawCommands();\n  }\n};\n\n/**\n * @private\n */\nModel.prototype.applyStyle = function (style) {\n  const isPnts = this.type === ModelType.TILE_PNTS;\n\n  const hasFeatureTable =\n    defined(this.featureTableId) &&\n    this.featureTables[this.featureTableId].featuresLength > 0;\n\n  const propertyAttributes = defined(this.structuralMetadata)\n    ? this.structuralMetadata.propertyAttributes\n    : undefined;\n  const hasPropertyAttributes =\n    defined(propertyAttributes) && defined(propertyAttributes[0]);\n\n  // Point clouds will be styled on the GPU unless they contain a batch table.\n  // That is, CPU styling will not be applied if:\n  // - points have no metadata at all, or\n  // - points have metadata stored as a property attribute\n  if (isPnts && (!hasFeatureTable || hasPropertyAttributes)) {\n    // Commands are rebuilt for point cloud styling since the new style may\n    // contain different shader functions.\n    this.resetDrawCommands();\n    return;\n  }\n\n  // The style is only set by the ModelFeatureTable. If there are no features,\n  // the color and show from the style are directly applied.\n  if (hasFeatureTable) {\n    const featureTable = this.featureTables[this.featureTableId];\n    featureTable.applyStyle(style);\n    updateStyleCommandsNeeded(this, style);\n  } else {\n    this.applyColorAndShow(style);\n    this._styleCommandsNeeded = undefined;\n  }\n};\n\nfunction makeModelOptions(loader, modelType, options) {\n  return {\n    loader: loader,\n    type: modelType,\n    resource: options.resource,\n    show: options.show,\n    modelMatrix: options.modelMatrix,\n    scale: options.scale,\n    enableVerticalExaggeration: options.enableVerticalExaggeration,\n    minimumPixelSize: options.minimumPixelSize,\n    maximumScale: options.maximumScale,\n    id: options.id,\n    allowPicking: options.allowPicking,\n    clampAnimations: options.clampAnimations,\n    shadows: options.shadows,\n    debugShowBoundingVolume: options.debugShowBoundingVolume,\n    enableDebugWireframe: options.enableDebugWireframe,\n    debugWireframe: options.debugWireframe,\n    cull: options.cull,\n    opaquePass: options.opaquePass,\n    customShader: options.customShader,\n    content: options.content,\n    heightReference: options.heightReference,\n    scene: options.scene,\n    distanceDisplayCondition: options.distanceDisplayCondition,\n    color: options.color,\n    colorBlendAmount: options.colorBlendAmount,\n    colorBlendMode: options.colorBlendMode,\n    silhouetteColor: options.silhouetteColor,\n    silhouetteSize: options.silhouetteSize,\n    enableShowOutline: options.enableShowOutline,\n    showOutline: options.showOutline,\n    outlineColor: options.outlineColor,\n    clippingPlanes: options.clippingPlanes,\n    clippingPolygons: options.clippingPolygons,\n    lightColor: options.lightColor,\n    imageBasedLighting: options.imageBasedLighting,\n    backFaceCulling: options.backFaceCulling,\n    credit: options.credit,\n    showCreditsOnScreen: options.showCreditsOnScreen,\n    splitDirection: options.splitDirection,\n    projectTo2D: options.projectTo2D,\n    enablePick: options.enablePick,\n    featureIdLabel: options.featureIdLabel,\n    instanceFeatureIdLabel: options.instanceFeatureIdLabel,\n    pointCloudShading: options.pointCloudShading,\n    classificationType: options.classificationType,\n    pickObject: options.pickObject,\n  };\n}\n\n/**\n * Interface for the function that is called with the loaded gltf object once loaded.\n * @callback Model.GltfCallback\n *\n * @param {object} gltf The gltf object\n */\n\nexport default Model;\n"],"mappings":"AAAA,OAAOA,cAAc,MAAM,8BAA8B;AACzD,OAAOC,UAAU,MAAM,0BAA0B;AACjD,OAAOC,YAAY,MAAM,4BAA4B;AACrD,OAAOC,KAAK,MAAM,qBAAqB;AACvC,OAAOC,MAAM,MAAM,sBAAsB;AACzC,OAAOC,KAAK,MAAM,qBAAqB;AACvC,OAAOC,OAAO,MAAM,uBAAuB;AAC3C,OAAOC,YAAY,MAAM,4BAA4B;AACrD,OAAOC,cAAc,MAAM,8BAA8B;AACzD,OAAOC,aAAa,MAAM,6BAA6B;AACvD,OAAOC,wBAAwB,MAAM,wCAAwC;AAC7E,OAAOC,SAAS,MAAM,yBAAyB;AAC/C,OAAOC,KAAK,MAAM,qBAAqB;AACvC,OAAOC,OAAO,MAAM,uBAAuB;AAC3C,OAAOC,OAAO,MAAM,uBAAuB;AAC3C,OAAOC,QAAQ,MAAM,wBAAwB;AAC7C,OAAOC,YAAY,MAAM,4BAA4B;AACrD,OAAOC,IAAI,MAAM,wBAAwB;AACzC,OAAOC,uBAAuB,MAAM,+BAA+B;AACnE,OAAOC,yBAAyB,MAAM,iCAAiC;AACvE,OAAOC,4BAA4B,MAAM,oCAAoC;AAC7E,OAAOC,cAAc,MAAM,sBAAsB;AACjD,OAAOC,UAAU,MAAM,kBAAkB;AACzC,OAAOC,eAAe,IACpBC,yBAAyB,QACpB,uBAAuB;AAC9B,OAAOC,kBAAkB,MAAM,0BAA0B;AACzD,OAAOC,iBAAiB,MAAM,yBAAyB;AACvD,OAAOC,SAAS,MAAM,iBAAiB;AACvC,OAAOC,eAAe,MAAM,uBAAuB;AACnD,OAAOC,UAAU,MAAM,kBAAkB;AACzC,OAAOC,cAAc,MAAM,sBAAsB;AACjD,OAAOC,UAAU,MAAM,iBAAiB;AACxC,OAAOC,aAAa,MAAM,oBAAoB;AAC9C,OAAOC,UAAU,MAAM,iBAAiB;AACxC,OAAOC,wBAAwB,MAAM,+BAA+B;AACpE,OAAOC,iBAAiB,MAAM,wBAAwB;AACtD,OAAOC,eAAe,MAAM,sBAAsB;AAClD,OAAOC,eAAe,MAAM,sBAAsB;AAClD,OAAOC,SAAS,MAAM,gBAAgB;AACtC,OAAOC,YAAY,MAAM,mBAAmB;AAC5C,OAAOC,cAAc,MAAM,8BAA8B;AACzD,OAAOC,UAAU,MAAM,iBAAiB;AACxC,OAAOC,mBAAmB,MAAM,0BAA0B;AAC1D,OAAOC,SAAS,MAAM,gBAAgB;;AAEtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,KAAKA,CAACC,OAAO,EAAE;EACtBA,OAAO,GAAGtC,YAAY,CAACsC,OAAO,EAAEtC,YAAY,CAACuC,YAAY,CAAC;EAC1D;EACA3C,KAAK,CAAC4C,MAAM,CAACC,MAAM,CAAC,gBAAgB,EAAEH,OAAO,CAACI,MAAM,CAAC;EACrD9C,KAAK,CAAC4C,MAAM,CAACC,MAAM,CAAC,kBAAkB,EAAEH,OAAO,CAACK,QAAQ,CAAC;EACzD;;EAEA;AACF;AACA;AACA;AACA;AACA;EACE,IAAI,CAACC,OAAO,GAAGN,OAAO,CAACI,MAAM;EAC7B,IAAI,CAACG,SAAS,GAAGP,OAAO,CAACK,QAAQ;;EAEjC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAI,CAACG,IAAI,GAAG9C,YAAY,CAACsC,OAAO,CAACQ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A;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAnL,KAAK,CAACsa,aAAa,GAAG,gBAAgBra,OAAO,EAAE;EAC7CA,OAAO,GAAGtC,YAAY,CAACsC,OAAO,EAAEtC,YAAY,CAACuC,YAAY,CAAC;;EAE1D;EACA,IAAI,CAACxC,OAAO,CAACuC,OAAO,CAACsa,GAAG,CAAC,IAAI,CAAC7c,OAAO,CAACuC,OAAO,CAACua,IAAI,CAAC,EAAE;IACnD,MAAM,IAAI5c,cAAc,CAAC,0BAA0B,CAAC;EACtD;EACA;;EAEA;EACA;EACA;EACA,MAAM4c,IAAI,GAAG7c,YAAY,CAACsC,OAAO,CAACsa,GAAG,EAAEta,OAAO,CAACua,IAAI,CAAC;EAEpD,MAAMC,aAAa,GAAG;IACpBC,eAAe,EAAEza,OAAO,CAACya,eAAe;IACxCC,YAAY,EAAE1a,OAAO,CAAC0a,YAAY;IAClCxN,yBAAyB,EAAElN,OAAO,CAACkN,yBAAyB;IAC5DyN,MAAM,EAAE3a,OAAO,CAAC2a,MAAM;IACtBC,WAAW,EAAE5a,OAAO,CAAC4a,WAAW;IAChCC,mBAAmB,EAAE7a,OAAO,CAAC0J,WAAW;IACxCE,UAAU,EAAE5J,OAAO,CAAC4J,UAAU;IAC9BkR,uBAAuB,EAAE9a,OAAO,CAACmI,oBAAoB;IACrD4S,oBAAoB,EAAE/a,OAAO,CAACqI,iBAAiB;IAC/C2S,qBAAqB,EAAEvd,OAAO,CAACuC,OAAO,CAACsJ,kBAAkB;EAC3D,CAAC;EAED,MAAM2R,QAAQ,GAAGvd,YAAY,CAACs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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}